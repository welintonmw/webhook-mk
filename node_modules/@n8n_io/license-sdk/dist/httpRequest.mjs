import{fetch as h,getGlobalDispatcher as y,setGlobalDispatcher as l,Dispatcher as u,ProxyAgent as g}from"undici";import{URL as x}from"url";function i(t){let o=process.env[t];return o?new g(o):null}var p=i("http_proxy_license_server")||i("http_proxy"),a=i("https_proxy_license_server")||i("https_proxy"),m={...p?{"http:":p}:{},...a?{"https:":a}:{}},f=(process.env.no_proxy??"").split(",").map(t=>t.trim()),d=y();l(new class extends u{dispatch(t,o){if(t.origin){let{host:r,protocol:e}=typeof t.origin=="string"?new x(t.origin):t.origin;if(!f.some(s=>s.startsWith(".")?r.endsWith(s):r===s)){let s=m[e];s&&s.dispatch(t,o)}}return d.dispatch(t,o)}});async function _(t,o,r={}){let e=new AbortController,s=setTimeout(()=>{e.abort()},r.timeoutInMs??3e4);try{let n=await h(t,{method:"post",body:JSON.stringify(o),headers:{"Content-Type":"application/json"},signal:e.signal}),c=await n.json();return{status:n.status,data:c}}catch(n){throw new Error("Connection Error",{cause:n})}finally{clearTimeout(s)}}var A={postRequest:_};export{A as default,_ as postRequest};
//# sourceMappingURL=httpRequest.mjs.map