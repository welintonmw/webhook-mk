var qe={ACTION:"action",DESCRIPTION:"description",DURATION:"duration",REPEAT:"repeat",SUMMARY:"summary",TRIGGER:"trigger",ATTACH:"attachment",ATTENDEE:"attendee"},Je={action:"ACTION",description:"DESCRIPTION",duration:"DURATION",repeat:"REPEAT",summary:"SUMMARY",trigger:"TRIGGER",attachment:"ATTACH",attendee:"ATTENDEE"};import ct from"lodash/compact";var Ge={METHOD:"method",PRODID:"prodId",VERSION:"version"},Qe={method:"METHOD",prodId:"PRODID",version:"VERSION"};var Oe="BEGIN",xe="END",Xe="VCALENDAR",Ae="VTIMEZONE",Ie="STANDARD",Ve="DAYLIGHT",Ne="VEVENT",Se="VALARM";var Q=e=>new RegExp(`${Oe}:${e}([\\s\\S]*?)${xe}:${e}`,"g"),ze=Q(Ae),Me=Q(Ie),he=Q(Ve),Ke=Q(Ne),Ye=Q(Se),U=e=>new RegExp(`${Oe}:${e}|${xe}:${e}`,"g"),et=U(Xe),tt=U(Ae),rt=U(Ie),nt=U(Ve),ot=U(Ne),st=U(Se);var ne=/\r\n|\r|\n/,oe=`\r
`,it=":",W=",",at='"',j=";";var X="=";var se=e=>`${e}${oe}`,m=(e,t,n)=>n?t==null?"":se(`${e};${n}:${t}`):se(`${e}:${t}`),D=e=>se(`BEGIN:${e}`),O=e=>se(`END:${e}`);var R=e=>{if(!(e.length<1))return`${e.map(t=>`${t.key}${X}${t.value}`).join(j)}`};var pt=e=>{if(e.type==="uri"){let t=R(ct([e.formatType&&{key:"FMTTYPE",value:e.formatType}]));return m("ATTACH",e.url,t)}if(e.type==="binary"){let t=R(ct([e.value&&{key:"VALUE",value:e.value},e.encoding&&{key:"ENCODING",value:e.encoding}]));return m("ATTACH",e.binary,t)}throw Error(`Attachment has no type! ${JSON.stringify(e)}`)};import er from"lodash/compact";var z=(e,t)=>t?`"MAILTO:${e}"`:`MAILTO:${e}`;var ie=(e,t)=>{let n=R(er([e.dir&&{key:"DIR",value:`"${e.dir}"`},e.delegatedFrom&&{key:"DELEGATED-FROM",value:z(e.delegatedFrom,!0)},e.member&&{key:"MEMBER",value:z(e.member,!0)},e.role&&{key:"ROLE",value:e.role},e.name&&{key:"CN",value:e.name},e.partstat&&{key:"PARTSTAT",value:e.partstat},e.role&&{key:"ROLE",value:e.role},e.sentBy&&{key:"SENT-BY",value:z(e.sentBy,!0)}]));return m(t,z(e.email),n)};var Z=e=>{let t="";return e.before&&(t+="-"),t+="P",e.weeks&&(t+=`${e.weeks}W`),e.days&&(t+=`${e.days}D`),(e.hours||e.minutes||e.seconds)&&(t+="T",e.hours&&(t+=`${e.hours}H`),e.minutes&&(t+=`${e.minutes}M`),e.seconds&&(t+=`${e.seconds}S`)),t};import rr from"lodash/compact";import tr from"lodash/compact";import mt from"lodash/isDate";var yt=e=>{if(!mt(e))throw Error(`Incorrect date object: ${e}`);let t=e.toISOString(),n=t.slice(0,4),r=t.slice(5,7),o=t.slice(8,10);return`${n}${r}${o}`},H=e=>{if(!mt(e))throw Error(`Incorrect date object: ${e}`);let t=e.toISOString(),n=t.slice(0,4),r=t.slice(5,7),o=t.slice(8,10),s=t.slice(11,13),i=t.slice(14,16),a=t.slice(17,19);return`${n}${r}${o}T${s}${i}${a}Z`};var M=(e,t)=>{var o;let n=t.type==="DATE"?yt(t.date):H(((o=t.local)==null?void 0:o.date)||t.date),r=R(tr([t.type&&{key:"VALUE",value:t.type},t.local&&{key:"TZID",value:t.local.timezone}]));return m(e,n,r)};var ut=e=>{var n;let t=R(rr([((n=e.options)==null?void 0:n.related)&&{key:"RELATED",value:e.options.related}]));if(e.type==="absolute")return M("TRIGGER",e.value);if(e.type==="relative")return m("TRIGGER",Z(e.value),t)};var x=e=>Object.keys(e);var Tt=e=>{let t=x(e),n="";return n+=D("VALARM"),t.forEach(r=>{if(r==="attachments"||r==="attendees")return;let o=Je[r];if(!o)return;let s=e[r];if(s&&s!=null){if(r==="trigger"){n+=ut(s);return}if(r==="duration"){n+=m(o,Z(s));return}if(r==="repeat"){n+=m(o,s==null?void 0:s.toString());return}n+=m(o,String(s))}}),e.attachments&&e.attachments.length>0&&e.attachments.forEach(r=>{n+=pt(r)}),e.attendees&&e.attendees.length>0&&e.attendees.forEach(r=>{n+=ie(r,"ATTENDEE")}),n+=O("VALARM"),n};var ft={"LAST-MODIFIED":"lastModified",ALARM:"alarm",CATEGORIES:"categories",CREATED:"created",DESCRIPTION:"description",DTSTAMP:"stamp",DTSTART:"start",LOCATION:"location",EXDATE:"exceptionDates",RRULE:"recurrenceRule",SUMMARY:"summary",UID:"uid",TRANSP:"timeTransparent",URL:"url",DTEND:"end",DURATION:"duration",GEO:"geo",CLASS:"class",ORGANIZER:"organizer",PRIORITY:"priority",SEQ:"sequence",STATUS:"status",ATTACH:"attach","RECURRENCE-ID":"recurrenceId",ATTENDEE:"attendee",COMMENT:"comment"},lt={alarm:"ALARM",categories:"CATEGORIES",created:"CREATED",description:"DESCRIPTION",lastModified:"LAST-MODIFIED",location:"LOCATION",exceptionDates:"EXDATE",recurrenceRule:"RRULE",stamp:"DTSTAMP",start:"DTSTART",summary:"SUMMARY",uid:"UID",timeTransparent:"TRANSP",url:"URL",end:"DTEND",duration:"DURATION",geo:"GEO",class:"CLASS",organizer:"ORGANIZER",priority:"PRIORITY",sequence:"SEQ",status:"STATUS",attach:"ATTACH",recurrenceId:"RECURRENCE-ID",attendee:"ATTENDEE",comment:"COMMENT"};var nr=["stamp","start","end","created","lastModified"],ae=e=>nr.includes(e),or=["categories"],ce=e=>or.includes(e);var Et=(e,t)=>M(t,e);import sr from"lodash/compact";var gt=e=>{let t=R(sr([e.dir&&{key:"DIR",value:`"${e.dir}"`},e.name&&{key:"CN",value:e.name},e.sentBy&&{key:"SENT-BY",value:z(e.sentBy)}]));return m("ORGANIZER",z(e.email),t)};import dt from"lodash/compact";var Rt=e=>e.occurence?`${e.occurence}${e.day}`:e.day;var pe=e=>{let t="",n=R(dt([e.byDay&&{key:"BYDAY",value:e.byDay.map(r=>Rt(r)).join(",")},e.byHour&&{key:"BYHOUR",value:e.byHour.join(",")},e.byMinute&&{key:"BYMINUTE",value:e.byMinute.join(",")},e.byMonth&&{key:"BYMONTH",value:e.byMonth.map(r=>r+1).join(",")},e.byMonthday&&{key:"BYMONTHDAY",value:e.byMonthday.join(",")},e.bySecond&&{key:"BYSECOND",value:e.bySecond.join(",")},e.bySetPos&&{key:"BYSETPOS",value:e.bySetPos.join(",")},e.byWeekNo&&{key:"BYWEEKNO",value:e.byWeekNo.join(",")},e.byYearday&&{key:"BYYEARDAY",value:e.byYearday.join(",")},e.count&&{key:"COUNT",value:e.count.toString()},e.frequency&&{key:"FREQ",value:e.frequency},e.interval&&{key:"INTERVAL",value:e.interval.toString()},e.until&&{key:"UNTIL",value:`${e.until.local&&`${R(dt([{key:"TZID",value:e.until.local.timezone}]))}=`}${e.until.date}`},e.workweekStart&&{key:"WKST",value:e.workweekStart}]));return t+=m("RRULE",n),t};var bt=e=>{let t=x(e),n="";return n+=D("VEVENT"),t.forEach(r=>{if(r==="alarms"||r==="attendees"||r==="exceptionDates")return;let o=lt[r];if(!o)return;let s=e[r];if(s!=null){if(ae(r)){n+=M(o,s);return}if(ce(r)){n+=m(o,s.join(","));return}if(r==="recurrenceRule"){n+=pe(s);return}if(r==="duration"){n+=m(o,Z(s));return}if(r==="organizer"){n+=gt(s);return}if(r==="sequence"){n+=s.toString();return}n+=m(o,String(s))}}),e.alarms&&e.alarms.length>0&&e.alarms.forEach(r=>{n+=Tt(r)}),e.attendees&&e.attendees.length>0&&e.attendees.forEach(r=>{n+=ie(r,"ATTENDEE")}),e.exceptionDates&&e.exceptionDates.length>0&&e.exceptionDates.forEach(r=>{n+=Et(r,"EXDATE")}),n+=O("VEVENT"),n};var Dt={"LAST-MODIFIED":"lastModified",TZID:"id",TZURL:"url"},Ot={id:"TZID",lastModified:"LAST-MODIFIED",url:"TZURL"};var xt={COMMENT:"comment",DTSTART:"start",RDATE:"recurrenceDate",RRULE:"recurrenceRule",TZNAME:"name",TZOFFSETFROM:"offsetFrom",TZOFFSETTO:"offsetTo"},At={comment:"COMMENT",name:"TZNAME",offsetFrom:"TZOFFSETFROM",offsetTo:"TZOFFSETTO",recurrenceDate:"RDATE",recurrenceRule:"RRULE",start:"DTSTART"};var It=e=>{let t=x(e),n="";return n+=D(e.type),t.forEach(r=>{if(r==="type")return;let o=At[r];if(!o)return;let s=e[r];if(r==="start"){n+=m(o,H(s));return}if(r==="recurrenceRule"){n+=pe(s);return}if(r==="recurrenceDate"){n+=M(o,s);return}n+=m(o,String(s))}),n+=O(e.type),n};var Vt=e=>{let t=x(e),n="";return n+=D("VTIMEZONE"),t.forEach(r=>{if(r==="props")return;let o=Ot[r];if(!o)return;let s=e[r];if(r==="lastModified"){n+=m(o,H(s));return}n+=m(o,String(s))}),e.props&&e.props.length>0&&e.props.forEach(r=>{n+=It(r)}),n+=O("VTIMEZONE"),n};var Nt=e=>{let t=e.split(ne),n=[];return t.forEach(r=>{if(r.length<75){n.push(r);return}ir(r,75).forEach(o=>{n.push(o)})}),n.join(oe)},ir=(e,t)=>{let n=e,r=[];for(;Math.ceil(n.length/t)>=1;)r.push(r.length===0?n.substring(0,t):` ${n.substring(0,t)}`),n=n.substring(t);return r};var Ls=e=>{let t=x(e),n="";return n+=D("VCALENDAR"),t.forEach(r=>{if(r==="events"||r==="timezones")return;let o=Qe[r];if(!o)return;let s=e[r];n+=m(o,s)}),e.timezones&&e.timezones.length>0&&e.timezones.forEach(r=>{n+=Vt(r)}),e.events&&e.events.length>0&&e.events.forEach(r=>{n+=bt(r)}),n+=O("VCALENDAR"),Nt(n)};import J from"lodash/set";import{z as P}from"zod";import{z as g}from"zod";var ar=["BASE64"],Xs=["BINARY"],me=g.discriminatedUnion("type",[g.object({type:g.literal("uri"),url:g.string().url(),formatType:g.string().optional(),encoding:g.never().optional(),value:g.never().optional(),binary:g.never().optional()}),g.object({type:g.literal("binary"),url:g.never().optional(),formatType:g.never().optional(),encoding:g.enum(ar),value:g.enum(["BINARY"]),binary:g.string()})]);import{z as N}from"zod";var cr=["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE","DELEGATED"],w=N.object({email:N.string().email(),name:N.string().optional(),member:N.string().email().optional(),delegatedFrom:N.string().email().optional(),role:N.string().optional(),partstat:N.enum(cr).optional(),dir:N.string().url().optional(),sentBy:N.string().email().optional()});import{z as v}from"zod";var h=v.object({before:v.boolean().optional(),weeks:v.number().optional(),days:v.number().optional(),hours:v.number().optional(),minutes:v.number().optional(),seconds:v.number().optional()});import{z as S}from"zod";import{setMilliseconds as pr}from"date-fns";import{z as C}from"zod";var mr=["DATE","DATE-TIME"],yr=C.object({date:C.date(),timezone:C.string(),tzoffset:C.string()}),ur=C.date().transform(e=>pr(e,0)),l=C.object({date:ur,type:C.enum(mr).optional(),local:yr.optional()});var Tr=["START","END"],fr=S.discriminatedUnion("type",[S.object({type:S.literal("absolute"),value:l}),S.object({type:S.literal("relative"),value:h})]),lr=S.object({related:S.enum(Tr).optional()}),Er=S.object({options:lr.optional()}),ye=S.intersection(Er,fr);var ue=P.object({action:P.string().default("DISPLAY"),description:P.string().optional(),trigger:ye,attendees:P.array(w).optional(),duration:h.optional(),repeat:P.number().optional(),summary:P.string().optional(),attachments:P.array(me).optional()});import{z as K}from"zod";import{z as y}from"zod";import{z as ee}from"zod";var Te=ee.object({name:ee.string().optional(),email:ee.string().email(),dir:ee.string().optional(),sentBy:ee.string().email().optional()});import{z as T}from"zod";import{z as Le}from"zod";var B=["SU","MO","TU","WE","TH","FR","SA"],fe=Le.object({day:Le.enum(B),occurence:Le.number().optional()});var gr=["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"],F=T.object({frequency:T.enum(gr),until:l.optional(),count:T.number().optional(),interval:T.number().optional(),bySecond:T.array(T.number().min(0).max(60)).optional(),byMinute:T.array(T.number().min(0).max(59)).optional(),byHour:T.array(T.number().min(0).max(23)).optional(),byDay:T.array(fe).optional(),byMonthday:T.array(T.number().min(-31).max(31)).optional(),byYearday:T.array(T.number().min(1).max(366)).optional(),byWeekNo:T.array(T.number().min(1).max(53)).optional(),byMonth:T.array(T.number().min(0).max(11)).optional(),bySetPos:T.array(T.number().min(-366).max(366)).optional(),workweekStart:T.enum(B).optional()});import{z as St}from"zod";var le=St.object({range:St.literal("THISANDFUTURE").optional(),value:l});var zt=["TENTATIVE","CONFIRMED","CANCELLED"];import{z as Rr}from"zod";var dr=l,je=Rr.array(dr);var br=["TRANSPARENT","OPAQUE"],Dr=["PRIVATE","PUBLIC","CONFIDENTIAL"],Or=y.union([y.object({duration:h,end:y.never().optional()}),y.object({duration:y.never().optional(),end:l})]),xr=y.object({summary:y.string(),uid:y.string(),created:l.optional(),lastModified:l.optional(),stamp:l,start:l,location:y.string().optional(),description:y.string().optional(),categories:y.array(y.string()).optional(),exceptionDates:je.optional(),recurrenceRule:F.optional(),alarms:y.array(ue).optional(),timeTransparent:y.enum(br).optional(),url:y.string().url().optional(),geo:y.string().optional(),class:y.enum(Dr).optional(),organizer:Te.optional(),priority:y.string().optional(),sequence:y.number().optional(),status:y.enum(zt).optional(),attach:y.string().optional(),recurrenceId:le.optional(),attendees:y.array(w).optional(),comment:y.string().optional()}),Ee=y.intersection(xr,Or);import{z as b}from"zod";var Ar=["STANDARD","DAYLIGHT"],ve=b.object({type:b.enum(Ar),start:b.date(),offsetTo:b.string(),offsetFrom:b.string(),recurrenceRule:F.optional(),comment:b.string().optional(),recurrenceDate:l.optional(),name:b.string().optional()}),ge=b.object({id:b.string(),lastModified:b.date().optional(),url:b.string().url().optional(),props:b.array(ve)});var Ir=["PUBLISH"],Mt=K.object({version:K.literal("2.0"),prodId:K.string(),method:K.union([K.enum(Ir),K.string()]).optional(),timezones:K.array(ge).optional(),events:K.array(Ee).optional()});var Ce=(e,t)=>(t==null?void 0:t.VALUE)==="BINARY"?{type:"binary",encoding:(t==null?void 0:t.ENCODING)||"BASE64",binary:e,value:t==null?void 0:t.VALUE}:{type:"uri",url:e,formatType:t==null?void 0:t.FMTTYPE},fa=(e,t)=>me.parse(Ce(e,t));var Y=e=>e.replace(/mailto:/gi,"");var te=(e,t)=>({email:Y(e),delegatedFrom:t!=null&&t["DELEGATED-FROM"]?Y(t["DELEGATED-FROM"]):void 0,dir:t==null?void 0:t.DIR,member:t!=null&&t.MEMBER?Y(t.MEMBER):void 0,name:t==null?void 0:t.CN,partstat:t==null?void 0:t.PARTSTAT,role:t==null?void 0:t.ROLE,sentBy:t!=null&&t["SENT-BY"]?Y(t["SENT-BY"]):void 0}),da=(e,t)=>w.parse(te(e,t));import $ from"lodash/set";var _=e=>{let t=e,n={};t[0]==="-"&&($(n,"before",!0),t=t.slice(1)),t=t.slice(1);let r=t.split("T"),o=r[0];if(o.includes("D")){let[i,a]=o.split("D");$(n,"days",Number(i)),o=a}if(o.includes("W")){let[i,a]=o.split("W");$(n,"weeks",Number(i)),o=a}let s=r[1];if(s){if(s.includes("H")){let[i,a]=s.split("H");$(n,"hours",Number(i)),s=a}if(s.includes("M")){let[i,a]=s.split("M");$(n,"minutes",Number(i)),s=a}if(s.includes("S")){let[i,a]=s.split("S");$(n,"seconds",Number(i)),s=a}}return n},xa=e=>h.parse(_(e));import{addMilliseconds as un}from"date-fns";import{z as ht}from"zod";var Pe=e=>{let t=Number.parseInt(e.slice(0,4),10),n=Number.parseInt(e.slice(4,6),10)-1,r=Number.parseInt(e.slice(6,8),10);return new Date(t,n,r)},Va=e=>ht.date().parse(Pe(e)),k=e=>{let t=Number.parseInt(e.slice(0,4),10),n=Number.parseInt(e.slice(4,6),10)-1,r=Number.parseInt(e.slice(6,8),10),o=Number.parseInt(e.slice(9,11),10),s=Number.parseInt(e.slice(11,13),10),i=Number.parseInt(e.slice(13,15),10);return new Date(Date.UTC(t,n,r,o,s,i))},Na=(e,t)=>ht.date().parse(k(e,t));import{compareAsc as pn,millisecondsToHours as mn,millisecondsToMinutes as yn}from"date-fns";import{addYears as an}from"date-fns";import{addDays as Vr,addHours as Nr,addMinutes as Sr,addMonths as zr,addSeconds as Mr,addWeeks as hr,addYears as Kr}from"date-fns";var q=(e,t)=>t===void 0?!1:e>=t,Kt=(e,{start:t,end:n},r)=>{if(q(r.length,e.count))return;let o=e.frequency,s=e.interval||1;if(!o)return;let i=t;if(o==="SECONDLY"){for(;i<n;){if(q(r.length,e.count))return;i=Mr(i,s),r.push([i])}return}if(o==="MINUTELY"){for(;i<n;){if(q(r.length,e.count))return;i=Sr(i,s),r.push([i])}return}if(o==="HOURLY"){for(;i<n;){if(q(r.length,e.count))return;i=Nr(i,s),r.push([i])}return}if(o==="DAILY"){for(;i<n;){if(q(r.length,e.count))return;i=Vr(i,s),r.push([i])}return}if(o==="WEEKLY"){for(;i<n;){if(q(r.length,e.count))return;i=hr(i,s),r.push([i])}return}if(o==="MONTHLY"){for(;i<n;)i=zr(i,s),r.push([i]);return}if(o==="YEARLY"){for(;i<n;)i=Kr(i,s),r.push([i]);return}};import{compareAsc as nn,isWithinInterval as on,isEqual as sn}from"date-fns";import{addMinutes as Yr,addWeeks as Lr,eachDayOfInterval as jr,endOfMonth as Yt,endOfYear as vr,getDay as Re,isWithinInterval as Cr,setDay as de,startOfDay as Pr,startOfMonth as Lt,startOfYear as Br,subWeeks as _r}from"date-fns";var jt=(e,t,n,r)=>{let o=n.map(({day:s,occurence:i})=>({occurence:i,day:B.indexOf(s)}));return e.frequency==="YEARLY"?e.byYearday||e.byMonthday?t.map(s=>s.filter(i=>o.find(({day:a})=>a===Re(i)))):e.byWeekNo?t.map(s=>s.flatMap(i=>o.map(({day:a})=>de(i,a,{weekStartsOn:r})))):e.byMonth?t.map(s=>s.flatMap(i=>o.flatMap(({day:a,occurence:c})=>Be(L(Lt(i)),L(Yt(i)),a,r,c)))):t.map(s=>s.flatMap(i=>o.flatMap(({day:a,occurence:c})=>Be(L(Br(i)),L(vr(i)),a,r,c)))):e.frequency==="MONTHLY"?e.byMonthday?t.map(s=>s.filter(i=>o.find(({day:a})=>a===Re(i)))):t.map(s=>s.flatMap(i=>o.flatMap(({day:a,occurence:c})=>Be(L(Lt(i)),L(Yt(i)),a,r,c)))):e.frequency==="WEEKLY"?t.map(s=>s.flatMap(i=>o.map(({day:a})=>de(i,a,{weekStartsOn:r})))):t.map(s=>s.filter(i=>o.find(({day:a})=>a===Re(i))))},Be=(e,t,n,r,o)=>{if(o!==void 0){if(!(o<0)){let f=de(e,n,{weekStartsOn:r}),u=e>f;return Lr(f,(o||1)-1+(u?1:0))}let a=de(t,n,{weekStartsOn:r}),c=t<a;return L(Pr(_r(a,-(o||1)-1+(c?1:0))))}return jr({start:e,end:t}).map(i=>L(i)).filter(i=>Cr(i,{start:e,end:t})).filter(i=>n===Re(i))},L=e=>Yr(e,-e.getTimezoneOffset());import{getHours as kr,setHours as Ur}from"date-fns";var vt=(e,t,n)=>e.frequency==="YEARLY"||e.frequency==="MONTHLY"||e.frequency==="WEEKLY"||e.frequency==="DAILY"?t.map(r=>r.flatMap(o=>n.map(s=>Ur(o,s)))):t.map(r=>r.filter(o=>n.includes(kr(o))));import{getMinutes as Wr,setMinutes as Zr}from"date-fns";var Ct=(e,t,n)=>e.frequency==="YEARLY"||e.frequency==="MONTHLY"||e.frequency==="WEEKLY"||e.frequency==="DAILY"||e.frequency==="HOURLY"?t.map(r=>r.flatMap(o=>n.map(s=>Zr(o,s)))):t.map(r=>r.filter(o=>n.includes(Wr(o))));import{getMonth as Hr,setMonth as wr}from"date-fns";var Pt=(e,t,n)=>e.frequency==="YEARLY"?t.map(r=>r.flatMap(o=>n.map(s=>wr(o,s)))):t.map(r=>r.filter(o=>n.includes(Hr(o))));import{getDaysInMonth as Fr,getMonth as $r,setDate as qr}from"date-fns";import Jr from"lodash/compact";var Bt=(e,t,n)=>e.frequency==="YEARLY"||e.frequency==="MONTHLY"?t.map(r=>r.flatMap(o=>{let s=Fr(o);return Jr(n.map(i=>i>s?void 0:qr(o,i)))})):e.frequency==="WEEKLY"?t:t.map(r=>r.filter(o=>n.includes($r(o))));import{getSeconds as Gr,setSeconds as Qr}from"date-fns";var _t=(e,t,n)=>e.frequency==="YEARLY"||e.frequency==="MONTHLY"||e.frequency==="WEEKLY"||e.frequency==="DAILY"||e.frequency==="HOURLY"||e.frequency==="MINUTELY"?t.map(r=>r.flatMap(o=>n.map(s=>Qr(o,s)))):t.map(r=>r.filter(o=>n.includes(Gr(o))));import{compareAsc as Xr}from"date-fns";var kt=(e,t,n)=>!e.byYearday&&!e.byWeekNo&&!e.byMonthday&&!e.byMonth&&!e.byDay&&!e.byHour&&!e.byMinute&&!e.bySecond?t:t.map(r=>r.sort(Xr).filter((o,s)=>n.some(i=>i>0?s===0?!1:s%i===0:s===0?r.length-1+i===0:s%(r.length-1+i)===0)));import{setWeek as en}from"date-fns";var Ut=(e,t,n,r)=>e.frequency==="YEARLY"?t.map(o=>o.flatMap(s=>n.map(i=>en(s,i,{weekStartsOn:r})))):t;import{getYear as tn,setDayOfYear as rn}from"date-fns";var Wt=(e,t,n)=>e.frequency==="YEARLY"?t.map(r=>r.flatMap(o=>n.map(s=>rn(o,s)))):e.frequency==="MONTHLY"||e.frequency==="WEEKLY"||e.frequency==="DAILY"?t:t.map(r=>r.filter(o=>n.includes(tn(o))));var Zt=(e,t,n)=>{let r=n;return e.byMonth&&(r=Pt(e,r,e.byMonth)),e.byWeekNo&&(r=Ut(e,r,e.byWeekNo,t.weekStartsOn)),e.byYearday&&(r=Wt(e,r,e.byYearday)),e.byMonthday&&(r=Bt(e,r,e.byMonthday)),e.byDay&&(r=jt(e,r,e.byDay,t.weekStartsOn)),e.byHour&&(r=vt(e,r,e.byHour)),e.byMinute&&(r=Ct(e,r,e.byMinute)),e.bySecond&&(r=_t(e,r,e.bySecond)),e.bySetPos&&(r=kt(e,r,e.bySetPos)),r.map(s=>s.sort(nn).filter(i=>!(t.exceptions.length>0&&t.exceptions.some(a=>sn(a,i))||!on(i,{start:t.start,end:t.end}))))};var cn=2,Ht=(e,t)=>{var p;let n=t.start,r=((p=e.until)==null?void 0:p.date)||(t==null?void 0:t.end)||an(n,cn),o=t.exceptions||[],s=(e.workweekStart?B.indexOf(e.workweekStart):1)%7,i=[[n]];Kt(e,{start:n,end:r},i);let a=Zt(e,{start:n,end:r,exceptions:o,weekStartsOn:s},i);return e.count?a.flat().splice(0,e.count):a.flat()};var wt=(e,t)=>t.flatMap(n=>!n.recurrenceRule||n.recurrenceRule.until&&n.recurrenceRule.until.date<e?n:Ht(n.recurrenceRule,{start:n.start,end:e}).map(o=>({...n,start:o})));var _e=e=>{let t=e[0]==="+"?1:-1,n=Number(e.slice(1,3)),r=e.length>3?Number(e.slice(3,5)):0,o=e.length>5?Number(e.slice(5,7)):0;return((n*60+r)*60+o)*1e3*t};var Ft=(e,t)=>{let n="en-US",r=new Date(t.toLocaleString(n,{timeZone:"UTC"}));return new Date(t.toLocaleString(n,{timeZone:e})).getTime()-r.getTime()};var $t=(e,t,n)=>{let r=n==null?void 0:n.find(s=>s.id===t);if(r){let s=wt(e,r.props).sort((c,p)=>pn(c.start,p.start));for(let c=0;c<s.length;c+=1)if(e<s[c].start){let p=s[c-1]?s[c-1].offsetTo:s[c].offsetFrom,f=p.length>5?p.substring(0,5):p;return{offset:f,milliseconds:_e(f)}}let i=s[s.length-1].offsetTo,a=i.length>5?i.substring(0,5):i;return{offset:a,milliseconds:_e(a)}}let o=Ft(t,e);if(!Number.isNaN(o)){let s=o<0,i=Math.abs(mn(o)),a=Math.abs(yn(o))-i*60,c=i.toString().length===1?`0${i}`:i.toString(),p=a.toString().length===1?`0${a}`:a.toString();return{offset:`${s?"-":"+"}${c}${p}`,milliseconds:o}}};var d=(e,t,n)=>{if((t==null?void 0:t.VALUE)==="DATE")return{date:Pe(e),type:t==null?void 0:t.VALUE};let r=(t==null?void 0:t.VALUE)||"DATE-TIME",o=k(e);if(!(t!=null&&t.TZID))return{date:o,type:r};let s=$t(o,t.TZID,n);return s?{date:un(o,-s.milliseconds),type:r,local:t!=null&&t.TZID?{date:o,timezone:t==null?void 0:t.TZID,tzoffset:s.offset}:void 0}:{date:o,type:r}},Vc=(e,t,n)=>l.parse(d(e,t,n));var ke=(e,t,n)=>(t==null?void 0:t.VALUE)==="DATE-TIME"||(t==null?void 0:t.VALUE)==="DATE"?{type:"absolute",value:d(e,t,n),options:{related:t==null?void 0:t.RELATED}}:{type:"relative",value:_(e),options:{related:t==null?void 0:t.RELATED}},hc=(e,t,n)=>ye.parse(ke(e,t,n));import Tn from"lodash/set";var fn=e=>e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e,Ue=e=>e.map(t=>{let[n,...r]=t.split(X),o=r.join(X);return{property:n,value:fn(o)}},{}),ln=e=>e.reduce((t,n)=>(Tn(t,n.property,n.value),t),{}),qt=e=>ln(Ue(e));var En=e=>{let t=!1,n;for(let s=0;s<e.length&&n===void 0;s+=1)e.charAt(s)===at&&(t=!t),e.charAt(s)===it&&!t&&(n=s);if(n===void 0)throw Error(`Line not valid: ${e}`);let r=e.substring(0,n),o=e.substring(n+1);return{property:r,value:o}},A=e=>{let{property:t,value:n}=En(e);if(t.includes(j)){let[r,...o]=t.split(j),s=qt(o);return{property:r,options:s,value:n}}return{property:t,value:n}};var I=e=>{let t=[],n=e.split(ne).filter(r=>r!=="");for(let r=0;r<n.length;){let o=n[r];for(r+=1;n[r]&&/^[ \t]/.test(n[r]);)o+=n[r].trimStart(),r+=1;t.push(o)}return t};var We=(e,t)=>{let n=e.replace(st,""),r=I(n),o={},s=[],i=[];return r.forEach(a=>{let{property:c,options:p,value:f}=A(a),u=qe[c];if(u){if(u==="trigger"){J(o,u,ke(f,p,t));return}if(u==="duration"){J(o,u,_(f));return}if(u==="repeat"){J(o,u,Number(f));return}if(u==="attachment"){s.push(Ce(f,p));return}if(u==="attendee"){i.push(te(f,p));return}J(o,u,f)}}),s.length>0&&J(o,"attachments",s),i.length>0&&J(o,"attendees",i),o},Gc=(e,t)=>ue.parse(We(e,t));import $e from"lodash/set";import V from"lodash/set";var Ze=(e,t)=>({name:t==null?void 0:t.CN,dir:t==null?void 0:t.DIR,sentBy:t!=null&&t["SENT-BY"]?Y(t["SENT-BY"]):void 0,email:Y(e)}),tp=(e,t)=>Te.parse(Ze(e,t));import G from"lodash/set";var Jt={BYDAY:"byDay",BYHOUR:"byHour",BYMINUTE:"byMinute",BYMONTH:"byMonth",BYMONTHDAY:"byMonthday",BYSECOND:"bySecond",BYSETPOS:"bySetPos",BYWEEKNO:"byWeekNo",BYYEARDAY:"byYearday",COUNT:"count",FREQ:"frequency",INTERVAL:"interval",UNTIL:"until",WKST:"workweekStart"};var He=e=>{if(e.length===2)return{day:e};let n=e.slice(0,-2);return{day:e.replace(n,""),occurence:Number(n)}},sp=e=>fe.parse(He(e));var gn=["until"],Rn=e=>gn.includes(e),dn=["bySecond","byMinute","byHour","byMonthday","byYearday","byWeekNo","bySetPos"],bn=e=>dn.includes(e),Dn=["byDay"],On=e=>Dn.includes(e),xn=["count","interval"],An=e=>xn.includes(e),re=(e,t)=>{let n={};return Ue(e.split(j)).forEach(o=>{let{property:s,value:i}=o,a=Jt[s];if(a){if(Rn(a)){G(n,a,d(i,{},t));return}if(bn(a)){G(n,a,i.split(W).map(c=>Number(c)));return}if(a==="byMonth"){G(n,a,i.split(W).map(c=>Number(c)-1));return}if(On(a)){G(n,a,i.split(W).map(c=>He(c)));return}if(An(a)){G(n,a,Number(i));return}G(n,a,i)}}),n},fp=(e,t)=>F.parse(re(e,t));var Gt=(e,t)=>e.split(",").map(n=>d(n,t));var we=(e,t)=>{let n=e.replace(ot,""),r=I(n.replace(Ye,"")),o={},s=[],i=[];r.forEach(c=>{let{property:p,options:f,value:u}=A(c),E=ft[p];if(E){if(ae(E)){V(o,E,d(u,f,t));return}if(ce(E)){V(o,E,u.split(W));return}if(E==="recurrenceRule"){V(o,E,re(u,t));return}if(E==="duration"){V(o,E,_(u));return}if(E==="organizer"){V(o,E,Ze(u,f));return}if(E==="sequence"){V(o,E,Number(u));return}if(E==="attendee"){s.push(te(u,f));return}if(E==="exceptionDates"){i.push(...Gt(u,f));return}V(o,E,u)}});let a=[...e.matchAll(Ye)].map(c=>c[0]);if(a.length>0){let c=a.map(p=>We(p,t));V(o,"alarms",c)}return s.length>0&&V(o,"attendees",s),i.length>0&&V(o,"exceptionDates",i),o},Yp=(e,t)=>Ee.parse(we(e,t));import Qt from"lodash/set";import be from"lodash/set";var De=(e,t)=>{let n=e.replace(rt,"").replace(nt,""),r=I(n),o={type:t||"STANDARD"};return r.forEach(s=>{let{property:i,options:a,value:c}=A(s),p=xt[i];if(p){if(p==="start"){be(o,p,k(c));return}if(p==="recurrenceRule"){be(o,p,re(c));return}if(p==="recurrenceDate"){be(o,p,d(c,a));return}be(o,p,c)}}),o},Zp=(e,t)=>ve.parse(De(e,t));var Fe=e=>{let t=e.replace(tt,""),n=I(t.replace(Me,"").replace(he,"")),r={props:[]};n.forEach(i=>{let{property:a,value:c}=A(i),p=Dt[a];if(p){if(p==="lastModified"){Qt(r,p,k(c));return}Qt(r,p,c)}});let o=[...t.matchAll(Me)].map(i=>i[0]);o.length>0&&o.forEach(i=>{r.props.push(De(i,"STANDARD"))});let s=[...t.matchAll(he)].map(i=>i[0]);return s.length>0&&s.forEach(i=>{r.props.push(De(i,"DAYLIGHT"))}),r},em=e=>ge.parse(Fe(e));var In=e=>{let t=e.replace(et,""),n=I(t.replace(Ke,"").replace(ze,"")),r={};n.forEach(i=>{let{property:a,value:c}=A(i),p=Ge[a];p&&$e(r,p,c)});let o=[...t.matchAll(ze)].map(i=>i[0]);if(o.length>0){let i=o.map(a=>Fe(a));$e(r,"timezones",i)}let s=[...t.matchAll(Ke)].map(i=>i[0]);if(s.length>0){let i=s.map(a=>we(a,r.timezones));$e(r,"events",i)}return r},mm=e=>Mt.parse(In(e));var Vn=(e,t,n)=>({value:d(e,t,n),range:t==null?void 0:t.RANGE}),fm=(e,t,n)=>le.parse(Vn(e,t,n));import{addDays as Nn,addHours as Sn,addMinutes as zn,addSeconds as Mn,addWeeks as hn,differenceInDays as Kn,differenceInHours as Yn,differenceInMinutes as Ln,differenceInSeconds as jn,differenceInWeeks as vn,subDays as Cn,subHours as Pn,subMinutes as Bn,subSeconds as _n,subWeeks as kn}from"date-fns";var Xt=(e,t)=>t.before?kn(Cn(Pn(Bn(_n(e,t.seconds||0),t.minutes||0),t.hours||0),t.days||0),t.weeks||0):hn(Nn(Sn(zn(Mn(e,t.seconds||0),t.minutes||0),t.hours||0),t.days||0),t.weeks||0),vm=(e,t)=>{let n=Math.abs(vn(t,e)),r=Math.abs(Kn(t,e)),o=r-n*7,s=Math.abs(Yn(t,e)),i=s-r*24,a=Math.abs(Ln(t,e)),c=a-s*60,f=Math.abs(jn(t,e))-a*60;return{before:e>t,weeks:n,days:o,hours:i,minutes:c,seconds:f}};var Bm=e=>e.end?e.end.date:Xt(e.start.date,e.duration);export{cn as DEFAULT_END_IN_YEARS,cr as attendeePartStatusTypes,Dr as classTypes,mr as dateObjectTypes,ar as encodingTypes,Ht as extendByRecurrenceRule,wt as extendTimezoneProps,Tt as generateIcsAlarm,pt as generateIcsAttachment,ie as generateIcsAttendee,Ls as generateIcsCalendar,yt as generateIcsDate,H as generateIcsDateTime,Z as generateIcsDuration,bt as generateIcsEvent,z as generateIcsMail,gt as generateIcsOrganizer,pe as generateIcsRecurrenceRule,M as generateIcsTimeStamp,Vt as generateIcsTimezone,It as generateIcsTimezoneProp,ut as generateIcsTrigger,Rt as generateIcsWeekdayNumber,vm as getDurationFromInterval,Bm as getEventEnd,Xt as getEventEndFromDuration,$t as getTimezoneObjectOffset,We as icsAlarmToObject,Ce as icsAttachmentToObject,te as icsAttendeeToObject,In as icsCalendarToObject,k as icsDateTimeToDateTime,Pe as icsDateToDate,_ as icsDurationToObject,we as icsEventToObject,Ze as icsOrganizerToObject,Vn as icsRecurrenceIdToObject,re as icsRecurrenceRuleToObject,d as icsTimeStampToObject,De as icsTimezonePropToObject,Fe as icsTimezoneToObject,ke as icsTriggerToObject,He as icsWeekdayNumberToObject,Gc as parseIcsAlarm,fa as parseIcsAttachment,da as parseIcsAttendee,mm as parseIcsCalendar,Va as parseIcsDate,Na as parseIcsDateTime,xa as parseIcsDuration,Yp as parseIcsEvent,tp as parseIcsOrganizer,fm as parseIcsRecurrenceId,fp as parseIcsRecurrenceRule,em as parseIcsTimezone,Zp as parseIcsTimezoneProp,hc as parseIcsTrigger,sp as parseIcsWeekdayNumber,Vc as parseicsTimeStamp,An as recurrenceObjectKeyIsNumber,bn as recurrenceObjectKeyIsNumberArray,Rn as recurrenceObjectKeyIsTimeStamp,On as recurrenceObjectKeyIsWeekdayNumberArray,gr as recurrenceRuleFrequencies,zt as statusTypes,br as timeTransparentTypes,_e as timeZoneOffsetToMilliseconds,Ar as timezonePropTypes,Tr as triggerRelations,Xs as valueTypes,B as weekDays,me as zAttachment,w as zAttendee,l as zDateObject,yr as zDateObjectTzProps,Te as zOrganizer,le as zRecurrenceId,F as zRecurrenceRule,ue as zVAlarm,Mt as zVCalendar,Ir as zVCalendarMethods,Ee as zVEvent,xr as zVEventBase,h as zVEventDuration,Or as zVEventDurationOrEnd,ye as zVEventTrigger,Er as zVEventTriggerBase,lr as zVEventTriggerOptions,fr as zVEventTriggerUnion,ge as zVTimezone,ve as zVTimezoneProp,fe as zWeekdayNumberObject};
