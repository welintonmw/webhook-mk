import{m as B}from"./pinia-sugP77Im.js";import{G as b,ag as s,l as r,M as T,a9 as V,O as c,p as i,I as l,T as g,H as U,U as a,K as R,P as k,V as S,S as y,J as q,m as u,F as W,a7 as L,R as _}from"./vendor-Dv5OeN6t.js";import{_ as v}from"./n8n-4UEsHtUL.js";import{N,T as F}from"./TemplateList-By-t2s0M.js";import{V as z}from"./vue-agile-BaIavDFU.js";import{$ as O,d as j,u as H,dj as Q,bG as D,a as K,e as G,b as J,d8 as X,V as E}from"./index-1OxaEeO3.js";import{T as Y}from"./TemplatesView-BbunSn-s.js";import"./axios-Mm4CS0gO.js";import"./esprima-next-nhoSXAeq.js";import"./luxon-CLwAIbs0.js";import"./lodash-es-CZ1inz46.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const Z=b({name:"Card",props:{loading:{type:Boolean},title:{type:String}}}),x="_card_17xq8_1",ee="_title_17xq8_17",te={card:x,title:ee},oe=["textContent"];function se(e,t,o,n,f,C){const p=s("n8n-loading"),m=s("n8n-card");return r(),T(m,R({class:e.$style.card},e.$attrs),V({default:c(()=>[a(p,{loading:e.loading,rows:3,variant:"p"},null,8,["loading"])]),_:2},[e.loading?void 0:{name:"header",fn:c(()=>[i("span",{class:l(e.$style.title),textContent:g(e.title)},null,10,oe)]),key:"0"},e.loading?void 0:{name:"footer",fn:c(()=>[U(e.$slots,"footer")]),key:"1"}]),1040,["class"])}const le={$style:te},I=v(Z,[["render",se],["__cssModules",le]]),ae=b({name:"TemplatesInfoCard",components:{Card:I,NodeList:N},props:{collection:{type:Object,required:!0},loading:{type:Boolean},showItemCount:{type:Boolean,default:!0},width:{type:String,required:!0}}});function re(e,t,o,n,f,C){const p=s("n8n-text"),m=s("NodeList"),w=s("Card");return r(),T(w,{loading:e.loading,title:e.collection.name,style:q({width:e.width})},{footer:c(()=>[i("span",null,[k(a(p,{size:"small",color:"text-light"},{default:c(()=>[y(g(e.collection.workflows.length)+" "+g(e.$locale.baseText("templates.workflows")),1)]),_:1},512),[[S,e.showItemCount]])]),a(m,{nodes:e.collection.nodes,"show-more":!1},null,8,["nodes"])]),_:1},8,["loading","title","style"])}const ne=v(ae,[["render",re]]),ie=b({name:"TemplatesInfoCarousel",components:{Card:I,TemplatesInfoCard:ne,agile:z},props:{collections:{type:Array,required:!0},loading:{type:Boolean},showItemCount:{type:Boolean,default:!0},showNavigation:{type:Boolean,default:!0},cardsWidth:{type:String,default:"240px"}},data(){return{carouselScrollPosition:0,cardWidth:parseInt(this.cardsWidth,10),sliderWidth:0,scrollEnd:!1,listElement:null}},watch:{collections(){setTimeout(()=>{this.updateCarouselScroll()},0)},loading(){setTimeout(()=>{this.updateCarouselScroll()},0)}},async mounted(){await this.$nextTick();const e=this.$refs.slider;e&&(this.listElement=e.$el.querySelector(".agile__list"),this.listElement&&this.listElement.addEventListener("scroll",this.updateCarouselScroll))},beforeUnmount(){const e=this.$refs.slider;e&&e.destroy(),window.removeEventListener("scroll",this.updateCarouselScroll)},methods:{updateCarouselScroll(){if(this.listElement){this.carouselScrollPosition=Number(this.listElement.scrollLeft.toFixed());const e=this.listElement.clientWidth,t=this.listElement.scrollWidth,o=this.carouselScrollPosition;this.scrollEnd=t-e<=o+7}},onCardClick(e,t){this.$emit("openCollection",{event:e,id:t})},scrollLeft(){this.listElement&&this.listElement.scrollBy({left:-(this.cardWidth*2),top:0,behavior:"smooth"})},scrollRight(){this.listElement&&this.listElement.scrollBy({left:this.cardWidth*2,top:0,behavior:"smooth"})}}}),ce="_container_1lokv_1",de="_button_1lokv_5",he="_leftButton_1lokv_26 _button_1lokv_5",ue="_rightButton_1lokv_35 _button_1lokv_5",pe={container:ce,button:de,leftButton:he,rightButton:ue};function me(e,t,o,n,f,C){const p=s("Card"),m=s("TemplatesInfoCard"),w=s("agile"),h=s("font-awesome-icon");return k((r(),u("div",{class:l(e.$style.container)},[a(w,{ref:"slider",dots:!1,"nav-buttons":!1,infinite:!1,"slides-to-show":4,onAfterChange:e.updateCarouselScroll},{default:c(()=>[(r(!0),u(W,null,L(e.loading?4:0,d=>(r(),T(p,{key:`loading-${d}`,loading:e.loading},null,8,["loading"]))),128)),(r(!0),u(W,null,L(e.loading?[]:e.collections,d=>(r(),T(m,{key:d.id,"data-test-id":"templates-info-card",collection:d,"show-item-count":e.showItemCount,width:e.cardsWidth,onClick:$=>e.onCardClick($,d.id)},null,8,["collection","show-item-count","width","onClick"]))),128))]),_:1},8,["onAfterChange"]),k(i("button",{class:l({[e.$style.leftButton]:!0}),onClick:t[0]||(t[0]=(...d)=>e.scrollLeft&&e.scrollLeft(...d))},[a(h,{icon:"chevron-left"})],2),[[S,e.showNavigation&&e.carouselScrollPosition>0]]),k(i("button",{class:l({[e.$style.rightButton]:!0}),onClick:t[1]||(t[1]=(...d)=>e.scrollRight&&e.scrollRight(...d))},[a(h,{icon:"chevron-right"})],2),[[S,e.showNavigation&&!e.scrollEnd]])],2)),[[S,e.loading||e.collections.length]])}const ge={$style:pe},fe=v(ie,[["render",me],["__cssModules",ge]]),Ce=b({name:"TemplateFilters",props:{categories:{type:Array,default:()=>[]},sortOnPopulate:{type:Boolean,default:!1},expandLimit:{type:Number,default:12},loading:{type:Boolean},selected:{type:Array,default:()=>[]}},emits:["clearAll","select","clear"],data(){return{collapsed:!0,sortedCategories:[]}},computed:{...B(O),allSelected(){return this.selected.length===0}},watch:{sortOnPopulate:{handler(e){e&&this.sortCategories()},immediate:!0},categories:{handler(e){e.length>0&&this.sortCategories()},immediate:!0}},methods:{sortCategories(){if(!this.sortOnPopulate)this.sortedCategories=this.categories;else{const e=this.selected||[],t=this.categories.filter(n=>e.includes(n)),o=this.categories.filter(n=>!e.includes(n));this.sortedCategories=t.concat(o)}},collapseAction(){this.collapsed=!1},handleCheckboxChanged(e,t){this.$emit(e?"select":"clear",t)},isSelected(e){return this.selected.includes(e)},resetCategories(){this.$emit("clearAll")}}}),we="_title_1sb10_1",ye="_categories_1sb10_6",$e="_item_1sb10_11",ke="_button_1sb10_18",Se={title:we,categories:ye,item:$e,button:ke},_e=["textContent"],Te=["data-test-id"];function be(e,t,o,n,f,C){const p=s("n8n-loading"),m=s("el-checkbox"),w=s("n8n-text");return r(),u("div",{class:l([e.$style.filters,"template-filters"]),"data-test-id":"templates-filter-container"},[i("div",{class:l(e.$style.title),textContent:g(e.$locale.baseText("templates.categoriesHeading"))},null,10,_e),e.loading?(r(),u("div",{key:0,class:l(e.$style.list)},[a(p,{loading:e.loading,rows:e.expandLimit},null,8,["loading","rows"])],2)):_("",!0),e.loading?_("",!0):(r(),u("ul",{key:1,class:l(e.$style.categories)},[i("li",{class:l(e.$style.item),"data-test-id":"template-filter-all-categories"},[a(m,{"model-value":e.allSelected,"onUpdate:modelValue":t[0]||(t[0]=()=>e.resetCategories())},{default:c(()=>[y(g(e.$locale.baseText("templates.allCategories")),1)]),_:1},8,["model-value"])],2),(r(!0),u(W,null,L(e.collapsed?e.sortedCategories.slice(0,e.expandLimit):e.sortedCategories,(h,d)=>(r(),u("li",{key:d,class:l(e.$style.item),"data-test-id":`template-filter-${h.name.toLowerCase().replaceAll(" ","-")}`},[a(m,{"model-value":e.isSelected(h),"onUpdate:modelValue":$=>e.handleCheckboxChanged($,h)},{default:c(()=>[y(g(h.name),1)]),_:2},1032,["model-value","onUpdate:modelValue"])],10,Te))),128))],2)),e.sortedCategories.length>e.expandLimit&&e.collapsed&&!e.loading?(r(),u("div",{key:2,class:l(e.$style.button),"data-test-id":"expand-categories-button",onClick:t[1]||(t[1]=(...h)=>e.collapseAction&&e.collapseAction(...h))},[a(w,{size:"small",color:"primary"},{default:c(()=>[y(" + "+g(`${e.sortedCategories.length-e.expandLimit} more`),1)]),_:1})],2)):_("",!0)],2)}const ve={$style:Se},We=v(Ce,[["render",be],["__cssModules",ve]]),Le=b({name:"TemplatesSearchView",components:{TemplatesInfoCarousel:fe,TemplateFilters:We,TemplateList:F,TemplatesView:Y},beforeRouteLeave(e,t,o){var f,C;const n=document.getElementById("content");n&&((C=(f=this.$route.meta)==null?void 0:f.setScrollPosition)==null||C.call(f,n.scrollTop)),this.trackSearch(),o()},setup(){const{callDebounced:e}=j();return{callDebounced:e,...H()}},data(){return{areCategoriesPrepopulated:!1,categories:[],loading:!0,loadingCategories:!0,loadingCollections:!0,loadingWorkflows:!0,search:"",searchEventToTrack:null,errorLoadingWorkflows:!1,creatorHubUrl:Q}},computed:{...B(J,O,G,K,D),totalWorkflows(){return this.templatesStore.getSearchedWorkflowsTotal(this.createQueryObject("name"))},workflows(){return this.templatesStore.getSearchedWorkflows(this.createQueryObject("name"))??[]},collections(){return this.templatesStore.getSearchedCollections(this.createQueryObject("id"))??[]},endOfSearchMessage(){return this.loadingWorkflows?null:!this.loadingCollections&&this.workflows.length===0&&this.collections.length===0?!this.settingsStore.isTemplatesEndpointReachable&&this.errorLoadingWorkflows?this.$locale.baseText("templates.connectionWarning"):this.$locale.baseText("templates.noSearchResults"):null},nothingFound(){return!this.loadingWorkflows&&!this.loadingCollections&&this.workflows.length===0&&this.collections.length===0}},watch:{workflows(e){e.length===0&&this.scrollTo(0)}},async mounted(){X("n8n - Templates"),await this.loadCategories(),this.loadWorkflowsAndCollections(!0),this.usersStore.showPersonalizationSurvey(),this.restoreSearchFromRoute(),setTimeout(()=>{var t;const e=(t=this.$route.meta)==null?void 0:t.scrollOffset;typeof e=="number"&&e>0&&this.scrollTo(e,"auto")},100)},methods:{createQueryObject(e){return{categories:this.categories.map(t=>e==="name"?t.name:String(t.id)),search:this.search}},restoreSearchFromRoute(){let e=!1;if(this.$route.query.search&&typeof this.$route.query.search=="string"&&(this.search=this.$route.query.search,e=!0),typeof this.$route.query.categories=="string"&&this.$route.query.categories.length){const t=this.$route.query.categories.split(",");this.categories=this.templatesStore.allCategories.filter(o=>t.includes(o.id.toString())),e=!0}e&&(this.updateSearch(),this.trackCategories(),this.areCategoriesPrepopulated=!0)},onOpenCollection({event:e,id:t}){this.navigateTo(e,E.COLLECTION,t)},onOpenTemplate({event:e,id:t}){this.navigateTo(e,E.TEMPLATE,t)},navigateTo(e,t,o){if(e.metaKey||e.ctrlKey){const n=this.$router.resolve({name:t,params:{id:o}});window.open(n.href,"_blank");return}else this.$router.push({name:t,params:{id:o}})},updateSearch(){this.updateQueryParam(this.search,this.categories.map(e=>e.id).join(",")),this.loadWorkflowsAndCollections(!1)},updateSearchTracking(e,t){e&&(this.searchEventToTrack&&this.searchEventToTrack.search_string.length>e.length||(this.searchEventToTrack={search_string:e,workflow_results_count:this.workflows.length,collection_results_count:this.collections.length,categories_applied:t.map(o=>this.templatesStore.getCategoryById(o.toString())),wf_template_repo_session_id:this.templatesStore.currentSessionId}))},trackSearch(){this.searchEventToTrack&&(this.$telemetry.track("User searched workflow templates",this.searchEventToTrack),this.searchEventToTrack=null)},onSearchInput(e){this.loadingWorkflows=!0,this.loadingCollections=!0,this.search=e,this.callDebounced(this.updateSearch,{debounceTime:500,trailing:!0}),e.length===0&&this.trackSearch()},onCategorySelected(e){this.categories=this.categories.concat(e),this.updateSearch(),this.trackCategories()},onCategoryUnselected(e){this.categories=this.categories.filter(t=>t.id!==e.id),this.updateSearch(),this.trackCategories()},onCategoriesCleared(){this.categories=[],this.updateSearch()},trackCategories(){this.categories.length&&this.$telemetry.track("User changed template filters",{search_string:this.search,categories_applied:this.categories,wf_template_repo_session_id:this.templatesStore.currentSessionId})},updateQueryParam(e,t){const o=Object.assign({},this.$route.query);t.length?o.categories=t:delete o.categories,e.length?o.search=e:delete o.search,this.$router.replace({query:o})},async onLoadMore(){if(!(this.workflows.length>=this.totalWorkflows))try{this.loadingWorkflows=!0,await this.templatesStore.getMoreWorkflows({categories:this.categories.map(e=>e.name),search:this.search})}catch{this.showMessage({title:"Error",message:"Could not load more workflows",type:"error"})}finally{this.loadingWorkflows=!1}},async loadCategories(){try{await this.templatesStore.getCategories()}catch{}this.loadingCategories=!1},async loadCollections(){try{this.loadingCollections=!0,await this.templatesStore.getCollections({categories:this.categories.map(e=>String(e.id)),search:this.search})}catch{}this.loadingCollections=!1},async loadWorkflows(){try{this.loadingWorkflows=!0,await this.templatesStore.getWorkflows({search:this.search,categories:this.categories.map(e=>e.name)}),this.errorLoadingWorkflows=!1}catch{this.errorLoadingWorkflows=!0}this.loadingWorkflows=!1},async loadWorkflowsAndCollections(e){const t=this.search,o=[...this.categories];await Promise.all([this.loadWorkflows(),this.loadCollections()]),e||this.updateSearchTracking(t,o.map(n=>n.id))},scrollTo(e,t="smooth"){setTimeout(()=>{const o=document.getElementById("content");o&&o.scrollTo({top:e,behavior:t})},0)}}}),Ee="_wrapper_1el39_1",Be="_contentWrapper_1el39_6",Oe="_filters_1el39_16",Ie="_search_1el39_22",Ae="_header_1el39_34",Me={wrapper:Ee,contentWrapper:Be,filters:Oe,search:Ie,header:Ae},Pe=["textContent"],Ve=["innerHTML"];function Ue(e,t,o,n,f,C){const p=s("n8n-heading"),m=s("n8n-button"),w=s("TemplateFilters"),h=s("font-awesome-icon"),d=s("n8n-input"),$=s("TemplatesInfoCarousel"),A=s("TemplateList"),M=s("n8n-text"),P=s("TemplatesView");return r(),T(P,null,{header:c(()=>[i("div",{class:l(e.$style.wrapper)},[i("div",{class:l(e.$style.title)},[a(p,{tag:"h1",size:"2xlarge"},{default:c(()=>[y(g(e.$locale.baseText("templates.heading")),1)]),_:1})],2),i("div",{class:l(e.$style.button)},[a(m,{size:"large",type:"secondary",element:"a",href:e.creatorHubUrl,label:e.$locale.baseText("templates.shareWorkflow"),target:"_blank"},null,8,["href","label"])],2)],2)]),content:c(()=>[i("div",{class:l(e.$style.contentWrapper)},[i("div",{class:l(e.$style.filters)},[a(w,{categories:e.templatesStore.allCategories,"sort-on-populate":e.areCategoriesPrepopulated,selected:e.categories,loading:e.loadingCategories,onClear:e.onCategoryUnselected,onClearAll:e.onCategoriesCleared,onSelect:e.onCategorySelected},null,8,["categories","sort-on-populate","selected","loading","onClear","onClearAll","onSelect"])],2),i("div",{class:l(e.$style.search)},[a(d,{"model-value":e.search,placeholder:e.$locale.baseText("templates.searchPlaceholder"),clearable:"","data-test-id":"template-search-input","onUpdate:modelValue":e.onSearchInput,onBlur:e.trackSearch},{prefix:c(()=>[a(h,{icon:"search"})]),_:1},8,["model-value","placeholder","onUpdate:modelValue","onBlur"]),k(i("div",{class:l(e.$style.carouselContainer)},[i("div",{class:l(e.$style.header)},[a(p,{bold:!0,size:"medium",color:"text-light"},{default:c(()=>[y(g(e.$locale.baseText("templates.collections"))+" ",1),e.loadingCollections?_("",!0):(r(),u("span",{key:0,"data-test-id":"collection-count-label",textContent:g(`(${e.collections.length})`)},null,8,Pe))]),_:1})],2),a($,{collections:e.collections,loading:e.loadingCollections,onOpenCollection:e.onOpenCollection},null,8,["collections","loading","onOpenCollection"])],2),[[S,e.collections.length||e.loadingCollections]]),a(A,{"infinite-scroll-enabled":!0,loading:e.loadingWorkflows,workflows:e.workflows,"total-count":e.totalWorkflows,onLoadMore:e.onLoadMore,onOpenTemplate:e.onOpenTemplate},null,8,["loading","workflows","total-count","onLoadMore","onOpenTemplate"]),e.endOfSearchMessage?(r(),u("div",{key:0,class:l(e.$style.endText)},[a(M,{size:"medium",color:"text-base"},{default:c(()=>[i("span",{innerHTML:e.endOfSearchMessage},null,8,Ve)]),_:1})],2)):_("",!0)],2)],2)]),_:1})}const Re={$style:Me},Ct=v(Le,[["render",Ue],["__cssModules",Re]]);export{Ct as default};
//# sourceMappingURL=TemplatesSearchView-Bmr6Nd6g.js.map
