import{m as A}from"./pinia-sugP77Im.js";import{j,K as L,s as O,er as R,es as S,a3 as B}from"./index-1OxaEeO3.js";import{D as F}from"./NodeDetailsView-DcV7LI-g.js";import{M as W,T as J}from"./TextWithHighlights-kUoC0rXY.js";import{G as q,ag as v,l as r,m as g,I as a,p as o,F as M,a7 as E,U as h,O as d,S as T,T as $,R as N,M as K}from"./vendor-Dv5OeN6t.js";import{_ as G}from"./n8n-4UEsHtUL.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";import"./file-saver-By8WREO3.js";import"./vue-json-pretty-Cqx2Hpq3.js";import"./dateFormatter-CfbOITvW.js";import"./RunDataAi-C3XiqNZa.js";import"./useWorkflowActivate-npf1npdP.js";const I=40,U=q({name:"RunDataTable",components:{Draggable:F,MappingPill:W,TextWithHighlights:J},props:{node:{type:Object,required:!0},inputData:{type:Array,required:!0},mappingEnabled:{type:Boolean},distanceFromActive:{type:Number,required:!0},runIndex:{type:Number},outputIndex:{type:Number},totalRuns:{type:Number},pageOffset:{type:Number,required:!0},hasDefaultHoverState:{type:Boolean},search:{type:String}},setup(){return{externalHooks:B()}},data(){return{activeColumn:-1,forceShowGrip:!1,draggedColumn:!1,draggingPath:null,hoveringPath:null,mappingHintVisible:!1,activeRow:null,columnLimit:I,columnLimitExceeded:!1}},mounted(){if(this.tableData&&this.tableData.columns&&this.$refs.draggable){const e=this.$refs.draggable.$refs.wrapper;e&&this.$emit("mounted",{avgRowHeight:e.offsetHeight/this.tableData.data.length})}},computed:{...A(L,j),hoveringItem(){return this.ndvStore.hoveringItem},pairedItemMappings(){return this.workflowsStore.workflowExecutionPairedItemMappings},tableData(){return this.convertToTable(this.inputData)},focusedMappableInput(){return this.ndvStore.focusedMappableInput},highlight(){return this.ndvStore.highlightDraggables}},methods:{shorten:O,isHoveringRow(e){var l;if(e===this.activeRow)return!0;const t=this.pageOffset+e;if(t===0&&!this.hoveringItem&&this.hasDefaultHoverState&&this.distanceFromActive===1)return!0;const n=R(((l=this.node)==null?void 0:l.name)??"",this.runIndex||0,this.outputIndex||0,t);if(!this.hoveringItem||!this.pairedItemMappings[n])return!1;const m=R(this.hoveringItem.nodeName,this.hoveringItem.runIndex,this.hoveringItem.outputIndex,this.hoveringItem.itemIndex);return this.pairedItemMappings[n].has(m)},onMouseEnterCell(e){const t=e.target;if(t&&this.mappingEnabled){const n=t.dataset.col;n&&!isNaN(parseInt(n,10))&&(this.activeColumn=parseInt(n,10))}if(t){const n=t.dataset.row;n&&!isNaN(parseInt(n,10))&&(this.activeRow=parseInt(n,10),this.$emit("activeRowChanged",this.pageOffset+this.activeRow))}},onMouseLeaveCell(){this.activeColumn=-1,this.activeRow=null,this.$emit("activeRowChanged",null)},onMouseEnterKey(e,t){this.hoveringPath=this.getCellExpression(e,t)},onMouseLeaveKey(){this.hoveringPath=null},isHovering(e,t){const n=this.getCellExpression(e,t);return this.hoveringPath===n},getExpression(e){return this.node?S({nodeName:this.node.name,distanceFromActive:this.distanceFromActive,path:[e]}):""},getPathNameFromTarget(e){return e?e.dataset.name:""},getCellPathName(e,t){const n=e[e.length-1];return typeof n=="string"?n:e.length>1?`${e[e.length-2]}[${n}]`:`${this.tableData.columns[t]}[${n}]`},getCellExpression(e,t){if(!this.node)return"";const n=this.tableData.columns[t];return S({nodeName:this.node.name,distanceFromActive:this.distanceFromActive,path:[n,...e]})},isEmpty(e){return e===""||Array.isArray(e)&&e.length===0||typeof e=="object"&&e!==null&&Object.keys(e).length===0||e===null||e===void 0},getValueToRender(e){return e===""?this.$locale.baseText("runData.emptyString"):typeof e=="string"?e:Array.isArray(e)&&e.length===0?this.$locale.baseText("runData.emptyArray"):typeof e=="object"&&e!==null&&Object.keys(e).length===0?this.$locale.baseText("runData.emptyObject"):e==null?`[${e}]`:e===!0||e===!1||typeof e=="number"?e.toString():JSON.stringify(e)},onDragStart(){this.draggedColumn=!0,this.ndvStore.resetMappingTelemetry()},onCellDragStart(e){e!=null&&e.dataset.value&&(this.draggingPath=e.dataset.value),this.onDragStart()},onCellDragEnd(e){this.draggingPath=null,this.onDragEnd(e.dataset.name||"","tree",e.dataset.depth||"0")},isDraggingKey(e,t){if(this.draggingPath)return this.draggingPath===this.getCellExpression(e,t)},onDragEnd(e,t,n="0"){setTimeout(()=>{const m=this.ndvStore.mappingTelemetry,l={src_node_type:this.node.type,src_field_name:e,src_nodes_back:this.distanceFromActive,src_run_index:this.runIndex,src_runs_total:this.totalRuns,src_field_nest_level:parseInt(n,10),src_view:"table",src_element:t,success:!1,...m};this.externalHooks.run("runDataTable.onDragEnd",l),this.$telemetry.track("User dragged data for mapping",l,{withPostHog:!0})},1e3)},isSimple(e){return typeof e!="object"||e===null||Array.isArray(e)&&e.length===0||typeof e=="object"&&Object.keys(e).length===0},hasJsonInColumn(e){return this.tableData.hasJson[this.tableData.columns[e]]},convertToTable(e){const t=[],n=[];let m,l,c;const C={};return e.forEach(y=>{if(!y.hasOwnProperty("json"))return;c=y.json,l=[];const D=Object.keys(c||{});D.length>I?(this.columnLimitExceeded=!0,m=D.slice(0,I)):m=D,n.forEach(s=>{c.hasOwnProperty(s)?(l.push(c[s]),m.splice(m.indexOf(s),1),C[s]=C[s]||typeof c[s]=="object"&&Object.keys(c[s]||{}).length>0||!1):l.push(void 0)}),m.forEach(s=>{n.push(s),l.push(c[s]),C[s]=C[s]||typeof c[s]=="object"&&Object.keys(c[s]||{}).length>0||!1}),t.push(l)}),t.forEach(y=>{n.length>y.length&&y.push(...new Array(n.length-y.length))}),{hasJson:C,columns:n,data:t}},switchToJsonView(){this.$emit("displayModeChange","json")}},watch:{focusedMappableInput(e){setTimeout(()=>{this.forceShowGrip=!!this.focusedMappableInput},e?300:150)}}}),z="/%257B%257BBASE_PATH%257D%257D/static/data-mapping-gif.gif",X="_dataDisplay_5ss8n_1",Q="_table_5ss8n_14",Y="_nodeClass_5ss8n_63",Z="_emptyCell_5ss8n_67",x="_header_5ss8n_71",ee="_draggableHeader_5ss8n_83",te="_dragButton_5ss8n_87",ne="_highlight_5ss8n_91",ae="_draggingHeader_5ss8n_95",se="_activeHeader_5ss8n_100",oe="_dataKey_5ss8n_109",re="_value_5ss8n_118",ie="_nestedValue_5ss8n_122 _value_5ss8n_118",le="_mappable_5ss8n_127",ge="_empty_5ss8n_67",de="_limitColWidth_5ss8n_135",pe="_minColWidth_5ss8n_139",he="_hoveringKey_5ss8n_143",me="_draggingKey_5ss8n_147",ue="_tableRightMargin_5ss8n_151",ce="_hoveringRow_5ss8n_159",ye="_warningTooltip_5ss8n_164",be={dataDisplay:X,table:Q,nodeClass:Y,emptyCell:Z,header:x,draggableHeader:ee,dragButton:te,highlight:ne,draggingHeader:ae,activeHeader:se,dataKey:oe,value:re,nestedValue:ie,mappable:le,empty:ge,limitColWidth:de,minColWidth:pe,hoveringKey:he,draggingKey:me,tableRightMargin:ue,hoveringRow:ce,warningTooltip:ye},fe=["data-row"],ve=o("img",{src:z},null,-1),Ce=["data-test-id"],De=["data-row","data-col"],we=["data-name","data-value","data-depth","onMouseenter"],$e={key:0};function Me(e,t,n,m,l,c){const C=v("n8n-info-tip"),y=v("MappingPill"),D=v("TextWithHighlights"),s=v("font-awesome-icon"),_=v("Draggable"),H=v("n8n-tooltip"),P=v("i18n-t"),k=v("n8n-tree");return r(),g("div",{class:a([e.$style.dataDisplay,{[e.$style.highlight]:e.highlight}])},[e.tableData.columns&&e.tableData.columns.length===0?(r(),g("table",{key:0,class:a(e.$style.table)},[o("tr",null,[o("th",{class:a(e.$style.emptyCell)},null,2),o("th",{class:a(e.$style.tableRightMargin)},null,2)]),(r(!0),g(M,null,E(e.tableData.data,(u,p)=>(r(),g("tr",{key:p,class:a({[e.$style.hoveringRow]:e.isHoveringRow(p)})},[o("td",{"data-row":p,"data-col":0,onMouseenter:t[0]||(t[0]=(...i)=>e.onMouseEnterCell&&e.onMouseEnterCell(...i)),onMouseleave:t[1]||(t[1]=(...i)=>e.onMouseLeaveCell&&e.onMouseLeaveCell(...i))},[h(C,null,{default:d(()=>[T($(e.$locale.baseText("runData.emptyItemHint")),1)]),_:1})],40,fe),o("td",{class:a(e.$style.tableRightMargin)},null,2)],2))),128))],2)):(r(),g("table",{key:1,class:a(e.$style.table)},[o("thead",null,[o("tr",null,[(r(!0),g(M,null,E(e.tableData.columns||[],(u,p)=>(r(),g("th",{key:u},[h(H,{placement:"bottom-start",disabled:!e.mappingEnabled,"show-after":1e3},{content:d(()=>[o("div",null,[ve,T(" "+$(e.$locale.baseText("dataMapping.dragColumnToFieldHint")),1)])]),default:d(()=>[h(_,{type:"mapping",data:e.getExpression(u),disabled:!e.mappingEnabled,onDragstart:e.onDragStart,onDragend:i=>e.onDragEnd(i,"column")},{preview:d(({canDrop:i})=>[h(y,{html:e.shorten(u,16,2),"can-drop":i},null,8,["html","can-drop"])]),default:d(({isDragging:i})=>[o("div",{class:a({[e.$style.header]:!0,[e.$style.draggableHeader]:e.mappingEnabled,[e.$style.activeHeader]:(p===e.activeColumn||e.forceShowGrip)&&e.mappingEnabled,[e.$style.draggingHeader]:i})},[h(D,{content:e.getValueToRender(u||""),search:e.search},null,8,["content","search"]),o("div",{class:a(e.$style.dragButton)},[h(s,{icon:"grip-vertical"})],2)],2)]),_:2},1032,["data","disabled","onDragstart","onDragend"])]),_:2},1032,["disabled"])]))),128)),e.columnLimitExceeded?(r(),g("th",{key:0,class:a(e.$style.header)},[h(H,{placement:"bottom-end"},{content:d(()=>[o("div",null,[h(P,{tag:"span",keypath:"dataMapping.tableView.tableColumnsExceeded.tooltip"},{columnLimit:d(()=>[T($(e.columnLimit),1)]),link:d(()=>[o("a",{onClick:t[2]||(t[2]=(...u)=>e.switchToJsonView&&e.switchToJsonView(...u))},$(e.$locale.baseText("dataMapping.tableView.tableColumnsExceeded.tooltip.link")),1)]),_:1})])]),default:d(()=>[o("span",null,[h(s,{class:a(e.$style.warningTooltip),icon:"exclamation-triangle"},null,8,["class"]),T(" "+$(e.$locale.baseText("dataMapping.tableView.tableColumnsExceeded")),1)])]),_:1})],2)):N("",!0),o("th",{class:a(e.$style.tableRightMargin)},null,2)])]),h(_,{ref:"draggable",tag:"tbody",type:"mapping","target-data-key":"mappable",disabled:!e.mappingEnabled,onDragstart:e.onCellDragStart,onDragend:e.onCellDragEnd},{preview:d(({canDrop:u,el:p})=>[h(y,{html:e.shorten(e.getPathNameFromTarget(p)||"",16,2),"can-drop":u},null,8,["html","can-drop"])]),default:d(()=>[(r(!0),g(M,null,E(e.tableData.data,(u,p)=>(r(),g("tr",{key:p,class:a({[e.$style.hoveringRow]:e.isHoveringRow(p)}),"data-test-id":e.isHoveringRow(p)?"hovering-item":void 0},[(r(!0),g(M,null,E(u,(i,b)=>(r(),g("td",{key:b,"data-row":p,"data-col":b,class:a(e.hasJsonInColumn(b)?e.$style.minColWidth:e.$style.limitColWidth),onMouseenter:t[4]||(t[4]=(...f)=>e.onMouseEnterCell&&e.onMouseEnterCell(...f)),onMouseleave:t[5]||(t[5]=(...f)=>e.onMouseLeaveCell&&e.onMouseLeaveCell(...f))},[e.isSimple(i)?(r(),K(D,{key:0,content:e.getValueToRender(i),search:e.search,class:a({[e.$style.value]:!0,[e.$style.empty]:e.isEmpty(i)})},null,8,["content","search","class"])):(r(),K(k,{key:1,"node-class":e.$style.nodeClass,value:i},{label:d(({label:f,path:w})=>[o("span",{class:a({[e.$style.hoveringKey]:e.mappingEnabled&&e.isHovering(w,b),[e.$style.draggingKey]:e.isDraggingKey(w,b),[e.$style.dataKey]:!0,[e.$style.mappable]:e.mappingEnabled}),"data-target":"mappable","data-name":e.getCellPathName(w,b),"data-value":e.getCellExpression(w,b),"data-depth":w.length,onMouseenter:()=>e.onMouseEnterKey(w,b),onMouseleave:t[3]||(t[3]=(...V)=>e.onMouseLeaveKey&&e.onMouseLeaveKey(...V))},$(f||e.$locale.baseText("runData.unnamedField")),43,we)]),value:d(({value:f})=>[h(D,{content:e.getValueToRender(f),search:e.search,class:a({[e.$style.nestedValue]:!0,[e.$style.empty]:e.isEmpty(f)})},null,8,["content","search","class"])]),_:2},1032,["node-class","value"]))],42,De))),128)),e.columnLimitExceeded?(r(),g("td",$e)):N("",!0),o("td",{class:a(e.$style.tableRightMargin)},null,2)],10,Ce))),128))]),_:1},8,["disabled","onDragstart","onDragend"])],2))],2)}const Ee={$style:be},lt=G(U,[["render",Me],["__cssModules",Ee]]);export{lt as default};
//# sourceMappingURL=RunDataTable-BVAuNDP9.js.map
