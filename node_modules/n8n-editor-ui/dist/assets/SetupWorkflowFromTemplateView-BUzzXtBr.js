import{r as U,e as k,G as D,az as K,aH as z,d as G,D as q,b as j,ag as W,l as o,M as f,O as C,u as a,S as x,T as $,p as h,I as u,m as A,F as Q,a7 as X,U as g}from"./vendor-Dv5OeN6t.js";import{d as J}from"./pinia-sugP77Im.js";import{$ as Y,a4 as Z,aR as ee,l as te,j as ae,dc as se,V as E,b4 as V,a3 as oe,G as H,bG as le,dd as re,de as ne,x as ie,df as de}from"./index-1OxaEeO3.js";import{c as pe}from"./templateActions-w_1vSarr.js";import{a9 as ue,ar as ce,_ as me}from"./n8n-4UEsHtUL.js";import{T as fe}from"./TemplatesView-BbunSn-s.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const ye=J("setupTemplate",()=>{const l=U(""),e=U(!0),d=U(!1),c=Y(),y=Z(),i=ee(),v=te(),N=ae(),r=k(()=>l.value?c.getFullTemplateById(l.value):null),R=k(()=>{var s;return((s=r.value)==null?void 0:s.workflow.nodes)??[]}),{appCredentials:P,credentialOverrides:b,credentialUsages:t,credentialsByKey:n,nodesRequiringCredentialsSorted:m,numFilledCredentials:I,selectedCredentialIdByKey:T,setSelectedCredentialId:p,unsetSelectedCredential:F}=se(R),w=s=>{l.value=s},O=new Set(["httpBasicAuth","httpCustomAuth","httpDigestAuth","httpHeaderAuth","oAuth1Api","oAuth2Api","httpQueryAuth"]),L=()=>{for(const s of t.value){if(O.has(s.credentialType))continue;const _=i.getCredentialsByType(s.credentialType);_.length===1&&(T.value[s.key]=_[0].id)}},B=async()=>{r.value||!l.value||(await c.fetchTemplateById(l.value),L())};return{credentialsByKey:n,isLoading:e,isSaving:d,appCredentials:P,nodesRequiringCredentialsSorted:m,template:r,credentialUsages:t,selectedCredentialIdByKey:T,credentialOverrides:b,numFilledCredentials:I,createWorkflow:async s=>{const{router:_}=s,S=H();if(r.value)try{d.value=!0;const M=await pe({template:r.value,credentialOverrides:b.value,rootStore:v,workflowsStore:N,nodeTypeProvider:y});S.track("User closed cred setup",{completed:!0,creds_filled:I.value,creds_needed:t.value.length,workflow_id:M.id}),S.track("User inserted workflow template",{source:"workflow",template_id:V(l.value),wf_template_repo_session_id:c.currentSessionId},{withPostHog:!0}),S.track("User saved new workflow from template",{template_id:V(l.value),workflow_id:M.id,wf_template_repo_session_id:c.currentSessionId}),await _.replace({name:E.WORKFLOW,params:{name:M.id}})}finally{d.value=!1}},skipSetup:async({router:s})=>{const _=oe(),S=H();await _.run("templatesWorkflowView.openWorkflow",{source:"workflow",template_id:l.value,wf_template_repo_session_id:c.currentSessionId}),S.track("User closed cred setup",{completed:!1,creds_filled:0,creds_needed:t.value.length,workflow_id:null}),await s.replace({name:E.TEMPLATE_IMPORT,params:{id:l.value}})},init:async()=>{e.value=!0;try{T.value={},await Promise.all([i.fetchAllCredentials(),i.fetchCredentialTypes(!1),y.loadNodeTypesIfNotLoaded(),B()]),L()}finally{e.value=!1}},loadTemplateIfNeeded:B,setInitialCredentialSelection:L,setTemplateId:w,setSelectedCredentialId:p,unsetSelectedCredential:F}}),ve={key:1},we=D({__name:"SetupWorkflowFromTemplateView",setup(l){const e=ye(),d=ie(),c=le(),y=K(),i=z(),v=k(()=>Array.isArray(y.params.id)?y.params.id[0]:y.params.id),N=k(()=>{var t;return((t=e.template)==null?void 0:t.name)??"unknown"}),r=k(()=>!e.isLoading),R=k(()=>i.resolve({name:E.TEMPLATE_IMPORT,params:{id:v.value}}).fullPath);G(v,async t=>{e.setTemplateId(t),await e.loadTemplateIfNeeded()});const P=async t=>{t.preventDefault(),await e.skipSetup({router:i})},b=async()=>!e.template?!1:e.credentialUsages.length===0?(await e.skipSetup({router:i}),!0):!1;return e.setTemplateId(v.value),q(async()=>{c.isFeatureEnabled(re)||i.replace({name:E.TEMPLATE_IMPORT,params:{id:v.value}})}),j(async()=>{await e.init(),await b()}),(t,n)=>{const m=W("n8n-loading"),I=W("n8n-button"),T=W("n8n-tooltip");return o(),f(fe,{"go-back-enabled":!0},{header:C(()=>[r.value?(o(),f(a(ue),{key:0,tag:"h1",size:"2xlarge"},{default:C(()=>[x($(a(d).baseText("templateSetup.title",{interpolate:{name:N.value}})),1)]),_:1})):(o(),f(m,{key:1,variant:"h1"}))]),content:C(()=>[h("div",{class:u(t.$style.grid)},[h("div",{class:u(t.$style.notice),"data-test-id":"info-callout"},[r.value?(o(),f(ne,{key:0,"app-credentials":a(e).appCredentials},null,8,["app-credentials"])):(o(),f(m,{key:1,variant:"p"}))],2),h("div",null,[r.value?(o(),A("ol",{key:0,class:u(t.$style.appCredentialsContainer)},[(o(!0),A(Q,null,X(a(e).credentialUsages,(p,F)=>(o(),f(de,{key:p.key,class:u(t.$style.appCredential),order:F+1,credentials:p,"selected-credential-id":a(e).selectedCredentialIdByKey[p.key],onCredentialSelected:n[0]||(n[0]=w=>a(e).setSelectedCredentialId(w.credentialUsageKey,w.credentialId)),onCredentialDeselected:n[1]||(n[1]=w=>a(e).unsetSelectedCredential(w.credentialUsageKey))},null,8,["class","order","credentials","selected-credential-id"]))),128))],2)):(o(),A("div",{key:1,class:u(t.$style.appCredentialsContainer)},[g(m,{class:u(t.$style.appCredential),variant:"p",rows:3},null,8,["class"]),g(m,{class:u(t.$style.appCredential),variant:"p",rows:3},null,8,["class"])],2))]),h("div",{class:u(t.$style.actions)},[g(a(ce),{href:R.value,"new-window":!1,onClick:n[2]||(n[2]=p=>P(p))},{default:C(()=>[x($(a(d).baseText("templateSetup.skip")),1)]),_:1},8,["href"]),r.value?(o(),f(T,{key:0,content:a(d).baseText("templateSetup.continue.button.fillRemaining"),disabled:a(e).numFilledCredentials>0},{default:C(()=>[g(I,{size:"large",label:a(d).baseText("templateSetup.continue.button"),disabled:a(e).isSaving||a(e).numFilledCredentials===0,"data-test-id":"continue-button",onClick:n[3]||(n[3]=p=>a(e).createWorkflow({router:a(i)}))},null,8,["label","disabled"])]),_:1},8,["content","disabled"])):(o(),A("div",ve,[g(m,{variant:"button"})]))],2)],2)]),_:1})}}}),_e="_grid_6bgsx_1",ke="_notice_6bgsx_9",Te="_appCredentialsContainer_6bgsx_13",Se="_appCredential_6bgsx_13",Ce="_actions_6bgsx_24",ge={grid:_e,notice:ke,appCredentialsContainer:Te,appCredential:Se,actions:Ce},be={$style:ge},lt=me(we,[["__cssModules",be]]);export{lt as default};
//# sourceMappingURL=SetupWorkflowFromTemplateView-BUzzXtBr.js.map
