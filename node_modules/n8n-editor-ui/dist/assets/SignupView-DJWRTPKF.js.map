{"version":3,"file":"SignupView-DJWRTPKF.js","sources":["../../src/views/SignupView.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport AuthView from '@/views/AuthView.vue';\nimport { useToast } from '@/composables/useToast';\n\nimport { computed, onMounted, ref } from 'vue';\nimport type { IFormBoxConfig } from '@/Interface';\nimport { VIEWS } from '@/constants';\nimport { useUIStore } from '@/stores/ui.store';\nimport { useUsersStore } from '@/stores/users.store';\nimport { useI18n } from '@/composables/useI18n';\nimport { useRoute, useRouter } from 'vue-router';\n\nconst uiStore = useUIStore();\nconst usersStore = useUsersStore();\n\nconst toast = useToast();\nconst i18n = useI18n();\nconst router = useRouter();\nconst route = useRoute();\n\nconst FORM_CONFIG: IFormBoxConfig = {\n\ttitle: i18n.baseText('auth.signup.setupYourAccount'),\n\tbuttonText: i18n.baseText('auth.signup.finishAccountSetup'),\n\tinputs: [\n\t\t{\n\t\t\tname: 'firstName',\n\t\t\tproperties: {\n\t\t\t\tlabel: i18n.baseText('auth.firstName'),\n\t\t\t\tmaxlength: 32,\n\t\t\t\trequired: true,\n\t\t\t\tautocomplete: 'given-name',\n\t\t\t\tcapitalize: true,\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname: 'lastName',\n\t\t\tproperties: {\n\t\t\t\tlabel: i18n.baseText('auth.lastName'),\n\t\t\t\tmaxlength: 32,\n\t\t\t\trequired: true,\n\t\t\t\tautocomplete: 'family-name',\n\t\t\t\tcapitalize: true,\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname: 'password',\n\t\t\tproperties: {\n\t\t\t\tlabel: i18n.baseText('auth.password'),\n\t\t\t\ttype: 'password',\n\t\t\t\tvalidationRules: [{ name: 'DEFAULT_PASSWORD_RULES' }],\n\t\t\t\trequired: true,\n\t\t\t\tinfoText: i18n.baseText('auth.defaultPasswordRequirements'),\n\t\t\t\tautocomplete: 'new-password',\n\t\t\t\tcapitalize: true,\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname: 'agree',\n\t\t\tproperties: {\n\t\t\t\tlabel: i18n.baseText('auth.agreement.label'),\n\t\t\t\ttype: 'checkbox',\n\t\t\t},\n\t\t},\n\t],\n};\n\nconst loading = ref(false);\nconst inviter = ref<null | { firstName: string; lastName: string }>(null);\nconst inviterId = ref<string | null>(null);\nconst inviteeId = ref<string | null>(null);\n\nconst inviteMessage = computed(() => {\n\tif (!inviter.value) {\n\t\treturn '';\n\t}\n\n\treturn i18n.baseText('settings.signup.signUpInviterInfo', {\n\t\tinterpolate: { firstName: inviter.value.firstName, lastName: inviter.value.lastName },\n\t});\n});\n\nonMounted(async () => {\n\tconst inviterIdParam = getQueryParameter('inviterId');\n\tconst inviteeIdParam = getQueryParameter('inviteeId');\n\ttry {\n\t\tif (!inviterIdParam || !inviteeIdParam) {\n\t\t\tthrow new Error(i18n.baseText('auth.signup.missingTokenError'));\n\t\t}\n\n\t\tinviterId.value = inviterIdParam;\n\t\tinviteeId.value = inviteeIdParam;\n\n\t\tconst invite = await usersStore.validateSignupToken({\n\t\t\tinviteeId: inviteeId.value,\n\t\t\tinviterId: inviterId.value,\n\t\t});\n\t\tinviter.value = invite.inviter as { firstName: string; lastName: string };\n\t} catch (e) {\n\t\ttoast.showError(e, i18n.baseText('auth.signup.tokenValidationError'));\n\t\tvoid router.replace({ name: VIEWS.SIGNIN });\n\t}\n});\n\nasync function onSubmit(values: { [key: string]: string | boolean }) {\n\tif (!inviterId.value || !inviteeId.value) {\n\t\ttoast.showError(\n\t\t\tnew Error(i18n.baseText('auth.signup.tokenValidationError')),\n\t\t\ti18n.baseText('auth.signup.setupYourAccountError'),\n\t\t);\n\t\treturn;\n\t}\n\n\ttry {\n\t\tloading.value = true;\n\t\tawait usersStore.acceptInvitation({\n\t\t\t...values,\n\t\t\tinviterId: inviterId.value,\n\t\t\tinviteeId: inviteeId.value,\n\t\t} as {\n\t\t\tinviteeId: string;\n\t\t\tinviterId: string;\n\t\t\tfirstName: string;\n\t\t\tlastName: string;\n\t\t\tpassword: string;\n\t\t});\n\n\t\tif (values.agree === true) {\n\t\t\ttry {\n\t\t\t\tawait uiStore.submitContactEmail(values.email.toString(), values.agree);\n\t\t\t} catch {}\n\t\t}\n\n\t\tawait router.push({ name: VIEWS.NEW_WORKFLOW });\n\t} catch (error) {\n\t\ttoast.showError(error, i18n.baseText('auth.signup.setupYourAccountError'));\n\t}\n\tloading.value = false;\n}\n\nfunction getQueryParameter(key: 'inviterId' | 'inviteeId'): string | null {\n\treturn !route.query[key] || typeof route.query[key] !== 'string'\n\t\t? null\n\t\t: (route.query[key] as string);\n}\n</script>\n\n<template>\n\t<AuthView\n\t\t:form=\"FORM_CONFIG\"\n\t\t:form-loading=\"loading\"\n\t\t:subtitle=\"inviteMessage\"\n\t\t@submit=\"onSubmit\"\n\t/>\n</template>\n"],"names":["uiStore","useUIStore","usersStore","useUsersStore","toast","useToast","i18n","useI18n","router","useRouter","route","useRoute","FORM_CONFIG","loading","ref","inviter","inviterId","inviteeId","inviteMessage","computed","onMounted","inviterIdParam","getQueryParameter","inviteeIdParam","invite","e","VIEWS","onSubmit","values","error","key"],"mappings":"srCAYA,MAAMA,EAAUC,IACVC,EAAaC,IAEbC,EAAQC,IACRC,EAAOC,IACPC,EAASC,IACTC,EAAQC,IAERC,EAA8B,CACnC,MAAON,EAAK,SAAS,8BAA8B,EACnD,WAAYA,EAAK,SAAS,gCAAgC,EAC1D,OAAQ,CACP,CACC,KAAM,YACN,WAAY,CACX,MAAOA,EAAK,SAAS,gBAAgB,EACrC,UAAW,GACX,SAAU,GACV,aAAc,aACd,WAAY,EACb,CACD,EACA,CACC,KAAM,WACN,WAAY,CACX,MAAOA,EAAK,SAAS,eAAe,EACpC,UAAW,GACX,SAAU,GACV,aAAc,cACd,WAAY,EACb,CACD,EACA,CACC,KAAM,WACN,WAAY,CACX,MAAOA,EAAK,SAAS,eAAe,EACpC,KAAM,WACN,gBAAiB,CAAC,CAAE,KAAM,yBAA0B,EACpD,SAAU,GACV,SAAUA,EAAK,SAAS,kCAAkC,EAC1D,aAAc,eACd,WAAY,EACb,CACD,EACA,CACC,KAAM,QACN,WAAY,CACX,MAAOA,EAAK,SAAS,sBAAsB,EAC3C,KAAM,UACP,CACD,CACD,CAAA,EAGKO,EAAUC,EAAI,EAAK,EACnBC,EAAUD,EAAoD,IAAI,EAClEE,EAAYF,EAAmB,IAAI,EACnCG,EAAYH,EAAmB,IAAI,EAEnCI,EAAgBC,EAAS,IACzBJ,EAAQ,MAINT,EAAK,SAAS,oCAAqC,CACzD,YAAa,CAAE,UAAWS,EAAQ,MAAM,UAAW,SAAUA,EAAQ,MAAM,QAAS,CAAA,CACpF,EALO,EAMR,EAEDK,EAAU,SAAY,CACf,MAAAC,EAAiBC,EAAkB,WAAW,EAC9CC,EAAiBD,EAAkB,WAAW,EAChD,GAAA,CACC,GAAA,CAACD,GAAkB,CAACE,EACvB,MAAM,IAAI,MAAMjB,EAAK,SAAS,+BAA+B,CAAC,EAG/DU,EAAU,MAAQK,EAClBJ,EAAU,MAAQM,EAEZ,MAAAC,EAAS,MAAMtB,EAAW,oBAAoB,CACnD,UAAWe,EAAU,MACrB,UAAWD,EAAU,KAAA,CACrB,EACDD,EAAQ,MAAQS,EAAO,cACfC,EAAG,CACXrB,EAAM,UAAUqB,EAAGnB,EAAK,SAAS,kCAAkC,CAAC,EAC/DE,EAAO,QAAQ,CAAE,KAAMkB,EAAM,OAAQ,CAC3C,CAAA,CACA,EAED,eAAeC,EAASC,EAA6C,CACpE,GAAI,CAACZ,EAAU,OAAS,CAACC,EAAU,MAAO,CACnCb,EAAA,UACL,IAAI,MAAME,EAAK,SAAS,kCAAkC,CAAC,EAC3DA,EAAK,SAAS,mCAAmC,CAAA,EAElD,MACD,CAEI,GAAA,CAcC,GAbJO,EAAQ,MAAQ,GAChB,MAAMX,EAAW,iBAAiB,CACjC,GAAG0B,EACH,UAAWZ,EAAU,MACrB,UAAWC,EAAU,KAAA,CAOrB,EAEGW,EAAO,QAAU,GAChB,GAAA,CACH,MAAM5B,EAAQ,mBAAmB4B,EAAO,MAAM,WAAYA,EAAO,KAAK,CAAA,MAC/D,CAAC,CAGV,MAAMpB,EAAO,KAAK,CAAE,KAAMkB,EAAM,aAAc,QACtCG,EAAO,CACfzB,EAAM,UAAUyB,EAAOvB,EAAK,SAAS,mCAAmC,CAAC,CAC1E,CACAO,EAAQ,MAAQ,EACjB,CAEA,SAASS,EAAkBQ,EAA+C,CACzE,MAAO,CAACpB,EAAM,MAAMoB,CAAG,GAAK,OAAOpB,EAAM,MAAMoB,CAAG,GAAM,SACrD,KACCpB,EAAM,MAAMoB,CAAG,CACpB"}