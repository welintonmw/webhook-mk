import{m as G}from"./pinia-sugP77Im.js";import{e as se,d$ as re,E as oe,o as ae,d as le,a as ne,x as ie,G as de}from"./index-1OxaEeO3.js";import{G as B,l as n,m as h,H as f,p as b,I as u,R as P,ag as r,M as g,O as i,U as c,P as J,V as Q,S as F,T as k,az as ue,r as w,e as W,d as D,b as ce,n as fe,ab as pe,al as me,F as q,a7 as ye}from"./vendor-Dv5OeN6t.js";import{_ as M}from"./n8n-4UEsHtUL.js";const he=B({name:"PageViewLayout",data(){return{loading:!1}},computed:{...G(se)}}),ge="_wrapper_u24kg_1",$e="_content_u24kg_12",ve={wrapper:ge,content:$e};function we(e,s,p,C,j,L){return n(),h("div",{class:u(e.$style.wrapper)},[f(e.$slots,"header"),b("main",{class:u(e.$style.content)},[f(e.$slots,"default")],2)],2)}const be={$style:ve},_e=M(he,[["render",we],["__cssModules",be]]),Pe=B({props:{overflow:{type:Boolean,default:!1}}}),Fe="_wrapper_183my_1",ke="_overflow_183my_6",je="_list_183my_6",Se="_body_183my_6",Ve={wrapper:Fe,overflow:ke,list:je,body:Se};function Ae(e,s,p,C,j,L){return n(),h("div",{class:u({[e.$style.wrapper]:!0,[e.$style.overflow]:e.overflow})},[b("div",{class:u(e.$style.list)},[e.$slots.header?(n(),h("div",{key:0,class:u(e.$style.header)},[f(e.$slots,"header")],2)):P("",!0),b("div",{class:u(e.$style.body)},[f(e.$slots,"default")],2)],2)],2)}const Ce={$style:Ve},Le=M(Pe,[["render",Ae],["__cssModules",Ce]]),Ue=B({components:{ProjectSharing:re},props:{modelValue:{type:Object,default:()=>({})},keys:{type:Array,default:()=>[]},shareable:{type:Boolean,default:!0},reset:{type:Function,default:()=>{}}},data(){return{EnterpriseEditionFeature:oe,selectedProject:null}},computed:{...G(ae),filtersLength(){let e=0;return this.keys.forEach(s=>{if(s==="search")return;const p=this.modelValue[s];e+=(Array.isArray(p)?p.length>0:p!=="")?1:0}),e},hasFilters(){return this.filtersLength>0}},watch:{filtersLength(e){this.$emit("update:filtersLength",e)}},async beforeMount(){await this.projectsStore.getAllProjects(),this.selectedProject=this.projectsStore.projects.find(e=>e.id===this.modelValue.homeProject)??null},methods:{setKeyValue(e,s){const p={...this.modelValue,[e]:s};this.$emit("update:modelValue",p)},resetFilters(){if(this.reset)this.reset();else{const e={...this.modelValue};this.keys.forEach(s=>{e[s]=Array.isArray(this.modelValue[s])?[]:""}),this.$emit("update:modelValue",e)}this.selectedProject=null}}}),De={"filter-button":"_filter-button_91qwg_1","filters-dropdown":"_filters-dropdown_91qwg_6","filters-dropdown-footer":"_filters-dropdown-footer_91qwg_11"};function Te(e,s,p,C,j,L){const $=r("n8n-badge"),S=r("n8n-button"),m=r("n8n-input-label"),_=r("ProjectSharing"),o=r("enterprise-edition"),V=r("n8n-link"),A=r("n8n-popover");return n(),g(A,{trigger:"click",width:"304",size:"large"},{reference:i(()=>[c(S,{icon:"filter",type:"tertiary",active:e.hasFilters,class:u(e.$style["filter-button"]),"data-test-id":"resources-list-filters-trigger"},{default:i(()=>[J(c($,{theme:"primary",class:"mr-4xs"},{default:i(()=>[F(k(e.filtersLength),1)]),_:1},512),[[Q,e.filtersLength>0]]),F(" "+k(e.$locale.baseText("forms.resourceFiltersDropdown.filters")),1)]),_:1},8,["active","class"])]),default:i(()=>[b("div",{class:u(e.$style["filters-dropdown"]),"data-test-id":"resources-list-filters-dropdown"},[f(e.$slots,"default",{filters:e.modelValue,setKeyValue:e.setKeyValue}),e.shareable&&e.projectsStore.isProjectHome?(n(),g(o,{key:0,features:[e.EnterpriseEditionFeature.Sharing]},{default:i(()=>[c(m,{label:e.$locale.baseText("forms.resourceFiltersDropdown.owner"),bold:!1,size:"small",color:"text-base",class:"mb-3xs"},null,8,["label"]),c(_,{modelValue:e.selectedProject,"onUpdate:modelValue":[s[0]||(s[0]=y=>e.selectedProject=y),s[1]||(s[1]=y=>e.setKeyValue("homeProject",y.id))],class:"pt-2xs",projects:e.projectsStore.projects,placeholder:e.$locale.baseText("forms.resourceFiltersDropdown.owner.placeholder"),"empty-options-text":e.$locale.baseText("projects.sharing.noMatchingProjects")},null,8,["modelValue","projects","placeholder","empty-options-text"])]),_:1},8,["features"])):P("",!0),e.hasFilters?(n(),h("div",{key:1,class:u([e.$style["filters-dropdown-footer"],"mt-s"])},[c(V,{onClick:e.resetFilters},{default:i(()=>[F(k(e.$locale.baseText("forms.resourceFiltersDropdown.reset")),1)]),_:1},8,["onClick"])],2)):P("",!0)],2)]),_:3})}const Ke={$style:De},ze=M(Ue,[["render",Te],["__cssModules",Ke]]),Re=B({name:"ResourcesListLayout",components:{PageViewLayout:_e,PageViewLayoutList:Le,ResourceFiltersDropdown:ze},props:{resourceKey:{type:String,default:""},displayName:{type:Function,default:e=>e.name},resources:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},initialize:{type:Function,default:()=>async()=>{}},filters:{type:Object,default:()=>({search:"",homeProject:""})},additionalFiltersHandler:{type:Function,required:!1,default:void 0},shareable:{type:Boolean,default:!0},showFiltersDropdown:{type:Boolean,default:!0},sortFns:{type:Object,default:()=>({})},sortOptions:{type:Array,default:()=>["lastUpdated","lastCreated","nameAsc","nameDesc"]},type:{type:String,default:"list"},typeProps:{type:Object,default:()=>({itemSize:80})}},emits:["update:filters","click:add","sort"],setup(e,{emit:s}){const p=ue(),C=ie(),{callDebounced:j}=le(),L=ne(),$=de(),S=w(!0),m=w(e.sortOptions[0]),_=w(!1),o=w(e.filters),V=w(1),A=w(10),y=w(!1),U=w(null),T=W(()=>Object.keys(o.value)),K=W(()=>e.resources.filter(d=>{let a=!0;if(o.value.homeProject&&(a=a&&!!(d.homeProject&&d.homeProject.id===o.value.homeProject)),o.value.search){const z=o.value.search.toLowerCase();a=a&&e.displayName(d).toLowerCase().includes(z)}return e.additionalFiltersHandler&&(a=e.additionalFiltersHandler(d,o.value,a)),a}).sort((d,a)=>{switch(m.value){case"lastUpdated":return e.sortFns.lastUpdated?e.sortFns.lastUpdated(d,a):new Date(a.updatedAt??"").valueOf()-new Date(d.updatedAt??"").valueOf();case"lastCreated":return e.sortFns.lastCreated?e.sortFns.lastCreated(d,a):new Date(a.createdAt??"").valueOf()-new Date(d.createdAt??"").valueOf();case"nameAsc":return e.sortFns.nameAsc?e.sortFns.nameAsc(d,a):e.displayName(d).trim().localeCompare(e.displayName(a).trim());case"nameDesc":return e.sortFns.nameDesc?e.sortFns.nameDesc(d,a):e.displayName(a).trim().localeCompare(e.displayName(d).trim());default:return e.sortFns[m.value]?e.sortFns[m.value](d,a):0}})),N=()=>{U.value&&U.value.focus()},O=()=>!!T.value.find(t=>t!=="search"&&(Array.isArray(e.filters[t])?e.filters[t].length>0:e.filters[t]!=="")),E=t=>{A.value=t},H=t=>{V.value=t},l=t=>{if(y.value){if(t!=="reset")return;setTimeout(()=>y.value=!1,1500)}const d=o.value,a=[],z=[];Object.keys(d).forEach(R=>{d[R]&&(a.push(R),z.push(R==="search"?null:d[R]))}),$.track(`User set filters in ${e.resourceKey} list`,{filters_set:a,filter_values:z,[`${e.resourceKey}_total_in_view`]:e.resources.length,[`${e.resourceKey}_after_filtering`]:K.value.length})},v=t=>{s("click:add",t)},X=t=>{s("update:filters",t)},I=()=>{Object.keys(o.value).forEach(t=>{o.value[t]=Array.isArray(o.value[t])?[]:""}),y.value=!0,l("reset"),s("update:filters",o.value)},Y=()=>"itemSize"in e.typeProps?e.typeProps.itemSize:0,Z=()=>"columns"in e.typeProps?e.typeProps.columns:{},x=()=>{$.track(`User changed sorting in ${e.resourceKey} list`,{sorting:m.value})},ee=t=>{_.value=t>0},te=t=>{o.value.search=t,s("update:filters",o.value)};return D(()=>e.filters,t=>{o.value=t}),D(()=>o.value.homeProject,()=>{l("homeProject")}),D(()=>o.value.search,()=>j(l,{debounceTime:1e3,trailing:!0},"search")),D(()=>m.value,t=>{s("sort",t),x()}),D(()=>{var t;return(t=p==null?void 0:p.params)==null?void 0:t.projectId},()=>{I()}),ce(async()=>{await e.initialize(),S.value=!1,await fe(),N(),O()&&(_.value=!0)}),{loading:S,i18n:C,search:U,usersStore:L,filterKeys:T,currentPage:V,rowsPerPage:A,filteredAndSortedResources:K,hasFilters:_,sortBy:m,resettingFilters:y,filtersModel:o,sendFiltersTelemetry:l,getColumns:Z,itemSize:Y,onAddButtonClick:v,onUpdateFiltersLength:ee,onUpdateFilters:X,resetFilters:I,callDebounced:j,setCurrentPage:H,setRowsPerPage:E,onSearch:te}}}),Be="_filters_18koc_1",Me="_search_18koc_16",Ne="_listWrapper_18koc_20",Oe="_datatable_18koc_38",Ee={"filters-row":"_filters-row_18koc_1",filters:Be,search:Me,listWrapper:Ne,"sort-and-filter":"_sort-and-filter_18koc_26","header-loading":"_header-loading_18koc_30","card-loading":"_card-loading_18koc_34",datatable:Oe},He={key:0},Ie={key:0},We={key:0,class:"mt-xs"},qe=b("div",{class:"pb-xs"},null,-1);function Ge(e,s,p,C,j,L){const $=r("n8n-loading"),S=r("n8n-action-box"),m=r("n8n-icon"),_=r("n8n-input"),o=r("ResourceFiltersDropdown"),V=r("n8n-option"),A=r("n8n-select"),y=r("n8n-button"),U=r("n8n-link"),T=r("n8n-info-tip"),K=r("n8n-recycle-scroller"),N=r("n8n-datatable"),O=r("n8n-text"),E=r("PageViewLayoutList"),H=r("PageViewLayout");return n(),g(H,null,{header:i(()=>[f(e.$slots,"header")]),default:i(()=>[e.loading?(n(),h("div",He,[c($,{class:u([e.$style["header-loading"],"mb-l"]),variant:"custom"},null,8,["class"]),c($,{class:u([e.$style["card-loading"],"mb-2xs"]),variant:"custom"},null,8,["class"]),c($,{class:u(e.$style["card-loading"]),variant:"custom"},null,8,["class"])])):(n(),h(q,{key:1},[e.resources.length===0?(n(),h("div",Ie,[f(e.$slots,"empty",{},()=>{var l,v;return[c(S,{"data-test-id":"empty-resources-list",emoji:"ðŸ‘‹",heading:e.i18n.baseText((l=e.usersStore.currentUser)!=null&&l.firstName?`${e.resourceKey}.empty.heading`:`${e.resourceKey}.empty.heading.userNotSetup`,{interpolate:{name:((v=e.usersStore.currentUser)==null?void 0:v.firstName)??""}}),description:e.i18n.baseText(`${e.resourceKey}.empty.description`),"button-text":e.i18n.baseText(`${e.resourceKey}.empty.button`),"button-type":"secondary","onClick:button":e.onAddButtonClick},null,8,["heading","description","button-text","onClick:button"])]})])):(n(),g(E,{key:1,overflow:e.type!=="list"},{header:i(()=>[b("div",{class:u(e.$style["filters-row"])},[b("div",{class:u(e.$style.filters)},[c(_,{ref:"search","model-value":e.filtersModel.search,class:u([e.$style.search,"mr-2xs"]),placeholder:e.i18n.baseText(`${e.resourceKey}.search.placeholder`),clearable:"","data-test-id":"resources-list-search","onUpdate:modelValue":e.onSearch},{prefix:i(()=>[c(m,{icon:"search"})]),_:1},8,["model-value","class","placeholder","onUpdate:modelValue"]),e.showFiltersDropdown?(n(),g(o,{key:0,keys:e.filterKeys,reset:e.resetFilters,"model-value":e.filtersModel,shareable:e.shareable,"onUpdate:modelValue":e.onUpdateFilters,"onUpdate:filtersLength":e.onUpdateFiltersLength},{default:i(l=>[f(e.$slots,"filters",pe(me(l)))]),_:3},8,["keys","reset","model-value","shareable","onUpdate:modelValue","onUpdate:filtersLength"])):P("",!0),b("div",{class:u(e.$style["sort-and-filter"])},[c(A,{modelValue:e.sortBy,"onUpdate:modelValue":s[0]||(s[0]=l=>e.sortBy=l),"data-test-id":"resources-list-sort"},{default:i(()=>[(n(!0),h(q,null,ye(e.sortOptions,l=>(n(),g(V,{key:l,"data-test-id":"resources-list-sort-item",value:l,label:e.i18n.baseText(`${e.resourceKey}.sort.${l}`)},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])],2)],2),f(e.$slots,"add-button",{disabled:e.disabled},()=>[c(y,{size:"large",disabled:e.disabled,"data-test-id":"resources-list-add",onClick:e.onAddButtonClick},{default:i(()=>[F(k(e.i18n.baseText(`${e.resourceKey}.add`)),1)]),_:1},8,["disabled","onClick"])])],2),f(e.$slots,"callout"),e.showFiltersDropdown?J((n(),h("div",We,[c(T,{bold:!1},{default:i(()=>[F(k(e.i18n.baseText(`${e.resourceKey}.filters.active`))+" ",1),c(U,{"data-test-id":"workflows-filter-reset",size:"small",onClick:e.resetFilters},{default:i(()=>[F(k(e.i18n.baseText(`${e.resourceKey}.filters.active.reset`)),1)]),_:1},8,["onClick"])]),_:1})],512)),[[Q,e.hasFilters]]):P("",!0),qe]),default:i(()=>[f(e.$slots,"preamble"),e.filteredAndSortedResources.length>0?(n(),h("div",{key:0,ref:"listWrapperRef",class:u(e.$style.listWrapper)},[e.type==="list"?(n(),g(K,{key:0,"data-test-id":"resources-list",items:e.filteredAndSortedResources,"item-size":e.itemSize(),"item-key":"id"},{default:i(({item:l,updateItemSize:v})=>[f(e.$slots,"default",{data:l,updateItemSize:v})]),_:3},8,["items","item-size"])):P("",!0),e.type==="datatable"?(n(),g(N,{key:1,"data-test-id":"resources-table",class:u(e.$style.datatable),columns:e.getColumns(),rows:e.filteredAndSortedResources,"current-page":e.currentPage,"rows-per-page":e.rowsPerPage,"onUpdate:currentPage":e.setCurrentPage,"onUpdate:rowsPerPage":e.setRowsPerPage},{row:i(({columns:l,row:v})=>[f(e.$slots,"default",{data:v,columns:l})]),_:3},8,["class","columns","rows","current-page","rows-per-page","onUpdate:currentPage","onUpdate:rowsPerPage"])):P("",!0)],2)):(n(),g(O,{key:1,color:"text-base",size:"medium","data-test-id":"resources-list-empty"},{default:i(()=>[F(k(e.i18n.baseText(`${e.resourceKey}.noResults`)),1)]),_:1})),f(e.$slots,"postamble")]),_:3},8,["overflow"]))],64))]),_:3})}const Je={$style:Ee},xe=M(Re,[["render",Ge],["__cssModules",Je]]);export{xe as R};
//# sourceMappingURL=ResourcesListLayout-B4W1PSHT.js.map
