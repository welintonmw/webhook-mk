import{G as H,az as J,aH as Q,r as f,e as A,b as X,ag as u,l as i,m as d,U as l,O as s,S as p,T as o,u as t,M as k,I as r,R as h,p as g,J as Y,a2 as Z}from"./vendor-Dv5OeN6t.js";import{cR as ee,e as te,u as ne,t as ae,O as a,dn as se,dp as oe}from"./index-1OxaEeO3.js";import{_ as ie}from"./n8n-4UEsHtUL.js";import"./pinia-sugP77Im.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const le={class:"settings-usage-and-plan"},ce={key:1},re={key:0},ue={key:1},de={key:0},pe={key:1},ge=["href"],_e=["href"],me=H({__name:"SettingsUsageAndPlan",setup(ze){const n=ee(),P=J(),B=Q(),I=te(),x=ne(),T=f(`callback=${encodeURIComponent(`${window.location.origin}${window.location.pathname}`)}`),V=A(()=>`${n.viewPlansUrl}&${T.value}&source=usage_page`),j=A(()=>`${n.managePlanUrl}&${T.value}`),_=f(!1),v=f(""),w=f(null),$=A(()=>ae(["rbac"],{rbac:{scope:"license:manage"}})),z=()=>{x.showMessage({type:"success",title:a.baseText("settings.usageAndPlan.license.activation.success.title"),message:a.baseText("settings.usageAndPlan.license.activation.success.message",{interpolate:{name:n.planName,type:n.planId?a.baseText("settings.usageAndPlan.plan"):a.baseText("settings.usageAndPlan.edition")}})})},L=e=>{x.showError(e,a.baseText("settings.usageAndPlan.license.activation.error.title"),e.message)},S=async()=>{try{await n.activateLicense(v.value),_.value=!1,z()}catch(e){L(e)}};X(async()=>{if(!n.isDesktop){if(n.setLoading(!0),P.query.key)try{await n.activateLicense(P.query.key),await B.replace({query:{}}),z(),n.setLoading(!1);return}catch(e){L(e)}try{!P.query.key&&$.value?await n.refreshLicenseManagementToken():await n.getLicenseInfo(),n.setLoading(!1)}catch(e){e.name||(e.name=a.baseText("settings.usageAndPlan.error")),x.showError(e,e.name,e.message)}}});const y=e=>{const c=n.telemetryPayload;c.action=e,oe.track("User clicked button on usage page",c)},q=()=>{_.value=!0,y("add_activation_key")},M=()=>{I.goToUpgrade("usage_page","open"),y("view_plans")},N=()=>{y("manage_plan")},R=()=>{v.value=""},D=()=>{var e;(e=w.value)==null||e.focus()},E=()=>{y("desktop_view_plans"),window.open(se,"_blank")};return(e,c)=>{const C=u("n8n-heading"),K=u("n8n-action-box"),U=u("i18n-t"),O=u("n8n-text"),W=u("n8n-info-tip"),m=u("n8n-button"),F=u("n8n-input"),G=u("el-dialog");return i(),d("div",le,[l(C,{size:"2xlarge"},{default:s(()=>[p(o(t(a).baseText("settings.usageAndPlan.title")),1)]),_:1}),t(n).isDesktop?(i(),k(K,{key:0,class:r(e.$style.actionBox),heading:t(a).baseText("settings.usageAndPlan.desktop.title"),description:t(a).baseText("settings.usageAndPlan.desktop.description"),"button-text":t(a).baseText("settings.usageAndPlan.button.plans"),"onClick:button":E},null,8,["class","heading","description","button-text"])):h("",!0),!t(n).isDesktop&&!t(n).isLoading?(i(),d("div",ce,[l(C,{class:r(e.$style.title),size:"large"},{default:s(()=>[l(U,{keypath:"settings.usageAndPlan.description",tag:"span"},{name:s(()=>[p(o(t(n).planName),1)]),type:s(()=>[t(n).planId?(i(),d("span",re,o(t(a).baseText("settings.usageAndPlan.plan")),1)):(i(),d("span",ue,o(t(a).baseText("settings.usageAndPlan.edition")),1))]),_:1})]),_:1},8,["class"]),g("div",{class:r(e.$style.quota)},[l(O,{size:"medium",color:"text-light"},{default:s(()=>[p(o(t(a).baseText("settings.usageAndPlan.activeWorkflows")),1)]),_:1}),g("div",{class:r(e.$style.chart)},[t(n).executionLimit>0?(i(),d("span",{key:0,class:r(e.$style.chartLine)},[g("span",{class:r(e.$style.chartBar),style:Y({width:`${t(n).executionPercentage}%`})},null,6)],2)):h("",!0),l(U,{tag:"span",class:r(e.$style.count),keypath:"settings.usageAndPlan.activeWorkflows.count"},{count:s(()=>[p(o(t(n).executionCount),1)]),limit:s(()=>[t(n).executionLimit<0?(i(),d("span",de,o(t(a).baseText("settings.usageAndPlan.activeWorkflows.unlimited")),1)):(i(),d("span",pe,o(t(n).executionLimit),1))]),_:1},8,["class"])],2)],2),l(W,null,{default:s(()=>[p(o(t(a).baseText("settings.usageAndPlan.activeWorkflows.hint")),1)]),_:1}),g("div",{class:r(e.$style.buttons)},[$.value?(i(),k(m,{key:0,class:r(e.$style.buttonTertiary),type:"tertiary",size:"large",onClick:q},{default:s(()=>[g("span",null,o(t(a).baseText("settings.usageAndPlan.button.activation")),1)]),_:1},8,["class"])):h("",!0),t(n).managementToken?(i(),k(m,{key:1,size:"large",onClick:N},{default:s(()=>[g("a",{href:j.value,target:"_blank"},o(t(a).baseText("settings.usageAndPlan.button.manage")),9,ge)]),_:1})):(i(),k(m,{key:2,size:"large",onClick:Z(M,["prevent"])},{default:s(()=>[g("a",{href:V.value,target:"_blank"},o(t(a).baseText("settings.usageAndPlan.button.plans")),9,_e)]),_:1}))],2),l(G,{modelValue:_.value,"onUpdate:modelValue":c[2]||(c[2]=b=>_.value=b),width:"480px",top:"0",title:t(a).baseText("settings.usageAndPlan.dialog.activation.title"),"modal-class":e.$style.center,onClosed:R,onOpened:D},{default:s(()=>[l(F,{ref_key:"activationKeyInput",ref:w,modelValue:v.value,"onUpdate:modelValue":c[0]||(c[0]=b=>v.value=b),placeholder:t(a).baseText("settings.usageAndPlan.dialog.activation.label")},null,8,["modelValue","placeholder"])]),footer:s(()=>[l(m,{type:"secondary",onClick:c[1]||(c[1]=b=>_.value=!1)},{default:s(()=>[p(o(t(a).baseText("settings.usageAndPlan.dialog.activation.cancel")),1)]),_:1}),l(m,{onClick:S},{default:s(()=>[p(o(t(a).baseText("settings.usageAndPlan.dialog.activation.activate")),1)]),_:1})]),_:1},8,["modelValue","title","modal-class"])])):h("",!0)])}}}),ve="_center_jzvne_1",ye="_actionBox_jzvne_5",be="_spacedFlex_jzvne_9",fe="_title_jzvne_15",ke="_quota_jzvne_20",he="_count_jzvne_32",Pe="_buttons_jzvne_37",xe="_chart_jzvne_53",Ae="_chartLine_jzvne_60",Te="_chartBar_jzvne_70",we={center:ve,actionBox:ye,spacedFlex:be,title:fe,quota:ke,count:he,buttons:Pe,chart:xe,chartLine:Ae,chartBar:Te},$e={$style:we},st=ie(me,[["__cssModules",$e],["__scopeId","data-v-698d6909"]]);export{st as default};
//# sourceMappingURL=SettingsUsageAndPlan-BVPtlthH.js.map
