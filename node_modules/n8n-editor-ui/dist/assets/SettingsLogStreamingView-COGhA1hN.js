import{m as N}from"./pinia-sugP77Im.js";import{H as z,E as M,d1 as O,A as R,aR as x,e as F,j,b as K,t as G,d2 as A}from"./index-1OxaEeO3.js";import{h as D,a3 as T,_ as I,b as q}from"./n8n-4UEsHtUL.js";import{G as H,ag as a,l as o,M as g,O as i,p as s,U as r,S,T as m,I as c,n as Y,m as l,F as v,R as _,a7 as J}from"./vendor-Dv5OeN6t.js";import{v as Q}from"./uuid-SoommWqA.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const y={OPEN:"open",DELETE:"delete"},X=H({components:{},setup(){return{...z()}},data(){return{EnterpriseEditionFeature:M,nodeParameters:{}}},props:{eventBus:{type:Object},destination:{type:Object,required:!0,default:D(T)},readonly:Boolean},mounted(){var e;this.nodeParameters=Object.assign(D(T),this.destination),(e=this.eventBus)==null||e.on("destinationWasSaved",this.onDestinationWasSaved)},beforeUnmount(){var e;(e=this.eventBus)==null||e.off("destinationWasSaved",this.onDestinationWasSaved)},computed:{...N(O),actions(){const e=[{label:this.$locale.baseText("workflows.item.open"),value:y.OPEN}];return this.readonly||e.push({label:this.$locale.baseText("workflows.item.delete"),value:y.DELETE}),e},typeLabelName(){return`settings.log-streaming.${this.destination.__type}`}},methods:{onDestinationWasSaved(){this.logStreamingStore.getDestination(this.destination.id)&&(this.nodeParameters=Object.assign(D(T),this.destination))},async onClick(e){const t=this.$refs.cardActions,n=e.target;t===n||t!=null&&t.contains(n)||n!=null&&n.contains(t)||this.$emit("edit",this.destination.id)},onEnabledSwitched(e){this.nodeParameters.enabled=e,this.saveDestination()},async saveDestination(){await this.logStreamingStore.saveDestination(this.nodeParameters)},async onAction(e){if(e===y.OPEN)this.$emit("edit",this.destination.id);else if(e===y.DELETE){if(await this.confirm(this.$locale.baseText("settings.log-streaming.destinationDelete.message",{interpolate:{destinationName:this.destination.label}}),this.$locale.baseText("settings.log-streaming.destinationDelete.headline"),{type:"warning",confirmButtonText:this.$locale.baseText("settings.log-streaming.destinationDelete.confirmButtonText"),cancelButtonText:this.$locale.baseText("settings.log-streaming.destinationDelete.cancelButtonText")})!==R)return;this.$emit("remove",this.destination.id)}}}}),Z="_cardLink_r6102_1",ee="_activeStatusText_r6102_11",te="_cardHeading_r6102_19",ne="_cardDescription_r6102_25",se="_cardActions_r6102_32",oe={cardLink:Z,activeStatusText:ee,cardHeading:te,cardDescription:ne,cardActions:se};function ie(e,t,n,u,W,P){const $=a("n8n-heading"),h=a("n8n-text"),b=a("el-switch"),k=a("n8n-action-toggle"),w=a("n8n-card");return o(),g(w,{class:c(e.$style.cardLink),"data-test-id":"destination-card",onClick:e.onClick},{header:i(()=>[s("div",null,[r($,{tag:"h2",bold:"",class:c(e.$style.cardHeading)},{default:i(()=>[S(m(e.destination.label),1)]),_:1},8,["class"]),s("div",{class:c(e.$style.cardDescription)},[r(h,{color:"text-light",size:"small"},{default:i(()=>[s("span",null,m(e.$locale.baseText(e.typeLabelName)),1)]),_:1})],2)])]),append:i(()=>[s("div",{ref:"cardActions",class:c(e.$style.cardActions)},[s("div",{class:c(e.$style.activeStatusText),"data-test-id":"destination-activator-status"},[e.nodeParameters.enabled?(o(),g(h,{key:0,color:"success",size:"small",bold:""},{default:i(()=>[S(m(e.$locale.baseText("workflowActivator.active")),1)]),_:1})):(o(),g(h,{key:1,color:"text-base",size:"small",bold:""},{default:i(()=>[S(m(e.$locale.baseText("workflowActivator.inactive")),1)]),_:1}))],2),r(b,{class:"mr-s",disabled:e.readonly,"model-value":e.nodeParameters.enabled,title:e.nodeParameters.enabled?e.$locale.baseText("workflowActivator.deactivateWorkflow"):e.$locale.baseText("workflowActivator.activateWorkflow"),"active-color":"#13ce66","inactive-color":"#8899AA","data-test-id":"workflow-activate-switch","onUpdate:modelValue":t[0]||(t[0]=L=>e.onEnabledSwitched(L))},null,8,["disabled","model-value","title"]),r(k,{actions:e.actions,theme:"dark",onAction:e.onAction},null,8,["actions","onAction"])],2)]),_:1},8,["class","onClick"])}const ae={$style:oe},re=I(X,[["render",ie],["__cssModules",ae]]),le=H({name:"SettingsLogStreamingView",components:{EventDestinationCard:re},props:{},data(){return{eventBus:q(),destinations:Array,disableLicense:!1,allDestinations:[]}},async mounted(){this.isLicensed&&(await this.credentialsStore.fetchCredentialTypes(!1),await this.credentialsStore.fetchAllCredentials(),this.uiStore.nodeViewInitialized=!1,await this.getDestinationDataFromBackend(),this.logStreamingStore.$onAction(({name:e,after:t})=>{(e==="removeDestination"||e==="updateDestination")&&t(async()=>{this.$forceUpdate()})}),this.eventBus.on("destinationWasSaved",this.onDestinationWasSaved),this.eventBus.on("remove",this.onRemove),this.eventBus.on("closing",this.onBusClosing))},beforeUnmount(){this.eventBus.off("destinationWasSaved",this.onDestinationWasSaved),this.eventBus.off("remove",this.onRemove),this.eventBus.off("closing",this.onBusClosing)},computed:{...N(K,O,j,F,x),sortedItemKeysByLabel(){var t;const e=[];for(const[n,u]of Object.entries(this.logStreamingStore.items))e.push({key:n,label:((t=u.destination)==null?void 0:t.label)??"Destination"});return e.sort((n,u)=>n.label.localeCompare(u.label))},environment(){return"production"},isLicensed(){return this.disableLicense?!1:this.settingsStore.isEnterpriseFeatureEnabled(M.LogStreaming)},canManageLogStreaming(){return G(["rbac"],{rbac:{scope:"logStreaming:manage"}})}},methods:{onDestinationWasSaved(){this.$forceUpdate()},onBusClosing(){this.workflowsStore.removeAllNodes({setStateDirty:!1,removePinData:!0}),this.uiStore.stateIsDirty=!1},async getDestinationDataFromBackend(){this.logStreamingStore.clearEventNames(),this.logStreamingStore.clearDestinationItemTrees(),this.allDestinations=[];const e=await this.logStreamingStore.fetchEventNames();if(e)for(const n of e)this.logStreamingStore.addEventName(n);const t=await this.logStreamingStore.fetchDestinations();if(t)for(const n of t)this.logStreamingStore.addDestination(n),this.allDestinations.push(n);this.$forceUpdate()},goToUpgrade(){this.uiStore.goToUpgrade("log-streaming","upgrade-log-streaming")},storeHasItems(){return this.logStreamingStore.items&&Object.keys(this.logStreamingStore.items).length>0},async addDestination(){const e=D(T);e.id=Q(),this.logStreamingStore.addDestination(e),await Y(),this.uiStore.openModalWithData({name:A,data:{destination:e,isNew:!0,eventBus:this.eventBus}})},async onRemove(e){if(!e)return;await this.logStreamingStore.deleteDestination(e);const t=this.workflowsStore.getNodeByName(e);t&&this.workflowsStore.removeNode(t)},async onEdit(e){if(!e)return;const t=this.logStreamingStore.getDestination(e);t&&this.uiStore.openModalWithData({name:A,data:{destination:t,isNew:!1,eventBus:this.eventBus}})}}}),de="_header_brzxt_1",ce="_destinationItem_brzxt_11",me={header:de,destinationItem:ce},ge={class:"mb-2xl"},ue={class:"ml-m"},he={class:"mb-l"},pe=["innerHTML"],fe={class:"mt-m text-right"},ve={key:1,"data-test-id":"action-box-licensed"},Se=["innerHTML"],be={key:0,class:"mb-l"},_e=["innerHTML"],ye={"data-test-id":"action-box-unlicensed"},De=["innerHTML"];function Te(e,t,n,u,W,P){const $=a("n8n-heading"),h=a("el-switch"),b=a("n8n-info-tip"),k=a("EventDestinationCard"),w=a("el-col"),L=a("el-row"),U=a("n8n-button"),B=a("n8n-action-box");return o(),l("div",null,[s("div",{class:c(e.$style.header)},[s("div",ge,[r($,{size:"2xlarge"},{default:i(()=>[S(m(e.$locale.baseText("settings.log-streaming.heading")),1)]),_:1}),e.environment!=="production"?(o(),l(v,{key:0},[s("strong",ue,"Disable License ("+m(e.environment)+")Â ",1),r(h,{modelValue:e.disableLicense,"onUpdate:modelValue":t[0]||(t[0]=d=>e.disableLicense=d),size:"large","data-test-id":"disable-license-toggle"},null,8,["modelValue"])],64)):_("",!0)])],2),e.isLicensed?(o(),l(v,{key:0},[s("div",he,[r(b,{theme:"info",type:"note"},{default:i(()=>[s("span",{innerHTML:e.$locale.baseText("settings.log-streaming.infoText")},null,8,pe)]),_:1})]),e.storeHasItems()?(o(),l(v,{key:0},[(o(!0),l(v,null,J(e.sortedItemKeysByLabel,d=>(o(),g(L,{key:d.key,gutter:10,class:c(e.$style.destinationItem)},{default:i(()=>{var E;return[(E=e.logStreamingStore.items[d.key])!=null&&E.destination?(o(),g(w,{key:0},{default:i(()=>{var C;return[r(k,{destination:(C=e.logStreamingStore.items[d.key])==null?void 0:C.destination,"event-bus":e.eventBus,readonly:!e.canManageLogStreaming,onRemove:V=>{var p,f;return e.onRemove((f=(p=e.logStreamingStore.items[d.key])==null?void 0:p.destination)==null?void 0:f.id)},onEdit:V=>{var p,f;return e.onEdit((f=(p=e.logStreamingStore.items[d.key])==null?void 0:p.destination)==null?void 0:f.id)}},null,8,["destination","event-bus","readonly","onRemove","onEdit"])]}),_:2},1024)):_("",!0)]}),_:2},1032,["class"]))),128)),s("div",fe,[e.canManageLogStreaming?(o(),g(U,{key:0,size:"large",onClick:e.addDestination},{default:i(()=>[S(m(e.$locale.baseText("settings.log-streaming.add")),1)]),_:1},8,["onClick"])):_("",!0)])],64)):(o(),l("div",ve,[r(B,{"button-text":e.$locale.baseText("settings.log-streaming.add"),"onClick:button":e.addDestination},{heading:i(()=>[s("span",{innerHTML:e.$locale.baseText("settings.log-streaming.addFirstTitle")},null,8,Se)]),_:1},8,["button-text","onClick:button"])]))],64)):(o(),l(v,{key:1},[e.$locale.baseText("settings.log-streaming.infoText")?(o(),l("div",be,[r(b,{theme:"info",type:"note"},{default:i(()=>[s("span",{innerHTML:e.$locale.baseText("settings.log-streaming.infoText")},null,8,_e)]),_:1})])):_("",!0),s("div",ye,[r(B,{description:e.$locale.baseText("settings.log-streaming.actionBox.description"),"button-text":e.$locale.baseText("settings.log-streaming.actionBox.button"),"onClick:button":e.goToUpgrade},{heading:i(()=>[s("span",{innerHTML:e.$locale.baseText("settings.log-streaming.actionBox.title")},null,8,De)]),_:1},8,["description","button-text","onClick:button"])])],64))])}const $e={$style:me},et=I(le,[["render",Te],["__cssModules",$e]]);export{et as default};
//# sourceMappingURL=SettingsLogStreamingView-COGhA1hN.js.map
