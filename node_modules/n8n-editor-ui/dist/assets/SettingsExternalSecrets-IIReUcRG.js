import{aO as I,e as P,u as O,e0 as j,e1 as X,e2 as G,e3 as K,x as $,e4 as W}from"./index-1OxaEeO3.js";import{D as Y}from"./luxon-CLwAIbs0.js";import{G as M,X as q,e as _,b as N,ag as i,l as s,M as x,O as a,p as d,I as m,U as p,S as v,T as c,u as n,R as H,m as f,n as J,F as Q,a7 as Z}from"./vendor-Dv5OeN6t.js";import{_ as ee}from"./n8n-4UEsHtUL.js";import"./pinia-sugP77Im.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const te=M({__name:"ExternalSecretsProviderCard.ee",props:{provider:{}},setup(w){const e=w,u=I(),t=$(),y=P(),g=O(),r=q(e,"provider"),l=_(()=>r.value.data??{}),{connectionState:S,testConnection:h,setConnectionState:T}=j(r,l),k=_(()=>[{value:"setup",label:t.baseText("settings.externalSecrets.card.actionDropdown.setup")},...e.provider.connected?[{value:"reload",label:t.baseText("settings.externalSecrets.card.actionDropdown.reload")}]:[]]),C=_(()=>e.provider.connected||Object.keys(l.value).length>0),b=_(()=>Y.fromISO(X(r.value.connectedAt)?r.value.connectedAt.toISOString():r.value.connectedAt||new Date().toISOString()).toFormat("dd LLL yyyy"));N(()=>{T(e.provider.state)});async function L(){return e.provider.connected?!0:(await u.getProvider(e.provider.name),await J(),await h()!=="error")}function D(){y.openModalWithData({name:W,data:{name:e.provider.name}})}async function R(){try{await u.reloadProvider(e.provider.name),g.showMessage({title:t.baseText("settings.externalSecrets.card.reload.success.title"),message:t.baseText("settings.externalSecrets.card.reload.success.description",{interpolate:{provider:e.provider.displayName}}),type:"success"})}catch(o){g.showError(o,t.baseText("error"))}}async function U(o){switch(o){case"setup":D();break;case"reload":await R();break}}return(o,A)=>{const B=i("n8n-text"),V=i("n8n-action-toggle"),z=i("n8n-button"),F=i("n8n-card");return s(),x(F,{class:m(o.$style.card)},{default:a(()=>[d("div",{class:m(o.$style.cardBody)},[p(G,{class:m(o.$style.cardImage),provider:r.value},null,8,["class","provider"]),d("div",{class:m(o.$style.cardContent)},[p(B,{bold:""},{default:a(()=>[v(c(r.value.displayName),1)]),_:1}),r.value.connected?(s(),x(B,{key:0,color:"text-light",size:"small"},{default:a(()=>{var E;return[d("span",null,c(n(t).baseText("settings.externalSecrets.card.secretsCount",{interpolate:{count:`${(E=n(u).secrets[r.value.name])==null?void 0:E.length}`}})),1),v(" | "),d("span",null,c(n(t).baseText("settings.externalSecrets.card.connectedAt",{interpolate:{date:b.value}})),1)]}),_:1})):H("",!0)],2),C.value?(s(),f("div",{key:0,class:m(o.$style.cardActions)},[p(K,{provider:r.value,"before-update":L,disabled:n(S)==="error"&&!r.value.connected},null,8,["provider","disabled"]),p(V,{class:"ml-s",theme:"dark",actions:k.value,onAction:U},null,8,["actions"])],2)):(s(),x(z,{key:1,type:"tertiary",onClick:A[0]||(A[0]=E=>D())},{default:a(()=>[v(c(n(t).baseText("settings.externalSecrets.card.setUp")),1)]),_:1}))],2)]),_:1},8,["class"])}}}),ne="_card_1v5vt_1",re="_cardImage_1v5vt_6",oe="_cardBody_1v5vt_11",se="_cardContent_1v5vt_17",ae="_cardActions_1v5vt_24",ce={card:ne,cardImage:re,cardBody:oe,cardContent:se,cardActions:ae},ie={$style:ce},le=ee(te,[["__cssModules",ie]]),de={class:"pb-3xl"},pe={key:0,"data-test-id":"external-secrets-content-licensed"},ue=["href"],me=["href"],je=M({__name:"SettingsExternalSecrets",setup(w){const e=$(),u=P(),t=I(),y=O(),g=_(()=>[...t.providers].sort((l,S)=>S.name.localeCompare(l.name)));N(()=>{if(t.isEnterpriseExternalSecretsEnabled)try{t.fetchAllSecrets(),t.getProviders()}catch(l){y.showError(l,e.baseText("error"))}});function r(){u.goToUpgrade("external-secrets","upgrade-external-secrets")}return(l,S)=>{const h=i("n8n-heading"),T=i("n8n-callout"),k=i("i18n-t"),C=i("n8n-action-box");return s(),f("div",de,[p(h,{size:"2xlarge"},{default:a(()=>[v(c(n(e).baseText("settings.externalSecrets.title")),1)]),_:1}),n(t).isEnterpriseExternalSecretsEnabled?(s(),f("div",pe,[p(T,{theme:"secondary",class:"mt-2xl mb-l"},{default:a(()=>[v(c(n(e).baseText("settings.externalSecrets.info"))+" ",1),d("a",{href:n(e).baseText("settings.externalSecrets.docs"),target:"_blank"},c(n(e).baseText("settings.externalSecrets.info.link")),9,ue)]),_:1}),(s(!0),f(Q,null,Z(g.value,b=>(s(),x(le,{key:b.name,provider:b},null,8,["provider"]))),128))])):(s(),x(C,{key:1,class:"mt-2xl mb-l","data-test-id":"external-secrets-content-unlicensed","button-text":n(e).baseText("settings.externalSecrets.actionBox.buttonText"),onClick:r},{heading:a(()=>[d("span",null,c(n(e).baseText("settings.externalSecrets.actionBox.title")),1)]),description:a(()=>[p(k,{keypath:"settings.externalSecrets.actionBox.description"},{link:a(()=>[d("a",{href:n(e).baseText("settings.externalSecrets.docs"),target:"_blank"},c(n(e).baseText("settings.externalSecrets.actionBox.description.link")),9,me)]),_:1})]),_:1},8,["button-text"]))])}}});export{je as default};
//# sourceMappingURL=SettingsExternalSecrets-IIReUcRG.js.map
