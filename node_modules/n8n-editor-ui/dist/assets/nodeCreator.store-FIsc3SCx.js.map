{"version":3,"file":"nodeCreator.store-FIsc3SCx.js","sources":["../../src/utils/sortUtils.ts","../../src/components/Node/NodeCreator/utils.ts","../../src/components/Node/NodeCreator/viewsData.ts","../../src/components/Node/NodeCreator/composables/useKeyboardNavigation.ts","../../src/components/Node/NodeCreator/composables/useViewStacks.ts","../../src/stores/nodeCreator.store.ts"],"sourcesContent":["/*\n\tConstants and utility functions used for searching for node types in node creator component\n*/\n\n// based on https://github.com/forrestthewoods/lib_fts/blob/master/code/fts_fuzzy_match.js\n\nconst SEQUENTIAL_BONUS = 60; // bonus for adjacent matches\nconst SEPARATOR_BONUS = 30; // bonus if match occurs after a separator\nconst CAMEL_BONUS = 30; // bonus if match is uppercase and prev is lower\nconst FIRST_LETTER_BONUS = 15; // bonus if the first letter is matched\n\nconst LEADING_LETTER_PENALTY = -20; // penalty applied for every letter in str before the first match\nconst MAX_LEADING_LETTER_PENALTY = -200; // maximum penalty for leading letters\nconst UNMATCHED_LETTER_PENALTY = -5;\n\n/**\n * Returns true if each character in pattern is found sequentially within target\n * @param {*} pattern string\n * @param {*} target string\n */\nfunction fuzzyMatchSimple(pattern: string, target: string): boolean {\n\tlet patternIdx = 0;\n\tlet strIdx = 0;\n\n\twhile (patternIdx < pattern.length && strIdx < target.length) {\n\t\tconst patternChar = pattern.charAt(patternIdx).toLowerCase();\n\t\tconst targetChar = target.charAt(strIdx).toLowerCase();\n\t\tif (patternChar === targetChar) {\n\t\t\tpatternIdx++;\n\t\t}\n\t\t++strIdx;\n\t}\n\n\treturn pattern.length !== 0 && target.length !== 0 && patternIdx === pattern.length;\n}\n\n/**\n * Does a fuzzy search to find pattern inside a string.\n * @param {*} pattern string        pattern to search for\n * @param {*} target     string        string which is being searched\n * @returns [boolean, number]       a boolean which tells if pattern was\n *                                  found or not and a search score\n */\nfunction fuzzyMatch(pattern: string, target: string): { matched: boolean; outScore: number } {\n\tconst recursionCount = 0;\n\tconst recursionLimit = 5;\n\tconst matches: number[] = [];\n\tconst maxMatches = 256;\n\n\treturn fuzzyMatchRecursive(\n\t\tpattern,\n\t\ttarget,\n\t\t0 /* patternCurIndex */,\n\t\t0 /* strCurrIndex */,\n\t\tnull /* srcMatces */,\n\t\tmatches,\n\t\tmaxMatches,\n\t\t0 /* nextMatch */,\n\t\trecursionCount,\n\t\trecursionLimit,\n\t);\n}\n\nfunction fuzzyMatchRecursive(\n\tpattern: string,\n\ttarget: string,\n\tpatternCurIndex: number,\n\ttargetCurrIndex: number,\n\ttargetMatches: null | number[],\n\tmatches: number[],\n\tmaxMatches: number,\n\tnextMatch: number,\n\trecursionCount: number,\n\trecursionLimit: number,\n): { matched: boolean; outScore: number } {\n\tlet outScore = 0;\n\n\t// Return if recursion limit is reached.\n\tif (++recursionCount >= recursionLimit) {\n\t\treturn { matched: false, outScore };\n\t}\n\n\t// Return if we reached ends of strings.\n\tif (patternCurIndex === pattern.length || targetCurrIndex === target.length) {\n\t\treturn { matched: false, outScore };\n\t}\n\n\t// Recursion params\n\tlet recursiveMatch = false;\n\tlet bestRecursiveMatches: number[] = [];\n\tlet bestRecursiveScore = 0;\n\n\t// Loop through pattern and str looking for a match.\n\tlet firstMatch = true;\n\twhile (patternCurIndex < pattern.length && targetCurrIndex < target.length) {\n\t\t// Match found.\n\t\tif (pattern[patternCurIndex].toLowerCase() === target[targetCurrIndex].toLowerCase()) {\n\t\t\tif (nextMatch >= maxMatches) {\n\t\t\t\treturn { matched: false, outScore };\n\t\t\t}\n\n\t\t\tif (firstMatch && targetMatches) {\n\t\t\t\tmatches = [...targetMatches];\n\t\t\t\tfirstMatch = false;\n\t\t\t}\n\n\t\t\tconst recursiveMatches: number[] = [];\n\t\t\tconst recursiveResult = fuzzyMatchRecursive(\n\t\t\t\tpattern,\n\t\t\t\ttarget,\n\t\t\t\tpatternCurIndex,\n\t\t\t\ttargetCurrIndex + 1,\n\t\t\t\tmatches,\n\t\t\t\trecursiveMatches,\n\t\t\t\tmaxMatches,\n\t\t\t\tnextMatch,\n\t\t\t\trecursionCount,\n\t\t\t\trecursionLimit,\n\t\t\t);\n\n\t\t\tconst recursiveScore = recursiveResult.outScore;\n\t\t\tif (recursiveResult.matched) {\n\t\t\t\t// Pick best recursive score.\n\t\t\t\tif (!recursiveMatch || recursiveScore > bestRecursiveScore) {\n\t\t\t\t\tbestRecursiveMatches = [...recursiveMatches];\n\t\t\t\t\tbestRecursiveScore = recursiveScore;\n\t\t\t\t}\n\t\t\t\trecursiveMatch = true;\n\t\t\t}\n\n\t\t\tmatches[nextMatch++] = targetCurrIndex;\n\t\t\t++patternCurIndex;\n\t\t}\n\t\t++targetCurrIndex;\n\t}\n\n\tconst matched = patternCurIndex === pattern.length;\n\n\tif (matched) {\n\t\toutScore = 100;\n\n\t\t// Apply leading letter penalty\n\t\tlet penalty = LEADING_LETTER_PENALTY * matches[0];\n\t\tpenalty = penalty < MAX_LEADING_LETTER_PENALTY ? MAX_LEADING_LETTER_PENALTY : penalty;\n\t\toutScore += penalty;\n\n\t\t//Apply unmatched penalty\n\t\tconst unmatched = target.length - nextMatch;\n\t\toutScore += UNMATCHED_LETTER_PENALTY * unmatched;\n\n\t\t// Apply ordering bonuses\n\t\tfor (let i = 0; i < nextMatch; i++) {\n\t\t\tconst currIdx = matches[i];\n\n\t\t\tif (i > 0) {\n\t\t\t\tconst prevIdx = matches[i - 1];\n\t\t\t\tif (currIdx === prevIdx + 1) {\n\t\t\t\t\toutScore += SEQUENTIAL_BONUS;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Check for bonuses based on neighbor character value.\n\t\t\tif (currIdx > 0) {\n\t\t\t\t// Camel case\n\t\t\t\tconst neighbor = target[currIdx - 1];\n\t\t\t\tconst curr = target[currIdx];\n\t\t\t\tif (neighbor !== neighbor.toUpperCase() && curr !== curr.toLowerCase()) {\n\t\t\t\t\toutScore += CAMEL_BONUS;\n\t\t\t\t}\n\t\t\t\tconst isNeighbourSeparator = neighbor === '_' || neighbor === ' ';\n\t\t\t\tif (isNeighbourSeparator) {\n\t\t\t\t\toutScore += SEPARATOR_BONUS;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// First letter\n\t\t\t\toutScore += FIRST_LETTER_BONUS;\n\t\t\t}\n\t\t}\n\n\t\t// Return best result\n\t\tif (recursiveMatch && (!matched || bestRecursiveScore > outScore)) {\n\t\t\t// Recursive score is better than \"this\"\n\t\t\tmatches = [...bestRecursiveMatches];\n\t\t\toutScore = bestRecursiveScore;\n\t\t\treturn { matched: true, outScore };\n\t\t} else if (matched) {\n\t\t\t// \"this\" score is better than recursive\n\t\t\treturn { matched: true, outScore };\n\t\t} else {\n\t\t\treturn { matched: false, outScore };\n\t\t}\n\t}\n\treturn { matched: false, outScore };\n}\n\n// prop = 'key'\n// prop = 'key1.key2'\n// prop = ['key1', 'key2']\nfunction getValue<T extends object>(obj: T, prop: string): unknown {\n\tif (obj.hasOwnProperty(prop)) {\n\t\treturn obj[prop as keyof T];\n\t}\n\n\tconst segments = prop.split('.');\n\n\tlet result = obj;\n\tlet i = 0;\n\twhile (result && i < segments.length) {\n\t\tconst key = segments[i] as keyof T;\n\t\tresult = result[key] as T;\n\t\ti++;\n\t}\n\treturn result;\n}\n\nexport function sublimeSearch<T extends object>(\n\tfilter: string,\n\tdata: Readonly<T[]>,\n\tkeys: Array<{ key: string; weight: number }>,\n): Array<{ score: number; item: T }> {\n\tconst results = data.reduce((accu: Array<{ score: number; item: T }>, item: T) => {\n\t\tlet values: Array<{ value: string; weight: number }> = [];\n\t\tkeys.forEach(({ key, weight }) => {\n\t\t\tconst value = getValue(item, key);\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\tvalues = values.concat(value.map((v) => ({ value: v, weight })));\n\t\t\t} else if (typeof value === 'string') {\n\t\t\t\tvalues.push({\n\t\t\t\t\tvalue,\n\t\t\t\t\tweight,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// for each item, check every key and get maximum score\n\t\tconst itemMatch = values.reduce(\n\t\t\t(\n\t\t\t\taccu: null | { matched: boolean; outScore: number },\n\t\t\t\t{ value, weight }: { value: string; weight: number },\n\t\t\t) => {\n\t\t\t\tif (!fuzzyMatchSimple(filter, value)) {\n\t\t\t\t\treturn accu;\n\t\t\t\t}\n\n\t\t\t\tconst match = fuzzyMatch(filter, value);\n\t\t\t\tmatch.outScore *= weight;\n\n\t\t\t\tconst { matched, outScore } = match;\n\t\t\t\tif (!accu && matched) {\n\t\t\t\t\treturn match;\n\t\t\t\t}\n\t\t\t\tif (matched && accu && outScore > accu.outScore) {\n\t\t\t\t\treturn match;\n\t\t\t\t}\n\t\t\t\treturn accu;\n\t\t\t},\n\t\t\tnull,\n\t\t);\n\n\t\tif (itemMatch) {\n\t\t\taccu.push({\n\t\t\t\tscore: itemMatch.outScore,\n\t\t\t\titem,\n\t\t\t});\n\t\t}\n\n\t\treturn accu;\n\t}, []);\n\n\tresults.sort((a, b) => {\n\t\treturn b.score - a.score;\n\t});\n\n\treturn results;\n}\n","import type {\n\tNodeCreateElement,\n\tActionCreateElement,\n\tSubcategorizedNodeTypes,\n\tSimplifiedNodeType,\n\tINodeCreateElement,\n\tSectionCreateElement,\n} from '@/Interface';\nimport {\n\tAI_CATEGORY_AGENTS,\n\tAI_SUBCATEGORY,\n\tCORE_NODES_CATEGORY,\n\tDEFAULT_SUBCATEGORY,\n} from '@/constants';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { sublimeSearch } from '@/utils/sortUtils';\nimport type { NodeViewItemSection } from './viewsData';\nimport { i18n } from '@/plugins/i18n';\nimport { sortBy } from 'lodash-es';\n\nexport function transformNodeType(\n\tnode: SimplifiedNodeType,\n\tsubcategory?: string,\n\ttype: 'node' | 'action' = 'node',\n): NodeCreateElement | ActionCreateElement {\n\tconst createElement = {\n\t\tuuid: uuidv4(),\n\t\tkey: node.name,\n\t\tsubcategory:\n\t\t\tsubcategory ?? node.codex?.subcategories?.[CORE_NODES_CATEGORY]?.[0] ?? DEFAULT_SUBCATEGORY,\n\t\tproperties: {\n\t\t\t...node,\n\t\t},\n\t\ttype,\n\t};\n\n\treturn type === 'action'\n\t\t? (createElement as ActionCreateElement)\n\t\t: (createElement as NodeCreateElement);\n}\n\nexport function subcategorizeItems(items: SimplifiedNodeType[]) {\n\tconst WHITE_LISTED_SUBCATEGORIES = [CORE_NODES_CATEGORY, AI_SUBCATEGORY];\n\treturn items.reduce((acc: SubcategorizedNodeTypes, item) => {\n\t\t// Only some subcategories are allowed\n\t\tlet subcategories: string[] = [DEFAULT_SUBCATEGORY];\n\n\t\tWHITE_LISTED_SUBCATEGORIES.forEach((category) => {\n\t\t\tif (item.codex?.categories?.includes(category)) {\n\t\t\t\tsubcategories = item.codex?.subcategories?.[category] ?? [];\n\t\t\t}\n\t\t});\n\n\t\tsubcategories.forEach((subcategory: string) => {\n\t\t\tif (!acc[subcategory]) {\n\t\t\t\tacc[subcategory] = [];\n\t\t\t}\n\t\t\tacc[subcategory].push(transformNodeType(item, subcategory));\n\t\t});\n\n\t\treturn acc;\n\t}, {});\n}\n\nexport function sortNodeCreateElements(nodes: INodeCreateElement[]) {\n\treturn nodes.sort((a, b) => {\n\t\tif (a.type !== 'node' || b.type !== 'node') return 0;\n\t\tconst displayNameA = a.properties?.displayName?.toLowerCase() || a.key;\n\t\tconst displayNameB = b.properties?.displayName?.toLowerCase() || b.key;\n\n\t\treturn displayNameA.localeCompare(displayNameB, undefined, { sensitivity: 'base' });\n\t});\n}\n\nexport function searchNodes(searchFilter: string, items: INodeCreateElement[]) {\n\t// In order to support the old search we need to remove the 'trigger' part\n\tconst trimmedFilter = searchFilter.toLowerCase().replace('trigger', '').trimEnd();\n\n\tconst result = (\n\t\tsublimeSearch<INodeCreateElement>(trimmedFilter, items, [\n\t\t\t{ key: 'properties.displayName', weight: 1.3 },\n\t\t\t{ key: 'properties.codex.alias', weight: 1 },\n\t\t]) || []\n\t).map(({ item }) => item);\n\n\treturn result;\n}\n\nexport function flattenCreateElements(items: INodeCreateElement[]): INodeCreateElement[] {\n\treturn items.map((item) => (item.type === 'section' ? item.children : item)).flat();\n}\nexport function isAINode(node: INodeCreateElement) {\n\tconst isNode = node.type === 'node';\n\tif (!isNode) return false;\n\n\tif (node.properties.codex?.categories?.includes(AI_SUBCATEGORY)) {\n\t\tconst isAgentSubcategory =\n\t\t\tnode.properties.codex?.subcategories?.[AI_SUBCATEGORY]?.includes(AI_CATEGORY_AGENTS);\n\n\t\treturn !isAgentSubcategory;\n\t}\n\n\treturn false;\n}\nexport function groupItemsInSections(\n\titems: INodeCreateElement[],\n\tsections: string[] | NodeViewItemSection[],\n\tsortAlphabetically = true,\n): INodeCreateElement[] {\n\tconst filteredSections = sections.filter(\n\t\t(section): section is NodeViewItemSection => typeof section === 'object',\n\t);\n\n\tconst itemsBySection = (items2: INodeCreateElement[]) =>\n\t\titems2.reduce((acc: Record<string, INodeCreateElement[]>, item) => {\n\t\t\tconst section = filteredSections.find((s) => s.items.includes(item.key));\n\n\t\t\tconst key = section?.key ?? 'other';\n\t\t\tif (key) {\n\t\t\t\tacc[key] = [...(acc[key] ?? []), item];\n\t\t\t}\n\t\t\treturn acc;\n\t\t}, {});\n\n\tconst mapNewSections = (\n\t\tnewSections: NodeViewItemSection[],\n\t\tchildren: Record<string, INodeCreateElement[]>,\n\t) =>\n\t\tnewSections.map(\n\t\t\t(section): SectionCreateElement => ({\n\t\t\t\ttype: 'section',\n\t\t\t\tkey: section.key,\n\t\t\t\ttitle: section.title,\n\t\t\t\tchildren: sortAlphabetically\n\t\t\t\t\t? sortNodeCreateElements(children[section.key] ?? [])\n\t\t\t\t\t: children[section.key] ?? [],\n\t\t\t}),\n\t\t);\n\n\tconst nonAINodes = items.filter((item) => !isAINode(item));\n\tconst AINodes = items.filter((item) => isAINode(item));\n\n\tconst nonAINodesBySection = itemsBySection(nonAINodes);\n\tconst nonAINodesSections = mapNewSections(filteredSections, nonAINodesBySection);\n\n\tconst AINodesBySection = itemsBySection(AINodes);\n\n\tconst AINodesSections = mapNewSections(sortBy(filteredSections, ['title']), AINodesBySection);\n\n\tconst result = [...nonAINodesSections, ...AINodesSections]\n\t\t.concat({\n\t\t\ttype: 'section',\n\t\t\tkey: 'other',\n\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.other'),\n\t\t\tchildren: sortNodeCreateElements(nonAINodesBySection.other ?? []),\n\t\t})\n\t\t.filter((section) => section.type !== 'section' || section.children.length > 0);\n\n\tif (result.length <= 1) {\n\t\treturn items;\n\t}\n\n\treturn result;\n}\n","import {\n\tCORE_NODES_CATEGORY,\n\tWEBHOOK_NODE_TYPE,\n\tOTHER_TRIGGER_NODES_SUBCATEGORY,\n\tEXECUTE_WORKFLOW_TRIGGER_NODE_TYPE,\n\tFORM_TRIGGER_NODE_TYPE,\n\tMANUAL_TRIGGER_NODE_TYPE,\n\tMANUAL_CHAT_TRIGGER_NODE_TYPE,\n\tSCHEDULE_TRIGGER_NODE_TYPE,\n\tREGULAR_NODE_CREATOR_VIEW,\n\tTRANSFORM_DATA_SUBCATEGORY,\n\tFLOWS_CONTROL_SUBCATEGORY,\n\tTRIGGER_NODE_CREATOR_VIEW,\n\tEMAIL_IMAP_NODE_TYPE,\n\tDEFAULT_SUBCATEGORY,\n\tAI_NODE_CREATOR_VIEW,\n\tAI_CATEGORY_AGENTS,\n\tAI_CATEGORY_CHAINS,\n\tAI_CATEGORY_DOCUMENT_LOADERS,\n\tAI_CATEGORY_LANGUAGE_MODELS,\n\tAI_CATEGORY_MEMORY,\n\tAI_CATEGORY_OUTPUTPARSER,\n\tAI_CATEGORY_RETRIEVERS,\n\tAI_CATEGORY_TEXT_SPLITTERS,\n\tAI_CATEGORY_TOOLS,\n\tAI_CATEGORY_VECTOR_STORES,\n\tAI_SUBCATEGORY,\n\tAI_CATEGORY_EMBEDDING,\n\tAI_OTHERS_NODE_CREATOR_VIEW,\n\tAI_UNCATEGORIZED_CATEGORY,\n\tCONVERT_TO_FILE_NODE_TYPE,\n\tEXTRACT_FROM_FILE_NODE_TYPE,\n\tSET_NODE_TYPE,\n\tCODE_NODE_TYPE,\n\tDATETIME_NODE_TYPE,\n\tFILTER_NODE_TYPE,\n\tREMOVE_DUPLICATES_NODE_TYPE,\n\tSPLIT_OUT_NODE_TYPE,\n\tLIMIT_NODE_TYPE,\n\tSUMMARIZE_NODE_TYPE,\n\tAGGREGATE_NODE_TYPE,\n\tMERGE_NODE_TYPE,\n\tHTML_NODE_TYPE,\n\tMARKDOWN_NODE_TYPE,\n\tXML_NODE_TYPE,\n\tCRYPTO_NODE_TYPE,\n\tIF_NODE_TYPE,\n\tSPLIT_IN_BATCHES_NODE_TYPE,\n\tHTTP_REQUEST_NODE_TYPE,\n\tHELPERS_SUBCATEGORY,\n\tRSS_READ_NODE_TYPE,\n\tEMAIL_SEND_NODE_TYPE,\n\tEDIT_IMAGE_NODE_TYPE,\n\tCOMPRESSION_NODE_TYPE,\n\tAI_CODE_TOOL_LANGCHAIN_NODE_TYPE,\n\tAI_WORKFLOW_TOOL_LANGCHAIN_NODE_TYPE,\n} from '@/constants';\nimport { useI18n } from '@/composables/useI18n';\nimport { useNodeTypesStore } from '@/stores/nodeTypes.store';\nimport type { SimplifiedNodeType } from '@/Interface';\nimport type { INodeTypeDescription, Themed } from 'n8n-workflow';\nimport { NodeConnectionType } from 'n8n-workflow';\nimport { useTemplatesStore } from '@/stores/templates.store';\n\nexport interface NodeViewItemSection {\n\tkey: string;\n\ttitle: string;\n\titems: string[];\n}\n\nexport interface NodeViewItem {\n\tkey: string;\n\ttype: string;\n\tproperties: {\n\t\tname?: string;\n\t\ttitle?: string;\n\t\ticon?: Themed<string>;\n\t\ticonProps?: {\n\t\t\tcolor?: string;\n\t\t};\n\t\turl?: string;\n\t\tconnectionType?: NodeConnectionType;\n\t\tpanelClass?: string;\n\t\tgroup?: string[];\n\t\tsections?: NodeViewItemSection[];\n\t\tdescription?: string;\n\t\tdisplayName?: string;\n\t\ttag?: {\n\t\t\ttype: string;\n\t\t\ttext: string;\n\t\t};\n\t\tforceIncludeNodes?: string[];\n\t\ticonData?: {\n\t\t\ttype: string;\n\t\t\ticon?: string;\n\t\t\tfileBuffer?: string;\n\t\t};\n\t};\n\tcategory?: string | string[];\n}\n\ninterface NodeView {\n\tvalue: string;\n\ttitle: string;\n\tinfo?: string;\n\tsubtitle?: string;\n\titems: NodeViewItem[];\n}\n\nfunction getAiNodesBySubcategory(nodes: INodeTypeDescription[], subcategory: string) {\n\treturn nodes\n\t\t.filter(\n\t\t\t(node) => !node.hidden && node.codex?.subcategories?.[AI_SUBCATEGORY]?.includes(subcategory),\n\t\t)\n\t\t.map((node) => ({\n\t\t\tkey: node.name,\n\t\t\ttype: 'node',\n\t\t\tproperties: {\n\t\t\t\tgroup: [],\n\t\t\t\tname: node.name,\n\t\t\t\tdisplayName: node.displayName,\n\t\t\t\ttitle: node.displayName,\n\t\t\t\tdescription: node.description,\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\t\ticon: node.icon!,\n\t\t\t\ticonUrl: node.iconUrl,\n\t\t\t},\n\t\t}))\n\t\t.sort((a, b) => a.properties.displayName.localeCompare(b.properties.displayName));\n}\n\nexport function AIView(_nodes: SimplifiedNodeType[]): NodeView {\n\tconst i18n = useI18n();\n\tconst nodeTypesStore = useNodeTypesStore();\n\tconst templatesStore = useTemplatesStore();\n\n\tconst chainNodes = getAiNodesBySubcategory(nodeTypesStore.allLatestNodeTypes, AI_CATEGORY_CHAINS);\n\tconst agentNodes = getAiNodesBySubcategory(nodeTypesStore.allLatestNodeTypes, AI_CATEGORY_AGENTS);\n\n\treturn {\n\t\tvalue: AI_NODE_CREATOR_VIEW,\n\t\ttitle: i18n.baseText('nodeCreator.aiPanel.aiNodes'),\n\t\tsubtitle: i18n.baseText('nodeCreator.aiPanel.selectAiNode'),\n\t\titems: [\n\t\t\t{\n\t\t\t\tkey: 'ai_templates_root',\n\t\t\t\ttype: 'link',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: i18n.baseText('nodeCreator.aiPanel.linkItem.title'),\n\t\t\t\t\ticon: 'box-open',\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.aiPanel.linkItem.description'),\n\t\t\t\t\tname: 'ai_templates_root',\n\t\t\t\t\turl: templatesStore.getWebsiteCategoryURL(undefined, 'AdvancedAI'),\n\t\t\t\t\ttag: {\n\t\t\t\t\t\ttype: 'info',\n\t\t\t\t\t\ttext: i18n.baseText('nodeCreator.triggerHelperPanel.manualTriggerTag'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t...agentNodes,\n\t\t\t...chainNodes,\n\t\t\t{\n\t\t\t\tkey: AI_OTHERS_NODE_CREATOR_VIEW,\n\t\t\t\ttype: 'view',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: i18n.baseText('nodeCreator.aiPanel.aiOtherNodes'),\n\t\t\t\t\ticon: 'robot',\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.aiPanel.aiOtherNodesDescription'),\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t};\n}\n\nexport function AINodesView(_nodes: SimplifiedNodeType[]): NodeView {\n\tconst i18n = useI18n();\n\n\tfunction getAISubcategoryProperties(nodeConnectionType: NodeConnectionType) {\n\t\treturn {\n\t\t\tconnectionType: nodeConnectionType,\n\t\t\ticonProps: {\n\t\t\t\tcolor: `var(--node-type-${nodeConnectionType}-color)`,\n\t\t\t},\n\t\t\tpanelClass: `nodes-list-panel-${nodeConnectionType}`,\n\t\t};\n\t}\n\n\treturn {\n\t\tvalue: AI_OTHERS_NODE_CREATOR_VIEW,\n\t\ttitle: i18n.baseText('nodeCreator.aiPanel.aiOtherNodes'),\n\t\tsubtitle: i18n.baseText('nodeCreator.aiPanel.selectAiNode'),\n\t\titems: [\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_DOCUMENT_LOADERS,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_DOCUMENT_LOADERS,\n\t\t\t\t\ticon: 'file-import',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiDocument),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_LANGUAGE_MODELS,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_LANGUAGE_MODELS,\n\t\t\t\t\ticon: 'language',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiLanguageModel),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_MEMORY,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_MEMORY,\n\t\t\t\t\ticon: 'brain',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiMemory),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_OUTPUTPARSER,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_OUTPUTPARSER,\n\t\t\t\t\ticon: 'list',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiOutputParser),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_RETRIEVERS,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_RETRIEVERS,\n\t\t\t\t\ticon: 'search',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiRetriever),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_TEXT_SPLITTERS,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_TEXT_SPLITTERS,\n\t\t\t\t\ticon: 'grip-lines-vertical',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiTextSplitter),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tkey: AI_CATEGORY_TOOLS,\n\t\t\t\tcategory: CORE_NODES_CATEGORY,\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_TOOLS,\n\t\t\t\t\ticon: 'tools',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiTool),\n\t\t\t\t\tsections: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'popular',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.popular'),\n\t\t\t\t\t\t\titems: [AI_WORKFLOW_TOOL_LANGCHAIN_NODE_TYPE, AI_CODE_TOOL_LANGCHAIN_NODE_TYPE],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_EMBEDDING,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_EMBEDDING,\n\t\t\t\t\ticon: 'vector-square',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiEmbedding),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_VECTOR_STORES,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_VECTOR_STORES,\n\t\t\t\t\ticon: 'project-diagram',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiVectorStore),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_UNCATEGORIZED_CATEGORY,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_UNCATEGORIZED_CATEGORY,\n\t\t\t\t\ticon: 'code',\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t};\n}\n\nexport function TriggerView() {\n\tconst i18n = useI18n();\n\n\tconst view: NodeView = {\n\t\tvalue: TRIGGER_NODE_CREATOR_VIEW,\n\t\ttitle: i18n.baseText('nodeCreator.triggerHelperPanel.selectATrigger'),\n\t\tsubtitle: i18n.baseText('nodeCreator.triggerHelperPanel.selectATriggerDescription'),\n\t\titems: [\n\t\t\t{\n\t\t\t\tkey: MANUAL_TRIGGER_NODE_TYPE,\n\t\t\t\ttype: 'node',\n\t\t\t\tcategory: [CORE_NODES_CATEGORY],\n\t\t\t\tproperties: {\n\t\t\t\t\tgroup: [],\n\t\t\t\t\tname: MANUAL_TRIGGER_NODE_TYPE,\n\t\t\t\t\tdisplayName: i18n.baseText('nodeCreator.triggerHelperPanel.manualTriggerDisplayName'),\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.manualTriggerDescription'),\n\t\t\t\t\ticon: 'fa:mouse-pointer',\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: DEFAULT_SUBCATEGORY,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\tforceIncludeNodes: [WEBHOOK_NODE_TYPE, EMAIL_IMAP_NODE_TYPE],\n\t\t\t\t\ttitle: 'App Trigger Nodes',\n\t\t\t\t\ticon: 'satellite-dish',\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: SCHEDULE_TRIGGER_NODE_TYPE,\n\t\t\t\ttype: 'node',\n\t\t\t\tcategory: [CORE_NODES_CATEGORY],\n\t\t\t\tproperties: {\n\t\t\t\t\tgroup: [],\n\t\t\t\t\tname: SCHEDULE_TRIGGER_NODE_TYPE,\n\t\t\t\t\tdisplayName: i18n.baseText('nodeCreator.triggerHelperPanel.scheduleTriggerDisplayName'),\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.scheduleTriggerDescription'),\n\t\t\t\t\ticon: 'fa:clock',\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: WEBHOOK_NODE_TYPE,\n\t\t\t\ttype: 'node',\n\t\t\t\tcategory: [CORE_NODES_CATEGORY],\n\t\t\t\tproperties: {\n\t\t\t\t\tgroup: [],\n\t\t\t\t\tname: WEBHOOK_NODE_TYPE,\n\t\t\t\t\tdisplayName: i18n.baseText('nodeCreator.triggerHelperPanel.webhookTriggerDisplayName'),\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.webhookTriggerDescription'),\n\t\t\t\t\ticonData: {\n\t\t\t\t\t\ttype: 'file',\n\t\t\t\t\t\ticon: 'webhook',\n\t\t\t\t\t\tfileBuffer: '/static/webhook-icon.svg',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: FORM_TRIGGER_NODE_TYPE,\n\t\t\t\ttype: 'node',\n\t\t\t\tcategory: [CORE_NODES_CATEGORY],\n\t\t\t\tproperties: {\n\t\t\t\t\tgroup: [],\n\t\t\t\t\tname: FORM_TRIGGER_NODE_TYPE,\n\t\t\t\t\tdisplayName: i18n.baseText('nodeCreator.triggerHelperPanel.formTriggerDisplayName'),\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.formTriggerDescription'),\n\t\t\t\t\ticonData: {\n\t\t\t\t\t\ttype: 'file',\n\t\t\t\t\t\ticon: 'form',\n\t\t\t\t\t\tfileBuffer: '/static/form-grey.svg',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: EXECUTE_WORKFLOW_TRIGGER_NODE_TYPE,\n\t\t\t\ttype: 'node',\n\t\t\t\tcategory: [CORE_NODES_CATEGORY],\n\t\t\t\tproperties: {\n\t\t\t\t\tgroup: [],\n\t\t\t\t\tname: EXECUTE_WORKFLOW_TRIGGER_NODE_TYPE,\n\t\t\t\t\tdisplayName: i18n.baseText('nodeCreator.triggerHelperPanel.workflowTriggerDisplayName'),\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.workflowTriggerDescription'),\n\t\t\t\t\ticon: 'fa:sign-out-alt',\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: MANUAL_CHAT_TRIGGER_NODE_TYPE,\n\t\t\t\ttype: 'node',\n\t\t\t\tcategory: [CORE_NODES_CATEGORY],\n\t\t\t\tproperties: {\n\t\t\t\t\tgroup: [],\n\t\t\t\t\tname: MANUAL_CHAT_TRIGGER_NODE_TYPE,\n\t\t\t\t\tdisplayName: i18n.baseText('nodeCreator.triggerHelperPanel.manualChatTriggerDisplayName'),\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.manualChatTriggerDescription'),\n\t\t\t\t\ticon: 'fa:comments',\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tkey: OTHER_TRIGGER_NODES_SUBCATEGORY,\n\t\t\t\tcategory: CORE_NODES_CATEGORY,\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: OTHER_TRIGGER_NODES_SUBCATEGORY,\n\t\t\t\t\ticon: 'folder-open',\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t};\n\n\treturn view;\n}\n\nexport function RegularView(nodes: SimplifiedNodeType[]) {\n\tconst i18n = useI18n();\n\n\tconst view: NodeView = {\n\t\tvalue: REGULAR_NODE_CREATOR_VIEW,\n\t\ttitle: i18n.baseText('nodeCreator.triggerHelperPanel.whatHappensNext'),\n\t\titems: [\n\t\t\t{\n\t\t\t\tkey: DEFAULT_SUBCATEGORY,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: 'App Regular Nodes',\n\t\t\t\t\ticon: 'globe',\n\t\t\t\t\tforceIncludeNodes: [RSS_READ_NODE_TYPE, EMAIL_SEND_NODE_TYPE],\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tkey: TRANSFORM_DATA_SUBCATEGORY,\n\t\t\t\tcategory: CORE_NODES_CATEGORY,\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: TRANSFORM_DATA_SUBCATEGORY,\n\t\t\t\t\ticon: 'pen',\n\t\t\t\t\tsections: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'popular',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.popular'),\n\t\t\t\t\t\t\titems: [SET_NODE_TYPE, CODE_NODE_TYPE, DATETIME_NODE_TYPE],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'addOrRemove',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.transform.addOrRemove'),\n\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\tFILTER_NODE_TYPE,\n\t\t\t\t\t\t\t\tREMOVE_DUPLICATES_NODE_TYPE,\n\t\t\t\t\t\t\t\tSPLIT_OUT_NODE_TYPE,\n\t\t\t\t\t\t\t\tLIMIT_NODE_TYPE,\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'combine',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.transform.combine'),\n\t\t\t\t\t\t\titems: [SUMMARIZE_NODE_TYPE, AGGREGATE_NODE_TYPE, MERGE_NODE_TYPE],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'convert',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.transform.convert'),\n\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\tHTML_NODE_TYPE,\n\t\t\t\t\t\t\t\tMARKDOWN_NODE_TYPE,\n\t\t\t\t\t\t\t\tXML_NODE_TYPE,\n\t\t\t\t\t\t\t\tCRYPTO_NODE_TYPE,\n\t\t\t\t\t\t\t\tEXTRACT_FROM_FILE_NODE_TYPE,\n\t\t\t\t\t\t\t\tCONVERT_TO_FILE_NODE_TYPE,\n\t\t\t\t\t\t\t\tCOMPRESSION_NODE_TYPE,\n\t\t\t\t\t\t\t\tEDIT_IMAGE_NODE_TYPE,\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tkey: FLOWS_CONTROL_SUBCATEGORY,\n\t\t\t\tcategory: CORE_NODES_CATEGORY,\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: FLOWS_CONTROL_SUBCATEGORY,\n\t\t\t\t\ticon: 'code-branch',\n\t\t\t\t\tsections: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'popular',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.popular'),\n\t\t\t\t\t\t\titems: [FILTER_NODE_TYPE, IF_NODE_TYPE, SPLIT_IN_BATCHES_NODE_TYPE, MERGE_NODE_TYPE],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tkey: HELPERS_SUBCATEGORY,\n\t\t\t\tcategory: CORE_NODES_CATEGORY,\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: HELPERS_SUBCATEGORY,\n\t\t\t\t\ticon: 'toolbox',\n\t\t\t\t\tsections: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'popular',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.popular'),\n\t\t\t\t\t\t\titems: [HTTP_REQUEST_NODE_TYPE, WEBHOOK_NODE_TYPE, CODE_NODE_TYPE],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t};\n\n\tconst hasAINodes = (nodes ?? []).some((node) => node.codex?.categories?.includes(AI_SUBCATEGORY));\n\tif (hasAINodes)\n\t\tview.items.push({\n\t\t\tkey: AI_NODE_CREATOR_VIEW,\n\t\t\ttype: 'view',\n\t\t\tproperties: {\n\t\t\t\ttitle: i18n.baseText('nodeCreator.aiPanel.langchainAiNodes'),\n\t\t\t\ticon: 'robot',\n\t\t\t\tdescription: i18n.baseText('nodeCreator.aiPanel.nodesForAi'),\n\t\t\t\ttag: {\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttext: i18n.baseText('nodeCreator.aiPanel.newTag'),\n\t\t\t\t},\n\t\t\t\tborderless: true,\n\t\t\t},\n\t\t} as NodeViewItem);\n\n\tview.items.push({\n\t\tkey: TRIGGER_NODE_CREATOR_VIEW,\n\t\ttype: 'view',\n\t\tproperties: {\n\t\t\ttitle: i18n.baseText('nodeCreator.triggerHelperPanel.addAnotherTrigger'),\n\t\t\ticon: 'bolt',\n\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.addAnotherTriggerDescription'),\n\t\t},\n\t});\n\n\treturn view;\n}\n","import { ref } from 'vue';\nimport { defineStore } from 'pinia';\n\nexport type KeyboardKey = (typeof WATCHED_KEYS)[number];\ninterface KeyHook {\n\tkeyboardKeys: KeyboardKey[];\n\tcondition?: (type: string, activeItemId: string) => boolean;\n\thandler: (activeItemId: string, keyboardKey: KeyboardKey) => void;\n}\n\nexport const KEYBOARD_ID_ATTR = 'data-keyboard-nav-id';\nexport const WATCHED_KEYS = [\n\t'ArrowUp',\n\t'ArrowDown',\n\t'ArrowLeft',\n\t'ArrowRight',\n\t'Enter',\n\t'Escape',\n\t'Tab',\n];\n\nexport const useKeyboardNavigation = defineStore('nodeCreatorKeyboardNavigation', () => {\n\tconst selectableItems = ref<Array<WeakRef<Element>>>([]);\n\tconst activeItemId = ref<string | null>(null);\n\t// Array of objects that contains key code and handler\n\tconst keysHooks = ref<Record<string, KeyHook>>({});\n\n\tfunction getItemType(element?: Element) {\n\t\treturn element?.getAttribute('data-keyboard-nav-type');\n\t}\n\tfunction getElementId(element?: Element) {\n\t\treturn element?.getAttribute(KEYBOARD_ID_ATTR) || undefined;\n\t}\n\tasync function refreshSelectableItems(): Promise<void> {\n\t\treturn await new Promise((resolve) => {\n\t\t\t// Wait for DOM to update\n\t\t\tcleanupSelectableItems();\n\t\t\tsetTimeout(() => {\n\t\t\t\tselectableItems.value = Array.from(\n\t\t\t\t\tdocument.querySelectorAll('[data-keyboard-nav-type]'),\n\t\t\t\t).map((el) => new WeakRef(el));\n\t\t\t\tresolve();\n\t\t\t}, 0);\n\t\t});\n\t}\n\n\tfunction executeKeyHooks(keyboardKey: KeyboardKey, activeItem: Element) {\n\t\tconst flatHooks = Object.values(keysHooks.value);\n\t\tconst hooks = flatHooks.filter((hook) => hook.keyboardKeys.includes(keyboardKey));\n\n\t\thooks.forEach((hook) => {\n\t\t\tif (!activeItemId.value) return;\n\n\t\t\tconst conditionPassed =\n\t\t\t\thook.condition === undefined ||\n\t\t\t\thook.condition(getItemType(activeItem) || '', activeItemId.value);\n\n\t\t\tif (conditionPassed && activeItemId.value) {\n\t\t\t\thook.handler(activeItemId.value, keyboardKey);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync function onKeyDown(e: KeyboardEvent) {\n\t\tconst pressedKey = e.key;\n\t\tif (!WATCHED_KEYS.includes(pressedKey)) return;\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tawait refreshSelectableItems();\n\t\tconst activeItemIndex = selectableItems.value.findIndex(\n\t\t\t(item) => getElementId(item?.deref()) === activeItemId.value,\n\t\t);\n\t\tconst activeItem = selectableItems.value[activeItemIndex]?.deref();\n\n\t\tconst isArrowDown = pressedKey === 'ArrowDown';\n\t\tconst isArrowUp = pressedKey === 'ArrowUp';\n\n\t\tif (!activeItem) return;\n\n\t\tif (isArrowDown) {\n\t\t\tconst nextItemIndex =\n\t\t\t\tactiveItemIndex < selectableItems.value.length - 1 ? activeItemIndex + 1 : 0;\n\n\t\t\tsetActiveItem(selectableItems.value[nextItemIndex]?.deref());\n\t\t}\n\t\tif (isArrowUp) {\n\t\t\tconst previousIndex =\n\t\t\t\tactiveItemIndex > 0 ? activeItemIndex - 1 : selectableItems.value.length - 1;\n\n\t\t\tsetActiveItem(selectableItems.value[previousIndex]?.deref());\n\t\t}\n\t\texecuteKeyHooks(pressedKey, activeItem);\n\t}\n\n\tfunction setActiveItemId(id: string) {\n\t\tactiveItemId.value = id;\n\t}\n\n\tfunction setActiveItem(item?: Element) {\n\t\tconst itemId = getElementId(item);\n\t\tif (!itemId) return;\n\n\t\tsetActiveItemId(itemId);\n\t\tif (item?.scrollIntoView) {\n\t\t\titem?.scrollIntoView({ block: 'center' });\n\t\t}\n\t}\n\n\tasync function setActiveItemIndex(index: number) {\n\t\tawait refreshSelectableItems();\n\n\t\tsetActiveItem(selectableItems.value[index]?.deref());\n\t}\n\n\tfunction attachKeydownEvent() {\n\t\tdocument.addEventListener('keydown', onKeyDown, { capture: true });\n\t}\n\n\tfunction detachKeydownEvent() {\n\t\tcleanupSelectableItems();\n\t\tdocument.removeEventListener('keydown', onKeyDown, { capture: true });\n\t}\n\n\tfunction registerKeyHook(name: string, hook: KeyHook) {\n\t\thook.keyboardKeys.forEach((keyboardKey) => {\n\t\t\tif (WATCHED_KEYS.includes(keyboardKey)) {\n\t\t\t\tkeysHooks.value = { ...keysHooks.value, [name]: hook };\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Key ${keyboardKey} is not supported`);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction cleanupSelectableItems() {\n\t\t// Cleanup to make sure DOM elements get garbage collected\n\t\tselectableItems.value = [];\n\t}\n\n\tfunction getActiveItemIndex() {\n\t\treturn selectableItems.value.findIndex(\n\t\t\t(item) => getElementId(item?.deref()) === activeItemId.value,\n\t\t);\n\t}\n\n\treturn {\n\t\tactiveItemId,\n\t\tattachKeydownEvent,\n\t\trefreshSelectableItems,\n\t\tdetachKeydownEvent,\n\t\tregisterKeyHook,\n\t\tgetActiveItemIndex,\n\t\tsetActiveItemId,\n\t\tsetActiveItemIndex,\n\t};\n});\n","import type {\n\tINodeCreateElement,\n\tNodeCreateElement,\n\tNodeFilterType,\n\tSimplifiedNodeType,\n} from '@/Interface';\nimport {\n\tAI_CATEGORY_ROOT_NODES,\n\tAI_CODE_NODE_TYPE,\n\tAI_NODE_CREATOR_VIEW,\n\tAI_OTHERS_NODE_CREATOR_VIEW,\n\tAI_SUBCATEGORY,\n\tDEFAULT_SUBCATEGORY,\n\tTRIGGER_NODE_CREATOR_VIEW,\n} from '@/constants';\nimport { defineStore } from 'pinia';\nimport { v4 as uuid } from 'uuid';\nimport { computed, nextTick, ref } from 'vue';\nimport difference from 'lodash-es/difference';\n\nimport { useNodeCreatorStore } from '@/stores/nodeCreator.store';\n\nimport {\n\tflattenCreateElements,\n\tgroupItemsInSections,\n\tisAINode,\n\tsearchNodes,\n\tsortNodeCreateElements,\n\tsubcategorizeItems,\n\ttransformNodeType,\n} from '../utils';\n\nimport type { NodeViewItem, NodeViewItemSection } from '@/components/Node/NodeCreator/viewsData';\nimport { AINodesView } from '@/components/Node/NodeCreator/viewsData';\nimport { useI18n } from '@/composables/useI18n';\nimport { useKeyboardNavigation } from './useKeyboardNavigation';\n\nimport { useNodeTypesStore } from '@/stores/nodeTypes.store';\nimport type { INodeInputFilter, NodeConnectionType, Themed } from 'n8n-workflow';\nimport { useCanvasStore } from '@/stores/canvas.store';\n\ninterface ViewStack {\n\tuuid?: string;\n\ttitle?: string;\n\tsubtitle?: string;\n\tsearch?: string;\n\tsubcategory?: string;\n\tinfo?: string;\n\tnodeIcon?: {\n\t\ticonType?: string;\n\t\ticon?: Themed<string>;\n\t\tcolor?: string;\n\t};\n\ticonUrl?: string;\n\trootView?: NodeFilterType;\n\tactiveIndex?: number;\n\ttransitionDirection?: 'in' | 'out';\n\thasSearch?: boolean;\n\tpreventBack?: boolean;\n\titems?: INodeCreateElement[];\n\tbaselineItems?: INodeCreateElement[];\n\tsearchItems?: SimplifiedNodeType[];\n\tforceIncludeNodes?: string[];\n\tmode?: 'actions' | 'nodes';\n\tbaseFilter?: (item: INodeCreateElement) => boolean;\n\titemsMapper?: (item: INodeCreateElement) => INodeCreateElement;\n\tpanelClass?: string;\n\tsections?: string[] | NodeViewItemSection[];\n}\n\nexport const useViewStacks = defineStore('nodeCreatorViewStacks', () => {\n\tconst nodeCreatorStore = useNodeCreatorStore();\n\tconst { getActiveItemIndex } = useKeyboardNavigation();\n\tconst i18n = useI18n();\n\n\tconst viewStacks = ref<ViewStack[]>([]);\n\n\tconst activeStackItems = computed<INodeCreateElement[]>(() => {\n\t\tconst stack = getLastActiveStack();\n\n\t\tif (!stack?.baselineItems) {\n\t\t\treturn stack.items ? extendItemsWithUUID(stack.items) : [];\n\t\t}\n\n\t\tif (stack.search && searchBaseItems.value) {\n\t\t\tconst searchBase =\n\t\t\t\tsearchBaseItems.value.length > 0\n\t\t\t\t\t? searchBaseItems.value\n\t\t\t\t\t: flattenCreateElements(stack.baselineItems ?? []);\n\n\t\t\tconst canvasHasAINodes = useCanvasStore().aiNodes.length > 0;\n\t\t\tconst filteredNodes =\n\t\t\t\tisAiRootView(stack) || canvasHasAINodes ? searchBase : filterOutAiNodes(searchBase);\n\n\t\t\tconst searchResults = extendItemsWithUUID(searchNodes(stack.search || '', filteredNodes));\n\n\t\t\tconst groupedNodes = groupIfAiNodes(searchResults, false) ?? searchResults;\n\t\t\t// Set the active index to the second item if there's a section\n\t\t\t// as the first item is collapsable\n\t\t\tstack.activeIndex = groupedNodes.some((node) => node.type === 'section') ? 1 : 0;\n\n\t\t\treturn groupedNodes;\n\t\t}\n\t\treturn extendItemsWithUUID(groupIfAiNodes(stack.baselineItems, true));\n\t});\n\n\tconst activeViewStack = computed<ViewStack>(() => {\n\t\tconst stack = getLastActiveStack();\n\t\tif (!stack) return {};\n\n\t\tconst flatBaselineItems = flattenCreateElements(stack.baselineItems ?? []);\n\n\t\treturn {\n\t\t\t...stack,\n\t\t\titems: activeStackItems.value,\n\t\t\thasSearch: flatBaselineItems.length > 8 || stack?.hasSearch,\n\t\t};\n\t});\n\n\tconst activeViewStackMode = computed(\n\t\t() => activeViewStack.value.mode || TRIGGER_NODE_CREATOR_VIEW,\n\t);\n\n\tconst searchBaseItems = computed<INodeCreateElement[]>(() => {\n\t\tconst stack = getLastActiveStack();\n\t\tif (!stack?.searchItems) return [];\n\n\t\treturn stack.searchItems.map((item) => transformNodeType(item, stack.subcategory));\n\t});\n\n\tfunction getLastActiveStack() {\n\t\treturn viewStacks.value[viewStacks.value.length - 1];\n\t}\n\n\t// Generate a delta between the global search results(all nodes) and the stack search results\n\tconst globalSearchItemsDiff = computed<INodeCreateElement[]>(() => {\n\t\tconst stack = getLastActiveStack();\n\t\tif (!stack?.search) return [];\n\n\t\tconst allNodes = nodeCreatorStore.mergedNodes.map((item) => transformNodeType(item));\n\t\t// Apply filtering for AI nodes if the current view is not the AI root view\n\t\tconst filteredNodes = isAiRootView(stack) ? allNodes : filterOutAiNodes(allNodes);\n\n\t\tlet globalSearchResult: INodeCreateElement[] = extendItemsWithUUID(\n\t\t\tsearchNodes(stack.search || '', filteredNodes),\n\t\t);\n\t\tif (isAiRootView(stack)) {\n\t\t\tglobalSearchResult = groupIfAiNodes(globalSearchResult);\n\t\t}\n\n\t\tconst filteredItems = globalSearchResult.filter((item) => {\n\t\t\treturn !activeStackItems.value.find((activeItem) => {\n\t\t\t\tif (activeItem.type === 'section') {\n\t\t\t\t\tconst matchingSectionItem = activeItem.children.some(\n\t\t\t\t\t\t(sectionItem) => sectionItem.key === item.key,\n\t\t\t\t\t);\n\t\t\t\t\treturn matchingSectionItem;\n\t\t\t\t}\n\n\t\t\t\treturn activeItem.key === item.key;\n\t\t\t});\n\t\t});\n\n\t\t// Filter out empty sections if all of their children are filtered out\n\t\tconst filteredSections = filteredItems.filter((item) => {\n\t\t\tif (item.type === 'section') {\n\t\t\t\tconst hasVisibleChildren = item.children.some((child) =>\n\t\t\t\t\tactiveStackItems.value.some((filteredItem) => filteredItem.key === child.key),\n\t\t\t\t);\n\n\t\t\t\treturn hasVisibleChildren;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\n\t\treturn filteredSections;\n\t});\n\n\tconst itemsBySubcategory = computed(() => subcategorizeItems(nodeCreatorStore.mergedNodes));\n\n\tfunction isAiRootView(stack: ViewStack) {\n\t\treturn stack.rootView === AI_NODE_CREATOR_VIEW;\n\t}\n\n\tfunction groupIfAiNodes(items: INodeCreateElement[], sortAlphabetically = true) {\n\t\tconst aiNodes = items.filter((node): node is NodeCreateElement => isAINode(node));\n\n\t\tif (aiNodes.length > 0) {\n\t\t\tconst sectionsMap = new Map<string, NodeViewItemSection>();\n\t\t\taiNodes.forEach((node) => {\n\t\t\t\tconst section = node.properties.codex?.subcategories?.[AI_SUBCATEGORY]?.[0];\n\n\t\t\t\tif (section) {\n\t\t\t\t\tconst currentItems = sectionsMap.get(section)?.items ?? [];\n\t\t\t\t\tconst isSubnodesSection =\n\t\t\t\t\t\t!node.properties.codex?.subcategories?.[AI_SUBCATEGORY].includes(\n\t\t\t\t\t\t\tAI_CATEGORY_ROOT_NODES,\n\t\t\t\t\t\t);\n\n\t\t\t\t\tsectionsMap.set(section, {\n\t\t\t\t\t\tkey: section,\n\t\t\t\t\t\ttitle: isSubnodesSection\n\t\t\t\t\t\t\t? `${section} (${i18n.baseText('nodeCreator.subnodes')})`\n\t\t\t\t\t\t\t: section,\n\t\t\t\t\t\titems: [...currentItems, node.key],\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst nonAiNodes = difference(items, aiNodes);\n\t\t\tconst nonAiTriggerNodes = nonAiNodes.filter(\n\t\t\t\t(item) => item.type === 'node' && useNodeTypesStore().isTriggerNode(item.properties.name),\n\t\t\t);\n\n\t\t\tconst nonAiRegularNodes = difference(nonAiNodes, nonAiTriggerNodes);\n\n\t\t\tif (nonAiNodes.length > 0) {\n\t\t\t\tlet sectionKey = '';\n\t\t\t\tif (nonAiRegularNodes.length && nonAiTriggerNodes.length) {\n\t\t\t\t\tsectionKey = i18n.baseText('nodeCreator.actionsCategory.regularAndTriggers');\n\t\t\t\t} else {\n\t\t\t\t\tsectionKey = nonAiRegularNodes.length\n\t\t\t\t\t\t? i18n.baseText('nodeCreator.actionsCategory.regularNodes')\n\t\t\t\t\t\t: i18n.baseText('nodeCreator.actionsCategory.triggerNodes');\n\t\t\t\t}\n\n\t\t\t\tconst nodesKeys = nonAiNodes.map((node) => node.key);\n\n\t\t\t\tsectionsMap.set(sectionKey, {\n\t\t\t\t\tkey: sectionKey,\n\t\t\t\t\ttitle: sectionKey,\n\t\t\t\t\titems: [...nodesKeys],\n\t\t\t\t});\n\t\t\t}\n\t\t\t// Convert sectionsMap to array of sections\n\t\t\tconst sections = Array.from(sectionsMap.values());\n\n\t\t\treturn groupItemsInSections(items, sections, sortAlphabetically);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tfunction filterOutAiNodes(items: INodeCreateElement[]) {\n\t\tconst filteredSearchBase = items.filter((item) => {\n\t\t\tif (item.type === 'node') {\n\t\t\t\tconst isAICategory = item.properties.codex?.categories?.includes(AI_SUBCATEGORY) === true;\n\n\t\t\t\tif (!isAICategory) return true;\n\n\t\t\t\tconst isRootNodeSubcategory =\n\t\t\t\t\titem.properties.codex?.subcategories?.[AI_SUBCATEGORY]?.includes(AI_CATEGORY_ROOT_NODES);\n\n\t\t\t\treturn isRootNodeSubcategory;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t\treturn filteredSearchBase;\n\t}\n\n\tasync function gotoCompatibleConnectionView(\n\t\tconnectionType: NodeConnectionType,\n\t\tisOutput?: boolean,\n\t\tfilter?: INodeInputFilter,\n\t) {\n\t\tlet nodesByConnectionType: { [key: string]: string[] };\n\t\tlet relatedAIView: { properties: NodeViewItem['properties'] } | undefined;\n\n\t\tif (isOutput === true) {\n\t\t\tnodesByConnectionType = useNodeTypesStore().visibleNodeTypesByInputConnectionTypeNames;\n\t\t\trelatedAIView = {\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: i18n.baseText('nodeCreator.aiPanel.aiNodes'),\n\t\t\t\t\ticon: 'robot',\n\t\t\t\t},\n\t\t\t};\n\t\t} else {\n\t\t\tnodesByConnectionType = useNodeTypesStore().visibleNodeTypesByOutputConnectionTypeNames;\n\n\t\t\trelatedAIView = AINodesView([]).items.find(\n\t\t\t\t(item) => item.properties.connectionType === connectionType,\n\t\t\t);\n\t\t}\n\n\t\tawait nextTick();\n\t\tpushViewStack({\n\t\t\ttitle: relatedAIView?.properties.title,\n\t\t\trootView: AI_OTHERS_NODE_CREATOR_VIEW,\n\t\t\tmode: 'nodes',\n\t\t\titems: nodeCreatorStore.allNodeCreatorNodes,\n\t\t\tnodeIcon: {\n\t\t\t\ticonType: 'icon',\n\t\t\t\ticon: relatedAIView?.properties.icon,\n\t\t\t\tcolor: relatedAIView?.properties.iconProps?.color,\n\t\t\t},\n\t\t\tpanelClass: relatedAIView?.properties.panelClass,\n\t\t\tbaseFilter: (i: INodeCreateElement) => {\n\t\t\t\t// AI Code node could have any connection type so we don't want to display it\n\t\t\t\t// in the compatible connection view as it would be displayed in all of them\n\t\t\t\tif (i.key === AI_CODE_NODE_TYPE) return false;\n\t\t\t\tconst displayNode = nodesByConnectionType[connectionType].includes(i.key);\n\n\t\t\t\t// TODO: Filtering works currently fine for displaying compatible node when dropping\n\t\t\t\t//       input connections. However, it does not work for output connections.\n\t\t\t\t//       For that reason does it currently display nodes that are maybe not compatible\n\t\t\t\t//       but then errors once it got selected by the user.\n\t\t\t\tif (displayNode && filter?.nodes?.length) {\n\t\t\t\t\treturn filter.nodes.includes(i.key);\n\t\t\t\t}\n\n\t\t\t\treturn displayNode;\n\t\t\t},\n\t\t\titemsMapper(item) {\n\t\t\t\treturn {\n\t\t\t\t\t...item,\n\t\t\t\t\tsubcategory: connectionType,\n\t\t\t\t};\n\t\t\t},\n\t\t\tpreventBack: true,\n\t\t});\n\t}\n\n\tfunction setStackBaselineItems() {\n\t\tconst stack = getLastActiveStack();\n\t\tif (!stack || !activeViewStack.value.uuid) return;\n\n\t\tlet stackItems = stack?.items ?? [];\n\n\t\tif (!stack?.items) {\n\t\t\tconst subcategory = stack?.subcategory ?? DEFAULT_SUBCATEGORY;\n\t\t\tconst itemsInSubcategory = itemsBySubcategory.value[subcategory];\n\t\t\tconst sections = stack.sections;\n\n\t\t\tif (sections) {\n\t\t\t\tstackItems = groupItemsInSections(itemsInSubcategory, sections);\n\t\t\t} else {\n\t\t\t\tstackItems = itemsInSubcategory;\n\t\t\t}\n\t\t}\n\n\t\t// Ensure that the nodes specified in `stack.forceIncludeNodes` are always included,\n\t\t// regardless of whether the subcategory is matched\n\t\tif ((stack.forceIncludeNodes ?? []).length > 0) {\n\t\t\tconst matchedNodes = nodeCreatorStore.mergedNodes\n\t\t\t\t.filter((item) => stack.forceIncludeNodes?.includes(item.name))\n\t\t\t\t.map((item) => transformNodeType(item, stack.subcategory));\n\n\t\t\tstackItems.push(...matchedNodes);\n\t\t}\n\n\t\tif (stack.baseFilter) {\n\t\t\tstackItems = stackItems.filter(stack.baseFilter);\n\t\t}\n\n\t\tif (stack.itemsMapper) {\n\t\t\tstackItems = stackItems.map(stack.itemsMapper);\n\t\t}\n\n\t\t// Sort only if non-root view\n\t\tif (!stack.items) {\n\t\t\tstackItems = sortNodeCreateElements(stackItems);\n\t\t}\n\n\t\tupdateCurrentViewStack({ baselineItems: stackItems });\n\t}\n\n\tfunction extendItemsWithUUID(items: INodeCreateElement[]) {\n\t\treturn items.map((item) => ({\n\t\t\t...item,\n\t\t\tuuid: `${item.key}-${uuid()}`,\n\t\t}));\n\t}\n\n\tfunction pushViewStack(stack: ViewStack) {\n\t\tif (activeViewStack.value.uuid) {\n\t\t\tupdateCurrentViewStack({ activeIndex: getActiveItemIndex() });\n\t\t}\n\n\t\tconst newStackUuid = uuid();\n\t\tviewStacks.value.push({\n\t\t\t...stack,\n\t\t\tuuid: newStackUuid,\n\t\t\ttransitionDirection: 'in',\n\t\t\tactiveIndex: 0,\n\t\t});\n\t\tsetStackBaselineItems();\n\t}\n\n\tfunction popViewStack() {\n\t\tif (activeViewStack.value.uuid) {\n\t\t\tviewStacks.value.pop();\n\t\t\tupdateCurrentViewStack({ transitionDirection: 'out' });\n\t\t}\n\t}\n\n\tfunction updateCurrentViewStack(stack: Partial<ViewStack>) {\n\t\tconst currentStack = getLastActiveStack();\n\t\tconst matchedIndex = viewStacks.value.findIndex((s) => s.uuid === currentStack.uuid);\n\t\tif (!currentStack) return;\n\n\t\t// For each key in the stack, update the matched stack\n\t\tObject.keys(stack).forEach((key) => {\n\t\t\tconst typedKey = key as keyof ViewStack;\n\t\t\tviewStacks.value[matchedIndex] = {\n\t\t\t\t...viewStacks.value[matchedIndex],\n\t\t\t\t[key]: stack[typedKey],\n\t\t\t};\n\t\t});\n\t}\n\n\tfunction resetViewStacks() {\n\t\tviewStacks.value = [];\n\t}\n\n\treturn {\n\t\tviewStacks,\n\t\tactiveViewStack,\n\t\tactiveViewStackMode,\n\t\tglobalSearchItemsDiff,\n\t\tgotoCompatibleConnectionView,\n\t\tresetViewStacks,\n\t\tupdateCurrentViewStack,\n\t\tpushViewStack,\n\t\tpopViewStack,\n\t};\n});\n","import { defineStore } from 'pinia';\nimport {\n\tAI_NODE_CREATOR_VIEW,\n\tNODE_CREATOR_OPEN_SOURCES,\n\tREGULAR_NODE_CREATOR_VIEW,\n\tSTORES,\n\tTRIGGER_NODE_CREATOR_VIEW,\n} from '@/constants';\nimport type {\n\tNodeFilterType,\n\tNodeCreatorOpenSource,\n\tSimplifiedNodeType,\n\tActionsRecord,\n\tToggleNodeCreatorOptions,\n\tAIAssistantConnectionInfo,\n} from '@/Interface';\n\nimport { computed, ref } from 'vue';\nimport { transformNodeType } from '@/components/Node/NodeCreator/utils';\nimport type { INodeInputConfiguration } from 'n8n-workflow';\nimport { NodeConnectionType, nodeConnectionTypes, NodeHelpers } from 'n8n-workflow';\nimport { useWorkflowsStore } from '@/stores/workflows.store';\nimport { useUIStore } from '@/stores/ui.store';\nimport { useNDVStore } from '@/stores/ndv.store';\nimport { useExternalHooks } from '@/composables/useExternalHooks';\nimport { useTelemetry } from '@/composables/useTelemetry';\nimport { useViewStacks } from '@/components/Node/NodeCreator/composables/useViewStacks';\nimport { useNodeTypesStore } from '@/stores/nodeTypes.store';\n\nexport const useNodeCreatorStore = defineStore(STORES.NODE_CREATOR, () => {\n\tconst workflowsStore = useWorkflowsStore();\n\tconst ndvStore = useNDVStore();\n\tconst uiStore = useUIStore();\n\tconst nodeTypesStore = useNodeTypesStore();\n\n\tconst externalHooks = useExternalHooks();\n\tconst telemetry = useTelemetry();\n\n\tconst selectedView = ref<NodeFilterType>(TRIGGER_NODE_CREATOR_VIEW);\n\tconst mergedNodes = ref<SimplifiedNodeType[]>([]);\n\tconst actions = ref<ActionsRecord<typeof mergedNodes.value>>({});\n\n\tconst showScrim = ref(false);\n\tconst openSource = ref<NodeCreatorOpenSource>('');\n\n\tconst allNodeCreatorNodes = computed(() =>\n\t\tObject.values(mergedNodes.value).map((i) => transformNodeType(i)),\n\t);\n\n\tfunction setMergeNodes(nodes: SimplifiedNodeType[]) {\n\t\tmergedNodes.value = nodes;\n\t}\n\n\tfunction setActions(nodes: ActionsRecord<typeof mergedNodes.value>) {\n\t\tactions.value = nodes;\n\t}\n\n\tfunction setShowScrim(isVisible: boolean) {\n\t\tshowScrim.value = isVisible;\n\t}\n\n\tfunction setSelectedView(view: NodeFilterType) {\n\t\tselectedView.value = view;\n\t}\n\n\tfunction setOpenSource(view: NodeCreatorOpenSource) {\n\t\topenSource.value = view;\n\t}\n\n\tfunction openNodeCreator({\n\t\tsource,\n\t\tcreateNodeActive,\n\t\tnodeCreatorView,\n\t}: ToggleNodeCreatorOptions) {\n\t\tif (createNodeActive === uiStore.isCreateNodeActive) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!nodeCreatorView) {\n\t\t\tnodeCreatorView =\n\t\t\t\tworkflowsStore.workflowTriggerNodes.length > 0\n\t\t\t\t\t? REGULAR_NODE_CREATOR_VIEW\n\t\t\t\t\t: TRIGGER_NODE_CREATOR_VIEW;\n\t\t}\n\t\t// Default to the trigger tab in node creator if there's no trigger node yet\n\t\tsetSelectedView(nodeCreatorView);\n\n\t\tlet mode;\n\t\tswitch (selectedView.value) {\n\t\t\tcase AI_NODE_CREATOR_VIEW:\n\t\t\t\tmode = 'ai';\n\t\t\t\tbreak;\n\t\t\tcase REGULAR_NODE_CREATOR_VIEW:\n\t\t\t\tmode = 'regular';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tmode = 'regular';\n\t\t}\n\n\t\tuiStore.isCreateNodeActive = createNodeActive;\n\t\tif (createNodeActive && source) {\n\t\t\tsetOpenSource(source);\n\t\t}\n\n\t\tvoid externalHooks.run('nodeView.createNodeActiveChanged', {\n\t\t\tsource,\n\t\t\tmode,\n\t\t\tcreateNodeActive,\n\t\t});\n\n\t\ttrackNodesPanelActiveChanged({\n\t\t\tsource,\n\t\t\tmode,\n\t\t\tcreateNodeActive,\n\t\t\tworkflowId: workflowsStore.workflowId,\n\t\t});\n\t}\n\n\tfunction trackNodesPanelActiveChanged({\n\t\tsource,\n\t\tmode,\n\t\tcreateNodeActive,\n\t\tworkflowId,\n\t}: {\n\t\tsource?: string;\n\t\tmode?: string;\n\t\tcreateNodeActive?: boolean;\n\t\tworkflowId?: string;\n\t}) {\n\t\ttelemetry.trackNodesPanel('nodeView.createNodeActiveChanged', {\n\t\t\tsource,\n\t\t\tmode,\n\t\t\tcreateNodeActive,\n\t\t\tworkflow_id: workflowId,\n\t\t});\n\t}\n\n\tfunction openSelectiveNodeCreator({\n\t\tconnectionType,\n\t\tnode,\n\t\tcreatorView,\n\t}: {\n\t\tconnectionType: NodeConnectionType;\n\t\tnode: string;\n\t\tcreatorView?: NodeFilterType;\n\t}) {\n\t\tconst nodeName = node ?? ndvStore.activeNodeName;\n\t\tconst nodeData = nodeName ? workflowsStore.getNodeByName(nodeName) : null;\n\n\t\tndvStore.activeNodeName = null;\n\n\t\tsetTimeout(() => {\n\t\t\tif (creatorView) {\n\t\t\t\topenNodeCreator({\n\t\t\t\t\tcreateNodeActive: true,\n\t\t\t\t\tnodeCreatorView: creatorView,\n\t\t\t\t});\n\t\t\t} else if (connectionType && nodeData) {\n\t\t\t\tinsertNodeAfterSelected({\n\t\t\t\t\tindex: 0,\n\t\t\t\t\tendpointUuid: `${nodeData.id}-input${connectionType}0`,\n\t\t\t\t\teventSource: NODE_CREATOR_OPEN_SOURCES.NOTICE_ERROR_MESSAGE,\n\t\t\t\t\toutputType: connectionType,\n\t\t\t\t\tsourceId: nodeData.id,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction insertNodeAfterSelected(info: AIAssistantConnectionInfo) {\n\t\tconst type = info.outputType ?? NodeConnectionType.Main;\n\t\t// Get the node and set it as active that new nodes\n\t\t// which get created get automatically connected\n\t\t// to it.\n\t\tconst sourceNode = workflowsStore.getNodeById(info.sourceId);\n\t\tif (!sourceNode) {\n\t\t\treturn;\n\t\t}\n\n\t\tuiStore.lastSelectedNode = sourceNode.name;\n\t\tuiStore.lastSelectedNodeEndpointUuid =\n\t\t\tinfo.endpointUuid ?? info.connection?.target.jtk?.endpoint.uuid;\n\t\tuiStore.lastSelectedNodeOutputIndex = info.index;\n\t\t// canvasStore.newNodeInsertPosition = null;\n\n\t\t// @TODO Add connection to store\n\t\t// if (info.connection) {\n\t\t// \tcanvasStore.setLastSelectedConnection(info.connection);\n\t\t// }\n\n\t\topenNodeCreator({\n\t\t\tsource: info.eventSource,\n\t\t\tcreateNodeActive: true,\n\t\t\tnodeCreatorView: info.nodeCreatorView,\n\t\t});\n\n\t\t// TODO: The animation is a bit glitchy because we're updating view stack immediately\n\t\t// after the node creator is opened\n\t\tconst isOutput = info.connection?.endpoints[0].parameters.connection === 'source';\n\t\tconst isScopedConnection =\n\t\t\ttype !== NodeConnectionType.Main && nodeConnectionTypes.includes(type);\n\n\t\tif (isScopedConnection) {\n\t\t\tuseViewStacks()\n\t\t\t\t.gotoCompatibleConnectionView(type, isOutput, getNodeCreatorFilter(sourceNode.name, type))\n\t\t\t\t.catch(() => {});\n\t\t}\n\t}\n\n\tfunction getNodeCreatorFilter(nodeName: string, outputType?: NodeConnectionType) {\n\t\tlet filter;\n\t\tconst workflow = workflowsStore.getCurrentWorkflow();\n\t\tconst workflowNode = workflow.getNode(nodeName);\n\t\tif (!workflowNode) return { nodes: [] };\n\n\t\tconst nodeType = nodeTypesStore.getNodeType(workflowNode?.type, workflowNode.typeVersion);\n\t\tif (nodeType) {\n\t\t\tconst inputs = NodeHelpers.getNodeInputs(workflow, workflowNode, nodeType);\n\n\t\t\tconst filterFound = inputs.filter((input) => {\n\t\t\t\tif (typeof input === 'string' || input.type !== outputType || !input.filter) {\n\t\t\t\t\t// No filters defined or wrong connection type\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}) as INodeInputConfiguration[];\n\n\t\t\tif (filterFound.length) {\n\t\t\t\tfilter = filterFound[0].filter;\n\t\t\t}\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\treturn {\n\t\topenSource,\n\t\tselectedView,\n\t\tshowScrim,\n\t\tmergedNodes,\n\t\tactions,\n\t\tsetShowScrim,\n\t\tsetSelectedView,\n\t\tsetOpenSource,\n\t\tsetActions,\n\t\tsetMergeNodes,\n\t\topenNodeCreator,\n\t\topenSelectiveNodeCreator,\n\t\tallNodeCreatorNodes,\n\t};\n});\n"],"names":["SEQUENTIAL_BONUS","SEPARATOR_BONUS","CAMEL_BONUS","FIRST_LETTER_BONUS","LEADING_LETTER_PENALTY","MAX_LEADING_LETTER_PENALTY","UNMATCHED_LETTER_PENALTY","fuzzyMatchSimple","pattern","target","patternIdx","strIdx","patternChar","targetChar","fuzzyMatch","fuzzyMatchRecursive","patternCurIndex","targetCurrIndex","targetMatches","matches","maxMatches","nextMatch","recursionCount","recursionLimit","outScore","recursiveMatch","bestRecursiveMatches","bestRecursiveScore","firstMatch","recursiveMatches","recursiveResult","recursiveScore","matched","penalty","unmatched","i","currIdx","prevIdx","neighbor","curr","getValue","obj","prop","segments","result","key","sublimeSearch","filter","data","keys","results","accu","item","values","weight","value","v","itemMatch","match","a","b","transformNodeType","node","subcategory","type","createElement","uuidv4","_c","_b","_a","CORE_NODES_CATEGORY","DEFAULT_SUBCATEGORY","subcategorizeItems","items","WHITE_LISTED_SUBCATEGORIES","AI_SUBCATEGORY","acc","subcategories","category","_d","sortNodeCreateElements","nodes","displayNameA","displayNameB","searchNodes","searchFilter","trimmedFilter","flattenCreateElements","isAINode","_e","AI_CATEGORY_AGENTS","groupItemsInSections","sections","sortAlphabetically","filteredSections","section","itemsBySection","items2","s","mapNewSections","newSections","children","nonAINodes","AINodes","nonAINodesBySection","nonAINodesSections","AINodesBySection","AINodesSections","sortBy","i18n","getAiNodesBySubcategory","AIView","_nodes","useI18n","nodeTypesStore","useNodeTypesStore","templatesStore","useTemplatesStore","chainNodes","AI_CATEGORY_CHAINS","agentNodes","AI_NODE_CREATOR_VIEW","AI_OTHERS_NODE_CREATOR_VIEW","AINodesView","getAISubcategoryProperties","nodeConnectionType","AI_CATEGORY_DOCUMENT_LOADERS","NodeConnectionType","AI_CATEGORY_LANGUAGE_MODELS","AI_CATEGORY_MEMORY","AI_CATEGORY_OUTPUTPARSER","AI_CATEGORY_RETRIEVERS","AI_CATEGORY_TEXT_SPLITTERS","AI_CATEGORY_TOOLS","AI_WORKFLOW_TOOL_LANGCHAIN_NODE_TYPE","AI_CODE_TOOL_LANGCHAIN_NODE_TYPE","AI_CATEGORY_EMBEDDING","AI_CATEGORY_VECTOR_STORES","AI_UNCATEGORIZED_CATEGORY","TriggerView","TRIGGER_NODE_CREATOR_VIEW","MANUAL_TRIGGER_NODE_TYPE","WEBHOOK_NODE_TYPE","EMAIL_IMAP_NODE_TYPE","SCHEDULE_TRIGGER_NODE_TYPE","FORM_TRIGGER_NODE_TYPE","EXECUTE_WORKFLOW_TRIGGER_NODE_TYPE","MANUAL_CHAT_TRIGGER_NODE_TYPE","OTHER_TRIGGER_NODES_SUBCATEGORY","RegularView","view","REGULAR_NODE_CREATOR_VIEW","RSS_READ_NODE_TYPE","EMAIL_SEND_NODE_TYPE","TRANSFORM_DATA_SUBCATEGORY","SET_NODE_TYPE","CODE_NODE_TYPE","DATETIME_NODE_TYPE","FILTER_NODE_TYPE","REMOVE_DUPLICATES_NODE_TYPE","SPLIT_OUT_NODE_TYPE","LIMIT_NODE_TYPE","SUMMARIZE_NODE_TYPE","AGGREGATE_NODE_TYPE","MERGE_NODE_TYPE","HTML_NODE_TYPE","MARKDOWN_NODE_TYPE","XML_NODE_TYPE","CRYPTO_NODE_TYPE","EXTRACT_FROM_FILE_NODE_TYPE","CONVERT_TO_FILE_NODE_TYPE","COMPRESSION_NODE_TYPE","EDIT_IMAGE_NODE_TYPE","FLOWS_CONTROL_SUBCATEGORY","IF_NODE_TYPE","SPLIT_IN_BATCHES_NODE_TYPE","HELPERS_SUBCATEGORY","HTTP_REQUEST_NODE_TYPE","KEYBOARD_ID_ATTR","WATCHED_KEYS","useKeyboardNavigation","defineStore","selectableItems","ref","activeItemId","keysHooks","getItemType","element","getElementId","refreshSelectableItems","resolve","cleanupSelectableItems","el","executeKeyHooks","keyboardKey","activeItem","hook","onKeyDown","e","pressedKey","activeItemIndex","isArrowDown","isArrowUp","nextItemIndex","setActiveItem","previousIndex","setActiveItemId","id","itemId","setActiveItemIndex","index","attachKeydownEvent","detachKeydownEvent","registerKeyHook","name","getActiveItemIndex","useViewStacks","nodeCreatorStore","useNodeCreatorStore","viewStacks","activeStackItems","computed","stack","getLastActiveStack","extendItemsWithUUID","searchBaseItems","searchBase","canvasHasAINodes","useCanvasStore","filteredNodes","isAiRootView","filterOutAiNodes","searchResults","groupedNodes","groupIfAiNodes","activeViewStack","flatBaselineItems","activeViewStackMode","globalSearchItemsDiff","allNodes","globalSearchResult","sectionItem","child","filteredItem","itemsBySubcategory","aiNodes","sectionsMap","currentItems","isSubnodesSection","_f","AI_CATEGORY_ROOT_NODES","nonAiNodes","difference","nonAiTriggerNodes","nonAiRegularNodes","sectionKey","nodesKeys","gotoCompatibleConnectionView","connectionType","isOutput","nodesByConnectionType","relatedAIView","nextTick","pushViewStack","AI_CODE_NODE_TYPE","displayNode","setStackBaselineItems","stackItems","itemsInSubcategory","matchedNodes","updateCurrentViewStack","uuid","newStackUuid","popViewStack","currentStack","matchedIndex","typedKey","resetViewStacks","STORES","workflowsStore","useWorkflowsStore","ndvStore","useNDVStore","uiStore","useUIStore","externalHooks","useExternalHooks","telemetry","useTelemetry","selectedView","mergedNodes","actions","showScrim","openSource","allNodeCreatorNodes","setMergeNodes","setActions","setShowScrim","isVisible","setSelectedView","setOpenSource","openNodeCreator","source","createNodeActive","nodeCreatorView","mode","trackNodesPanelActiveChanged","workflowId","openSelectiveNodeCreator","creatorView","nodeName","nodeData","insertNodeAfterSelected","NODE_CREATOR_OPEN_SOURCES","info","sourceNode","nodeConnectionTypes","getNodeCreatorFilter","outputType","workflow","workflowNode","nodeType","filterFound","NodeHelpers.getNodeInputs","input"],"mappings":"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"}