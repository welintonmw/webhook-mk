import{G as W,aI as G,aJ as Z,r as V,e as B,ag as v,l as h,M as H,O as i,U as l,S as b,T as u,u as r,a2 as L,p as m,m as D,I as S,R as O,aH as ue,d as de,D as pe,F as me,a7 as ve,n as je}from"./vendor-Dv5OeN6t.js";import{_ as ee,h as Y}from"./n8n-4UEsHtUL.js";import{d$ as be,x as J,e as fe,a as ge,o as _e,ed as ye,U as xe,u as Pe,V as Te,G as Ve}from"./index-1OxaEeO3.js";import{P as he}from"./ProjectTabs-5ZO9YR8J.js";import"./axios-Mm4CS0gO.js";import"./esprima-next-nhoSXAeq.js";import"./luxon-CLwAIbs0.js";import"./lodash-es-CZ1inz46.js";import"./pinia-sugP77Im.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const Ne={class:"pt-l"},Ue=W({__name:"ProjectDeleteDialog",props:G({currentProject:{},projects:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:G(["confirmDelete"],["update:modelValue"]),setup($,{emit:f}){const n=$,o=Z($,"modelValue"),N=f,j=J(),g=V(null),p=V(null),y=V(""),x=B(()=>p.value==="transfer"?!!g.value:p.value==="wipe"?y.value===j.baseText("projects.settings.delete.question.wipe.placeholder"):!1),U=()=>{var d;x.value&&(p.value==="wipe"&&(g.value=null),N("confirmDelete",(d=g.value)==null?void 0:d.id))};return(d,s)=>{var A;const M=v("n8n-text"),w=v("el-radio"),z=v("n8n-input"),F=v("n8n-input-label"),I=v("N8nButton"),R=v("el-dialog");return h(),H(R,{modelValue:o.value,"onUpdate:modelValue":s[4]||(s[4]=P=>o.value=P),title:r(j).baseText("projects.settings.delete.title",{interpolate:{projectName:((A=n.currentProject)==null?void 0:A.name)??""}}),width:"500"},{footer:i(()=>[l(I,{type:"danger","native-type":"button",disabled:!x.value,"data-test-id":"project-settings-delete-confirm-button",onClick:L(U,["stop","prevent"])},{default:i(()=>[b(u(r(j).baseText("projects.settings.danger.deleteProject")),1)]),_:1},8,["disabled"])]),default:i(()=>[l(M,{color:"text-base"},{default:i(()=>[b(u(r(j).baseText("projects.settings.delete.message")),1)]),_:1}),m("div",Ne,[l(w,{"model-value":p.value,label:"transfer",class:"mb-s","onUpdate:modelValue":s[0]||(s[0]=P=>p.value="transfer")},{default:i(()=>[l(M,{color:"text-dark"},{default:i(()=>[b(u(r(j).baseText("projects.settings.delete.question.transfer.label")),1)]),_:1})]),_:1},8,["model-value"]),p.value==="transfer"?(h(),D("div",{key:0,class:S(d.$style.operation)},[l(M,{color:"text-dark"},{default:i(()=>[b(u(r(j).baseText("projects.settings.delete.question.transfer.title")),1)]),_:1}),l(be,{modelValue:g.value,"onUpdate:modelValue":s[1]||(s[1]=P=>g.value=P),class:"pt-2xs",projects:n.projects,"empty-options-text":r(j).baseText("projects.sharing.noMatchingProjects")},null,8,["modelValue","projects","empty-options-text"])],2)):O("",!0),l(w,{"model-value":p.value,label:"wipe",class:"mb-s","onUpdate:modelValue":s[2]||(s[2]=P=>p.value="wipe")},{default:i(()=>[l(M,{color:"text-dark"},{default:i(()=>[b(u(r(j).baseText("projects.settings.delete.question.wipe.label")),1)]),_:1})]),_:1},8,["model-value"]),p.value==="wipe"?(h(),D("div",{key:1,class:S(d.$style.operation)},[l(F,{label:r(j).baseText("projects.settings.delete.question.wipe.title")},{default:i(()=>[l(z,{modelValue:y.value,"onUpdate:modelValue":s[3]||(s[3]=P=>y.value=P),placeholder:r(j).baseText("projects.settings.delete.question.wipe.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],2)):O("",!0)])]),_:1},8,["modelValue","title"])}}}),we="_operation_1mn5e_1",ke={operation:we},Se={$style:ke},$e=ee(Ue,[["__cssModules",Se]]),Me={class:"pt-l"},Ce=W({__name:"ProjectRoleUpgradeDialog",props:G({limit:{},planName:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup($){const f=$,n=Z($,"modelValue"),o=fe(),N=J(),j=async()=>{await o.goToUpgrade("rbac","upgrade-rbac"),n.value=!1};return(g,p)=>{const y=v("i18n-t"),x=v("N8nButton"),U=v("el-dialog");return h(),H(U,{modelValue:n.value,"onUpdate:modelValue":p[1]||(p[1]=d=>n.value=d),title:r(N).baseText("projects.settings.role.upgrade.title"),width:"500"},{footer:i(()=>[l(x,{type:"secondary","native-type":"button",onClick:p[0]||(p[0]=d=>n.value=!1)},{default:i(()=>[b(u(r(N).baseText("generic.cancel")),1)]),_:1}),l(x,{type:"primary","native-type":"button",onClick:j},{default:i(()=>[b(u(r(N).baseText("projects.create.limitReached.link")),1)]),_:1})]),default:i(()=>[m("div",Me,[l(y,{keypath:"projects.settings.role.upgrade.message"},{planName:i(()=>[b(u(f.planName),1)]),limit:i(()=>[b(u(r(N).baseText("projects.create.limit",{adjustToNumber:f.limit,interpolate:{num:String(f.limit)}})),1)]),_:1})])]),_:1},8,["modelValue","title"])}}}),De={for:"projectName"},Ie={for:"projectMembers"},Be={key:0,class:"mr-2xs"},Re=m("hr",{class:"mb-2xl"},null,-1),Ae={class:"mb-xs"},Ee=m("br",null,null,-1),qe=W({__name:"ProjectSettings",setup($){const f=ge(),n=J(),o=_e(),N=ye(),j=xe(),g=Pe(),p=ue(),y=Ve(),x=V(!1),U=V(!1),d=V(!1),s=V({name:"",relations:[]}),M=V({"project:editor":n.baseText("projects.settings.role.editor"),"project:admin":n.baseText("projects.settings.role.admin")}),w=V(null),z=B(()=>f.allUsers.filter(e=>!(s.value.relations||[]).find(a=>a.id===e.id))),F=B(()=>o.teamProjects.filter(e=>e.id!==o.currentProjectId)),I=B(()=>N.processedProjectRoles.map(e=>({...e,name:M.value[e.role]}))),R=B(()=>{var e;return(e=I.value.find(t=>t.licensed))==null?void 0:e.role}),A=e=>{d.value=!0;const t=f.getUserById(e);if(!t)return;const{id:a,firstName:c,lastName:C,email:k}=t,E={id:a,firstName:c,lastName:C,email:k};R.value&&(E.role=R.value),s.value.relations.push(E)},P=(e,t)=>{d.value=!0;const a=s.value.relations.findIndex(c=>c.id===e.id);t==="remove"?s.value.relations.splice(a,1):s.value.relations[a].role=t},te=()=>{d.value=!0},oe=()=>{var e,t;s.value.relations=(e=o.currentProject)!=null&&e.relations?Y(o.currentProject.relations):[],s.value.name=((t=o.currentProject)==null?void 0:t.name)??"",d.value=!1},se=()=>{const e={};return o.currentProject&&(s.value.name!==o.currentProject.name&&(e.name=s.value.name??""),s.value.relations.length!==o.currentProject.relations.length&&(e.memberAdded=s.value.relations.filter(t=>{var a;return!((a=o.currentProject)!=null&&a.relations.find(c=>c.id===t.id))}),e.memberRemoved=o.currentProject.relations.filter(t=>!s.value.relations.find(a=>a.id===t.id))),e.role=s.value.relations.filter(t=>{var c,C;const a=(c=o.currentProject)==null?void 0:c.relations.find(k=>k.id===t.id);return(a==null?void 0:a.role)!==t.role&&!((C=e.memberAdded)!=null&&C.find(k=>k.id===t.id))})),e},ae=e=>{var t;e.name&&y.track("User changed project name",{project_id:(t=o.currentProject)==null?void 0:t.id,name:e.name}),e.memberAdded&&e.memberAdded.forEach(a=>{var c;y.track("User added member to project",{project_id:(c=o.currentProject)==null?void 0:c.id,target_user_id:a.id,role:a.role})}),e.memberRemoved&&e.memberRemoved.forEach(a=>{var c;y.track("User removed member from project",{project_id:(c=o.currentProject)==null?void 0:c.id,target_user_id:a.id})}),e.role&&e.role.forEach(a=>{var c;y.track("User changed member role on project",{project_id:(c=o.currentProject)==null?void 0:c.id,target_user_id:a.id,role:a.role})})},re=async()=>{try{if(d.value&&o.currentProject){const e=se();await o.updateProject({id:o.currentProject.id,name:s.value.name,relations:s.value.relations.map(t=>({userId:t.id,role:t.role}))}),ae(e),d.value=!1,g.showMessage({title:n.baseText("projects.settings.save.successful.title",{interpolate:{projectName:s.value.name??""}}),type:"success"})}}catch(e){g.showError(e,n.baseText("projects.settings.save.error.title"))}},le=async()=>{await o.getAllProjects(),x.value=!0},ne=async e=>{var t;try{if(o.currentProject){const a=((t=o.currentProject)==null?void 0:t.name)??"";await o.deleteProject(o.currentProject.id,e),await p.push({name:Te.HOMEPAGE}),g.showMessage({title:n.baseText("projects.settings.delete.successful.title",{interpolate:{projectName:a}}),type:"success"}),x.value=!0}}catch(a){g.showError(a,n.baseText("projects.settings.delete.error.title"))}},ie=()=>{w.value&&s.value.name===n.baseText("projects.settings.newProjectName")&&(w.value.focus(),w.value.select())};return de(()=>o.currentProject,async()=>{var e,t;s.value.name=((e=o.currentProject)==null?void 0:e.name)??"",s.value.relations=(t=o.currentProject)!=null&&t.relations?Y(o.currentProject.relations):[],await je(),ie()},{immediate:!0}),pe(async()=>{await f.fetchUsers()}),(e,t)=>{var K,Q,X;const a=v("N8nInput"),c=v("N8nIcon"),C=v("N8nUserSelect"),k=v("N8nOption"),E=v("N8nSelect"),q=v("N8nButton"),ce=v("N8nUsersList");return h(),D("div",{class:S(e.$style.projectSettings)},[m("div",{class:S(e.$style.header)},[l(he)],2),m("form",{onSubmit:L(re,["prevent"])},[m("fieldset",null,[m("label",De,u(r(n).baseText("projects.settings.name")),1),l(a,{id:"projectName",ref_key:"nameInput",ref:w,modelValue:s.value.name,"onUpdate:modelValue":t[0]||(t[0]=_=>s.value.name=_),type:"text",name:"name","data-test-id":"project-settings-name-input",onInput:te},null,8,["modelValue"])]),m("fieldset",null,[m("label",Ie,u(r(n).baseText("projects.settings.projectMembers")),1),l(C,{id:"projectMembers",class:"mb-s",size:"large",users:z.value,"current-user-id":(K=r(f).currentUser)==null?void 0:K.id,placeholder:e.$locale.baseText("workflows.shareModal.select.placeholder"),"data-test-id":"project-members-select","onUpdate:modelValue":A},{prefix:i(()=>[l(c,{icon:"search"})]),_:1},8,["users","current-user-id","placeholder"]),l(ce,{actions:[],users:s.value.relations,"current-user-id":(Q=r(f).currentUser)==null?void 0:Q.id,"delete-label":e.$locale.baseText("workflows.shareModal.list.delete")},{actions:i(({user:_})=>[m("div",{class:S(e.$style.buttons)},[l(E,{class:"mr-2xs","model-value":(_==null?void 0:_.role)||I.value[0].role,size:"small","onUpdate:modelValue":T=>P(_,T)},{default:i(()=>[(h(!0),D(me,null,ve(I.value,T=>(h(),H(k,{key:T.role,value:T.role,label:T.name,disabled:!T.licensed},{default:i(()=>[b(u(T.name),1),T.licensed?O("",!0):(h(),D("span",{key:0,class:S(e.$style.upgrade),onClick:t[1]||(t[1]=He=>U.value=!0)},"  - "+u(r(n).baseText("generic.upgrade")),3))]),_:2},1032,["value","label","disabled"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue"]),l(q,{type:"tertiary","native-type":"button",square:"",icon:"trash","data-test-id":"project-user-remove",onClick:T=>P(_,"remove")},null,8,["onClick"])],2)]),_:1},8,["users","current-user-id","delete-label"])]),m("fieldset",{class:S(e.$style.buttons)},[m("div",null,[d.value?(h(),D("small",Be,u(r(n).baseText("projects.settings.message.unsavedChanges")),1)):O("",!0),l(q,{disabled:!d.value,type:"secondary","native-type":"button",class:"mr-2xs","data-test-id":"project-settings-cancel-button",onClick:L(oe,["stop","prevent"])},{default:i(()=>[b(u(r(n).baseText("projects.settings.button.cancel")),1)]),_:1},8,["disabled"])]),l(q,{disabled:!d.value,type:"primary","data-test-id":"project-settings-save-button"},{default:i(()=>[b(u(r(n).baseText("projects.settings.button.save")),1)]),_:1},8,["disabled"])],2),m("fieldset",null,[Re,m("h3",Ae,u(r(n).baseText("projects.settings.danger.title")),1),m("small",null,u(r(n).baseText("projects.settings.danger.message")),1),Ee,l(q,{type:"tertiary","native-type":"button",class:"mt-s","data-test-id":"project-settings-delete-button",onClick:L(le,["stop","prevent"])},{default:i(()=>[b(u(r(n).baseText("projects.settings.danger.deleteProject")),1)]),_:1})])],32),l($e,{modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=_=>x.value=_),"current-project":r(o).currentProject,projects:F.value,onConfirmDelete:ne},null,8,["modelValue","current-project","projects"]),l(Ce,{modelValue:U.value,"onUpdate:modelValue":t[3]||(t[3]=_=>U.value=_),limit:r(o).teamProjectsLimit,"plan-name":(X=r(j).currentPlanData)==null?void 0:X.displayName},null,8,["modelValue","limit","plan-name"])],2)}}}),Le="_projectSettings_2vgb7_1",Oe="_header_2vgb7_21",ze="_upgrade_2vgb7_27",Fe="_buttons_2vgb7_31",Ge={projectSettings:Le,header:Oe,upgrade:ze,buttons:Fe},We={$style:Ge},Vt=ee(qe,[["__cssModules",We]]);export{Vt as default};
//# sourceMappingURL=ProjectSettings-CfcplqBX.js.map
