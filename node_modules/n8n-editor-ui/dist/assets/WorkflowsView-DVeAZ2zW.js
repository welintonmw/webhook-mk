import{R as se}from"./ResourcesListLayout-B4W1PSHT.js";import{G as N,aH as oe,e as L,ag as l,l as w,M as j,O as n,U as r,I as h,S as k,T as p,p as g,a2 as ae,u as z,P as R,V as F,m as T,R as v,F as re,a7 as ne}from"./vendor-Dv5OeN6t.js";import{u as le,b as x,e as B,a as H,j as K,o as q,r as ie,d9 as de,x as ce,V as M,y as ue,F as me,A as pe,e6 as fe,H as we,G as he,w as ke,$ as ge,c as be,n as ye,E as Se}from"./index-1OxaEeO3.js";import{d as _e}from"./dateformat-CIxnBJXX.js";import{W as Te}from"./WorkflowActivator-BXWURYao.js";import{_ as ve}from"./ProjectCardBadge.vue_vue_type_script_setup_true_lang-6oVL0vKx.js";import{_ as Q}from"./n8n-4UEsHtUL.js";import{m as Ce}from"./pinia-sugP77Im.js";import{P as Ee}from"./ProjectTabs-5ZO9YR8J.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";import"./useWorkflowActivate-npf1npdP.js";const $e={key:0},We=N({__name:"WorkflowCard",props:{data:{default:()=>({id:"",createdAt:"",updatedAt:"",active:!1,connections:{},nodes:[],name:"",sharedWithProjects:[],homeProject:{},versionId:""})},readOnly:{type:Boolean,default:!1}},emits:["expand:tags","click:tag"],setup(e,{emit:s}){const a={OPEN:"open",SHARE:"share",DUPLICATE:"duplicate",DELETE:"delete",MOVE:"move"},o=e,c=s,f=le(),b=we(),i=ce(),C=oe(),U=he(),D=x(),S=B(),_=H(),E=K(),$=q(),W=L(()=>_.currentUser??{}),O=L(()=>ie(o.data)),P=L(()=>{const t=[{label:i.baseText("workflows.item.open"),value:a.OPEN},{label:i.baseText("workflows.item.share"),value:a.SHARE}];return o.readOnly||t.push({label:i.baseText("workflows.item.duplicate"),value:a.DUPLICATE}),O.value.move&&t.push({label:i.baseText("workflows.item.move"),value:a.MOVE}),O.value.delete&&!o.readOnly&&t.push({label:i.baseText("workflows.item.delete"),value:a.DELETE}),t}),I=L(()=>{const t=new Date().getFullYear().toString();return _e(o.data.createdAt,`d mmmm${String(o.data.createdAt).startsWith(t)?"":", yyyy"}`)});async function A(t){if(t!=null&&t.ctrlKey||t!=null&&t.metaKey){const d=C.resolve({name:M.WORKFLOW,params:{name:o.data.id}});window.open(d.href,"_blank");return}await C.push({name:M.WORKFLOW,params:{name:o.data.id}})}function m(t,d){d.stopPropagation(),c("click:tag",t,d)}function u(){c("expand:tags")}async function V(t){switch(t){case a.OPEN:await A();break;case a.DUPLICATE:S.openModalWithData({name:me,data:{id:o.data.id,name:o.data.name,tags:(o.data.tags??[]).map(d=>typeof d!="string"&&"id"in d?d.id:d)}});break;case a.SHARE:S.openModalWithData({name:ue,data:{id:o.data.id}}),U.track("User opened sharing modal",{workflow_id:o.data.id,user_id_sharer:W.value.id,sub_view:"Workflows listing"});break;case a.DELETE:await Y();break;case a.MOVE:G();break}}async function Y(){if(await b.confirm(i.baseText("mainSidebar.confirmMessage.workflowDelete.message",{interpolate:{workflowName:o.data.name}}),i.baseText("mainSidebar.confirmMessage.workflowDelete.headline"),{type:"warning",confirmButtonText:i.baseText("mainSidebar.confirmMessage.workflowDelete.confirmButtonText"),cancelButtonText:i.baseText("mainSidebar.confirmMessage.workflowDelete.cancelButtonText")})===pe){try{await E.deleteWorkflow(o.data.id)}catch(d){f.showError(d,i.baseText("generic.deleteWorkflowError"));return}f.showMessage({title:i.baseText("mainSidebar.showMessage.handleSelect1.title"),type:"success"})}}function G(){S.openModalWithData({name:fe,data:{resource:o.data,resourceType:i.baseText("generic.workflow").toLocaleLowerCase()}})}return(t,d)=>{const J=l("n8n-heading"),X=l("n8n-tags"),Z=l("n8n-text"),ee=l("n8n-action-toggle"),te=l("n8n-card");return w(),j(te,{class:h(t.$style.cardLink),onClick:A},{header:n(()=>[r(J,{tag:"h2",bold:"",class:h(t.$style.cardHeading),"data-test-id":"workflow-card-name"},{default:n(()=>[k(p(t.data.name),1)]),_:1},8,["class"])]),append:n(()=>[g("div",{class:h(t.$style.cardActions),onClick:d[0]||(d[0]=ae(()=>{},["stop"]))},[r(ve,{resource:t.data,"personal-project":z($).personalProject},null,8,["resource","personal-project"]),r(Te,{class:"mr-s","workflow-active":t.data.active,"workflow-id":t.data.id,"data-test-id":"workflow-card-activator"},null,8,["workflow-active","workflow-id"]),r(ee,{actions:P.value,theme:"dark","data-test-id":"workflow-card-actions",onAction:V},null,8,["actions"])],2)]),default:n(()=>[g("div",{class:h(t.$style.cardDescription)},[r(Z,{color:"text-light",size:"small"},{default:n(()=>[R(g("span",null,[k(p(t.$locale.baseText("workflows.item.updated"))+" ",1),r(de,{date:String(t.data.updatedAt)},null,8,["date"]),k(" | ")],512),[[F,t.data]]),R(g("span",{class:"mr-2xs"},p(t.$locale.baseText("workflows.item.created"))+" "+p(I.value),513),[[F,t.data]]),z(D).areTagsEnabled&&t.data.tags&&t.data.tags.length>0?R((w(),T("span",$e,[r(X,{tags:t.data.tags,"truncate-at":3,truncate:"","data-test-id":"workflow-card-tags","onClick:tag":m,onExpand:u},null,8,["tags"])],512)),[[F,t.data]]):v("",!0)]),_:1})],2)]),_:1},8,["class"])}}}),Oe="_cardLink_1ahnz_1",Ae="_cardHeading_1ahnz_11",Le="_cardDescription_1ahnz_20",je="_cardActions_1ahnz_27",Ue={cardLink:Oe,cardHeading:Ae,cardDescription:Le,cardActions:je},De={$style:Ue},Pe=Q(We,[["__cssModules",De]]),y={ACTIVE:!0,DEACTIVATED:!1,ALL:""},Ie=N({name:"WorkflowsView",components:{ResourcesListLayout:se,WorkflowCard:Pe,TagsDropdown:ke,ProjectTabs:Ee},data(){return{filters:{search:"",homeProject:"",status:y.ALL,tags:[]},sourceControlStoreUnsubscribe:()=>{}}},computed:{...Ce(x,B,H,K,ye,be,q,ge),readOnlyEnv(){return this.sourceControlStore.preferences.branchReadOnly},currentUser(){return this.usersStore.currentUser||{}},allWorkflows(){return this.workflowsStore.allWorkflows},isShareable(){return this.settingsStore.isEnterpriseFeatureEnabled(Se.Sharing)},statusFilterOptions(){return[{label:this.$locale.baseText("workflows.filters.status.all"),value:y.ALL},{label:this.$locale.baseText("workflows.filters.status.active"),value:y.ACTIVE},{label:this.$locale.baseText("workflows.filters.status.deactivated"),value:y.DEACTIVATED}]},userRole(){var a,o;const e=(a=this.usersStore.currentUserCloudInfo)==null?void 0:a.role;if(e)return e;const s=(o=this.usersStore.currentUser)==null?void 0:o.personalizationAnswers;if(s&&"role"in s)return s.role},isSalesUser(){return this.userRole?["Sales","sales-and-marketing"].includes(this.userRole):!1},showProjectTabs(){return!!this.$route.params.projectId||!!this.allWorkflows.length||this.projectsStore.myProjects.length>1},addWorkflowButtonText(){return this.projectsStore.currentProject?this.$locale.baseText("workflows.project.add"):this.$locale.baseText("workflows.add")}},watch:{filters:{deep:!0,handler(){this.saveFiltersOnQueryString()}},"filters.tags"(){this.sendFiltersTelemetry("tags")},"$route.params.projectId"(){this.initialize()}},async mounted(){await this.setFiltersFromQueryString(),this.usersStore.showPersonalizationSurvey(),this.sourceControlStoreUnsubscribe=this.sourceControlStore.$onAction(({name:e,after:s})=>{e==="pullWorkfolder"&&s&&s(()=>{this.initialize()})})},beforeUnmount(){this.sourceControlStoreUnsubscribe()},methods:{onFiltersUpdated(e){this.filters=e},addWorkflow(){var e,s;this.uiStore.nodeViewInitialized=!1,this.$router.push({name:M.NEW_WORKFLOW,query:{projectId:(s=(e=this.$route)==null?void 0:e.params)==null?void 0:s.projectId}}),this.$telemetry.track("User clicked add workflow button",{source:"Workflows list"})},getTemplateRepositoryURL(){return this.templatesStore.websiteTemplateRepositoryURL},trackCategoryLinkClick(e){var s;this.$telemetry.track(`User clicked Browse ${e} Templates`,{role:(s=this.usersStore.currentUserCloudInfo)==null?void 0:s.role,active_workflow_count:this.workflowsStore.activeWorkflows.length})},async initialize(){var e,s;await Promise.all([this.usersStore.fetchUsers(),this.workflowsStore.fetchAllWorkflows((s=(e=this.$route)==null?void 0:e.params)==null?void 0:s.projectId),this.workflowsStore.fetchActiveWorkflows()])},onClickTag(e){this.filters.tags.includes(e)||this.filters.tags.push(e)},onFilter(e,s,a){return this.settingsStore.areTagsEnabled&&s.tags.length>0&&(a=a&&s.tags.every(o=>{var c;return(c=e.tags)==null?void 0:c.find(f=>typeof f=="object"?`${f.id}`==`${o}`:`${f}`==`${o}`)})),s.status!==""&&(a=a&&e.active===s.status),a},sendFiltersTelemetry(e){this.$refs.layout.sendFiltersTelemetry(e)},saveFiltersOnQueryString(){const e={};this.filters.search&&(e.search=this.filters.search),typeof this.filters.status!="string"&&(e.status=this.filters.status.toString()),this.filters.tags.length&&(e.tags=this.filters.tags.join(",")),this.filters.homeProject&&(e.homeProject=this.filters.homeProject),this.$router.replace({query:Object.keys(e).length?e:void 0})},isValidProjectId(e){return this.projectsStore.projects.some(s=>s.id===e)},async setFiltersFromQueryString(){const{tags:e,status:s,search:a,homeProject:o}=this.$route.query,c={};if(o&&typeof o=="string"&&(await this.projectsStore.getAllProjects(),this.isValidProjectId(o)&&(c.homeProject=o)),a&&typeof a=="string"&&(c.search=a),e&&typeof e=="string"){const f=this.tagsStore.allTags.map(i=>i.id),b=e.split(",").filter(i=>f.includes(i));b.length&&(c.tags=b)}s&&typeof s=="string"&&[y.ACTIVE.toString(),y.DEACTIVATED.toString()].includes(s)&&(c.status=s==="true"),Object.keys(c).length&&(this.filters={...this.filters,...c})}}}),Re=Ie,Fe="_actionsContainer_1gv00_1",Me="_emptyStateCard_1gv00_6",Ve="_emptyStateCardIcon_1gv00_19",ze={actionsContainer:Fe,emptyStateCard:Me,emptyStateCardIcon:Ve},Ne={target:"_blank",href:"https://docs.n8n.io/source-control-environments/"},xe={class:"text-center mt-s"},Be=["href"],He={key:0,class:"mb-s"},Ke={class:"mb-s"};function qe(e,s,a,o,c,f){const b=l("ProjectTabs"),i=l("n8n-button"),C=l("i18n-t"),U=l("n8n-tooltip"),D=l("WorkflowCard"),S=l("n8n-heading"),_=l("n8n-text"),E=l("n8n-icon"),$=l("n8n-card"),W=l("n8n-input-label"),O=l("TagsDropdown"),P=l("n8n-option"),I=l("n8n-select"),A=l("ResourcesListLayout");return w(),j(A,{ref:"layout","resource-key":"workflows",resources:e.allWorkflows,filters:e.filters,"additional-filters-handler":e.onFilter,"type-props":{itemSize:80},shareable:e.isShareable,initialize:e.initialize,disabled:e.readOnlyEnv,"onClick:add":e.addWorkflow,"onUpdate:filters":e.onFiltersUpdated},{header:n(()=>[e.showProjectTabs?(w(),j(b,{key:0})):v("",!0)]),"add-button":n(({disabled:m})=>[r(U,{disabled:!e.readOnlyEnv},{content:n(()=>[r(C,{tag:"span",keypath:"mainSidebar.workflows.readOnlyEnv.tooltip"},{link:n(()=>[g("a",Ne,p(e.$locale.baseText("mainSidebar.workflows.readOnlyEnv.tooltip.link")),1)]),_:1})]),default:n(()=>[g("div",null,[r(i,{size:"large",block:"",disabled:m,"data-test-id":"resources-list-add",onClick:e.addWorkflow},{default:n(()=>[k(p(e.addWorkflowButtonText),1)]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["disabled"])]),default:n(({data:m,updateItemSize:u})=>[r(D,{"data-test-id":"resources-list-item",class:"mb-2xs",data:m,"read-only":e.readOnlyEnv,"onExpand:tags":V=>u(m),"onClick:tag":e.onClickTag},null,8,["data","read-only","onExpand:tags","onClick:tag"])]),empty:n(()=>[g("div",xe,[r(S,{tag:"h2",size:"xlarge",class:"mb-2xs"},{default:n(()=>[k(p(e.currentUser.firstName?e.$locale.baseText("workflows.empty.heading",{interpolate:{name:e.currentUser.firstName}}):e.$locale.baseText("workflows.empty.heading.userNotSetup")),1)]),_:1}),r(_,{size:"large",color:"text-base"},{default:n(()=>[k(p(e.$locale.baseText(e.readOnlyEnv?"workflows.empty.description.readOnlyEnv":"workflows.empty.description")),1)]),_:1})]),e.readOnlyEnv?v("",!0):(w(),T("div",{key:0,class:h(["text-center","mt-2xl",e.$style.actionsContainer])},[e.isSalesUser?(w(),T("a",{key:0,href:e.getTemplateRepositoryURL(),class:h(e.$style.emptyStateCard),target:"_blank"},[r($,{hoverable:"","data-test-id":"browse-sales-templates-card",onClick:s[0]||(s[0]=m=>e.trackCategoryLinkClick("Sales"))},{default:n(()=>[r(E,{class:h(e.$style.emptyStateCardIcon),icon:"box-open"},null,8,["class"]),r(_,{size:"large",class:"mt-xs",color:"text-base"},{default:n(()=>[k(p(e.$locale.baseText("workflows.empty.browseTemplates")),1)]),_:1})]),_:1})],10,Be)):v("",!0),r($,{class:h(e.$style.emptyStateCard),hoverable:"","data-test-id":"new-workflow-card",onClick:e.addWorkflow},{default:n(()=>[r(E,{class:h(e.$style.emptyStateCardIcon),icon:"file"},null,8,["class"]),r(_,{size:"large",class:"mt-xs",color:"text-base"},{default:n(()=>[k(p(e.$locale.baseText("workflows.empty.startFromScratch")),1)]),_:1})]),_:1},8,["class","onClick"])],2))]),filters:n(({setKeyValue:m})=>[e.settingsStore.areTagsEnabled?(w(),T("div",He,[r(W,{label:e.$locale.baseText("workflows.filters.tags"),bold:!1,size:"small",color:"text-base",class:"mb-3xs"},null,8,["label"]),r(O,{placeholder:e.$locale.baseText("workflowOpen.filterWorkflows"),"model-value":e.filters.tags,"create-enabled":!1,"onUpdate:modelValue":u=>m("tags",u)},null,8,["placeholder","model-value","onUpdate:modelValue"])])):v("",!0),g("div",Ke,[r(W,{label:e.$locale.baseText("workflows.filters.status"),bold:!1,size:"small",color:"text-base",class:"mb-3xs"},null,8,["label"]),r(I,{"data-test-id":"status-dropdown","model-value":e.filters.status,"onUpdate:modelValue":u=>m("status",u)},{default:n(()=>[(w(!0),T(re,null,ne(e.statusFilterOptions,u=>(w(),j(P,{key:u.label,label:u.label,value:u.value,"data-test-id":"status"},null,8,["label","value"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue"])])]),_:1},8,["resources","filters","additional-filters-handler","shareable","initialize","disabled","onClick:add","onUpdate:filters"])}const Qe={$style:ze},Ot=Q(Re,[["render",qe],["__cssModules",Qe]]);export{Ot as default};
//# sourceMappingURL=WorkflowsView-DVeAZ2zW.js.map
