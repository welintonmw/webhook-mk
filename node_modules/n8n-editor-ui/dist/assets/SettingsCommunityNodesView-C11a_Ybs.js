import{cU as C,e as $,cV as B,u as L,b as D,cW as O,cX as T,cY as w,cZ as x,c_ as V,a3 as z}from"./index-1OxaEeO3.js";import{m as v}from"./pinia-sugP77Im.js";import{G as A,ag as l,l as t,m as s,I as o,U as a,p as c,O as i,S as y,T as r,F as b,a7 as N,M as k,R as S,aH as R}from"./vendor-Dv5OeN6t.js";import{_ as P}from"./n8n-4UEsHtUL.js";import{u as H}from"./usePushConnection-PQgFeT_8.js";import{a as Y}from"./collaboration.store-Ol7bcCFc.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const G=A({name:"CommunityPackageCard",props:{communityPackage:{type:Object,required:!1,default:null},loading:{type:Boolean,default:!1}},data(){return{packageActions:[{label:this.$locale.baseText("settings.communityNodes.viewDocsAction.label"),value:C.VIEW_DOCS,type:"external-link"},{label:this.$locale.baseText("settings.communityNodes.uninstallAction.label"),value:C.UNINSTALL}]}},computed:{...v($)},methods:{async onAction(e){if(this.communityPackage)switch(e){case C.VIEW_DOCS:this.$telemetry.track("user clicked to browse the cnr package documentation",{package_name:this.communityPackage.packageName,package_version:this.communityPackage.installedVersion}),window.open(`${B}${this.communityPackage.packageName}`,"_blank");break;case C.UNINSTALL:this.uiStore.openCommunityPackageUninstallConfirmModal(this.communityPackage.packageName);break}},onUpdateClick(){this.communityPackage&&this.uiStore.openCommunityPackageUpdateConfirmModal(this.communityPackage.packageName)}}}),K="_cardContainer_1cg0i_1",Q="_packageCard_1cg0i_9",W="_cardSkeleton_1cg0i_10",j="_loader_1cg0i_24",q="_cardInfoContainer_1cg0i_35",F="_cardTitle_1cg0i_40",X="_cardSubtitle_1cg0i_47",Z="_cardControlsContainer_1cg0i_52",J="_cardActions_1cg0i_58",ee={cardContainer:K,packageCard:Q,cardSkeleton:W,loader:j,cardInfoContainer:q,cardTitle:F,cardSubtitle:X,cardControlsContainer:Z,cardActions:J},te={key:0};function oe(e,m,n,h,I,M){const _=l("n8n-loading"),d=l("n8n-text"),g=l("n8n-icon"),u=l("n8n-tooltip"),p=l("n8n-button"),U=l("n8n-action-toggle");return t(),s("div",{class:o(e.$style.cardContainer)},[e.loading?(t(),s("div",{key:0,class:o(e.$style.cardSkeleton)},[a(_,{class:o(e.$style.loader),variant:"p",rows:1},null,8,["class"]),a(_,{class:o(e.$style.loader),variant:"p",rows:1},null,8,["class"])],2)):e.communityPackage?(t(),s("div",{key:1,class:o(e.$style.packageCard)},[c("div",{class:o(e.$style.cardInfoContainer)},[c("div",{class:o(e.$style.cardTitle)},[a(d,{bold:!0,size:"large"},{default:i(()=>[y(r(e.communityPackage.packageName),1)]),_:1})],2),c("div",{class:o(e.$style.cardSubtitle)},[a(d,{bold:!0,size:"small",color:"text-light"},{default:i(()=>[y(r(e.$locale.baseText("settings.communityNodes.packageNodes.label",{adjustToNumber:e.communityPackage.installedNodes.length}))+":Â  ",1)]),_:1}),a(d,{size:"small",color:"text-light"},{default:i(()=>[(t(!0),s(b,null,N(e.communityPackage.installedNodes,(f,E)=>(t(),s("span",{key:f.name},[y(r(f.name),1),E!=e.communityPackage.installedNodes.length-1?(t(),s("span",te,",")):S("",!0)]))),128))]),_:1})],2)],2),c("div",{class:o(e.$style.cardControlsContainer)},[a(d,{bold:!0,size:"large",color:"text-light"},{default:i(()=>[y(" v"+r(e.communityPackage.installedVersion),1)]),_:1}),e.communityPackage.failedLoading===!0?(t(),k(u,{key:0,placement:"top"},{content:i(()=>[c("div",null,r(e.$locale.baseText("settings.communityNodes.failedToLoad.tooltip")),1)]),default:i(()=>[a(g,{icon:"exclamation-triangle",color:"danger",size:"large"})]),_:1})):e.communityPackage.updateAvailable?(t(),k(u,{key:1,placement:"top"},{content:i(()=>[c("div",null,r(e.$locale.baseText("settings.communityNodes.updateAvailable.tooltip")),1)]),default:i(()=>[a(p,{outline:"",label:"Update",onClick:e.onUpdateClick},null,8,["onClick"])]),_:1})):(t(),k(u,{key:2,placement:"top"},{content:i(()=>[c("div",null,r(e.$locale.baseText("settings.communityNodes.upToDate.tooltip")),1)]),default:i(()=>[a(g,{icon:"check-circle",color:"text-light",size:"large"})]),_:1})),c("div",{class:o(e.$style.cardActions)},[a(U,{actions:e.packageActions,onAction:e.onAction},null,8,["actions","onAction"])],2)],2)],2)):S("",!0)],2)}const ae={$style:ee},ne=P(G,[["render",oe],["__cssModules",ae]]),se=31,ie=A({name:"SettingsCommunityNodesView",components:{CommunityPackageCard:ne},setup(){const e=R(),m=H({router:e});return{externalHooks:z(),...L(),pushConnection:m}},data(){return{loading:!1}},computed:{...v(O,D,$,Y),getEmptyStateDescription(){const e=this.communityNodesStore.availablePackageCount;return this.settingsStore.isDesktopDeployment?this.$locale.baseText("contextual.communityNodes.unavailable.description.desktop"):e<se?this.$locale.baseText("settings.communityNodes.empty.description.no-packages",{interpolate:{docURL:T}}):this.$locale.baseText("settings.communityNodes.empty.description",{interpolate:{docURL:T,count:(Math.floor(e/10)*10).toString()}})},getEmptyStateButtonText(){return this.settingsStore.isDesktopDeployment?this.$locale.baseText("contextual.communityNodes.unavailable.button.desktop"):this.shouldShowInstallButton?this.$locale.baseText("settings.communityNodes.empty.installPackageLabel"):""},shouldShowInstallButton(){return this.settingsStore.isDesktopDeployment||this.settingsStore.isNpmAvailable},actionBoxConfig(){return this.settingsStore.isNpmAvailable?this.settingsStore.isQueueModeEnabled?{calloutText:this.$locale.baseText("settings.communityNodes.queueMode.warning",{interpolate:{docURL:x}}),calloutTheme:"warning",hideButton:!0}:{calloutText:"",calloutTheme:"",hideButton:!1}:{calloutText:this.$locale.baseText("settings.communityNodes.npmUnavailable.warning",{interpolate:{npmUrl:w}}),calloutTheme:"warning",hideButton:!0}}},beforeMount(){this.pushConnection.initialize(),this.pushStore.pushConnect()},async mounted(){try{this.loading=!0,await this.communityNodesStore.fetchInstalledPackages();const e=this.communityNodesStore.getInstalledPackages,m=e.filter(n=>n.updateAvailable);this.$telemetry.track("user viewed cnr settings page",{num_of_packages_installed:e.length,installed_packages:e.map(n=>({package_name:n.packageName,package_version:n.installedVersion,package_nodes:n.installedNodes.map(h=>`${h.name}-v${h.latestVersion}`),is_update_available:n.updateAvailable!==void 0})),packages_to_update:m.map(n=>({package_name:n.packageName,package_version_current:n.installedVersion,package_version_available:n.updateAvailable})),number_of_updates_available:m.length})}catch(e){this.showError(e,this.$locale.baseText("settings.communityNodes.fetchError.title"),this.$locale.baseText("settings.communityNodes.fetchError.message"))}finally{this.loading=!1}try{await this.communityNodesStore.fetchAvailableCommunityPackageCount()}finally{this.loading=!1}},beforeUnmount(){this.pushStore.pushDisconnect(),this.pushConnection.terminate()},methods:{onClickEmptyStateButton(){if(this.settingsStore.isDesktopDeployment)return this.goToUpgrade();this.openInstallModal()},goToUpgrade(){this.uiStore.goToUpgrade("community-nodes","upgrade-community-nodes")},openInstallModal(){const e={is_empty_state:this.communityNodesStore.getInstalledPackages.length===0};this.$telemetry.track("user clicked cnr install button",e),this.externalHooks.run("settingsCommunityNodesView.openInstallModal",e),this.uiStore.openModal(V)}}}),le="_container_18kse_1",ce="_headingContainer_18kse_9",re="_loadingContainer_18kse_14",me="_actionBoxContainer_18kse_19",de="_cardsContainer_18kse_23",ue={container:le,headingContainer:ce,loadingContainer:re,actionBoxContainer:me,cardsContainer:de};function pe(e,m,n,h,I,M){const _=l("n8n-heading"),d=l("n8n-button"),g=l("n8n-action-box"),u=l("CommunityPackageCard");return t(),s("div",{class:o(e.$style.container)},[c("div",{class:o(e.$style.headingContainer)},[a(_,{size:"2xlarge"},{default:i(()=>[y(r(e.$locale.baseText("settings.communityNodes")),1)]),_:1}),!e.settingsStore.isQueueModeEnabled&&e.communityNodesStore.getInstalledPackages.length>0&&!e.loading?(t(),k(d,{key:0,label:e.$locale.baseText("settings.communityNodes.installModal.installButton.label"),size:"large",onClick:e.openInstallModal},null,8,["label","onClick"])):S("",!0)],2),e.settingsStore.isQueueModeEnabled?(t(),s("div",{key:0,class:o(e.$style.actionBoxContainer)},[a(g,{heading:e.$locale.baseText("settings.communityNodes.empty.title"),description:e.getEmptyStateDescription,"callout-text":e.actionBoxConfig.calloutText,"callout-theme":e.actionBoxConfig.calloutTheme},null,8,["heading","description","callout-text","callout-theme"])],2)):e.loading?(t(),s("div",{key:1,class:o(e.$style.cardsContainer)},[(t(),s(b,null,N(2,p=>a(u,{key:"index-"+p,loading:!0})),64))],2)):e.communityNodesStore.getInstalledPackages.length===0?(t(),s("div",{key:2,class:o(e.$style.actionBoxContainer)},[a(g,{heading:e.$locale.baseText("settings.communityNodes.empty.title"),description:e.getEmptyStateDescription,"button-text":e.getEmptyStateButtonText,"callout-text":e.actionBoxConfig.calloutText,"callout-theme":e.actionBoxConfig.calloutTheme,"onClick:button":e.onClickEmptyStateButton},null,8,["heading","description","button-text","callout-text","callout-theme","onClick:button"])],2)):(t(),s("div",{key:3,class:o(e.$style.cardsContainer)},[(t(!0),s(b,null,N(e.communityNodesStore.getInstalledPackages,p=>(t(),k(u,{key:p.packageName,"community-package":p},null,8,["community-package"]))),128))],2))],2)}const ge={$style:ue},Qe=P(ie,[["render",pe],["__cssModules",ge]]);export{Qe as default};
//# sourceMappingURL=SettingsCommunityNodesView-C11a_Ybs.js.map
