import{R as F}from"./ResourcesListLayout-B4W1PSHT.js";import{G as M,e as h,ag as r,l as y,M as v,O as n,U as i,I as u,S as b,T as c,p,a2 as U,u as x,m as j,R as W,P as k,V as P,F as H,a7 as Y}from"./vendor-Dv5OeN6t.js";import{d as G}from"./dateformat-CIxnBJXX.js";import{e as N,aR as w,o as I,ea as J,eb as K,d9 as Q,x as q,A as X,e6 as Z,H as ee,aO as te,n as ae,a4 as se,ec as oe,b as ne,E as re,aQ as ie}from"./index-1OxaEeO3.js";import{_ as le}from"./ProjectCardBadge.vue_vue_type_script_setup_true_lang-6oVL0vKx.js";import{_ as D}from"./n8n-4UEsHtUL.js";import{m as de}from"./pinia-sugP77Im.js";import{P as ce}from"./ProjectTabs-5ZO9YR8J.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const pe={key:0},me=M({__name:"CredentialCard",props:{data:{default:()=>({id:"",createdAt:"",updatedAt:"",type:"",name:"",sharedWithProjects:[],homeProject:{}})},readOnly:{type:Boolean,default:!1}},setup(e){const a={OPEN:"open",DELETE:"delete",MOVE:"move"},s=e,o=q(),$=ee(),T=N(),f=w(),E=I(),m=h(()=>f.getCredentialTypeByName(s.data.type)),_=h(()=>J(s.data)),S=h(()=>{const t=[{label:o.baseText("credentials.item.open"),value:a.OPEN}];return _.value.delete&&t.push({label:o.baseText("credentials.item.delete"),value:a.DELETE}),_.value.move&&t.push({label:o.baseText("credentials.item.move"),value:a.MOVE}),t}),g=h(()=>{const t=new Date().getFullYear().toString();return G(s.data.createdAt,`d mmmm${s.data.createdAt.startsWith(t)?"":", yyyy"}`)});function C(){T.openExistingCredential(s.data.id)}async function l(t){switch(t){case a.OPEN:C();break;case a.DELETE:await d();break;case a.MOVE:O();break}}async function d(){await $.confirm(o.baseText("credentialEdit.credentialEdit.confirmMessage.deleteCredential.message",{interpolate:{savedCredentialName:s.data.name}}),o.baseText("credentialEdit.credentialEdit.confirmMessage.deleteCredential.headline"),{confirmButtonText:o.baseText("credentialEdit.credentialEdit.confirmMessage.deleteCredential.confirmButtonText")})===X&&await f.deleteCredential({id:s.data.id})}function O(){T.openModalWithData({name:Z,data:{resource:s.data,resourceType:o.baseText("generic.credential").toLocaleLowerCase()}})}return(t,A)=>{const V=r("n8n-heading"),B=r("n8n-text"),R=r("n8n-action-toggle"),z=r("n8n-card");return y(),v(z,{class:u(t.$style.cardLink),onClick:C},{prepend:n(()=>{var L;return[i(K,{"credential-type-name":((L=m.value)==null?void 0:L.name)??""},null,8,["credential-type-name"])]}),header:n(()=>[i(V,{tag:"h2",bold:"",class:u(t.$style.cardHeading)},{default:n(()=>[b(c(t.data.name),1)]),_:1},8,["class"])]),append:n(()=>[p("div",{class:u(t.$style.cardActions),onClick:A[0]||(A[0]=U(()=>{},["stop"]))},[i(le,{resource:t.data,"personal-project":x(E).personalProject},null,8,["resource","personal-project"]),i(R,{"data-test-id":"credential-card-actions",actions:S.value,theme:"dark",onAction:l},null,8,["actions"])],2)]),default:n(()=>[p("div",{class:u(t.$style.cardDescription)},[i(B,{color:"text-light",size:"small"},{default:n(()=>[m.value?(y(),j("span",pe,c(m.value.displayName)+" | ",1)):W("",!0),k(p("span",null,[b(c(t.$locale.baseText("credentials.item.updated"))+" ",1),i(Q,{date:t.data.updatedAt},null,8,["date"]),b(" | ")],512),[[P,t.data]]),k(p("span",null,c(t.$locale.baseText("credentials.item.created"))+" "+c(g.value),513),[[P,t.data]])]),_:1})],2)]),_:1},8,["class"])}}}),ue="_cardLink_1no2l_1",ye="_cardHeading_1no2l_11",fe="_cardDescription_1no2l_19",_e="_cardActions_1no2l_26",Ce={cardLink:ue,cardHeading:ye,cardDescription:fe,cardActions:_e},he={$style:Ce},be=D(me,[["__cssModules",he]]),Te=M({name:"CredentialsView",components:{ResourcesListLayout:F,CredentialCard:be,ProjectTabs:ce},data(){return{filters:{search:"",homeProject:"",type:""},sourceControlStoreUnsubscribe:()=>{}}},computed:{...de(w,se,N,ae,te,I),allCredentials(){return this.credentialsStore.allCredentials.map(e=>({id:e.id,name:e.name,value:"",updatedAt:e.updatedAt,createdAt:e.createdAt,homeProject:e.homeProject,scopes:e.scopes,type:e.type,sharedWithProjects:e.sharedWithProjects}))},allCredentialTypes(){return this.credentialsStore.allCredentialTypes},credentialTypesById(){return this.credentialsStore.credentialTypesById},addCredentialButtonText(){return this.projectsStore.currentProject?this.$locale.baseText("credentials.project.add"):this.$locale.baseText("credentials.add")}},watch:{"filters.type"(){this.sendFiltersTelemetry("type")},"$route.params.projectId"(){this.initialize()}},mounted(){this.sourceControlStoreUnsubscribe=this.sourceControlStore.$onAction(({name:e,after:a})=>{e==="pullWorkfolder"&&a&&a(()=>{this.initialize()})})},beforeUnmount(){this.sourceControlStoreUnsubscribe()},methods:{addCredential(){this.uiStore.openModal(oe),this.$telemetry.track("User clicked add cred button",{source:"Creds list"})},async initialize(){var s,o;const e=ne().isEnterpriseFeatureEnabled(re.Variables),a=[this.credentialsStore.fetchAllCredentials((o=(s=this.$route)==null?void 0:s.params)==null?void 0:o.projectId),this.credentialsStore.fetchCredentialTypes(!1),this.externalSecretsStore.fetchAllSecrets(),this.nodeTypesStore.loadNodeTypesIfNotLoaded(),e?ie().fetchAllVariables():Promise.resolve()];await Promise.all(a)},onFilter(e,a,s){if(a.type.length>0&&(s=s&&a.type.includes(e.type)),a.search){const o=a.search.toLowerCase();s=s||this.credentialTypesById[e.type]&&this.credentialTypesById[e.type].displayName.toLowerCase().includes(o)}return s},sendFiltersTelemetry(e){this.$refs.layout.sendFiltersTelemetry(e)}}}),Ee="_sidebarContainer_pm4w0_5",Se={"type-input":"_type-input_pm4w0_1",sidebarContainer:Ee},ge={class:"mb-s"};function ve(e,a,s,o,$,T){const f=r("ProjectTabs"),E=r("n8n-button"),m=r("CredentialCard"),_=r("n8n-input-label"),S=r("n8n-option"),g=r("n8n-select"),C=r("ResourcesListLayout");return y(),v(C,{ref:"layout","resource-key":"credentials",resources:e.allCredentials,initialize:e.initialize,filters:e.filters,"additional-filters-handler":e.onFilter,"type-props":{itemSize:77},"onClick:add":e.addCredential,"onUpdate:filters":a[0]||(a[0]=l=>e.filters=l)},{header:n(()=>[i(f)]),"add-button":n(({disabled:l})=>[p("div",null,[i(E,{size:"large",block:"",disabled:l,"data-test-id":"resources-list-add",onClick:e.addCredential},{default:n(()=>[b(c(e.addCredentialButtonText),1)]),_:2},1032,["disabled","onClick"])])]),default:n(({data:l})=>[i(m,{"data-test-id":"resources-list-item",class:"mb-2xs",data:l},null,8,["data"])]),filters:n(({setKeyValue:l})=>[p("div",ge,[i(_,{label:e.$locale.baseText("credentials.filters.type"),bold:!1,size:"small",color:"text-base",class:"mb-3xs"},null,8,["label"]),i(g,{ref:"typeInput","model-value":e.filters.type,size:"medium",multiple:"",filterable:"",class:u(e.$style["type-input"]),"onUpdate:modelValue":d=>l("type",d)},{default:n(()=>[(y(!0),j(H,null,Y(e.allCredentialTypes,d=>(y(),v(S,{key:d.name,value:d.name,label:d.displayName},null,8,["value","label"]))),128))]),_:2},1032,["model-value","class","onUpdate:modelValue"])])]),_:1},8,["resources","initialize","filters","additional-filters-handler","onClick:add"])}const $e={$style:Se},ot=D(Te,[["render",ve],["__cssModules",$e]]);export{ot as default};
//# sourceMappingURL=CredentialsView-DnJ_jhDo.js.map
