import{m as oe}from"./pinia-sugP77Im.js";import{P as se}from"./PushConnectionTracker-Bp-RjnYr.js";import{aK as re,u as X,x as Z,e as ee,l as ne,d8 as ae,b as ce}from"./index-1OxaEeO3.js";import{a as J,W as T,u as ie}from"./usePushConnection-PQgFeT_8.js";import{G as I,r as v,ag as g,l,m as d,p as k,U as u,O as p,H as Y,I as c,R as F,M as L,S as b,T as s,F as E,a7 as N,u as f,e as q,b as le,y as de,aH as ue}from"./vendor-Dv5OeN6t.js";import{_ as S}from"./n8n-4UEsHtUL.js";import{C as H}from"./vue-chartjs-DGI3EW71.js";import{a as pe}from"./collaboration.store-Ol7bcCFc.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";function te(t){return t.reduce((a,r)=>a+r,0)/t.length}function me(t){return te(t).toFixed(2)}function R(t){return t/1024/1024/1024}const _e=I({__name:"WorkerAccordion.ee",props:{icon:{default:"tasks"},iconColor:{default:"black"},initialExpanded:{type:Boolean,default:!0}},setup(t){const r=v(t.initialExpanded);function i(){r.value=!r.value}return(o,m)=>{const e=g("n8n-icon"),h=g("n8n-text");return l(),d("div",{class:c(["accordion",o.$style.container])},[k("div",{class:c({[o.$style.header]:!0,[o.$style.expanded]:r.value}),onClick:i},[u(e,{icon:o.icon,color:o.iconColor,size:"small",class:"mr-2xs"},null,8,["icon","color"]),u(h,{class:c(o.$style.headerText),color:"text-base",size:"small",align:"left",bold:""},{default:p(()=>[Y(o.$slots,"title")]),_:3},8,["class"]),u(e,{icon:r.value?"chevron-up":"chevron-down",bold:""},null,8,["icon"])],2),r.value?(l(),d("div",{key:0,class:c({[o.$style.description]:!0,[o.$style.collapsed]:!r.value})},[Y(o.$slots,"content")],2)):F("",!0)],2)}}}),he="_container_odamb_1",ke="_header_odamb_5",ye="_headerText_odamb_11",fe="_expanded_odamb_15",ge="_description_odamb_19",$e={container:he,header:ke,headerText:ye,expanded:fe,description:ge},be={$style:$e},O=S(_e,[["__cssModules",be]]),we=["href"],ve=["href"],Me=I({__name:"WorkerJobAccordion.ee",props:{items:{}},setup(t){const a=t;function r(i){let o=Math.floor((new Date().getTime()-i.getTime())/1e3);const m=Math.floor(o/3600);o-=m*3600;const e=Math.floor(o/60);return o-=e*60,`${m}h ${e}m ${Math.floor(o)}s`}return(i,o)=>{const m=g("n8n-text");return l(),L(O,{icon:"tasks","icon-color":"black","initial-expanded":!0},{title:p(()=>[b(s(i.$locale.baseText("workerList.item.jobListTitle"))+" ("+s(i.items.length)+") ",1)]),content:p(()=>[a.items.length>0?(l(),d("div",{key:0,class:c(i.$style.accordionItems)},[(l(!0),d(E,null,N(a.items,e=>(l(),d("div",{key:e.executionId,class:c(i.$style.accordionItem)},[k("a",{href:"/workflow/"+e.workflowId+"/executions/"+e.executionId}," Execution "+s(e.executionId)+" - "+s(e.workflowName),9,we),u(m,{color:"text-base",size:"small",align:"left"},{default:p(()=>{var h;return[b(" | Started at: "+s((h=new Date(e.startedAt))==null?void 0:h.toLocaleTimeString())+" | Running for "+s(r(new Date(e.startedAt)))+" "+s(e.retryOf?`| Retry of: ${e.retryOf}`:"")+" | ",1)]}),_:2},1024),k("a",{target:"_blank",href:"/workflow/"+e.workflowId}," (Open workflow)",8,ve)],2))),128))],2)):(l(),d("div",{key:1,class:c(i.$style.accordionItems)},[k("span",{class:c(i.$style.empty)},s(i.$locale.baseText("workerList.item.jobList.empty")),3)],2))]),_:1})}}}),Ie="_accordionItems_kt5sk_1",Se="_accordionItem_kt5sk_1",Ce="_empty_kt5sk_14",Te={accordionItems:Ie,accordionItem:Se,empty:Ce},Le={$style:Te},xe=S(Me,[["__cssModules",Le]]),Ae=["onClick"],We=I({__name:"WorkerNetAccordion.ee",props:{items:{}},setup(t){const a=t,r=Z(),i=re(),{showMessage:o}=X();function m(e){try{i.copy(e),o({title:r.baseText("workerList.item.copyAddressToClipboard"),type:"success"})}catch{}}return(e,h)=>(l(),L(O,{icon:"tasks","icon-color":"black","initial-expanded":!1},{title:p(()=>[b(s(e.$locale.baseText("workerList.item.netListTitle"))+" ("+s(e.items.length)+") ",1)]),content:p(()=>[a.items.length>0?(l(),d("div",{key:0,class:c(e.$style.accordionItems)},[(l(!0),d(E,null,N(a.items,y=>(l(),d("div",{key:y.address,class:c(e.$style.accordionItem),onClick:n=>m(y.address)},[b(s(y.family)+": ",1),k("span",{class:c(e.$style.clickable)},s(y.address),3),b(" "+s(y.internal?"(internal)":""),1)],10,Ae))),128))],2)):F("",!0)]),_:1}))}}),Ue="_accordionItems_10xds_1",Re="_accordionItem_10xds_1",Be="_clickable_10xds_15",De={accordionItems:Ue,accordionItem:Re,clickable:Be},Pe={$style:De},He=S(We,[["__cssModules",Pe]]),Je=I({__name:"WorkerChartsAccordion.ee",props:{workerId:{}},setup(t){var j,z,G;const a=t,r=(w,x,C=0)=>({datasets:[{label:w,backgroundColor:x,data:C?Array(Math.min(T,C)).fill(0):[]}],labels:Array(Math.min(T,C)).fill("")}),i=J(),o=v(void 0),m=v(void 0),e=v(void 0),h=()=>({responsive:!0,maintainAspectRatio:!0,scales:{y:{type:"linear",display:!0,position:"left",min:0,suggestedMax:5}}}),y=h(),n=h();(j=n.scales)!=null&&j.y&&(n.scales.y.suggestedMax=100);const _=R((z=i.workers[a.workerId])==null?void 0:z.totalMem)??1,$=h();(G=$.scales)!=null&&G.y&&($.scales.y.suggestedMax=_);const M=v(r("Job Count","rgb(255, 111, 92)",T)),W=v(r("Processor Usage","rgb(19, 205, 103)",T)),V=v(r("Memory Usage","rgb(244, 216, 174)",T));return i.$onAction(({name:w,store:x})=>{var C,K;if(w==="updateWorkerStatus"){const B=T-(((C=x.workersHistory[a.workerId])==null?void 0:C.length)??0),A=r("Job Count","rgb(255, 111, 92)",B),D=r("Processor Usage","rgb(19, 205, 103)",B),P=r("Memory Usage","rgb(244, 216, 174)",B);(K=x.workersHistory[a.workerId])==null||K.forEach(U=>{var Q;A.datasets[0].data.push(U.data.runningJobsSummary.length),(Q=A.labels)==null||Q.push(new Date(U.timestamp).toLocaleTimeString()),D.datasets[0].data.push(te(U.data.loadAvg)),D.labels=A.labels,P.datasets[0].data.push(_-R(U.data.freeMem)),P.labels=A.labels}),M.value=A,W.value=D,V.value=P}}),(w,x)=>(l(),L(O,{icon:"tasks","icon-color":"black","initial-expanded":!1},{title:p(()=>[b(s(w.$locale.baseText("workerList.item.chartsTitle")),1)]),content:p(()=>[k("div",{class:c(w.$style.charts)},[u(f(H),{ref_key:"chartRefJobs",ref:o,type:"line",data:M.value,options:f(y),class:c(w.$style.chart)},null,8,["data","options","class"]),u(f(H),{ref_key:"chartRefCPU",ref:m,type:"line",data:W.value,options:f(n),class:c(w.$style.chart)},null,8,["data","options","class"]),u(f(H),{ref_key:"chartRefMemory",ref:e,type:"line",data:V.value,options:f($),class:c(w.$style.chart)},null,8,["data","options","class"])],2)]),_:1}))}}),Fe="_accordionItems_2yo1p_1",Ee="_accordionItem_2yo1p_1",Ne="_charts_2yo1p_14",Oe="_chart_2yo1p_14",Ve={accordionItems:Fe,accordionItem:Ee,charts:Ne,chart:Oe},je={$style:Ve},ze=S(Je,[["__cssModules",je]]),Ge=k("br",null,null,-1),Ke=I({__name:"WorkerCard.ee",props:{workerId:{}},setup(t){let a;const r=J(),i=t,o=v("0"),m=v(!1),e=q(()=>r.getWorkerStatus(i.workerId)),h=q(()=>{var n;return((n=e.value)==null?void 0:n.interfaces.toSorted((_,$)=>_.family.localeCompare($.family)))??[]});function y(n){const _=Math.floor(n/86400);n-=_*3600*24;const $=Math.floor(n/3600);n-=$*3600;const M=Math.floor(n/60);return n-=M*60,`${_}d ${$}h ${M}m ${Math.floor(n)}s`}return le(()=>{a=setInterval(()=>{const n=r.getWorkerLastUpdated(i.workerId);if(!n)return;const _=Math.ceil((Date.now()-n)/1e3);m.value=_>10,o.value=_.toFixed(0)},500)}),de(()=>{clearInterval(a)}),(n,_)=>{const $=g("n8n-heading"),M=g("n8n-text"),W=g("n8n-card");return e.value?(l(),L(W,{key:0,class:c(n.$style.cardLink)},{header:p(()=>[u($,{tag:"h2",bold:"",class:c(m.value?[n.$style.cardHeading,n.$style.stale]:[n.$style.cardHeading]),"data-test-id":"worker-card-name"},{default:p(()=>[b(" Name: "+s(e.value.workerId)+" ("+s(e.value.hostname)+") ",1),Ge,b(" Average Load: "+s(f(me)(e.value.loadAvg??[0]))+" | Free Memory: "+s(f(R)(e.value.freeMem).toFixed(2))+"GB / "+s(f(R)(e.value.totalMem).toFixed(2))+"GB "+s(m.value?" (stale)":""),1)]),_:1},8,["class"])]),append:p(()=>[k("div",{ref:"cardActions",class:c(n.$style.cardActions)},null,2)]),default:p(()=>[k("div",{class:c(n.$style.cardDescription)},[u(M,{color:"text-light",size:"small",class:c(n.$style.container)},{default:p(()=>[k("span",null,s(n.$locale.baseText("workerList.item.lastUpdated"))+" "+s(o.value)+"s ago | n8n-Version: "+s(e.value.version)+" | Architecture: "+s(e.value.arch)+" ( "+s(e.value.platform)+") | Uptime: "+s(y(e.value.uptime)),1),u(xe,{items:e.value.runningJobsSummary},null,8,["items"]),u(He,{items:h.value},null,8,["items"]),u(ze,{"worker-id":e.value.workerId},null,8,["worker-id"])]),_:1},8,["class"])],2)]),_:1},8,["class"])):F("",!0)}}}),Qe="_container_s5el6_1",Ye="_cardLink_s5el6_5",qe="_cardHeading_s5el6_15",Xe="_stale_s5el6_21",Ze="_cardDescription_s5el6_25",et="_cardActions_s5el6_32",tt={container:Qe,cardLink:Ye,cardHeading:qe,stale:Xe,cardDescription:Ze,cardActions:et},ot={$style:tt},st=S(Ke,[["__cssModules",ot]]),rt=I({name:"WorkerList",components:{PushConnectionTracker:se,WorkerCard:st},props:{autoRefreshEnabled:{type:Boolean,default:!0}},setup(){const t=ue(),a=Z(),r=ie({router:t});return{i18n:a,pushConnection:r,...X()}},computed:{...oe(ne,ee,pe,J),combinedWorkers(){const t=[];for(const a in this.orchestrationManagerStore.workers)t.push(this.orchestrationManagerStore.workers[a]);return t},initialStatusReceived(){return this.orchestrationManagerStore.initialStatusReceived},workerIds(){return Object.keys(this.orchestrationManagerStore.workers)},pageTitle(){return this.i18n.baseText("workerList.pageTitle")}},mounted(){ae(`n8n - ${this.pageTitle}`),this.$telemetry.track("User viewed worker view",{instance_id:this.rootStore.instanceId})},beforeMount(){window.Cypress===void 0&&(this.pushConnection.initialize(),this.pushStore.pushConnect(),this.orchestrationManagerStore.startWorkerStatusPolling())},beforeUnmount(){window.Cypress===void 0&&(this.orchestrationManagerStore.stopWorkerStatusPolling(),this.pushStore.pushDisconnect(),this.pushConnection.terminate())},methods:{averageLoadAvg(t){return(t.reduce((a,r)=>a+r,0)/t.length).toFixed(2)},getStatus(t){return t.runningJobsSummary.length>0?"running":"success"},getRowClass(t){return[this.$style.execRow,this.$style[this.getStatus(t)]].join(" ")}}}),nt="_workerListHeader_12j1s_1",at="_card_12j1s_8",ct="_tableLoader_12j1s_12",it={workerListHeader:nt,card:at,tableLoader:ct},lt={key:0},dt={key:1},ut={key:0},pt={key:1};function mt(t,a,r,i,o,m){const e=g("PushConnectionTracker"),h=g("n8n-heading"),y=g("n8n-spinner"),n=g("WorkerCard");return l(),d("div",null,[u(e,{class:"actions"}),k("div",{class:c(t.$style.workerListHeader)},[u(h,{tag:"h1",size:"2xlarge"},{default:p(()=>[b(s(t.pageTitle),1)]),_:1})],2),t.initialStatusReceived?(l(),d("div",dt,[t.workerIds.length===0?(l(),d("div",ut,s(t.$locale.baseText("workerList.empty")),1)):(l(),d("div",pt,[(l(!0),d(E,null,N(t.workerIds,_=>(l(),d("div",{key:_,class:c(t.$style.card)},[u(n,{"worker-id":_,"data-test-id":"worker-card"},null,8,["worker-id"])],2))),128))]))])):(l(),d("div",lt,[u(y)]))])}const _t={$style:it},ht=S(rt,[["render",mt],["__cssModules",_t]]),kt=["href"],yt=I({__name:"WorkerView",setup(t){const a=ce(),r=ee(),i=()=>{r.goToUpgrade("worker-view","upgrade-worker-view")};return(o,m)=>{const e=g("n8n-action-box");return f(a).isQueueModeEnabled&&f(a).isWorkerViewAvailable?(l(),L(ht,{key:0,"data-test-id":"worker-view-licensed"})):(l(),L(e,{key:1,"data-test-id":"worker-view-unlicensed",class:c(o.$style.actionBox),description:o.$locale.baseText("workerList.actionBox.description"),"button-text":o.$locale.baseText("workerList.actionBox.buttonText"),"onClick:button":i},{heading:p(()=>[k("span",null,s(o.$locale.baseText("workerList.actionBox.title")),1)]),description:p(()=>[b(s(o.$locale.baseText("workerList.actionBox.description"))+" ",1),k("a",{href:o.$locale.baseText("workerList.docs.url"),target:"_blank"},s(o.$locale.baseText("workerList.actionBox.description.link")),9,kt)]),_:1},8,["class","description","button-text"]))}}}),ft="_actionBox_13ul9_1",gt={actionBox:ft},$t={$style:gt},eo=S(yt,[["__cssModules",$t]]);export{eo as default};
//# sourceMappingURL=WorkerView-DV19-i1-.js.map
