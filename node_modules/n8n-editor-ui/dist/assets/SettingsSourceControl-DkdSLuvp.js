import{n as X,e as Y,u as j,Y as J,c$ as ee,x as te,A as U,H as se}from"./index-1OxaEeO3.js";import{G as oe,r as ne,e as V,b as re,Z as ae,ag as g,l as m,m as x,U as c,O as a,S as h,T as r,u as s,p as n,I as l,M as _,R as b}from"./vendor-Dv5OeN6t.js";import{_ as ce}from"./n8n-4UEsHtUL.js";import"./pinia-sugP77Im.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const le={key:0,"data-test-id":"source-control-content-licensed"},ie=["href"],ue={for:"repoUrl"},pe=["href"],de={key:2,"data-test-id":"source-control-connected-content"},ge=n("hr",null,null,-1),me=["href"],he=oe({__name:"SettingsSourceControl",setup(we){const e=te(),o=X(),w=Y(),p=j(),S=se(),y=J(),d=ne(!1),E=V(()=>o.preferences.branches.map(t=>({value:t,label:t}))),K=async()=>{y.startLoading(),y.setLoadingText(e.baseText("settings.sourceControl.loading.connecting"));try{await o.savePreferences({repositoryUrl:o.preferences.repositoryUrl}),await o.getBranches(),d.value=!0,p.showMessage({title:e.baseText("settings.sourceControl.toast.connected.title"),message:e.baseText("settings.sourceControl.toast.connected.message"),type:"success"})}catch(t){p.showError(t,e.baseText("settings.sourceControl.toast.connected.error"))}y.stopLoading()},$=async()=>{try{await S.confirm(e.baseText("settings.sourceControl.modals.disconnect.message"),e.baseText("settings.sourceControl.modals.disconnect.title"),{confirmButtonText:e.baseText("settings.sourceControl.modals.disconnect.confirm"),cancelButtonText:e.baseText("settings.sourceControl.modals.disconnect.cancel")})===U&&(y.startLoading(),await o.disconnect(!0),d.value=!1,p.showMessage({title:e.baseText("settings.sourceControl.toast.disconnected.title"),message:e.baseText("settings.sourceControl.toast.disconnected.message"),type:"success"}))}catch(t){p.showError(t,e.baseText("settings.sourceControl.toast.disconnected.error"))}y.stopLoading()},I=async()=>{y.startLoading();try{await o.updatePreferences({branchName:o.preferences.branchName,branchReadOnly:o.preferences.branchReadOnly,branchColor:o.preferences.branchColor}),p.showMessage({title:e.baseText("settings.sourceControl.saved.title"),type:"success"})}catch(t){p.showError(t,"Error setting branch")}y.stopLoading()},z=async t=>{t!==o.preferences.branchName&&(o.preferences.branchName=t)},N=()=>{w.goToUpgrade("source-control","upgrade-source-control")},R=async()=>{await o.getPreferences(),o.preferences.connected&&(d.value=!0,o.getBranches())};re(async()=>{o.isEnterpriseSourceControlEnabled&&await R()});const B=ae({repoUrl:!1,keyGeneratorType:!1});function C(t,i){B[t]=i}const M=[{name:"REQUIRED"},{name:"MATCH_REGEX",config:{regex:/^(ssh:\/\/)?git@(?:\[[0-9a-fA-F:]+\]|(?:[a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+)(?::[0-9]+)*:(?:v[0-9]+\/)?[a-zA-Z0-9_.\-\/]+(\.git)?(?:\/[a-zA-Z0-9_.\-\/]+)*$/,message:e.baseText("settings.sourceControl.repoUrlInvalid")}}],O=[{name:"REQUIRED"}],G=V(()=>B.repoUrl),L=[{name:"REQUIRED"}];async function A(){try{await S.confirm(e.baseText("settings.sourceControl.modals.refreshSshKey.message"),e.baseText("settings.sourceControl.modals.refreshSshKey.title"),{confirmButtonText:e.baseText("settings.sourceControl.modals.refreshSshKey.confirm"),cancelButtonText:e.baseText("settings.sourceControl.modals.refreshSshKey.cancel")})===U&&(await o.generateKeyPair(o.preferences.keyGeneratorType),p.showMessage({title:e.baseText("settings.sourceControl.refreshSshKey.successful.title"),type:"success"}))}catch(t){p.showError(t,e.baseText("settings.sourceControl.refreshSshKey.error.title"))}}const D=async()=>{try{await o.getBranches(),p.showMessage({title:e.baseText("settings.sourceControl.refreshBranches.success"),type:"success"})}catch(t){p.showError(t,e.baseText("settings.sourceControl.refreshBranches.error"))}},F=async t=>{t!==o.preferences.keyGeneratorType&&(o.preferences.keyGeneratorType=t)};return(t,i)=>{const T=g("n8n-heading"),v=g("i18n-t"),P=g("n8n-callout"),k=g("n8n-form-input"),f=g("n8n-button"),Z=g("n8n-notice"),Q=g("n8n-tooltip"),H=g("n8n-checkbox"),q=g("n8n-color-picker"),W=g("n8n-action-box");return m(),x("div",null,[c(T,{size:"2xlarge",tag:"h1"},{default:a(()=>[h(r(s(e).baseText("settings.sourceControl.title")),1)]),_:1}),s(o).isEnterpriseSourceControlEnabled?(m(),x("div",le,[c(P,{theme:"secondary",icon:"info-circle",class:"mt-2xl mb-l"},{default:a(()=>[c(v,{keypath:"settings.sourceControl.description",tag:"span"},{link:a(()=>[n("a",{href:s(e).baseText("settings.sourceControl.docs.url"),target:"_blank"},r(s(e).baseText("settings.sourceControl.description.link")),9,ie)]),_:1})]),_:1}),c(T,{size:"xlarge",tag:"h2",class:"mb-s"},{default:a(()=>[h(r(s(e).baseText("settings.sourceControl.gitConfig")),1)]),_:1}),n("div",{class:l(t.$style.group)},[n("label",ue,r(s(e).baseText("settings.sourceControl.repoUrl")),1),n("div",{class:l(t.$style.groupFlex)},[c(k,{id:"repoUrl",modelValue:s(o).preferences.repositoryUrl,"onUpdate:modelValue":i[0]||(i[0]=u=>s(o).preferences.repositoryUrl=u),label:"",class:"ml-0",name:"repoUrl","validate-on-blur":"","validation-rules":M,disabled:d.value,placeholder:s(e).baseText("settings.sourceControl.repoUrlPlaceholder"),onValidate:i[1]||(i[1]=u=>C("repoUrl",u))},null,8,["modelValue","disabled","placeholder"]),d.value?(m(),_(f,{key:0,class:l(t.$style.disconnectButton),type:"tertiary",size:"large",icon:"trash","data-test-id":"source-control-disconnect-button",onClick:$},{default:a(()=>[h(r(s(e).baseText("settings.sourceControl.button.disconnect")),1)]),_:1},8,["class"])):b("",!0)],2)],2),s(o).preferences.publicKey?(m(),x("div",{key:0,class:l(t.$style.group)},[n("label",null,r(s(e).baseText("settings.sourceControl.sshKey")),1),n("div",{class:l({[t.$style.sshInput]:!d.value})},[d.value?b("",!0):(m(),_(k,{key:0,id:"keyGeneratorType",class:l(t.$style.sshKeyTypeSelect),label:"",type:"select",name:"keyGeneratorType","data-test-id":"source-control-ssh-key-type-select","validate-on-blur":"","validation-rules":O,options:s(o).sshKeyTypesWithLabel,"model-value":s(o).preferences.keyGeneratorType,onValidate:i[2]||(i[2]=u=>C("keyGeneratorType",u)),"onUpdate:modelValue":F},null,8,["class","options","model-value"])),c(ee,{class:l(t.$style.copyInput),collapse:"",size:"medium",value:s(o).preferences.publicKey,"copy-button-text":s(e).baseText("generic.clickToCopy")},null,8,["class","value","copy-button-text"]),d.value?b("",!0):(m(),_(f,{key:1,size:"large",type:"tertiary",icon:"sync","data-test-id":"source-control-refresh-ssh-key-button",onClick:A},{default:a(()=>[h(r(s(e).baseText("settings.sourceControl.refreshSshKey")),1)]),_:1}))],2),c(Z,{type:"info",class:"mt-s"},{default:a(()=>[c(v,{keypath:"settings.sourceControl.sshKeyDescription",tag:"span"},{link:a(()=>[n("a",{href:s(e).baseText("settings.sourceControl.docs.setup.ssh.url"),target:"_blank"},r(s(e).baseText("settings.sourceControl.sshKeyDescriptionLink")),9,pe)]),_:1})]),_:1})],2)):b("",!0),d.value?b("",!0):(m(),_(f,{key:1,size:"large",disabled:!G.value,class:l(t.$style.connect),"data-test-id":"source-control-connect-button",onClick:K},{default:a(()=>[h(r(s(e).baseText("settings.sourceControl.button.connect")),1)]),_:1},8,["disabled","class"])),d.value?(m(),x("div",de,[n("div",{class:l(t.$style.group)},[ge,c(T,{size:"xlarge",tag:"h2",class:"mb-s"},{default:a(()=>[h(r(s(e).baseText("settings.sourceControl.instanceSettings")),1)]),_:1}),n("label",null,r(s(e).baseText("settings.sourceControl.branches")),1),n("div",{class:l(t.$style.branchSelection)},[c(k,{id:"branchName",label:"",type:"select",name:"branchName",class:"mb-s","data-test-id":"source-control-branch-select","validate-on-blur":"","validation-rules":L,options:E.value,"model-value":s(o).preferences.branchName,onValidate:i[3]||(i[3]=u=>C("branchName",u)),"onUpdate:modelValue":z},null,8,["options","model-value"]),c(Q,{placement:"top"},{content:a(()=>[n("span",null,r(s(e).baseText("settings.sourceControl.refreshBranches.tooltip")),1)]),default:a(()=>[c(f,{size:"small",type:"tertiary",icon:"sync",square:"",class:l(t.$style.refreshBranches),"data-test-id":"source-control-refresh-branches-button",onClick:D},null,8,["class"])]),_:1})],2),c(H,{modelValue:s(o).preferences.branchReadOnly,"onUpdate:modelValue":i[4]||(i[4]=u=>s(o).preferences.branchReadOnly=u),class:l(t.$style.readOnly)},{default:a(()=>[c(v,{keypath:"settings.sourceControl.protected",tag:"span"},{bold:a(()=>[n("strong",null,r(s(e).baseText("settings.sourceControl.protected.bold")),1)]),_:1})]),_:1},8,["modelValue","class"])],2),n("div",{class:l(t.$style.group)},[n("label",null,r(s(e).baseText("settings.sourceControl.color")),1),n("div",null,[c(q,{modelValue:s(o).preferences.branchColor,"onUpdate:modelValue":i[5]||(i[5]=u=>s(o).preferences.branchColor=u),size:"small"},null,8,["modelValue"])])],2),n("div",{class:l([t.$style.group,"pt-s"])},[c(f,{size:"large",disabled:!s(o).preferences.branchName,"data-test-id":"source-control-save-settings-button",onClick:I},{default:a(()=>[h(r(s(e).baseText("settings.sourceControl.button.save")),1)]),_:1},8,["disabled"])],2)])):b("",!0)])):(m(),_(W,{key:1,"data-test-id":"source-control-content-unlicensed",class:l(t.$style.actionBox),description:s(e).baseText("settings.sourceControl.actionBox.description"),"button-text":s(e).baseText("settings.sourceControl.actionBox.buttonText"),"onClick:button":N},{heading:a(()=>[n("span",null,r(s(e).baseText("settings.sourceControl.actionBox.title")),1)]),description:a(()=>[h(r(s(e).baseText("settings.sourceControl.actionBox.description"))+" ",1),n("a",{href:s(e).baseText("settings.sourceControl.docs.url"),target:"_blank"},r(s(e).baseText("settings.sourceControl.actionBox.description.link")),9,me)]),_:1},8,["class","description","button-text"]))])}}}),ye="_group_1exsh_1",be="_readOnly_1exsh_22",fe="_groupFlex_1exsh_26",_e="_connect_1exsh_40",xe="_disconnectButton_1exsh_44",Ce="_actionBox_1exsh_49",Te="_sshInput_1exsh_53",ve="_copyInput_1exsh_64",ke="_sshKeyTypeSelect_1exsh_68",Se="_branchSelection_1exsh_76",Be="_refreshBranches_1exsh_85",Ue={group:ye,readOnly:be,groupFlex:fe,connect:_e,disconnectButton:xe,actionBox:Ce,sshInput:Te,copyInput:ve,sshKeyTypeSelect:ke,branchSelection:Se,refreshBranches:Be},Ve={$style:Ue},rt=ce(he,[["__cssModules",Ve]]);export{rt as default};
//# sourceMappingURL=SettingsSourceControl-DkdSLuvp.js.map
