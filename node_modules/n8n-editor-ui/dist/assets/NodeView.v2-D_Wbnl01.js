const __vite__fileDeps=["assets/NodeCreation-PrQGENrl.js","assets/n8n-4UEsHtUL.js","assets/axios-Mm4CS0gO.js","assets/esprima-next-nhoSXAeq.js","assets/luxon-CLwAIbs0.js","assets/vendor-Dv5OeN6t.js","assets/lodash-es-CZ1inz46.js","assets/n8n-C4uNEd0H.css","assets/index-1OxaEeO3.js","assets/pinia-sugP77Im.js","assets/flatted-DN8lQ2XG.js","assets/@vueuse/core-BBHtM40w.js","assets/@n8n/permissions-BxxteU-C.js","assets/dateformat-CIxnBJXX.js","assets/vue-i18n-Delvyc9x.js","assets/uuid-SoommWqA.js","assets/@n8n/codemirror-lang-sql-DBO6T13I.js","assets/@lezer/common-B6ct0j_v.js","assets/prettier-bS6l4Vb1.js","assets/@jsplumb/util-DS-9vq_E.js","assets/@jsplumb/core-CVBraiyY.js","assets/@jsplumb/common-CF-b-6-M.js","assets/@jsplumb/connector-bezier-BGU0Ovbw.js","assets/@jsplumb/browser-ui-BVF2KoJK.js","assets/codemirror-lang-html-n8n-CWDO6_kP.js","assets/@n8n/codemirror-lang-Dl0FW_KM.js","assets/fast-json-stable-stringify-BOfzoJX1.js","assets/timeago.js-CiyKClrF.js","assets/qrcode.vue-BGkPba5A.js","assets/vue3-touch-events-mV0oX_Sl.js","assets/chart.js-343vZi4M.js","assets/index-BhLXy8h2.css","assets/nodeCreator.store-FIsc3SCx.js","assets/NodeCreation-gfazfzcF.css","assets/NodeDetailsView-DcV7LI-g.js","assets/file-saver-By8WREO3.js","assets/vue-json-pretty-Cqx2Hpq3.js","assets/dateFormatter-CfbOITvW.js","assets/RunDataAi-C3XiqNZa.js","assets/RunDataAi-BTTIiRHW.css","assets/useWorkflowActivate-npf1npdP.js","assets/NodeDetailsView-BwEWVeE3.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as D,N as j,o as Et,k as It,e as Re}from"./n8n-4UEsHtUL.js";import{G as S,z as q,e as r,ag as me,l as w,m as M,p as H,M as B,u as v,R as U,U as I,I as h,av as V,H as ae,T as Z,J as te,L as St,af as Le,X as F,E as je,O as W,F as fe,a7 as De,r as K,b as qe,Y as Mt,K as ve,a2 as Bt,aH as Rt,az as Dt,y as Vt,aM as Ve,aK as Pe}from"./vendor-Dv5OeN6t.js";import{c as Pt,d as se,e as Ot,f as Wt,h as At,P as Ht,u as Ut,i as zt}from"./@vue-flow/core-B52NSkuk.js";import{_ as Lt}from"./@vue-flow/background-D2lL98mx.js";import{_ as jt}from"./@vue-flow/controls-BSXHzp1O.js";import{_ as qt}from"./@vue-flow/minimap-Ln1mW_RP.js";import{x as oe,bQ as ee,bR as le,a4 as ye,ao as Kt,aa as Ft,e as _e,aH as Yt,j as Ke,aq as Xt,K as Jt,b5 as Gt,bK as Qt,bP as Zt,N as eo,aD as to,bx as oo,G as no,a3 as Fe,u as so,c as ao,n as lo,b as io,aR as ro,aQ as co,aO as uo,l as po,L as fo,aL as vo,V as mo,E as Oe,a_ as Q,b9 as yo,az as _o}from"./index-1OxaEeO3.js";import{v as Ye}from"./uuid-SoommWqA.js";import{u as go}from"./nodeCreator.store-FIsc3SCx.js";import{u as bo}from"./collaboration.store-Ol7bcCFc.js";import"./axios-Mm4CS0gO.js";import"./esprima-next-nhoSXAeq.js";import"./luxon-CLwAIbs0.js";import"./lodash-es-CZ1inz46.js";import"./pinia-sugP77Im.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const No=!1,wo="Test",ho=S({__name:"CanvasNodeToolbar",emits:["delete"],setup(o,{emit:e}){const s=e,t=V(),l=q(ee),p=oe(),c=r(()=>l==null?void 0:l.data.value);function i(){}function y(){}function g(){s("delete")}function $(n,d){}return(n,d)=>{var b;const _=me("N8nIconButton");return w(),M("div",{class:h(v(t).canvasNodeToolbar)},[H("div",{class:h(v(t).canvasNodeToolbarItems)},[((b=c.value)==null?void 0:b.renderType)!=="configuration"?(w(),B(_,{key:0,"data-test-id":"execute-node-button",type:"tertiary",text:"",size:"small",icon:"play",disabled:No,title:v(p).baseText("node.testStep"),onClick:i},null,8,["title"])):U("",!0),I(_,{"data-test-id":"disable-node-button",type:"tertiary",text:"",size:"small",icon:"power-off",title:wo,onClick:y}),I(_,{"data-test-id":"delete-node-button",type:"tertiary",size:"small",text:"",icon:"trash",title:v(p).baseText("node.delete"),onClick:g},null,8,["title"]),I(_,{"data-test-id":"overflow-node-button",type:"tertiary",size:"small",text:"",icon:"ellipsis-h",onClick:d[0]||(d[0]=R=>void 0)})],2)],2)}}}),Co="_canvasNodeToolbar_jnu94_1",$o="_canvasNodeToolbarItems_jnu94_5",To={canvasNodeToolbar:Co,canvasNodeToolbarItems:$o},xo={$style:To},ko=D(ho,[["__cssModules",xo]]);function ge({inputs:o,outputs:e}){const s=r(()=>v(o).filter(i=>i.type===j.Main)),t=r(()=>v(o).filter(i=>i.type!==j.Main)),l=r(()=>t.value.filter(i=>i.required)),p=r(()=>v(e).filter(i=>i.type===j.Main)),c=r(()=>v(e).filter(i=>i.type!==j.Main));return{mainInputs:s,nonMainInputs:t,requiredNonMainInputs:l,mainOutputs:p,nonMainOutputs:c}}const Eo=S({__name:"CanvasNodeDefault",setup(o){const e=q(ee),s=V(),t=r(()=>(e==null?void 0:e.label.value)??""),l=r(()=>(e==null?void 0:e.data.value.inputs)??[]),p=r(()=>(e==null?void 0:e.data.value.outputs)??[]),{mainOutputs:c}=ge({inputs:l,outputs:p}),i=r(()=>({[s.node]:!0,[s.selected]:e==null?void 0:e.selected.value})),y=r(()=>({"--node-main-output-count":c.value.length}));return(g,$)=>v(e)?(w(),M("div",{key:0,class:h(i.value),style:te(y.value),"data-test-id":"canvas-node-default"},[ae(g.$slots,"default"),t.value?(w(),M("div",{key:0,class:h(v(s).label)},Z(t.value),3)):U("",!0)],6)):U("",!0)}}),Io="_node_15zlx_1",So="_label_15zlx_12",Mo="_selected_15zlx_22",Bo={node:Io,label:So,selected:Mo},Ro={$style:Bo},We=D(Eo,[["__cssModules",Ro]]),Do=S({__name:"CanvasNodeConfiguration",setup(o){const e=q(ee),s=V(),t=r(()=>(e==null?void 0:e.label.value)??""),l=r(()=>({[s.node]:!0,[s.selected]:e==null?void 0:e.selected.value}));return(p,c)=>(w(),M("div",{class:h(l.value),"data-test-id":"canvas-node-configuration"},[ae(p.$slots,"default"),t.value?(w(),M("div",{key:0,class:h(v(s).label)},Z(t.value),3)):U("",!0)],2))}}),Vo="_node_moq9d_1",Po="_selected_moq9d_12",Oo="_label_moq9d_16",Wo={node:Vo,selected:Po,label:Oo},Ao={$style:Wo},Ho=D(Do,[["__cssModules",Ao]]),Uo=S({__name:"CanvasNodeConfigurable",setup(o){const e=q(ee),s=V(),t=r(()=>(e==null?void 0:e.label.value)??""),l=r(()=>(e==null?void 0:e.data.value.inputs)??[]),p=r(()=>(e==null?void 0:e.data.value.outputs)??[]),{nonMainInputs:c,requiredNonMainInputs:i}=ge({inputs:l,outputs:p}),y=r(()=>({[s.node]:!0,[s.selected]:e==null?void 0:e.selected.value})),g=r(()=>{const $={};if(i.value.length>0){let n=0;$["--configurable-node-input-count"]=c.value.length+n}return $});return($,n)=>(w(),M("div",{class:h(y.value),style:te(g.value),"data-test-id":"canvas-node-configurable"},[ae($.$slots,"default"),H("div",{class:h(v(s).label)},Z(t.value),3)],6))}}),zo="_node_hze9s_1",Lo="_label_hze9s_14",jo="_selected_hze9s_22",qo={node:zo,label:Lo,selected:jo},Ko={$style:qo},Fo=D(Uo,[["__cssModules",Ko]]),Yo=S({__name:"CanvasNodeRenderer",setup(o){const e=q(ee),s=St(),t=()=>{let l;switch(e==null?void 0:e.data.value.renderType){case"configurable":l=Fo;break;case"configuration":l=Ho;break;case"trigger":l=We;break;default:l=We}return Le(l,s.default)};return(l,p)=>(w(),B(t))}}),Xo=S({__name:"CanvasHandleMainInput",setup(o){const e=q(le),s=V(),t=r(()=>(e==null?void 0:e.label.value)??"");return(l,p)=>(w(),M("div",{class:h(["canvas-node-handle-main-input",v(s).handle])},[H("div",{class:h(v(s).label)},Z(t.value),3)],2))}}),Jo="_handle_xh297_1",Go="_label_xh297_11",Qo={handle:Jo,label:Go},Zo={$style:Qo},en=D(Xo,[["__cssModules",Zo]]),tn=S({__name:"CanvasHandleMainOutput",setup(o){const e=q(le),s=V(),t=r(()=>(e==null?void 0:e.label.value)??"");return(l,p)=>(w(),M("div",{class:h(["canvas-node-handle-main-output",v(s).handle])},[H("div",{class:h(v(s).label)},Z(t.value),3),H("div",{class:h(v(s).circle)},null,2)],2))}}),on="_handle_ro506_1",nn="_circle_ro506_6",sn="_plus_ro506_16",an="_label_ro506_28",ln={handle:on,circle:nn,plus:sn,label:an},rn={$style:ln},cn=D(tn,[["__cssModules",rn]]),dn=S({__name:"CanvasHandleNonMain",setup(o){const e=q(le),s=V(),t=r(()=>(e==null?void 0:e.label.value)??"");return(l,p)=>(w(),M("div",{class:h(["canvas-node-handle-non-main",v(s).handle])},[H("div",{class:h(v(s).diamond)},null,2),H("div",{class:h(v(s).label)},Z(t.value),3)],2))}}),un="_handle_b5gv0_1",pn="_diamond_b5gv0_7",fn="_label_b5gv0_17",vn={handle:un,diamond:pn,label:fn},mn={$style:vn},yn=D(dn,[["__cssModules",mn]]),_n=S({__name:"HandleRenderer",props:{mode:{},label:{},type:{},index:{},position:{},offset:{}},setup(o){const e=o,s=V(),t=r(()=>e.mode==="input"?"target":"source"),l=r(()=>e.mode==="output"),p=r(()=>e.mode==="input"),c=y=>{let g;return e.type===j.Main?e.mode==="input"?g=en:g=cn:g=yn,Le(g,y)},i=F(e,"label");return je(le,{label:i}),(y,g)=>(w(),B(v(Pt),{id:`${y.mode}s/${y.type}/${y.index}`,class:h([v(s).handle]),type:t.value,position:y.position,style:te(y.offset),"connectable-start":l.value,"connectable-end":p.value},{default:W(()=>[I(c,{label:i.value},null,8,["label"])]),_:1},8,["id","class","type","position","style","connectable-start","connectable-end"]))}}),gn="_handle_n4rp3_1",bn={handle:gn},Nn={$style:bn},Ae=D(_n,[["__cssModules",Nn]]),wn=S({__name:"CanvasNode",props:{id:{},type:{},selected:{type:Boolean},connectable:{type:[Boolean,Number,String,Function]},position:{},dimensions:{},label:{},isValidTargetPos:{type:Function},isValidSourcePos:{type:Function},parent:{},parentNodeId:{},dragging:{type:Boolean},resizing:{type:Boolean},zIndex:{},targetPosition:{},sourcePosition:{},dragHandle:{},data:{},events:{}},emits:["delete","activate"],setup(o,{emit:e}){const s=e,t=o,l=r(()=>t.data.inputs),p=r(()=>t.data.outputs),c=ye(),{mainInputs:i,nonMainInputs:y,mainOutputs:g,nonMainOutputs:$}=ge({inputs:l,outputs:p}),n=r(()=>c.getNodeType(t.data.type,t.data.typeVersion)),d=r(()=>[...i.value.map(b(se.Left,"top")),...y.value.map(b(se.Bottom,"left"))]),_=r(()=>[...g.value.map(b(se.Right,"top")),...$.value.map(b(se.Top,"left"))]),b=(T,O)=>(C,Y,ie)=>({...C,position:T,offset:{[O]:`${100/(ie.length+1)*(Y+1)}%`}}),R=F(t,"id"),N=F(t,"data"),P=F(t,"label"),u=F(t,"selected");je(ee,{id:R,data:N,label:P,selected:u,nodeType:n});function m(){s("delete",t.id)}function k(){s("activate",t.id)}return(T,O)=>(w(),M("div",{class:h(T.$style.canvasNode),"data-test-id":"canvas-node"},[(w(!0),M(fe,null,De(_.value,C=>(w(),B(Ae,{key:`${C.type}/${C.index}`,mode:"output","data-test-id":"canvas-node-output-handle",type:C.type,label:C.label,index:C.index,position:C.position,offset:C.offset},null,8,["type","label","index","position","offset"]))),128)),(w(!0),M(fe,null,De(d.value,C=>(w(),B(Ae,{key:`${C.type}/${C.index}`,mode:"input","data-test-id":"canvas-node-input-handle",type:C.type,label:C.label,index:C.index,position:C.position,offset:C.offset},null,8,["type","label","index","position","offset"]))),128)),n.value?(w(),B(ko,{key:0,"data-test-id":"canvas-node-toolbar",class:h(T.$style.canvasNodeToolbar),onDelete:m},null,8,["class"])):U("",!0),n.value?(w(),B(Yo,{key:1,onDblclick:k},{default:W(()=>[I(Kt,{"node-type":n.value,size:40,shrink:!1},null,8,["node-type"])]),_:1})):U("",!0)],2))}}),hn="_canvasNode_4o1th_1",Cn="_canvasNodeToolbar_4o1th_1",$n={canvasNode:hn,canvasNodeToolbar:Cn},Tn={$style:$n},xn=D(wn,[["__cssModules",Tn]]),kn=S({__name:"CanvasEdgeToolbar",emits:["delete"],setup(o,{emit:e}){const s=e,t=V(),l=oe(),p=r(()=>({[t.canvasEdgeToolbar]:!0}));function c(){s("delete")}return(i,y)=>{const g=me("N8nIconButton");return w(),M("div",{class:h(p.value),"data-test-id":"canvas-edge-toolbar"},[I(g,{"data-test-id":"delete-connection-button",type:"tertiary",size:"small",icon:"trash",title:v(l).baseText("node.delete"),onClick:c},null,8,["title"])],2)}}}),En="_canvasEdgeToolbar_szqhv_1",In={canvasEdgeToolbar:En},Sn={$style:In},Mn=D(kn,[["__cssModules",Sn]]),Bn=S({__name:"CanvasEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},hovered:{type:Boolean}},emits:["delete"],setup(o,{emit:e}){const s=e,t=o,l=V(),p=r(()=>({strokeWidth:2,...t.style})),c=r(()=>t.selected||t.hovered),i=r(()=>({transform:`translate(-50%, -50%) translate(${g.value[1]}px,${g.value[2]}px)`})),y=r(()=>({[l.edgeToolbar]:!0,[l.edgeToolbarVisible]:c.value,nodrag:!0,nopan:!0})),g=r(()=>Ot({sourceX:t.sourceX,sourceY:t.sourceY,sourcePosition:t.sourcePosition,targetX:t.targetX,targetY:t.targetY,targetPosition:t.targetPosition})),$=r(()=>({source:t.source,target:t.target,sourceHandle:t.sourceHandleId,targetHandle:t.targetHandleId}));function n(){s("delete",$.value)}return(d,_)=>{var b;return w(),M(fe,null,[I(v(Wt),{id:d.id,style:te(p.value),path:g.value[0],"marker-end":d.markerEnd,label:(b=d.data)==null?void 0:b.label,"label-x":g.value[1],"label-y":g.value[2],"label-style":{fill:"white"},"label-show-bg":!0,"label-bg-style":{fill:"red"},"label-bg-padding":[2,4],"label-bg-border-radius":2,class:h(v(l).edge)},null,8,["id","style","path","marker-end","label","label-x","label-y","class"]),I(v(At),null,{default:W(()=>[I(Mn,{class:h(y.value),style:te(i.value),onDelete:n},null,8,["class","style"])]),_:1})],64)}}}),Rn="_edgeToolbar_12aab_1",Dn="_edgeToolbarVisible_12aab_5",Vn={edgeToolbar:Rn,edgeToolbarVisible:Dn},Pn={$style:Vn},On=D(Bn,[["__cssModules",Pn]]),Wn=S({__name:"Canvas",props:{id:{default:"canvas"},elements:{default:()=>[]},connections:{default:()=>[]},controlsPosition:{default:Ht.BottomLeft}},emits:["update:modelValue","update:node:position","update:node:active","delete:node","delete:connection","create:connection"],setup(o,{emit:e}){const s=V(),t=e,l=o,{getSelectedEdges:p,getSelectedNodes:c}=Ut({id:l.id}),i=K({});qe(()=>{document.addEventListener("keydown",_)}),Mt(()=>{document.removeEventListener("keydown",_)});function y(N){N.nodes.forEach(P=>{t("update:node:position",P.id,P.position)})}function g(N){t("update:node:active",N)}function $(N){t("delete:node",N)}function n(N){t("delete:connection",N)}function d(...N){t("create:connection",N[0])}function _(N){N.key==="Delete"&&(p.value.forEach(n),c.value.forEach(({id:P})=>$(P)))}function b(N){i.value[N.edge.id]=!0}function R(N){i.value[N.edge.id]=!1}return(N,P)=>(w(),B(v(zt),{id:N.id,nodes:N.elements,edges:N.connections,"apply-changes":!1,"fit-view-on-init":"","pan-on-scroll":"","min-zoom":.2,"max-zoom":2,"data-test-id":"canvas",onNodeDragStop:y,onEdgeMouseEnter:b,onEdgeMouseLeave:R,onConnect:d},{"node-canvas-node":W(u=>[I(xn,ve(u,{onDelete:$,onActivate:g}),null,16)]),"edge-canvas-edge":W(u=>[I(On,ve(u,{hovered:i.value[u.id],onDelete:n}),null,16,["hovered"])]),default:W(()=>[I(v(Lt),{"data-test-id":"canvas-background","pattern-color":"#aaa",gap:16}),I(v(qt),{"data-test-id":"canvas-minimap",pannable:""}),I(v(jt),{"data-test-id":"canvas-controls",class:h(v(s).canvasControls),position:N.controlsPosition},null,8,["class","position"])]),_:1},8,["id","nodes","edges"]))}});function An(o,e){const s=[];return Object.keys(o).forEach(t=>{var c;const l=(c=e.find(i=>i.name===t))==null?void 0:c.id;Object.keys(o[t]).forEach(i=>{o[t][i].forEach((g,$)=>{g.forEach(n=>{var R;const d=(R=e.find(N=>N.name===n.node))==null?void 0:R.id,_=n.type,b=n.index;l&&d&&s.push({id:`[${l}/${i}/${$}][${d}/${_}/${b}]`,source:l,target:d,sourceHandle:`outputs/${i}/${$}`,targetHandle:`inputs/${_}/${b}`,data:{fromNodeName:t,source:{index:$,type:i},target:{index:b,type:_}}})})})})}),s}function He(o){const[,e,s]=(o??"").split("/"),t=Ft(e)?e:j.Main;let l=parseInt(s,10);return isNaN(l)&&(l=0),{type:t,index:l}}function Ue(o,e,s){const t=(o==null?void 0:o.name)??"",{type:l,index:p}=He(s.sourceHandle),c=(e==null?void 0:e.name)??"",{type:i,index:y}=He(s.targetHandle);return[{node:t,type:l,index:p},{node:c,type:i,index:y}]}function ze(o){return typeof o=="string"?(console.warn("Node endpoints have not been evaluated",o),[]):o.map((e,s)=>{const t=typeof e=="string"?e:e.type,l=typeof e=="string"?void 0:e.displayName,p=o.slice(0,s+1).filter(i=>(typeof i=="string"?i:i.type)===t).length-1,c=typeof e=="string"?!1:e.required;return{type:t,index:p,label:l,...c?{required:c}:{}}})}function Xe(o,e){if(!e.has(o))return o;for(let s=1;s<100;s++){const t=`${o} ${s}`;if(!e.has(t))return t}return`${o} ${Ye()}`}function Hn({workflow:o,workflowObject:e}){const s=oe(),t=ye(),l=r(()=>o.value.nodes.reduce((n,d)=>{let _="default";switch(!0){case t.isTriggerNode(d.type):_="trigger";break;case t.isConfigNode(e.value,d,d.type):_="configuration";break;case t.isConfigurableNode(e.value,d,d.type):_="configurable";break}return n[d.type]=_,n},{})??{}),p=r(()=>o.value.nodes.reduce((n,d)=>{const _=t.getNodeType(d.type),b=e.value.getNode(d.name);return n[d.id]=b&&_?ze(Et(e.value,b,_)):[],n},{})),c=r(()=>o.value.nodes.reduce((n,d)=>{const _=t.getNodeType(d.type),b=e.value.getNode(d.name);return n[d.id]=b&&_?ze(It(e.value,b,_)):[],n},{})),i=r(()=>[...o.value.nodes.map(n=>{const d={id:n.id,type:n.type,typeVersion:n.typeVersion,inputs:p.value[n.id]??[],outputs:c.value[n.id]??[],renderType:l.value[n.type]??"default"};return{id:n.id,label:n.name,type:"canvas-node",position:{x:n.position[0],y:n.position[1]},data:d}})]),y=r(()=>An(o.value.connections??[],o.value.nodes??[]).map(d=>{const _=g(),b=$(d);return{...d,type:_,label:b}}));function g(n){return"canvas-edge"}function $(n){var _,b;const d=(b=o.value.pinData)==null?void 0:b[((_=n.data)==null?void 0:_.fromNodeName)??""];return d!=null&&d.length?s.baseText("ndv.output.items",{adjustToNumber:d.length,interpolate:{count:String(d.length)}}):""}return{connections:y,elements:i}}const Un=S({__name:"WorkflowCanvas",props:{id:{},workflow:{},workflowObject:{}},setup(o){const e=o,s=V(),t=F(e,"workflow"),l=F(e,"workflowObject"),{elements:p,connections:c}=Hn({workflow:t,workflowObject:l});return(i,y)=>(w(),M("div",{class:h(v(s).wrapper)},[H("div",{class:h(v(s).canvas)},[t.value?(w(),B(Wn,ve({key:0,elements:v(p),connections:v(c)},i.$attrs),null,16,["elements","connections"])):U("",!0)],2),ae(i.$slots,"default")],2))}}),zn="_wrapper_jh0fs_1",Ln="_canvas_jh0fs_9",jn="_executionButtons_jh0fs_16",qn={wrapper:zn,canvas:Ln,executionButtons:jn},Kn={$style:qn},Fn=D(Un,[["__cssModules",Kn]]),Yn=S({__name:"CanvasExecuteWorkflowButton",emits:["click"],setup(o){const e=_e(),s=oe(),t=r(()=>e.isActionActive("workflowRunning")),l=r(()=>t.value?s.baseText("nodeView.runButtonText.executingWorkflow"):s.baseText("nodeView.runButtonText.executeWorkflow"));return(p,c)=>{const i=me("N8nButton");return w(),B(Yt,{label:l.value,shortcut:{metaKey:!0,keys:["↵"]}},{default:W(()=>[I(i,{loading:t.value,label:l.value,size:"large",icon:"flask",type:"primary","data-test-id":"execute-workflow-button",onClick:c[0]||(c[0]=Bt(y=>p.$emit("click",y),["stop"]))},null,8,["loading","label"])]),_:1},8,["label"])}}});function Xn(){const o=Ke(),e=Xt(),s=_e(),t=Jt(),l=no(),p=Fe();function c(u,m,{trackHistory:k=!1,trackBulk:T=!0}={}){const O=o.getNodeById(u);if(!O)return;k&&T&&e.startRecordingUndo();const C=[...O.position],Y=[m.x,m.y];o.setNodePositionById(u,Y),k&&(e.pushCommandToUndo(new Gt(O.name,C,Y)),T&&e.stopRecordingUndo())}async function i(u,m,{trackHistory:k=!1}={}){if(u===m)return;k&&e.startRecordingUndo(),m=Xe(m,o.canvasNames);const T=o.getCurrentWorkflow(!0);T.renameNode(u,m),k&&e.pushCommandToUndo(new Qt(u,m)),o.renameNodeSelectedAndExecution({old:u,new:m}),o.setNodes(Object.values(T.nodes)),o.setConnections(T.connectionsBySourceNode),t.activeNodeName===u&&(t.activeNodeName=m),k&&e.stopRecordingUndo()}async function y(u,m){await i(u,m)}function g(u,{trackHistory:m=!1,trackBulk:k=!0}={}){const T=o.getNodeById(u);T&&(m&&k&&e.startRecordingUndo(),o.removeNodeById(u),o.removeNodeConnectionsById(u),o.removeNodeExecutionDataById(u),m&&(e.pushCommandToUndo(new Zt(T)),k&&e.stopRecordingUndo()),n(u))}function $(u){o.addNode(u)}function n(u){const m=o.getNodeById(u);m&&(m.type===eo?l.track("User deleted workflow note",{workflow_id:o.workflowId,is_welcome_note:m.name===to}):(p.run("node.deleteNode",{node:m}),l.track("User deleted node",{node_type:m.type,workflow_id:o.workflowId})))}function d(u){const m=o.getNodeById(u);m&&(t.activeNodeName=m.name)}function _(u){t.activeNodeName=u}function b(u){const m=o.getNodeById(u.source),k=o.getNodeById(u.target);if(!m||!k||!P(m,k))return;const T=Ue(m,k,u);o.addConnection({connection:T}),s.stateIsDirty=!0}function R(u,{trackHistory:m=!1,trackBulk:k=!0}={}){const T=o.getNodeById(u.source),O=o.getNodeById(u.target);if(!T||!O)return;const C=Ue(T,O,u);m&&k&&e.startRecordingUndo(),o.removeConnection({connection:C}),m&&(e.pushCommandToUndo(new oo(C)),k&&e.stopRecordingUndo())}function N(u){o.addConnection({connection:u})}function P(u,m){return u.id!==m.id}return{updateNodePosition:c,setNodeActive:d,setNodeActiveByName:_,renameNode:i,revertRenameNode:y,deleteNode:g,revertDeleteNode:$,trackDeleteNode:n,createConnection:b,deleteConnection:R,revertDeleteConnection:N,isConnectionAllowed:P}}const Jn=S({__name:"NodeView.v2",setup(o){const e=Pe(async()=>await Re(()=>import("./NodeCreation-PrQGENrl.js").then(a=>a.N),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]))),s=Pe(async()=>await Re(()=>import("./NodeDetailsView-DcV7LI-g.js").then(a=>a.a),__vite__mapDeps([34,1,2,3,4,5,6,7,9,8,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,35,36,37,38,39,40,41]))),t=V(),l=Rt(),p=Dt(),c=oe(),i=Fe(),y=so(),g=ye(),$=_e(),n=Ke(),d=ao(),_=lo(),b=go(),R=io(),N=ro(),P=co(),u=uo(),m=po(),k=bo(),T=fo(),{runWorkflow:O}=vo({router:l}),{updateNodePosition:C,renameNode:Y,revertRenameNode:ie,setNodeActive:Je,deleteNode:Ge,revertDeleteNode:Qe,createConnection:Ze,deleteConnection:et,revertDeleteConnection:tt,setNodeActiveByName:ot}=Xn(),re=K(!0),be=K(null),Ne=K(!1),we=K(!1),he=K(!0),Ce=K(!1),ce=r(()=>p.params.workflowId),de=r(()=>n.workflowsById[ce.value]),A=r(()=>n.workflow),ue=r(()=>n.getCurrentWorkflow()),$e=r(()=>p.name===mo.DEMO),ne=r(()=>{var a;return((a=p==null?void 0:p.meta)==null?void 0:a.readOnlyCanvas)===!0}),X=r(()=>_.preferences.branchReadOnly),nt=r(()=>n.workflowTriggerNodes);r(()=>nt.value.length>0&&!re.value&&!$e.value&&!X.value),qe(()=>{st()});async function st(){re.value=!0;const a=[g.getNodeTypes(),n.fetchWorkflow(ce.value)];!R.isPreviewMode&&!$e.value&&(a.push(n.fetchActiveWorkflows(),N.fetchAllCredentials(),N.fetchCredentialTypes(!0)),R.isEnterpriseFeatureEnabled(Oe.Variables)&&a.push(P.fetchAllVariables()),R.isEnterpriseFeatureEnabled(Oe.ExternalSecrets)&&a.push(u.fetchAllSecrets()));try{await Promise.all(a)}catch(f){return y.showError(f,c.baseText("nodeView.showError.mounted1.title"),c.baseText("nodeView.showError.mounted1.message")+":")}ct(ce.value),at(),it(),window.parent&&window.parent.postMessage(JSON.stringify({command:"n8nReady",version:m.versionCli}),"*"),re.value=!1}Vt(()=>{rt(),lt()});function at(){Q.on("revertRemoveNode",Te),Q.on("revertRemoveConnection",ke),Q.on("revertRenameNode",Ie)}function lt(){Q.off("revertRemoveNode",Te),Q.off("revertRemoveConnection",ke),Q.off("revertRenameNode",Ie)}function it(){window.addEventListener("message",Ee)}function rt(){window.removeEventListener("message",Ee)}function ct(a){const f=n.workflowsById[a];n.addWorkflow(f),n.setWorkflow(f),n.setActive(f.active||!1),n.setWorkflowId(f.id),n.setWorkflowName({newName:f.name,setStateDirty:!1}),n.setWorkflowSettings(f.settings??{}),n.setWorkflowPinData(f.pinData??{}),n.setWorkflowVersionId(f.versionId),n.setWorkflowMetadata(f.meta),f.usedCredentials&&n.setUsedCredentials(f.usedCredentials);const E=f.tags??[],x=E.map(z=>z.id);n.setWorkflowTagIds(x||[]),d.upsertTags(E),i.run("workflow.open",{workflowId:de.value.id,workflowName:de.value.name}),k.notifyWorkflowOpened(de.value.id)}async function dt(){await O({})}function ut(a,f){C(a,f,{trackHistory:!0})}function pt(a){Ge(a,{trackHistory:!0})}function Te({node:a}){Qe(a)}function ft(a){Je(a)}function xe(a){Ze(a)}function vt(a){et(a,{trackHistory:!0})}function ke({connection:a}){tt(a)}async function mt({nodes:a,connections:f},E=!1,x){let z=x;for(const{type:J,name:G,position:L,isAutoAdd:pe,openDetail:xt}of a){try{await yt({name:G,type:J,position:L??z},{dragAndDrop:E,openNDV:xt??!1,trackHistory:!0,isAutoAdd:pe})}catch(kt){y.showError(kt,c.baseText("error"));continue}const Be=A.value.nodes[A.value.nodes.length-1];z=[Be.position[0]+yo*2+_o,Be.position[1]]}const Se=A.value.nodes.length-a.length;for(const{from:J,to:G}of f){const L=A.value.nodes[Se+J.nodeIndex],pe=A.value.nodes[Se+G.nodeIndex];xe({source:L.id,sourceHandle:`outputs/${j.Main}/${J.outputIndex??0}`,target:pe.id,targetHandle:`inputs/${j.Main}/${G.inputIndex??0}`})}const Tt=A.value.nodes[A.value.nodes.length-1],Me=ue.value.getParentNodesByDepth(Tt.name,1);Me.length>1&&Me.slice(1).forEach((J,G)=>{const L=n.getNodeByName(J.name);L&&C(L.id,{x:L.position[0],y:L.position[1]+100*(G+1)})})}async function yt(a,f={}){if(!gt())throw new Error(c.baseText("nodeViewV2.showError.editingNotAllowed"));const E=await _t(a);if(!E)throw new Error(c.baseText("nodeViewV2.showError.failedToCreateNode"));return E.name=Xe(E.name,n.canvasNames),n.addNode(E),E}async function _t(a){const f=g.getNodeType(a.type);let E=f.defaultVersion;return typeof E>"u"&&(E=Array.isArray(f.version)?f.version.slice(-1)[0]:f.version),{id:Ye(),name:a.name??f.defaults.name,type:f.name,typeVersion:E,position:a.position??[0,0],parameters:{}}}function gt(){var a;if((a=be.value)!=null&&a.visible)return!1;if(ne.value||X.value){const f=ne.value?"executions":"workflows";return be.value=y.showMessage({title:c.baseText(X.value?`readOnlyEnv.showMessage.${f}.title`:"readOnly.showMessage.executions.title"),message:c.baseText(X.value?`readOnlyEnv.showMessage.${f}.message`:"readOnly.showMessage.executions.message"),type:"info",dangerouslyUseHTMLString:!0}),!1}return!0}async function Ee(a){var f,E;if(!(!a||typeof a.data!="string"||!((E=(f=a.data)==null?void 0:f.includes)!=null&&E.call(f,'"command"'))))try{const x=JSON.parse(a.data);if(x&&x.command==="openWorkflow")try{await Ct(x.data),he.value=x.canOpenNDV??!0,Ce.value=x.hideNodeIssues??!1,we.value=!1}catch(z){window.top&&window.top.postMessage(JSON.stringify({command:"error",message:c.baseText("openWorkflow.workflowImportError")}),"*"),y.showMessage({title:c.baseText("openWorkflow.workflowImportError"),message:z.message,type:"error"})}else if(x&&x.command==="openExecution")try{Ne.value=x.executionMode!=="manual",await ht(x.executionId),he.value=x.canOpenNDV??!0,Ce.value=x.hideNodeIssues??!1,we.value=!0}catch(z){window.top&&window.top.postMessage(JSON.stringify({command:"error",message:c.baseText("nodeView.showError.openExecution.title")}),"*"),y.showMessage({title:c.baseText("nodeView.showError.openExecution.title"),message:z.message,type:"error"})}else(x==null?void 0:x.command)==="setActiveExecution"&&(T.activeExecution=await T.fetchExecution(x.executionId))}catch{}}async function bt(a){ot(a)}async function Nt(a,f){b.openSelectiveNodeCreator({node:a,connectionType:f})}function wt(a){b.openNodeCreator(a)}async function ht(a){}async function Ct(a){}async function Ie({currentName:a,newName:f}){await ie(a,f)}function $t(a){a.name==="name"&&a.oldValue&&Y(a.oldValue,a.value)}return(a,f)=>A.value&&ue.value?(w(),B(Fn,{key:0,workflow:A.value,"workflow-object":ue.value,"onUpdate:node:position":ut,"onUpdate:node:active":ft,"onDelete:node":pt,"onCreate:connection":xe,"onDelete:connection":vt},{default:W(()=>[H("div",{class:h(v(t).executionButtons)},[I(Yn,{onClick:dt})],2),(w(),B(Ve,null,{default:W(()=>[!ne.value&&!X.value?(w(),B(v(e),{key:0,"create-node-active":v($).isCreateNodeActive,"node-view-scale":1,onToggleNodeCreator:wt,onAddNodes:mt},null,8,["create-node-active"])):U("",!0)]),_:1})),(w(),B(Ve,null,{default:W(()=>[I(v(s),{"read-only":ne.value||X.value,"is-production-execution-preview":Ne.value,renaming:!1,onValueChanged:$t,onSwitchSelectedNode:bt,onOpenConnectionNodeCreator:Nt},null,8,["read-only","is-production-execution-preview"])]),_:1}))]),_:1},8,["workflow","workflow-object"])):U("",!0)}}),Gn="_executionButtons_1bnph_1",Qn={executionButtons:Gn},Zn={$style:Qn},Vs=D(Jn,[["__cssModules",Zn]]);export{Vs as default};
//# sourceMappingURL=NodeView.v2-D_Wbnl01.js.map
