import{u as $,L as b,x as B}from"./index-1OxaEeO3.js";import{G as A,r as a,e as M,b as C,y as J,d as f,ag as P,l as m,m as v,I as d,U as V,R,p as U}from"./vendor-Dv5OeN6t.js";import{_ as X}from"./n8n-4UEsHtUL.js";const Y=["src"],j=A({__name:"WorkflowPreview",props:{loading:{type:Boolean,default:!1},mode:{default:"workflow"},workflow:{default:void 0},executionId:{default:void 0},executionMode:{default:void 0},loaderType:{default:"image"},canOpenNDV:{type:Boolean,default:!0},hideNodeIssues:{type:Boolean,default:!1}},emits:["close"],setup(I,{emit:D}){const e=I,T=D,s=B(),p=$(),k=b(),l=a(null),c=a(!1),y=a(!1),u=a(!1),_=a(0),E=a(0),L=M(()=>`${window.BASE_PATH??"/"}workflows/demo`),t=M(()=>!e.loading&&(e.mode==="workflow"&&!!e.workflow||e.mode==="execution"&&!!e.executionId)&&y.value),x=()=>{var o,n,r;try{if(!e.workflow)throw new Error(s.baseText("workflowPreview.showError.missingWorkflow"));if(!e.workflow.nodes||!Array.isArray(e.workflow.nodes))throw new Error(s.baseText("workflowPreview.showError.arrayEmpty"));(r=(n=(o=l.value)==null?void 0:o.contentWindow)==null?void 0:n.postMessage)==null||r.call(n,JSON.stringify({command:"openWorkflow",workflow:e.workflow,canOpenNDV:e.canOpenNDV,hideNodeIssues:e.hideNodeIssues}),"*")}catch(i){p.showError(i,s.baseText("workflowPreview.showError.previewError.title"),s.baseText("workflowPreview.showError.previewError.message"))}},g=()=>{var o,n,r,i,w,z;try{if(!e.executionId)throw new Error(s.baseText("workflowPreview.showError.missingExecution"));(r=(n=(o=l.value)==null?void 0:o.contentWindow)==null?void 0:n.postMessage)==null||r.call(n,JSON.stringify({command:"openExecution",executionId:e.executionId,executionMode:e.executionMode??"",canOpenNDV:e.canOpenNDV}),"*"),k.activeExecution&&((z=(w=(i=l.value)==null?void 0:i.contentWindow)==null?void 0:w.postMessage)==null||z.call(w,JSON.stringify({command:"setActiveExecution",executionId:k.activeExecution.id}),"*"))}catch(W){p.showError(W,s.baseText("workflowPreview.showError.previewError.title"),s.baseText("workflowPreview.executionMode.showError.previewError.message"))}},O=()=>{u.value=!0,_.value=window.scrollX,E.value=window.scrollY},S=()=>{u.value=!1},h=({data:o})=>{var n;if((n=o==null?void 0:o.includes)!=null&&n.call(o,'"command"'))try{const r=JSON.parse(o);r.command==="n8nReady"?y.value=!0:r.command==="openNDV"?c.value=!0:r.command==="closeNDV"?c.value=!1:r.command==="error"&&T("close")}catch(r){console.error(r)}},N=()=>{u.value&&window.scrollTo(_.value,E.value)};return C(()=>{window.addEventListener("message",h),document.addEventListener("scroll",N)}),J(()=>{window.removeEventListener("message",h),document.removeEventListener("scroll",N)}),f(()=>t.value,()=>{t.value&&(e.mode==="workflow"?x():e.mode==="execution"&&g())}),f(()=>e.executionId,()=>{e.mode==="execution"&&e.executionId&&g()}),f(()=>e.workflow,()=>{e.mode==="workflow"&&e.workflow&&x()}),(o,n)=>{const r=P("n8n-loading"),i=P("n8n-spinner");return m(),v("div",{class:d(o.$style.container)},[o.loaderType==="image"&&!t.value?(m(),v("div",{key:0,class:d(o.$style.imageLoader)},[V(r,{loading:!t.value,rows:1,variant:"image"},null,8,["loading"])],2)):o.loaderType==="spinner"&&!t.value?(m(),v("div",{key:1,class:d(o.$style.spinner)},[V(i,{type:"dots"})],2)):R("",!0),U("iframe",{ref_key:"iframeRef",ref:l,class:d({[o.$style.workflow]:!c.value,[o.$style.executionPreview]:o.mode==="execution",[o.$style.openNDV]:c.value,[o.$style.show]:t.value}),src:L.value,"data-test-id":"workflow-preview-iframe",onMouseenter:O,onMouseleave:S},null,42,Y)],2)}}}),G="_container_tdzzv_1",H="_workflow_tdzzv_8",q="_show_tdzzv_14",F="_openNDV_tdzzv_20",K="_spinner_tdzzv_29",Q="_imageLoader_tdzzv_37",Z="_executionPreview_tdzzv_45",ee={container:G,workflow:H,show:q,openNDV:F,spinner:K,imageLoader:Q,executionPreview:Z},oe={$style:ee},te=X(j,[["__cssModules",oe]]);export{te as W};
//# sourceMappingURL=WorkflowPreview-CVwpKdpj.js.map
