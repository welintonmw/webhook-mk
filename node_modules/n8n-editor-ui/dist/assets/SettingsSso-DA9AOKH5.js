import{G as J,e as f,r as v,b as K,ag as d,l as T,m as C,U as u,O as c,S as x,T as o,u as s,p as a,M as V,I as p,R as W,P as B,V as I}from"./vendor-Dv5OeN6t.js";import{l as Y,cQ as Z,e as tt,u as et,c$ as M,x as st,G as at,H as ot}from"./index-1OxaEeO3.js";import{_ as nt}from"./n8n-4UEsHtUL.js";import"./pinia-sugP77Im.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const lt={class:"pb-3xl"},it={href:"https://docs.n8n.io/user-management/saml/",target:"_blank"},rt={key:0,"data-test-id":"sso-content-licensed"},ut={class:"mt-2xs mb-s"},dt=J({__name:"SettingsSso",setup(xt){const l={URL:"url",XML:"xml"},e=st(),R=at(),$=Y(),n=Z(),j=tt(),z=ot(),y=et(),X=f(()=>n.isSamlLoginEnabled?e.baseText("settings.sso.activated"):e.baseText("settings.sso.deactivated")),_=v(!1),S=v(),U=v(),N=v([{label:e.baseText("settings.sso.settings.ips.options.url"),value:l.URL},{label:e.baseText("settings.sso.settings.ips.options.xml"),value:l.XML}]),i=v(l.URL),m=v(),g=v(),D=f(()=>{var t,r;return i.value===l.URL?!!m.value&&m.value!==((t=n.samlConfig)==null?void 0:t.metadataUrl):i.value===l.XML?!!g.value&&g.value!==((r=n.samlConfig)==null?void 0:r.metadata):!1}),O=f(()=>i.value===l.URL?!!m.value&&_.value:i.value===l.XML?!!g.value&&_.value:!1),w=async()=>{const t=await n.getSamlConfig();U.value=t==null?void 0:t.entityID,S.value=t==null?void 0:t.returnUrl,t!=null&&t.metadataUrl?i.value=l.URL:t!=null&&t.metadata&&(i.value=l.XML),g.value=t==null?void 0:t.metadata,m.value=t==null?void 0:t.metadataUrl,_.value=!!(t!=null&&t.metadata)},G=async()=>{try{const t=i.value===l.URL?{metadataUrl:m.value}:{metadata:g.value};await n.saveSamlConfig(t),n.isSamlLoginEnabled||await z.confirm(e.baseText("settings.sso.settings.save.activate.message"),e.baseText("settings.sso.settings.save.activate.title"),{confirmButtonText:e.baseText("settings.sso.settings.save.activate.test"),cancelButtonText:e.baseText("settings.sso.settings.save.activate.cancel")})==="confirm"&&await h(),R.track("User updated single sign on settings",{instance_id:$.instanceId,identity_provider:i.value==="url"?"metadata":"xml",is_active:n.isSamlLoginEnabled})}catch(t){y.showError(t,e.baseText("settings.sso.settings.save.error"));return}finally{await w()}},h=async()=>{try{const t=await n.testSamlConfig();typeof window<"u"&&window.open(t,"_blank")}catch(t){y.showError(t,"error")}},P=()=>{j.goToUpgrade("sso","upgrade-sso")};return K(async()=>{if(n.isEnterpriseSamlEnabled)try{await w()}catch(t){y.showError(t,"error")}}),(t,r)=>{const k=d("n8n-heading"),A=d("el-switch"),H=d("n8n-tooltip"),Q=d("n8n-info-tip"),q=d("n8n-radio-buttons"),L=d("n8n-input"),E=d("n8n-button"),F=d("n8n-action-box");return T(),C("div",lt,[u(k,{size:"2xlarge"},{default:c(()=>[x(o(s(e).baseText("settings.sso.title")),1)]),_:1}),a("div",{class:p(t.$style.top)},[u(k,{size:"xlarge"},{default:c(()=>[x(o(s(e).baseText("settings.sso.subtitle")),1)]),_:1}),s(n).isEnterpriseSamlEnabled?(T(),V(H,{key:0,disabled:s(n).isSamlLoginEnabled||_.value},{content:c(()=>[a("span",null,o(s(e).baseText("settings.sso.activation.tooltip")),1)]),default:c(()=>[u(A,{modelValue:s(n).isSamlLoginEnabled,"onUpdate:modelValue":r[0]||(r[0]=b=>s(n).isSamlLoginEnabled=b),disabled:!_.value,class:p(t.$style.switch),"inactive-text":X.value},null,8,["modelValue","disabled","class","inactive-text"])]),_:1},8,["disabled"])):W("",!0)],2),u(Q,null,{default:c(()=>[x(o(s(e).baseText("settings.sso.info"))+" ",1),a("a",it,o(s(e).baseText("settings.sso.info.link")),1)]),_:1}),s(n).isEnterpriseSamlEnabled?(T(),C("div",rt,[a("div",{class:p(t.$style.group)},[a("label",null,o(s(e).baseText("settings.sso.settings.redirectUrl.label")),1),u(M,{value:S.value,"copy-button-text":s(e).baseText("generic.clickToCopy"),"toast-title":s(e).baseText("settings.sso.settings.redirectUrl.copied")},null,8,["value","copy-button-text","toast-title"]),a("small",null,o(s(e).baseText("settings.sso.settings.redirectUrl.help")),1)],2),a("div",{class:p(t.$style.group)},[a("label",null,o(s(e).baseText("settings.sso.settings.entityId.label")),1),u(M,{value:U.value,"copy-button-text":s(e).baseText("generic.clickToCopy"),"toast-title":s(e).baseText("settings.sso.settings.entityId.copied")},null,8,["value","copy-button-text","toast-title"]),a("small",null,o(s(e).baseText("settings.sso.settings.entityId.help")),1)],2),a("div",{class:p(t.$style.group)},[a("label",null,o(s(e).baseText("settings.sso.settings.ips.label")),1),a("div",ut,[u(q,{modelValue:i.value,"onUpdate:modelValue":r[1]||(r[1]=b=>i.value=b),options:N.value},null,8,["modelValue","options"])]),B(a("div",null,[u(L,{modelValue:m.value,"onUpdate:modelValue":r[2]||(r[2]=b=>m.value=b),type:"text",name:"metadataUrl",size:"large",placeholder:s(e).baseText("settings.sso.settings.ips.url.placeholder")},null,8,["modelValue","placeholder"]),a("small",null,o(s(e).baseText("settings.sso.settings.ips.url.help")),1)],512),[[I,i.value===l.URL]]),B(a("div",null,[u(L,{modelValue:g.value,"onUpdate:modelValue":r[3]||(r[3]=b=>g.value=b),type:"textarea",name:"metadata",rows:4},null,8,["modelValue"]),a("small",null,o(s(e).baseText("settings.sso.settings.ips.xml.help")),1)],512),[[I,i.value===l.XML]])],2),a("div",{class:p(t.$style.buttons)},[u(E,{disabled:!D.value,size:"large","data-test-id":"sso-save",onClick:G},{default:c(()=>[x(o(s(e).baseText("settings.sso.settings.save")),1)]),_:1},8,["disabled"]),u(E,{disabled:!O.value,size:"large",type:"tertiary","data-test-id":"sso-test",onClick:h},{default:c(()=>[x(o(s(e).baseText("settings.sso.settings.test")),1)]),_:1},8,["disabled"])],2),a("footer",{class:p(t.$style.footer)},o(s(e).baseText("settings.sso.settings.footer.hint")),3)])):(T(),V(F,{key:1,"data-test-id":"sso-content-unlicensed",class:p(t.$style.actionBox),description:s(e).baseText("settings.sso.actionBox.description"),"button-text":s(e).baseText("settings.sso.actionBox.buttonText"),"onClick:button":P},{heading:c(()=>[a("span",null,o(s(e).baseText("settings.sso.actionBox.title")),1)]),_:1},8,["class","description","button-text"]))])}}}),ct="_top_1i3kj_1",pt="_buttons_1i3kj_14",mt="_group_1i3kj_23",gt="_actionBox_1i3kj_39",bt="_footer_1i3kj_43",vt={top:ct,switch:"_switch_1i3kj_8",buttons:pt,group:mt,actionBox:gt,footer:bt},_t={$style:vt},Ft=nt(dt,[["__cssModules",_t]]);export{Ft as default};
//# sourceMappingURL=SettingsSso-DA9AOKH5.js.map
