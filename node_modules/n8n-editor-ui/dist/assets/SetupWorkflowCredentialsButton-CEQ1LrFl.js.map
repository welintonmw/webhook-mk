{"version":3,"file":"SetupWorkflowCredentialsButton-CEQ1LrFl.js","sources":["../../src/components/SetupWorkflowCredentialsButton/SetupWorkflowCredentialsButton.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport { computed, onBeforeUnmount, watch } from 'vue';\nimport { useI18n } from '@/composables/useI18n';\nimport { SETUP_CREDENTIALS_MODAL_KEY, TEMPLATE_CREDENTIAL_SETUP_EXPERIMENT } from '@/constants';\nimport { useNodeTypesStore } from '@/stores/nodeTypes.store';\nimport { usePostHog } from '@/stores/posthog.store';\nimport { useUIStore } from '@/stores/ui.store';\nimport { useWorkflowsStore } from '@/stores/workflows.store';\nimport { doesNodeHaveAllCredentialsFilled } from '@/utils/nodes/nodeTransforms';\n\nconst workflowsStore = useWorkflowsStore();\nconst nodeTypesStore = useNodeTypesStore();\nconst uiStore = useUIStore();\nconst posthogStore = usePostHog();\nconst i18n = useI18n();\n\nconst isTemplateSetupCompleted = computed(() => {\n\treturn !!workflowsStore.workflow?.meta?.templateCredsSetupCompleted;\n});\n\nconst allCredentialsFilled = computed(() => {\n\tif (isTemplateSetupCompleted.value) {\n\t\treturn true;\n\t}\n\n\tconst nodes = workflowsStore.getNodes();\n\tif (!nodes.length) {\n\t\treturn false;\n\t}\n\n\treturn nodes.every((node) => doesNodeHaveAllCredentialsFilled(nodeTypesStore, node));\n});\n\nconst showButton = computed(() => {\n\tconst isFeatureEnabled = posthogStore.isFeatureEnabled(TEMPLATE_CREDENTIAL_SETUP_EXPERIMENT);\n\tconst isCreatedFromTemplate = !!workflowsStore.workflow?.meta?.templateId;\n\tif (!isFeatureEnabled || !isCreatedFromTemplate || isTemplateSetupCompleted.value) {\n\t\treturn false;\n\t}\n\n\treturn !allCredentialsFilled.value;\n});\n\nconst unsubscribe = watch(allCredentialsFilled, (newValue) => {\n\tif (newValue) {\n\t\tworkflowsStore.addToWorkflowMetadata({\n\t\t\ttemplateCredsSetupCompleted: true,\n\t\t});\n\n\t\tunsubscribe();\n\t}\n});\n\nconst handleClick = () => {\n\tuiStore.openModal(SETUP_CREDENTIALS_MODAL_KEY);\n};\n\nonBeforeUnmount(() => {\n\tuiStore.closeModal(SETUP_CREDENTIALS_MODAL_KEY);\n});\n</script>\n\n<template>\n\t<n8n-button\n\t\tv-if=\"showButton\"\n\t\t:label=\"i18n.baseText('nodeView.setupTemplate')\"\n\t\tsize=\"large\"\n\t\ticon=\"box-open\"\n\t\ttype=\"secondary\"\n\t\t@click=\"handleClick()\"\n\t/>\n</template>\n"],"names":["workflowsStore","useWorkflowsStore","nodeTypesStore","useNodeTypesStore","uiStore","useUIStore","posthogStore","usePostHog","i18n","useI18n","isTemplateSetupCompleted","computed","_b","_a","allCredentialsFilled","nodes","node","doesNodeHaveAllCredentialsFilled","showButton","isFeatureEnabled","TEMPLATE_CREDENTIAL_SETUP_EXPERIMENT","isCreatedFromTemplate","unsubscribe","watch","newValue","handleClick","SETUP_CREDENTIALS_MODAL_KEY","onBeforeUnmount"],"mappings":"+rCAUA,MAAMA,EAAiBC,IACjBC,EAAiBC,IACjBC,EAAUC,IACVC,EAAeC,IACfC,EAAOC,IAEPC,EAA2BC,EAAS,IAAM,SAC/C,MAAO,CAAC,GAACC,GAAAC,EAAAb,EAAe,WAAf,YAAAa,EAAyB,OAAzB,MAAAD,EAA+B,4BAAA,CACxC,EAEKE,EAAuBH,EAAS,IAAM,CAC3C,GAAID,EAAyB,MACrB,MAAA,GAGF,MAAAK,EAAQf,EAAe,WACzB,OAACe,EAAM,OAIJA,EAAM,MAAOC,GAASC,EAAiCf,EAAgBc,CAAI,CAAC,EAH3E,EAG2E,CACnF,EAEKE,EAAaP,EAAS,IAAM,SAC3B,MAAAQ,EAAmBb,EAAa,iBAAiBc,CAAoC,EACrFC,EAAwB,CAAC,GAACT,GAAAC,EAAAb,EAAe,WAAf,YAAAa,EAAyB,OAAzB,MAAAD,EAA+B,YAC/D,MAAI,CAACO,GAAoB,CAACE,GAAyBX,EAAyB,MACpE,GAGD,CAACI,EAAqB,KAAA,CAC7B,EAEKQ,EAAcC,EAAMT,EAAuBU,GAAa,CACzDA,IACHxB,EAAe,sBAAsB,CACpC,4BAA6B,EAAA,CAC7B,EAEWsB,IACb,CACA,EAEKG,EAAc,IAAM,CACzBrB,EAAQ,UAAUsB,CAA2B,CAAA,EAG9C,OAAAC,EAAgB,IAAM,CACrBvB,EAAQ,WAAWsB,CAA2B,CAAA,CAC9C"}