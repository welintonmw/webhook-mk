import{G as ee,av as ue,aH as de,r as W,e as k,ag as h,l as i,m as b,p as s,M as w,R as g,I as r,a2 as Z,T as u,U as _,O as y,u as n,S as V,d as xe,b as oe,P as pe,V as me,F as fe,a7 as ye,a0 as we,D as _e,y as be}from"./vendor-Dv5OeN6t.js";import{E as he,a as ve}from"./ExecutionsFilter-0XcXH83H.js";import{at as ge,O as ke,x as te,V as Le,j as ne,L as le,u as ie,A as Te,H as Ee,G as ae,d8 as Ae,a3 as Ce}from"./index-1OxaEeO3.js";import{c as Ie}from"./dateFormatter-CfbOITvW.js";import{u as Se}from"./useExecutionHelpers-LeKoU_T-.js";import{_ as ce}from"./n8n-4UEsHtUL.js";import{s as $e}from"./pinia-sugP77Im.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const Me={key:0},De={key:1},Ne={key:0},Oe={key:1},We=s("br",null,null,-1),Re={key:2},ze=s("br",null,null,-1),je=ee({__name:"GlobalExecutionsListItem",props:{execution:{},selected:{type:Boolean,default:!1},workflowName:{}},emits:["stop","select","retrySaved","retryOriginal","delete"],setup(H,{emit:I}){const m=I,c=H,o=ue(),l=te(),S=de(),x=Se(),L=W(!1),f=k(()=>c.execution.status==="running"),p=k(()=>c.execution.waitTill?new Date(c.execution.waitTill).toISOString()===ge:!1),d=k(()=>x.isExecutionRetriable(c.execution)),M=k(()=>({[o.executionListItem]:!0,[o[c.execution.status]]:!0})),v=k(()=>c.execution.startedAt?U(c.execution.startedAt):""),C=k(()=>c.execution.waitTill?U(c.execution.waitTill):""),D=k(()=>c.execution.stoppedAt?l.displayTimer(new Date(c.execution.stoppedAt).getTime()-new Date(c.execution.startedAt).getTime(),!0):""),T=k(()=>c.execution.status==="waiting"&&p.value?l.baseText("executionsList.statusTooltipText.theWorkflowIsWaitingIndefinitely"):""),N=k(()=>{switch(c.execution.status){case"waiting":return l.baseText("executionsList.waiting");case"canceled":return l.baseText("executionsList.canceled");case"crashed":return l.baseText("executionsList.error");case"new":return l.baseText("executionsList.running");case"running":return l.baseText("executionsList.running");case"success":return l.baseText("executionsList.succeeded");case"error":return l.baseText("executionsList.error");default:return l.baseText("executionsList.unknown")}}),P=k(()=>{switch(c.execution.status){case"waiting":return"executionsList.statusWaiting";case"canceled":return"executionsList.statusCanceled";case"crashed":case"error":case"success":return c.execution.stoppedAt?"executionsList.statusText":"executionsList.statusTextWithoutTime";case"new":return"executionsList.statusRunning";case"running":return"executionsList.statusRunning";default:return"executionsList.statusUnknown"}});function U(t){const{date:R,time:z}=Ie(t);return ke.baseText("executionsList.started",{interpolate:{time:z,date:R}})}function $(){const t=S.resolve({name:Le.EXECUTION_PREVIEW,params:{name:c.execution.workflowId,executionId:c.execution.id}});window.open(t.href,"_blank")}function X(){L.value=!0,m("stop",c.execution)}function q(){m("select",c.execution)}async function J(t){m(t,c.execution)}return(t,R)=>{const z=h("ElCheckbox"),F=h("FontAwesomeIcon"),K=h("i18n-t"),j=h("N8nTooltip"),G=h("N8nButton"),Q=h("N8nIconButton"),B=h("ElDropdownItem"),e=h("ElDropdownMenu"),a=h("ElDropdown");return i(),b("tr",{class:r(M.value)},[s("td",null,[t.execution.stoppedAt&&t.execution.id?(i(),w(z,{key:0,"model-value":t.selected,label:"","data-test-id":"select-execution-checkbox","onUpdate:modelValue":q},null,8,["model-value"])):g("",!0)]),s("td",null,[s("span",{class:r(t.$style.link),onClick:Z($,["stop"])},u(t.execution.workflowName||t.workflowName),3)]),s("td",null,[s("span",null,u(v.value),1)]),s("td",null,[s("div",{class:r(t.$style.statusColumn)},[f.value?(i(),b("span",{key:0,class:r(t.$style.spinner)},[_(F,{icon:"spinner",spin:""})],2)):g("",!0),p.value?(i(),w(j,{key:2,placement:"top"},{content:y(()=>[s("span",null,u(T.value),1)]),default:y(()=>[s("span",{class:r(t.$style.status)},u(N.value),3)]),_:1})):(i(),w(K,{key:1,"data-test-id":"execution-status",tag:"span",keypath:P.value},{status:y(()=>[s("span",{class:r(t.$style.status)},u(N.value),3)]),time:y(()=>[t.execution.waitTill?(i(),b("span",Me,u(C.value),1)):t.execution.stoppedAt?(i(),b("span",De,u(D.value),1)):(i(),w(he,{key:2,"start-time":t.execution.startedAt},null,8,["start-time"]))]),_:1},8,["keypath"]))],2)]),s("td",null,[t.execution.id?(i(),b("span",Ne,"#"+u(t.execution.id),1)):g("",!0),t.execution.retryOf?(i(),b("span",Oe,[We,s("small",null," ("+u(n(l).baseText("executionsList.retryOf"))+" #"+u(t.execution.retryOf)+") ",1)])):t.execution.retrySuccessId?(i(),b("span",Re,[ze,s("small",null," ("+u(n(l).baseText("executionsList.successRetry"))+" #"+u(t.execution.retrySuccessId)+") ",1)])):g("",!0)]),s("td",null,[t.execution.mode==="manual"?(i(),w(j,{key:0,placement:"top"},{content:y(()=>[s("span",null,u(n(l).baseText("executionsList.test")),1)]),default:y(()=>[_(F,{icon:"flask"})]),_:1})):g("",!0)]),s("td",null,[s("div",{class:r(t.$style.buttonCell)},[t.execution.stoppedAt&&t.execution.id?(i(),w(G,{key:0,size:"small",outline:"",label:n(l).baseText("executionsList.view"),onClick:Z($,["stop"])},null,8,["label"])):g("",!0)],2)]),s("td",null,[s("div",{class:r(t.$style.buttonCell)},[!t.execution.stoppedAt||t.execution.waitTill?(i(),w(G,{key:0,"data-test-id":"stop-execution-button",size:"small",outline:"",label:n(l).baseText("executionsList.stop"),loading:L.value,onClick:Z(X,["stop"])},null,8,["label","loading"])):g("",!0)],2)]),s("td",null,[f.value?g("",!0):(i(),w(a,{key:0,trigger:"click",onCommand:J},{dropdown:y(()=>[_(e,{class:r({[t.$style.actions]:!0,[t.$style.deleteOnly]:!d.value})},{default:y(()=>[d.value?(i(),w(B,{key:0,"data-test-id":"execution-retry-saved-dropdown-item",class:r(t.$style.retryAction),command:"retrySaved"},{default:y(()=>[V(u(n(l).baseText("executionsList.retryWithCurrentlySavedWorkflow")),1)]),_:1},8,["class"])):g("",!0),d.value?(i(),w(B,{key:1,"data-test-id":"execution-retry-original-dropdown-item",class:r(t.$style.retryAction),command:"retryOriginal"},{default:y(()=>[V(u(n(l).baseText("executionsList.retryWithOriginalWorkflow")),1)]),_:1},8,["class"])):g("",!0),_(B,{"data-test-id":"execution-delete-dropdown-item",class:r(t.$style.deleteAction),command:"delete"},{default:y(()=>[V(u(n(l).baseText("generic.delete")),1)]),_:1},8,["class"])]),_:1},8,["class"])]),default:y(()=>[_(Q,{text:"",type:"tertiary",size:"mini",icon:"ellipsis-v"})]),_:1}))])],2)}}}),Be="_executionListItem_jgpi5_1",Ve="_crashed_jgpi5_30",He="_error_jgpi5_30",Ue="_success_jgpi5_33",Fe="_running_jgpi5_36",Ge="_waiting_jgpi5_39",Pe="_unknown_jgpi5_42",Xe="_link_jgpi5_46",qe="_statusColumn_jgpi5_52",Je="_spinner_jgpi5_57",Ke="_status_jgpi5_52",Qe="_buttonCell_jgpi5_83",Ye={executionListItem:Be,crashed:Ve,error:He,success:Ue,new:"_new_jgpi5_36",running:Fe,waiting:Ge,unknown:Pe,link:Xe,statusColumn:qe,spinner:Je,status:Ke,buttonCell:Qe},Ze={$style:Ye},et=ce(je,[["__cssModules",Ze]]),tt={key:1},st=s("th",null,null,-1),ot=s("th",null,null,-1),nt=s("th",null,null,-1),lt=s("th",null,null,-1),it=ee({__name:"GlobalExecutionsList",props:{executions:{},filters:{},total:{default:0},estimated:{type:Boolean,default:!1}},emits:["closeModal","execution:stop","update:autoRefresh","update:filters"],setup(H,{emit:I}){const m=H,c=I,o=te(),l=ae(),S=ne(),x=le(),L=W(!1),f=W(!1),p=W(!1),d=W({}),M=Ee(),v=ie(),C=k(()=>p.value?m.total:Object.keys(d.value).length),D=k(()=>[{id:"all",name:o.baseText("executionsList.allWorkflows")},...S.allWorkflows]);xe(()=>m.executions,()=>{m.executions.length===0&&$(),z()}),oe(()=>{L.value=!0});function T(){p.value=!p.value,f.value=!p.value,N()}function N(){f.value=!f.value,f.value?R():(p.value=!1,d.value={})}function P(e){const a=e.id;if(d.value[a]){const{[a]:E,...O}=d.value;d.value=O}else d.value={...d.value,[a]:!0};f.value=Object.keys(d.value).length===m.executions.length,p.value=Object.keys(d.value).length===m.total}async function U(){if(await M.confirm(o.baseText("executionsList.confirmMessage.message",{interpolate:{count:C.value.toString()}}),o.baseText("executionsList.confirmMessage.headline"),{type:"warning",confirmButtonText:o.baseText("executionsList.confirmMessage.confirmButtonText"),cancelButtonText:o.baseText("executionsList.confirmMessage.cancelButtonText")})===Te){try{await x.deleteExecutions({filters:x.executionsFilters,...p.value?{deleteBefore:m.executions[0].startedAt}:{ids:Object.keys(d.value)}})}catch(a){v.showError(a,o.baseText("executionsList.showError.handleDeleteSelected.title"));return}v.showMessage({title:o.baseText("executionsList.showMessage.handleDeleteSelected.title"),type:"success"}),$()}}function $(){f.value=!1,p.value=!1,d.value={}}async function X(e){c("update:filters",e),$()}function q(e){return J(e.workflowId??"")??o.baseText("executionsList.unsavedWorkflow")}function J(e){var a;return(a=D.value.find(E=>E.id===e))==null?void 0:a.name}async function t(){if(x.filters.status==="running")return;let e;m.executions.length!==0&&(e=m.executions.slice(-1)[0].id);try{await x.fetchExecutions(x.executionsFilters,e)}catch(a){v.showError(a,o.baseText("executionsList.showError.loadMore.title"))}}function R(){m.executions.forEach(e=>{d.value[e.id]=!0})}function z(){p.value&&(f.value=!0,R())}async function F(e){await j(e,!0)}async function K(e){await j(e,!1)}async function j(e,a){try{await x.retryExecution(e.id,a)?v.showMessage({title:o.baseText("executionsList.showMessage.retrySuccessfulTrue.title"),type:"success"}):v.showMessage({title:o.baseText("executionsList.showMessage.retrySuccessfulFalse.title"),type:"error"})}catch(E){v.showError(E,o.baseText("executionsList.showError.retryExecution.title"))}l.track("User clicked retry execution button",{workflow_id:S.workflowId,execution_id:e.id,retry_type:a?"current":"original"})}async function G(e){try{await x.stopCurrentExecution(e.id),v.showMessage({title:o.baseText("executionsList.showMessage.stopExecution.title"),message:o.baseText("executionsList.showMessage.stopExecution.message",{interpolate:{activeExecutionId:e.id}}),type:"success"}),c("execution:stop")}catch(a){v.showError(a,o.baseText("executionsList.showError.stopExecution.title"))}}async function Q(e){try{if(await x.deleteExecutions({ids:[e.id]}),f.value){const{[e.id]:a,...E}=d.value;d.value=E}}catch(a){v.showError(a,o.baseText("executionsList.showError.handleDeleteSelected.title"))}}async function B(e){e?await x.startAutoRefreshInterval():x.stopAutoRefreshInterval()}return(e,a)=>{const E=h("N8nHeading"),O=h("N8nLoading"),se=h("ElCheckbox"),re=h("el-checkbox"),Y=h("N8nButton");return i(),b("div",{class:r(e.$style.execListWrapper)},[s("div",{class:r(e.$style.execList)},[s("div",{class:r(e.$style.execListHeader)},[_(E,{tag:"h1",size:"2xlarge"},{default:y(()=>[V(u(n(o).baseText("executionsList.workflowExecutions")),1)]),_:1}),s("div",{class:r(e.$style.execListHeaderControls)},[L.value?(i(),w(se,{key:1,modelValue:n(x).autoRefresh,"onUpdate:modelValue":[a[0]||(a[0]=A=>n(x).autoRefresh=A),a[1]||(a[1]=A=>B(A))],class:"mr-xl","data-test-id":"execution-auto-refresh-checkbox"},{default:y(()=>[V(u(n(o).baseText("executionsList.autoRefresh")),1)]),_:1},8,["modelValue"])):(i(),w(O,{key:0,class:r(e.$style.filterLoader),variant:"custom"},null,8,["class"])),pe(_(ve,{workflows:D.value,onFilterChanged:X},null,8,["workflows"]),[[me,L.value]])],2)],2),f.value&&e.total>0?(i(),w(se,{key:0,class:r(e.$style.selectAll),label:n(o).baseText("executionsList.selectAll",{adjustToNumber:e.total,interpolate:{executionNum:`${e.total}`}}),"model-value":p.value,"data-test-id":"select-all-executions-checkbox","onUpdate:modelValue":T},null,8,["class","label","model-value"])):g("",!0),L.value?(i(),b("table",{key:2,class:r(e.$style.execTable)},[s("thead",null,[s("tr",null,[s("th",null,[_(re,{"model-value":f.value,disabled:e.total<1,label:"","data-test-id":"select-visible-executions-checkbox","onUpdate:modelValue":N},null,8,["model-value","disabled"])]),s("th",null,u(n(o).baseText("executionsList.name")),1),s("th",null,u(n(o).baseText("executionsList.startedAt")),1),s("th",null,u(n(o).baseText("executionsList.status")),1),s("th",null,u(n(o).baseText("executionsList.id")),1),st,ot,nt,lt])]),_(we,{tag:"tbody",name:"executions-list"},{default:y(()=>[(i(!0),b(fe,null,ye(e.executions,A=>(i(),w(et,{key:A.id,execution:A,"workflow-name":q(A),selected:d.value[A.id]||p.value,onStop:G,onDelete:Q,onSelect:P,onRetrySaved:F,onRetryOriginal:K},null,8,["execution","workflow-name","selected"]))),128))]),_:1})],2)):(i(),b("div",tt,[_(O,{class:r(e.$style.tableLoader),variant:"custom"},null,8,["class"]),_(O,{class:r(e.$style.tableLoader),variant:"custom"},null,8,["class"]),_(O,{class:r(e.$style.tableLoader),variant:"custom"},null,8,["class"])])),!e.executions.length&&L.value&&!n(x).loading?(i(),b("div",{key:3,class:r(e.$style.loadedAll),"data-test-id":"execution-list-empty"},u(n(o).baseText("executionsList.empty")),3)):e.total>e.executions.length||e.estimated?(i(),b("div",{key:4,class:r(e.$style.loadMore)},[_(Y,{icon:"sync",title:n(o).baseText("executionsList.loadMore"),label:n(o).baseText("executionsList.loadMore"),loading:n(x).loading,"data-test-id":"load-more-button",onClick:a[2]||(a[2]=A=>t())},null,8,["title","label","loading"])],2)):L.value&&!n(x).loading?(i(),b("div",{key:5,class:r(e.$style.loadedAll),"data-test-id":"execution-all-loaded"},u(n(o).baseText("executionsList.loadedAll")),3)):g("",!0)],2),C.value>0?(i(),b("div",{key:0,class:r(e.$style.selectionOptions),"data-test-id":"selected-executions-info"},[s("span",null,u(n(o).baseText("executionsList.selected",{adjustToNumber:C.value,interpolate:{count:`${C.value}`}})),1),_(Y,{label:n(o).baseText("generic.delete"),type:"tertiary","data-test-id":"delete-selected-button",onClick:U},null,8,["label"]),_(Y,{label:n(o).baseText("executionsList.clearSelection"),type:"tertiary","data-test-id":"clear-selection-button",onClick:$},null,8,["label"])],2)):g("",!0)],2)}}}),at="_execListWrapper_1xozp_1",ct="_execList_1xozp_1",rt="_execListHeader_1xozp_22",ut="_execListHeaderControls_1xozp_29",dt="_selectionOptions_1xozp_35",xt="_execTable_1xozp_53",pt="_loadMore_1xozp_96",mt="_loadedAll_1xozp_102",ft="_actions_1xozp_109",yt="_deleteOnly_1xozp_109",wt="_retryAction_1xozp_113",_t="_deleteAction_1xozp_113",bt="_selectAll_1xozp_117",ht="_filterLoader_1xozp_123",vt="_tableLoader_1xozp_128",gt={execListWrapper:at,execList:ct,execListHeader:rt,execListHeaderControls:ut,selectionOptions:dt,execTable:xt,loadMore:pt,loadedAll:mt,actions:ft,deleteOnly:yt,retryAction:wt,deleteAction:_t,selectAll:bt,filterLoader:ht,tableLoader:vt},kt={$style:gt},Lt=ce(it,[["__cssModules",kt]]),os=ee({__name:"ExecutionsView",setup(H){const I=te(),m=ae(),c=Ce(),o=ne(),l=le(),S=ie();W(!1);const{executionsCount:x,executionsCountEstimated:L,filters:f,allExecutions:p}=$e(l);_e(async()=>{await d(),c.run("executionsList.openDialog"),m.track("User opened Executions log",{workflow_id:o.workflowId})}),oe(async()=>{Ae(`n8n - ${I.baseText("executionsList.workflowExecutions")}`),document.addEventListener("visibilitychange",M),await l.initialize()}),be(()=>{l.reset(),document.removeEventListener("visibilitychange",M)});async function d(){try{await o.fetchAllWorkflows()}catch(T){S.showError(T,I.baseText("executionsList.showError.loadWorkflows.title"))}}function M(){document.visibilityState==="hidden"?l.stopAutoRefreshInterval():l.startAutoRefreshInterval()}async function v(){try{await l.fetchExecutions()}catch(T){S.showError(T,I.baseText("executionsList.showError.refreshData.title"))}}async function C(T){l.reset(),l.setFilters(T),await l.initialize()}async function D(){await v()}return(T,N)=>(i(),w(Lt,{executions:n(p),filters:n(f),total:n(x),"estimated-total":n(L),"onExecution:stop":D,"onUpdate:filters":C},null,8,["executions","filters","total","estimated-total"]))}});export{os as default};
//# sourceMappingURL=ExecutionsView-aFiZuLVt.js.map
