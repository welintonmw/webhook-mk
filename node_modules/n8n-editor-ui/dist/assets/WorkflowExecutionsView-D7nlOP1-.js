import{m as N,s as ce}from"./pinia-sugP77Im.js";import{G as O,ag as c,l as r,m as $,U as d,O as x,p as _,S as v,T as h,I as u,M as k,R as w,F as de,a7 as fe,a0 as me,aH as G,az as pe,r as D,e as A,d as q,b as xe,y as he,u as we}from"./vendor-Dv5OeN6t.js";import{j as H,V as b,L as X,aI as ye,J as Ee,A as ge,aJ as ve,q as j,d as K,u as J,H as ke,p as $e,e as _e,b as be,a4 as Q,c as Ie,P as Y,cG as Te,a3 as Se,ap as Re,x as Me,cH as Le,G as We}from"./index-1OxaEeO3.js";import{E as Ce,a as De}from"./ExecutionsFilter-0XcXH83H.js";import{u as Ae}from"./useExecutionHelpers-LeKoU_T-.js";import{_ as F}from"./n8n-4UEsHtUL.js";import{W as Oe}from"./WorkflowExecutionsInfoAccordion-aldNazgt.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";import"./dateFormatter-CfbOITvW.js";const ze=O({name:"WorkflowExecutionsCard",components:{ExecutionsTime:Ce},props:{execution:{type:Object,required:!0},highlight:{type:Boolean,default:!1},showGap:{type:Boolean,default:!1}},emits:["retryExecution","mounted"],setup(){return{executionHelpers:Ae()}},computed:{...N(H),currentWorkflow(){return this.$route.params.name||this.workflowsStore.workflowId},retryExecutionActions(){return[{id:"current-workflow",label:this.$locale.baseText("executionsList.retryWithCurrentlySavedWorkflow")},{id:"original-workflow",label:this.$locale.baseText("executionsList.retryWithOriginalWorkflow")}]},executionUIDetails(){return this.executionHelpers.getUIDetails(this.execution)},isActive(){return this.execution.id===this.$route.params.executionId},isRetriable(){return this.executionHelpers.isExecutionRetriable(this.execution)},executionPreviewViewName(){return b.EXECUTION_PREVIEW}},mounted(){this.$emit("mounted",this.execution.id)},methods:{onRetryMenuItemSelect(e){this.$emit("retryExecution",{execution:this.execution,command:e})}}}),Ue="_WorkflowExecutionsCard_16ozu_1",Ne="_active_16ozu_8",He="_executionStatus_16ozu_11",Fe="_executionLink_16ozu_14",Be="_spinner_16ozu_17",Pe="_running_16ozu_17",Ve="_statusLabel_16ozu_24",qe="_success_16ozu_29",Ge="_waiting_16ozu_32",Xe="_error_16ozu_38",je="_unknown_16ozu_44",Ke="_icon_16ozu_61",Je="_icons_16ozu_66",Qe="_retry_16ozu_74",Ye="_manual_16ozu_77",Ze="_showGap_16ozu_85",et={WorkflowExecutionsCard:Ue,active:Ne,executionStatus:He,executionLink:Fe,new:"_new_16ozu_17",spinner:Be,running:Pe,statusLabel:Ve,success:qe,waiting:Ge,error:Xe,unknown:je,icon:Ke,icons:Je,retry:Qe,manual:Ye,showGap:Ze},tt={key:0};function ot(e,t,n,f,i,I){const m=c("n8n-text"),y=c("n8n-spinner"),s=c("ExecutionsTime"),T=c("n8n-action-dropdown"),R=c("font-awesome-icon"),S=c("n8n-tooltip"),M=c("router-link");return r(),$("div",{class:u({"execution-card":!0,[e.$style.WorkflowExecutionsCard]:!0,[e.$style.active]:e.isActive,[e.$style[e.executionUIDetails.name]]:!0,[e.$style.highlight]:e.highlight,[e.$style.showGap]:e.showGap})},[d(M,{class:u(e.$style.executionLink),to:{name:e.executionPreviewViewName,params:{name:e.currentWorkflow,executionId:e.execution.id}},"data-test-execution-status":e.executionUIDetails.name},{default:x(()=>[_("div",{class:u(e.$style.description)},[d(m,{color:"text-dark",bold:!0,size:"medium","data-test-id":"execution-time"},{default:x(()=>[v(h(e.executionUIDetails.startTime),1)]),_:1}),_("div",{class:u(e.$style.executionStatus)},[e.executionUIDetails.name==="running"?(r(),k(y,{key:0,size:"small",class:u([e.$style.spinner,"mr-4xs"])},null,8,["class"])):w("",!0),d(m,{class:u(e.$style.statusLabel),size:"small"},{default:x(()=>[v(h(e.executionUIDetails.label),1)]),_:1},8,["class"]),v(" "+h(" ")+" "),e.executionUIDetails.name==="running"?(r(),k(m,{key:1,color:e.isActive?"text-dark":"text-base",size:"small"},{default:x(()=>[v(h(e.$locale.baseText("executionDetails.runningTimeRunning"))+" ",1),d(s,{"start-time":e.execution.startedAt},null,8,["start-time"])]),_:1},8,["color"])):e.executionUIDetails.runningTime!==""?(r(),k(m,{key:2,color:e.isActive?"text-dark":"text-base",size:"small"},{default:x(()=>{var a;return[v(h(e.$locale.baseText("executionDetails.runningTimeFinished",{interpolate:{time:(a=e.executionUIDetails)==null?void 0:a.runningTime}})),1)]}),_:1},8,["color"])):w("",!0)],2),e.execution.mode==="retry"?(r(),$("div",tt,[d(m,{color:e.isActive?"text-dark":"text-base",size:"small"},{default:x(()=>[v(h(e.$locale.baseText("executionDetails.retry"))+" #"+h(e.execution.retryOf),1)]),_:1},8,["color"])])):w("",!0)],2),_("div",{class:u(e.$style.icons)},[e.isRetriable?(r(),k(T,{key:0,class:u([e.$style.icon,e.$style.retry]),items:e.retryExecutionActions,"activator-icon":"redo","data-test-id":"retry-execution-button",onSelect:e.onRetryMenuItemSelect},null,8,["class","items","onSelect"])):w("",!0),e.execution.mode==="manual"?(r(),k(S,{key:1,placement:"top"},{content:x(()=>[_("span",null,h(e.$locale.baseText("executionsList.test")),1)]),default:x(()=>[e.execution.mode==="manual"?(r(),k(R,{key:0,class:u([e.$style.icon,e.$style.manual]),icon:"flask"},null,8,["class"])):w("",!0)]),_:1})):w("",!0)],2)]),_:1},8,["class","to","data-test-execution-status"])],2)}const nt={$style:et},st=F(ze,[["render",ot],["__cssModules",nt]]),it=O({name:"WorkflowExecutionsSidebar",components:{WorkflowExecutionsCard:st,WorkflowExecutionsInfoAccordion:Oe,ExecutionsFilter:De},props:{executions:{type:Array,required:!0},loading:{type:Boolean,default:!0},loadingMore:{type:Boolean,default:!1},temporaryExecution:{type:Object,default:null}},emits:{retryExecution:null,loadMore:null,refresh:null,filterUpdated:null,reloadExecutions:null,"update:autoRefresh":null},data(){return{filter:{},mountedItems:[],autoScrollDeps:{activeExecutionSet:!1,cardsMounted:!1,scroll:!0}}},computed:{...N(X,H)},watch:{$route(e,t){t.name===b.EXECUTION_PREVIEW&&e.name===b.EXECUTION_HOME&&this.$router.go(-1)},"executionsStore.activeExecution"(e,t){e&&e.id!==(t==null?void 0:t.id)&&(this.autoScrollDeps.activeExecutionSet=!0)},autoScrollDeps:{handler(e){Object.values(e).every(Boolean)&&this.scrollToActiveCard()},deep:!0}},methods:{onItemMounted(e){var t;this.mountedItems.push(e),this.mountedItems.length===this.executions.length&&(this.autoScrollDeps.cardsMounted=!0,this.checkListSize()),((t=this.executionsStore.activeExecution)==null?void 0:t.id)===e&&(this.autoScrollDeps.activeExecutionSet=!0)},loadMore(e=20){if(!this.loading){const t=this.$refs.executionList;if(t){const n=t.offsetHeight-(t.scrollHeight-t.scrollTop);n>-10&&n<10&&this.$emit("loadMore",e)}}},onRetryExecution(e){this.$emit("retryExecution",e)},onRefresh(){this.$emit("refresh")},onFilterChanged(e){this.$emit("filterUpdated",e)},reloadExecutions(){this.$emit("reloadExecutions")},checkListSize(){const e=this.$refs.container,t=this.$refs[`execution-${this.mountedItems[this.mountedItems.length-1]}`];if(e&&(t!=null&&t.length)){const n=t[0].$el,f=Math.ceil(e.clientHeight/n.clientHeight);f>this.executions.length&&this.$emit("loadMore",f-this.executions.length)}},scrollToActiveCard(){var n;const e=this.$refs.executionList,t=this.$refs[`execution-${(n=this.executionsStore.activeExecution)==null?void 0:n.id}`];if(e&&(t!=null&&t.length)&&this.executionsStore.activeExecution){const i=t[0].$el.getBoundingClientRect(),I=200;i.top>e.offsetHeight&&(this.autoScrollDeps.scroll=!1,e.scrollTo({top:i.top-I,behavior:"smooth"}))}}}}),rt="_container_qg8we_1",at="_heading_qg8we_12",ut="_controls_qg8we_19",lt="_executionList_qg8we_31",ct="_infoAccordion_qg8we_49",dt="_noResultsContainer_qg8we_61",ft={container:rt,heading:at,controls:ut,executionList:lt,infoAccordion:ct,noResultsContainer:dt},mt={key:0,class:"mr-l"},pt={key:3,class:"mr-m"};function xt(e,t,n,f,i,I){const m=c("n8n-heading"),y=c("el-checkbox"),s=c("ExecutionsFilter"),T=c("n8n-loading"),R=c("n8n-text"),S=c("WorkflowExecutionsCard"),M=c("WorkflowExecutionsInfoAccordion");return r(),$("div",{ref:"container",class:u(["executions-sidebar",e.$style.container]),"data-test-id":"executions-sidebar"},[_("div",{class:u(e.$style.heading)},[d(m,{tag:"h2",size:"medium",color:"text-dark"},{default:x(()=>[v(h(e.$locale.baseText("generic.executions")),1)]),_:1})],2),_("div",{class:u(e.$style.controls)},[d(y,{modelValue:e.executionsStore.autoRefresh,"onUpdate:modelValue":[t[0]||(t[0]=a=>e.executionsStore.autoRefresh=a),t[1]||(t[1]=a=>e.$emit("update:autoRefresh",a))],"data-test-id":"auto-refresh-checkbox"},{default:x(()=>[v(h(e.$locale.baseText("executionsList.autoRefresh")),1)]),_:1},8,["modelValue"]),d(s,{"popover-placement":"left-start",onFilterChanged:e.onFilterChanged},null,8,["onFilterChanged"])],2),_("div",{ref:"executionList",class:u(e.$style.executionList),"data-test-id":"current-executions-list",onScroll:t[2]||(t[2]=a=>e.loadMore(20))},[e.loading?(r(),$("div",mt,[d(T,{variant:"rect"})])):w("",!0),!e.loading&&e.executions.length===0?(r(),$("div",{key:1,class:u(e.$style.noResultsContainer),"data-test-id":"execution-list-empty"},[d(R,{color:"text-base",size:"medium",align:"center"},{default:x(()=>[v(h(e.$locale.baseText("executionsLandingPage.noResults")),1)]),_:1})],2)):e.temporaryExecution?(r(),k(S,{key:2,ref:`execution-${e.temporaryExecution.id}`,execution:e.temporaryExecution,"data-test-id":`execution-details-${e.temporaryExecution.id}`,"show-gap":!0,onRetryExecution:e.onRetryExecution},null,8,["execution","data-test-id","onRetryExecution"])):w("",!0),d(me,{name:"executions-list"},{default:x(()=>[(r(!0),$(de,null,fe(e.executions,a=>(r(),k(S,{key:a.id,ref_for:!0,ref:`execution-${a.id}`,execution:a,"data-test-id":`execution-details-${a.id}`,onRetryExecution:e.onRetryExecution,onMounted:e.onItemMounted},null,8,["execution","data-test-id","onRetryExecution","onMounted"]))),128))]),_:1}),e.loadingMore?(r(),$("div",pt,[d(T,{variant:"p",rows:1})])):w("",!0)],34),_("div",{class:u(e.$style.infoAccordion)},[d(M,{"initially-expanded":!1})],2)],2)}const ht={$style:ft},wt=F(it,[["render",xt],["__cssModules",ht],["__scopeId","data-v-4ab2abd5"]]),yt=O({name:"WorkflowExecutionsList",components:{WorkflowExecutionsSidebar:wt},async beforeRouteLeave(e,t,n){if(ye(e)===Ee.WORKFLOW){n();return}if(this.uiStore.stateIsDirty){const f=await this.confirm(this.$locale.baseText("generic.unsavedWork.confirmMessage.message"),{title:this.$locale.baseText("generic.unsavedWork.confirmMessage.headline"),type:"warning",confirmButtonText:this.$locale.baseText("generic.unsavedWork.confirmMessage.confirmButtonText"),cancelButtonText:this.$locale.baseText("generic.unsavedWork.confirmMessage.cancelButtonText"),showClose:!0});f===ge?(await this.workflowHelpers.saveCurrentWorkflow({},!1)&&await this.npsSurveyStore.fetchPromptsData(),this.uiStore.stateIsDirty=!1,n()):f===ve&&(this.uiStore.stateIsDirty=!1,n())}else n()},props:{loading:{type:Boolean,default:!1},workflow:{type:Object,required:!0},executions:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},execution:{type:Object,default:null},loadingMore:{type:Boolean,default:!1}},emits:["execution:delete","execution:stop","execution:retry","update:auto-refresh","update:filters","load-more","reload"],setup(){const e=Se(),t=G(),n=j({router:t}),{callDebounced:f}=K();return{externalHooks:e,workflowHelpers:n,callDebounced:f,...J(),...ke()}},computed:{...N(Ie,Q,be,_e,$e),temporaryExecution(){return!this.executions.find(t=>{var n;return t.id===((n=this.execution)==null?void 0:n.id)})?this.execution:void 0},hidePreview(){return this.loading||!this.execution&&this.executions.length},filterApplied(){return this.filters.status!=="all"},workflowDataNotLoaded(){return this.workflow.id===Y&&this.workflow.name===""},requestFilter(){return Te({...this.filters,workflowId:this.workflow.id})}},watch:{execution(e){e&&this.$router.push({name:b.EXECUTION_PREVIEW,params:{name:this.workflow.id,executionId:e.id}}).catch(()=>{})}},methods:{async onDeleteCurrentExecution(){var e;this.$emit("execution:delete",(e=this.execution)==null?void 0:e.id)},async onStopExecution(){var e;this.$emit("execution:stop",(e=this.execution)==null?void 0:e.id)},async onRetryExecution(e){const t=e.command==="current-workflow";this.$emit("execution:retry",{id:e.execution.id,loadWorkflow:t})}}}),Et="_container_16o1g_1",gt="_content_16o1g_7",vt={container:Et,content:gt};function kt(e,t,n,f,i,I){const m=c("WorkflowExecutionsSidebar"),y=c("router-view");return r(),$("div",{class:u(e.$style.container)},[d(m,{executions:e.executions,loading:e.loading&&!e.executions.length,"loading-more":e.loadingMore,"temporary-execution":e.temporaryExecution,"onUpdate:autoRefresh":t[0]||(t[0]=s=>e.$emit("update:auto-refresh",s)),onReloadExecutions:t[1]||(t[1]=s=>e.$emit("reload")),onFilterUpdated:t[2]||(t[2]=s=>e.$emit("update:filters",s)),onLoadMore:t[3]||(t[3]=s=>e.$emit("load-more")),onRetryExecution:e.onRetryExecution},null,8,["executions","loading","loading-more","temporary-execution","onRetryExecution"]),e.hidePreview?w("",!0):(r(),$("div",{key:0,class:u(e.$style.content)},[d(y,{name:"executionPreview",execution:e.execution,onDeleteCurrentExecution:e.onDeleteCurrentExecution,onRetryExecution:e.onRetryExecution,onStopExecution:e.onStopExecution},null,8,["execution","onDeleteCurrentExecution","onRetryExecution","onStopExecution"])],2))],2)}const $t={$style:vt},_t=F(yt,[["render",kt],["__cssModules",$t]]),so=O({__name:"WorkflowExecutionsView",setup(e){const t=X(),n=H(),f=Q(),i=Me(),I=We(),m=pe(),y=G(),s=J(),{callDebounced:T}=K(),R=j({router:y}),S=Re(),{filters:M}=ce(t),a=D(!1),L=D(!1),g=D(),E=A(()=>m.params.name||n.workflowId),W=A(()=>m.params.executionId),p=A(()=>[...t.currentExecutionsByWorkflowId[E.value]??[],...t.executionsByWorkflowId[E.value]??[]]),Z=A(()=>p.value.find(o=>o.id===W.value)??z.value),z=D();q(()=>E.value,async()=>{await V()}),q(()=>W.value,async()=>{await B()}),xe(async()=>{await f.loadNodeTypesIfNotLoaded(),await Promise.all([f.loadNodeTypesIfNotLoaded(),V(),t.initialize(E.value)]),await B(),await ee(),document.addEventListener("visibilitychange",P)}),he(()=>{t.reset(),document.removeEventListener("visibilitychange",P)});async function B(){if(W.value)try{z.value=await t.fetchExecution(W.value),t.activeExecution=z.value}catch(o){s.showError(o,i.baseText("nodeView.showError.openExecution.title"))}}function P(){document.visibilityState==="hidden"?t.stopAutoRefreshInterval():t.startAutoRefreshInterval(E.value)}async function ee(){m.name===b.EXECUTION_HOME&&p.value.length>0&&g.value&&await y.push({name:b.EXECUTION_PREVIEW,params:{name:g.value.id,executionId:p.value[0].id}}).catch(()=>{})}async function V(){if(n.workflow.id===Y)try{await n.fetchActiveWorkflows();const o=await n.fetchWorkflow(E.value);await R.initState(o),await S.addNodes(o.nodes,o.connections)}catch(o){s.showError(o,i.baseText("nodeView.showError.openWorkflow.title"))}g.value=n.workflow}async function te(o){o?await t.startAutoRefreshInterval(E.value):t.stopAutoRefreshInterval()}async function U(){if(E.value)try{await t.fetchExecutions({...t.executionsFilters,workflowId:E.value})}catch(o){o.errorCode===Le?s.showMessage({title:i.baseText("executionsList.showError.refreshData.title"),message:o.message,type:"error",duration:3500},!1):s.showError(o,i.baseText("executionsList.showError.refreshData.title"))}}async function oe(o){t.reset(),t.setFilters(o),await t.initialize(E.value)}async function ne(o){try{await t.stopCurrentExecution(o),s.showMessage({title:i.baseText("executionsList.showMessage.stopExecution.title"),message:i.baseText("executionsList.showMessage.stopExecution.message",{interpolate:{activeExecutionId:o}}),type:"success"}),await U()}catch(l){s.showError(l,i.baseText("executionsList.showError.stopExecution.title"))}}async function se(o){a.value=!0;try{const l=p.value.findIndex(le=>le.id===o),C=p.value[l+1]||p.value[l-1]||p.value[0];await t.deleteExecutions({ids:[o]}),g.value&&(p.value.length>0?await y.replace({name:b.EXECUTION_PREVIEW,params:{name:g.value.id,executionId:C.id}}).catch(()=>{}):await y.replace({name:b.EXECUTION_HOME,params:{name:g.value.id}}))}catch(l){a.value=!1,s.showError(l,i.baseText("executionsList.showError.handleDeleteSelected.title"));return}a.value=!1,s.showMessage({title:i.baseText("executionsList.showMessage.handleDeleteSelected.title"),type:"success"})}async function ie(o){var l;s.showMessage({title:i.baseText("executionDetails.runningMessage"),type:"info",duration:2e3}),await re(o),await U(),I.track("User clicked retry execution button",{workflow_id:(l=g.value)==null?void 0:l.id,execution_id:o.id,retry_type:o.loadWorkflow?"current":"original"})}async function re(o){try{await t.retryExecution(o.id,o.loadWorkflow)?s.showMessage({title:i.baseText("executionsList.showMessage.retrySuccessfulTrue.title"),type:"success"}):s.showMessage({title:i.baseText("executionsList.showMessage.retrySuccessfulFalse.title"),type:"error"})}catch(l){s.showError(l,i.baseText("executionsList.showError.retryExecution.title"))}}async function ae(){L.value||await T(ue,{debounceTime:1e3})}async function ue(){var l;if((l=t.executionsFilters.status)!=null&&l.includes("running")||p.value.length>=t.executionsCount)return;L.value=!0;let o;p.value.length!==0&&(o=p.value.slice(-1)[0].id);try{await t.fetchExecutions(t.executionsFilters,o)}catch(C){L.value=!1,s.showError(C,i.baseText("executionsList.showError.loadMore.title"));return}L.value=!1}return(o,l)=>g.value?(r(),k(_t,{key:0,executions:p.value,execution:Z.value,filters:we(M),workflow:g.value,loading:a.value,"loading-more":L.value,"onExecution:stop":ne,"onExecution:delete":se,"onExecution:retry":ie,"onUpdate:filters":oe,"onUpdate:autoRefresh":te,onLoadMore:ae,onReload:U},null,8,["executions","execution","filters","workflow","loading","loading-more"])):w("",!0)}});export{so as default};
//# sourceMappingURL=WorkflowExecutionsView-D7nlOP1-.js.map
