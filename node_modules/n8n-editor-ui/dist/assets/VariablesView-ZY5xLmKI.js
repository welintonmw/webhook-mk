import{aK as de,u as te,b as se,a as le,dm as ne,E as oe,x as ie,aQ as ce,e as ve,n as be,A as me,G as pe,H as fe}from"./index-1OxaEeO3.js";import{R as ye}from"./ResourcesListLayout-B4W1PSHT.js";import{G as re,e as C,r as g,b as _e,d as ge,ag as R,l as r,m as y,p as f,T as c,M as U,u as b,U as m,O as l,S as _,I as H,R as J,n as ae,D as Te,y as ke,a9 as he}from"./vendor-Dv5OeN6t.js";import{_ as ue,as as xe}from"./n8n-4UEsHtUL.js";import"./pinia-sugP77Im.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const Ce={class:"variables-key-column"},we={key:0},Ve={class:"variables-value-column"},$e={key:0},Re={class:"variables-usage-column"},Ee={key:0},Se=re({__name:"VariablesRow",props:{data:{},editing:{type:Boolean,default:!1}},emits:["save","cancel","edit","delete"],setup(ee,{emit:j}){const n=ie(),L=de(),{showMessage:W}=te(),K=se(),u=le(),E=j,S=ee,w=C(()=>ne(u.currentUser)),t=g({...S.data}),V=g({key:!1,value:!1}),i=C(()=>V.value.name&&V.value.value),T=g(),P=g(),d=g(`$vars.${S.data.name}`),X=C(()=>K.isEnterpriseFeatureEnabled(oe.Variables));_e(()=>{I()});const A=[{name:"REQUIRED"},{name:"MAX_LENGTH",config:{maximum:50}},{name:"MATCH_REGEX",config:{regex:/^[a-zA-Z]/,message:n.baseText("variables.editing.key.error.startsWithLetter")}},{name:"MATCH_REGEX",config:{regex:/^[a-zA-Z][a-zA-Z0-9_]*$/,message:n.baseText("variables.editing.key.error.jsonKey")}}],Z=[{name:"MAX_LENGTH",config:{maximum:220}}];ge(()=>t.value.name,async()=>{await ae(),V.value.name&&k()});function k(){d.value=`$vars.${t.value.name||S.data.name}`}async function p(){t.value={...S.data},E("cancel",t.value)}async function z(){E("save",t.value)}async function Q(){E("edit",t.value),await ae(),I()}async function q(){E("delete",t.value)}function O(o,s){V.value[o]=s}function G(){L.copy(d.value),W({title:n.baseText("variables.row.usage.copiedToClipboard"),type:"success"})}function I(){var o,s,$;($=(s=(o=T.value)==null?void 0:o.inputRef)==null?void 0:s.focus)==null||$.call(s)}return(o,s)=>{const $=R("n8n-form-input"),D=R("n8n-tooltip"),h=R("n8n-button");return r(),y("tr",{class:H(o.$style.variablesRow),"data-test-id":"variables-row"},[f("td",Ce,[f("div",null,[o.editing?(r(),U($,{key:1,ref_key:"keyInputRef",ref:T,modelValue:t.value.name,"onUpdate:modelValue":s[0]||(s[0]=v=>t.value.name=v),label:"",name:"name","data-test-id":"variable-row-key-input",placeholder:b(n).baseText("variables.editing.key.placeholder"),required:"","validate-on-blur":"","validation-rules":A,onValidate:s[1]||(s[1]=v=>O("name",v))},null,8,["modelValue","placeholder"])):(r(),y("span",we,c(o.data.name),1))])]),f("td",Ve,[f("div",null,[o.editing?(r(),U($,{key:1,ref_key:"valueInputRef",ref:P,modelValue:t.value.value,"onUpdate:modelValue":s[2]||(s[2]=v=>t.value.value=v),label:"",name:"value","data-test-id":"variable-row-value-input",placeholder:b(n).baseText("variables.editing.value.placeholder"),"validate-on-blur":"","validation-rules":Z,onValidate:s[3]||(s[3]=v=>O("value",v))},null,8,["modelValue","placeholder"])):(r(),y("span",$e,c(o.data.value),1))])]),f("td",Re,[f("div",null,[m(D,{placement:"top"},{content:l(()=>[_(c(b(n).baseText("variables.row.usage.copyToClipboard")),1)]),default:l(()=>[t.value.name&&d.value?(r(),y("span",{key:0,class:H(o.$style.usageSyntax),onClick:G},c(d.value),3)):J("",!0)]),_:1})])]),X.value?(r(),y("td",Ee,[o.editing?(r(),y("div",{key:0,class:H(o.$style.buttons)},[m(h,{"data-test-id":"variable-row-cancel-button",type:"tertiary",class:"mr-xs",onClick:p},{default:l(()=>[_(c(b(n).baseText("variables.row.button.cancel")),1)]),_:1}),m(h,{"data-test-id":"variable-row-save-button",disabled:!i.value,type:"primary",onClick:z},{default:l(()=>[_(c(b(n).baseText("variables.row.button.save")),1)]),_:1},8,["disabled"])],2)):(r(),y("div",{key:1,class:H([o.$style.buttons,o.$style.hoverButtons])},[m(D,{disabled:w.value.update,placement:"top"},{content:l(()=>[_(c(b(n).baseText("variables.row.button.edit.onlyRoleCanEdit")),1)]),default:l(()=>[f("div",null,[m(h,{"data-test-id":"variable-row-edit-button",type:"tertiary",class:"mr-xs",disabled:!w.value.update,onClick:Q},{default:l(()=>[_(c(b(n).baseText("variables.row.button.edit")),1)]),_:1},8,["disabled"])])]),_:1},8,["disabled"]),m(D,{disabled:w.value.delete,placement:"top"},{content:l(()=>[_(c(b(n).baseText("variables.row.button.delete.onlyRoleCanDelete")),1)]),default:l(()=>[f("div",null,[m(h,{"data-test-id":"variable-row-delete-button",type:"tertiary",disabled:!w.value.delete,onClick:q},{default:l(()=>[_(c(b(n).baseText("variables.row.button.delete")),1)]),_:1},8,["disabled"])])]),_:1},8,["disabled"])],2))])):J("",!0)],2)}}}),Ae="_variablesRow_14ir1_1",Be="_hoverButtons_14ir1_1",Me="_buttons_14ir1_10",Ue="_usageSyntax_14ir1_21",Ie={variablesRow:Ae,hoverButtons:Be,buttons:Me,usageSyntax:Ue},De={$style:Ie},Ne=ue(Se,[["__cssModules",De]]),Fe={key:0},Le={key:1},F="@tmpvar",We=re({__name:"VariablesView",setup(ee){const j=se(),n=ce(),L=le(),W=ve(),K=pe(),u=ie(),E=fe(),S=be();let w=()=>{};const t=g(null),{showError:V}=te(),i=g([]),T=g({}),P=ne(L.currentUser),d=C(()=>j.isEnterpriseFeatureEnabled(oe.Variables)),X=C(()=>i.value.map(e=>({id:e.id,name:e.key,value:e.value}))),A=C(()=>d.value&&P.create),Z=C(()=>[{id:0,path:"name",label:u.baseText("variables.table.key"),classes:["variables-key-column"]},{id:1,path:"value",label:u.baseText("variables.table.value"),classes:["variables-value-column"]},{id:2,path:"usage",label:u.baseText("variables.table.usage"),classes:["variables-usage-column"]},...d.value?[{id:3,path:"actions",label:""}]:[]]),k=C(()=>W.contextBasedTranslationKeys),p=g([]),z=(e,a,x)=>`${e.id}`.startsWith(F)?-1:`${a.id}`.startsWith(F)?1:p.value.includes(e.id)&&p.value.includes(a.id)?p.value.indexOf(e.id)-p.value.indexOf(a.id):p.value.includes(e.id)?-1:p.value.includes(a.id)?1:x==="asc"?v(e).trim().localeCompare(v(a).trim()):v(a).trim().localeCompare(v(e).trim()),Q={nameAsc:(e,a)=>z(e,a,"asc"),nameDesc:(e,a)=>z(e,a,"desc")};function q(){p.value=[]}const O=e=>({id:e.id,key:e.name,value:"value"in e?e.value:""});async function G(){d.value&&(await n.fetchAllVariables(),i.value=[...n.variables])}function I(){const e={id:xe(F),key:"",value:""};t.value&&(t.value.$refs.listWrapperRef&&(t.value.$refs.listWrapperRef.scrollTop=0),t.value.currentPage!==1&&t.value.setCurrentPage(1)),i.value.unshift(e),T.value[e.id]=!0,K.track("User clicked add variable button")}async function o(e){let a;const x=O(e);try{if(typeof e.id=="string"&&e.id.startsWith(F)){const{id:B,...Y}=x;a=await n.createVariable(Y),i.value.unshift(a),i.value=i.value.filter(N=>N.id!==e.id),p.value.unshift(a.id)}else a=await n.updateVariable(x),i.value=i.value.filter(B=>B.id!==e.id),i.value.push(a),s(a)}catch(B){V(B,u.baseText("variables.errors.save"))}}function s(e){T.value={...T.value,[e.id]:!T.value[e.id]}}function $(e){typeof e.id=="string"&&e.id.startsWith(F)?i.value=i.value.filter(a=>a.id!==e.id):s(e)}async function D(e){try{if(await E.confirm(u.baseText("variables.modals.deleteConfirm.message",{interpolate:{name:e.key}}),u.baseText("variables.modals.deleteConfirm.title"),{confirmButtonText:u.baseText("variables.modals.deleteConfirm.confirmButton"),cancelButtonText:u.baseText("variables.modals.deleteConfirm.cancelButton")})!==me)return;await n.deleteVariable(e),i.value=i.value.filter(x=>x.id!==e.id)}catch(a){V(a,u.baseText("variables.errors.delete"))}}function h(){W.goToUpgrade("variables","upgrade-variables")}function v(e){return e.name}return Te(()=>{w=S.$onAction(({name:e,after:a})=>{e==="pullWorkfolder"&&a&&a(()=>{G()})})}),ke(()=>{w()}),(e,a)=>{const x=R("n8n-heading"),B=R("n8n-button"),Y=R("n8n-tooltip"),N=R("n8n-action-box");return r(),U(ye,{ref_key:"layoutRef",ref:t,class:"variables-view","resource-key":"variables",disabled:!d.value,resources:X.value,initialize:G,shareable:!1,"display-name":v,"sort-fns":Q,"sort-options":["nameAsc","nameDesc"],"show-filters-dropdown":!1,type:"datatable","type-props":{columns:Z.value},onSort:q,"onClick:add":I},he({header:l(()=>[m(x,{size:"2xlarge",class:"mb-m"},{default:l(()=>[_(c(b(u).baseText("variables.heading")),1)]),_:1})]),"add-button":l(()=>[m(Y,{placement:"top",disabled:A.value},{content:l(()=>[d.value?(r(),y("span",Le,c(b(u).baseText("variables.add.onlyOwnerCanCreate")),1)):(r(),y("span",Fe,c(b(u).baseText(`variables.add.unavailable${i.value.length===0?".empty":""}`)),1))]),default:l(()=>[f("div",null,[m(B,{size:"large",block:"",disabled:!A.value,"data-test-id":"resources-list-add",onClick:I},{default:l(()=>[_(c(e.$locale.baseText("variables.add")),1)]),_:1},8,["disabled"])])]),_:1},8,["disabled"])]),default:l(({data:M})=>[(r(),U(Ne,{key:M.id,editing:T.value[M.id],data:M,onSave:o,onEdit:s,onCancel:$,onDelete:D},null,8,["editing","data"]))]),_:2},[d.value?void 0:{name:"preamble",fn:l(()=>[m(N,{class:"mb-m","data-test-id":"unavailable-resources-list",emoji:"ðŸ‘‹",heading:e.$locale.baseText(k.value.variables.unavailable.title),description:e.$locale.baseText(k.value.variables.unavailable.description),"button-text":e.$locale.baseText(k.value.variables.unavailable.button),"button-type":"secondary","onClick:button":h},null,8,["heading","description","button-text"])]),key:"0"},!d.value||d.value&&!A.value?{name:"empty",fn:l(()=>{var M;return[d.value?A.value?J("",!0):(r(),U(N,{key:1,"data-test-id":"cannot-create-variables",emoji:"ðŸ‘‹",heading:e.$locale.baseText("variables.empty.notAllowedToCreate.heading",{interpolate:{name:((M=b(L).currentUser)==null?void 0:M.firstName)??""}}),description:e.$locale.baseText("variables.empty.notAllowedToCreate.description"),onClick:h},null,8,["heading","description"])):(r(),U(N,{key:0,"data-test-id":"unavailable-resources-list",emoji:"ðŸ‘‹",heading:e.$locale.baseText(k.value.variables.unavailable.title),description:e.$locale.baseText(k.value.variables.unavailable.description),"button-text":e.$locale.baseText(k.value.variables.unavailable.button),"button-type":"secondary","onClick:button":h},null,8,["heading","description","button-text"]))]}),key:"1"}:void 0]),1032,["disabled","resources","type-props"])}}}),ze="_sidebarContainer_pm4w0_5",Oe={"type-input":"_type-input_pm4w0_1",sidebarContainer:ze},Ge={$style:Oe},Ta=ue(We,[["__cssModules",Ge],["__scopeId","data-v-32167291"]]);export{Ta as default};
//# sourceMappingURL=VariablesView-ZY5xLmKI.js.map
