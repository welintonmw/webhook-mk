{"version":3,"file":"SettingsSso-DA9AOKH5.js","sources":["../../src/views/SettingsSso.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport { computed, ref, onMounted } from 'vue';\nimport { useSSOStore } from '@/stores/sso.store';\nimport { useUIStore } from '@/stores/ui.store';\nimport CopyInput from '@/components/CopyInput.vue';\nimport { useI18n } from '@/composables/useI18n';\nimport { useMessage } from '@/composables/useMessage';\nimport { useToast } from '@/composables/useToast';\nimport { useTelemetry } from '@/composables/useTelemetry';\nimport { useRootStore } from '@/stores/root.store';\n\nconst IdentityProviderSettingsType = {\n\tURL: 'url',\n\tXML: 'xml',\n};\n\nconst i18n = useI18n();\nconst telemetry = useTelemetry();\nconst rootStore = useRootStore();\nconst ssoStore = useSSOStore();\nconst uiStore = useUIStore();\nconst message = useMessage();\nconst toast = useToast();\n\nconst ssoActivatedLabel = computed(() =>\n\tssoStore.isSamlLoginEnabled\n\t\t? i18n.baseText('settings.sso.activated')\n\t\t: i18n.baseText('settings.sso.deactivated'),\n);\nconst ssoSettingsSaved = ref(false);\n\nconst redirectUrl = ref();\nconst entityId = ref();\n\nconst ipsOptions = ref([\n\t{\n\t\tlabel: i18n.baseText('settings.sso.settings.ips.options.url'),\n\t\tvalue: IdentityProviderSettingsType.URL,\n\t},\n\t{\n\t\tlabel: i18n.baseText('settings.sso.settings.ips.options.xml'),\n\t\tvalue: IdentityProviderSettingsType.XML,\n\t},\n]);\nconst ipsType = ref(IdentityProviderSettingsType.URL);\n\nconst metadataUrl = ref();\nconst metadata = ref();\n\nconst isSaveEnabled = computed(() => {\n\tif (ipsType.value === IdentityProviderSettingsType.URL) {\n\t\treturn !!metadataUrl.value && metadataUrl.value !== ssoStore.samlConfig?.metadataUrl;\n\t} else if (ipsType.value === IdentityProviderSettingsType.XML) {\n\t\treturn !!metadata.value && metadata.value !== ssoStore.samlConfig?.metadata;\n\t}\n\treturn false;\n});\n\nconst isTestEnabled = computed(() => {\n\tif (ipsType.value === IdentityProviderSettingsType.URL) {\n\t\treturn !!metadataUrl.value && ssoSettingsSaved.value;\n\t} else if (ipsType.value === IdentityProviderSettingsType.XML) {\n\t\treturn !!metadata.value && ssoSettingsSaved.value;\n\t}\n\treturn false;\n});\n\nconst getSamlConfig = async () => {\n\tconst config = await ssoStore.getSamlConfig();\n\n\tentityId.value = config?.entityID;\n\tredirectUrl.value = config?.returnUrl;\n\n\tif (config?.metadataUrl) {\n\t\tipsType.value = IdentityProviderSettingsType.URL;\n\t} else if (config?.metadata) {\n\t\tipsType.value = IdentityProviderSettingsType.XML;\n\t}\n\n\tmetadata.value = config?.metadata;\n\tmetadataUrl.value = config?.metadataUrl;\n\tssoSettingsSaved.value = !!config?.metadata;\n};\n\nconst onSave = async () => {\n\ttry {\n\t\tconst config =\n\t\t\tipsType.value === IdentityProviderSettingsType.URL\n\t\t\t\t? { metadataUrl: metadataUrl.value }\n\t\t\t\t: { metadata: metadata.value };\n\t\tawait ssoStore.saveSamlConfig(config);\n\n\t\tif (!ssoStore.isSamlLoginEnabled) {\n\t\t\tconst answer = await message.confirm(\n\t\t\t\ti18n.baseText('settings.sso.settings.save.activate.message'),\n\t\t\t\ti18n.baseText('settings.sso.settings.save.activate.title'),\n\t\t\t\t{\n\t\t\t\t\tconfirmButtonText: i18n.baseText('settings.sso.settings.save.activate.test'),\n\t\t\t\t\tcancelButtonText: i18n.baseText('settings.sso.settings.save.activate.cancel'),\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (answer === 'confirm') {\n\t\t\t\tawait onTest();\n\t\t\t}\n\t\t}\n\n\t\ttelemetry.track('User updated single sign on settings', {\n\t\t\tinstance_id: rootStore.instanceId,\n\t\t\tidentity_provider: ipsType.value === 'url' ? 'metadata' : 'xml',\n\t\t\tis_active: ssoStore.isSamlLoginEnabled,\n\t\t});\n\t} catch (error) {\n\t\ttoast.showError(error, i18n.baseText('settings.sso.settings.save.error'));\n\t\treturn;\n\t} finally {\n\t\tawait getSamlConfig();\n\t}\n};\n\nconst onTest = async () => {\n\ttry {\n\t\tconst url = await ssoStore.testSamlConfig();\n\n\t\tif (typeof window !== 'undefined') {\n\t\t\twindow.open(url, '_blank');\n\t\t}\n\t} catch (error) {\n\t\ttoast.showError(error, 'error');\n\t}\n};\n\nconst goToUpgrade = () => {\n\tvoid uiStore.goToUpgrade('sso', 'upgrade-sso');\n};\n\nonMounted(async () => {\n\tif (!ssoStore.isEnterpriseSamlEnabled) {\n\t\treturn;\n\t}\n\ttry {\n\t\tawait getSamlConfig();\n\t} catch (error) {\n\t\ttoast.showError(error, 'error');\n\t}\n});\n</script>\n\n<template>\n\t<div class=\"pb-3xl\">\n\t\t<n8n-heading size=\"2xlarge\">{{ i18n.baseText('settings.sso.title') }}</n8n-heading>\n\t\t<div :class=\"$style.top\">\n\t\t\t<n8n-heading size=\"xlarge\">{{ i18n.baseText('settings.sso.subtitle') }}</n8n-heading>\n\t\t\t<n8n-tooltip\n\t\t\t\tv-if=\"ssoStore.isEnterpriseSamlEnabled\"\n\t\t\t\t:disabled=\"ssoStore.isSamlLoginEnabled || ssoSettingsSaved\"\n\t\t\t>\n\t\t\t\t<template #content>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{{ i18n.baseText('settings.sso.activation.tooltip') }}\n\t\t\t\t\t</span>\n\t\t\t\t</template>\n\t\t\t\t<el-switch\n\t\t\t\t\tv-model=\"ssoStore.isSamlLoginEnabled\"\n\t\t\t\t\t:disabled=\"!ssoSettingsSaved\"\n\t\t\t\t\t:class=\"$style.switch\"\n\t\t\t\t\t:inactive-text=\"ssoActivatedLabel\"\n\t\t\t\t/>\n\t\t\t</n8n-tooltip>\n\t\t</div>\n\t\t<n8n-info-tip>\n\t\t\t{{ i18n.baseText('settings.sso.info') }}\n\t\t\t<a href=\"https://docs.n8n.io/user-management/saml/\" target=\"_blank\">\n\t\t\t\t{{ i18n.baseText('settings.sso.info.link') }}\n\t\t\t</a>\n\t\t</n8n-info-tip>\n\t\t<div v-if=\"ssoStore.isEnterpriseSamlEnabled\" data-test-id=\"sso-content-licensed\">\n\t\t\t<div :class=\"$style.group\">\n\t\t\t\t<label>{{ i18n.baseText('settings.sso.settings.redirectUrl.label') }}</label>\n\t\t\t\t<CopyInput\n\t\t\t\t\t:value=\"redirectUrl\"\n\t\t\t\t\t:copy-button-text=\"i18n.baseText('generic.clickToCopy')\"\n\t\t\t\t\t:toast-title=\"i18n.baseText('settings.sso.settings.redirectUrl.copied')\"\n\t\t\t\t/>\n\t\t\t\t<small>{{ i18n.baseText('settings.sso.settings.redirectUrl.help') }}</small>\n\t\t\t</div>\n\t\t\t<div :class=\"$style.group\">\n\t\t\t\t<label>{{ i18n.baseText('settings.sso.settings.entityId.label') }}</label>\n\t\t\t\t<CopyInput\n\t\t\t\t\t:value=\"entityId\"\n\t\t\t\t\t:copy-button-text=\"i18n.baseText('generic.clickToCopy')\"\n\t\t\t\t\t:toast-title=\"i18n.baseText('settings.sso.settings.entityId.copied')\"\n\t\t\t\t/>\n\t\t\t\t<small>{{ i18n.baseText('settings.sso.settings.entityId.help') }}</small>\n\t\t\t</div>\n\t\t\t<div :class=\"$style.group\">\n\t\t\t\t<label>{{ i18n.baseText('settings.sso.settings.ips.label') }}</label>\n\t\t\t\t<div class=\"mt-2xs mb-s\">\n\t\t\t\t\t<n8n-radio-buttons v-model=\"ipsType\" :options=\"ipsOptions\" />\n\t\t\t\t</div>\n\t\t\t\t<div v-show=\"ipsType === IdentityProviderSettingsType.URL\">\n\t\t\t\t\t<n8n-input\n\t\t\t\t\t\tv-model=\"metadataUrl\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tname=\"metadataUrl\"\n\t\t\t\t\t\tsize=\"large\"\n\t\t\t\t\t\t:placeholder=\"i18n.baseText('settings.sso.settings.ips.url.placeholder')\"\n\t\t\t\t\t/>\n\t\t\t\t\t<small>{{ i18n.baseText('settings.sso.settings.ips.url.help') }}</small>\n\t\t\t\t</div>\n\t\t\t\t<div v-show=\"ipsType === IdentityProviderSettingsType.XML\">\n\t\t\t\t\t<n8n-input v-model=\"metadata\" type=\"textarea\" name=\"metadata\" :rows=\"4\" />\n\t\t\t\t\t<small>{{ i18n.baseText('settings.sso.settings.ips.xml.help') }}</small>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div :class=\"$style.buttons\">\n\t\t\t\t<n8n-button :disabled=\"!isSaveEnabled\" size=\"large\" data-test-id=\"sso-save\" @click=\"onSave\">\n\t\t\t\t\t{{ i18n.baseText('settings.sso.settings.save') }}\n\t\t\t\t</n8n-button>\n\t\t\t\t<n8n-button\n\t\t\t\t\t:disabled=\"!isTestEnabled\"\n\t\t\t\t\tsize=\"large\"\n\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\tdata-test-id=\"sso-test\"\n\t\t\t\t\t@click=\"onTest\"\n\t\t\t\t>\n\t\t\t\t\t{{ i18n.baseText('settings.sso.settings.test') }}\n\t\t\t\t</n8n-button>\n\t\t\t</div>\n\t\t\t<footer :class=\"$style.footer\">\n\t\t\t\t{{ i18n.baseText('settings.sso.settings.footer.hint') }}\n\t\t\t</footer>\n\t\t</div>\n\t\t<n8n-action-box\n\t\t\tv-else\n\t\t\tdata-test-id=\"sso-content-unlicensed\"\n\t\t\t:class=\"$style.actionBox\"\n\t\t\t:description=\"i18n.baseText('settings.sso.actionBox.description')\"\n\t\t\t:button-text=\"i18n.baseText('settings.sso.actionBox.buttonText')\"\n\t\t\t@click:button=\"goToUpgrade\"\n\t\t>\n\t\t\t<template #heading>\n\t\t\t\t<span>{{ i18n.baseText('settings.sso.actionBox.title') }}</span>\n\t\t\t</template>\n\t\t</n8n-action-box>\n\t</div>\n</template>\n\n<style lang=\"scss\" module>\n.top {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: var(--spacing-2xl) 0 var(--spacing-xl);\n}\n\n.switch {\n\tspan {\n\t\tfont-size: var(--font-size-2xs);\n\t\tfont-weight: var(--font-weight-bold);\n\t\tcolor: var(--color-text-light);\n\t}\n}\n\n.buttons {\n\tdisplay: flex;\n\tjustify-content: flex-start;\n\tpadding: var(--spacing-2xl) 0 var(--spacing-2xs);\n\n\tbutton {\n\t\tmargin: 0 var(--spacing-s) 0 0;\n\t}\n}\n\n.group {\n\tpadding: var(--spacing-xl) 0 0;\n\n\t> label {\n\t\tdisplay: inline-block;\n\t\tfont-size: var(--font-size-s);\n\t\tfont-weight: var(--font-weight-bold);\n\t\tpadding: 0 0 var(--spacing-2xs);\n\t}\n\n\tsmall {\n\t\tdisplay: block;\n\t\tpadding: var(--spacing-2xs) 0 0;\n\t\tfont-size: var(--font-size-2xs);\n\t\tcolor: var(--color-text-base);\n\t}\n}\n\n.actionBox {\n\tmargin: var(--spacing-2xl) 0 0;\n}\n\n.footer {\n\tcolor: var(--color-text-base);\n\tfont-size: var(--font-size-2xs);\n}\n</style>\n"],"names":["IdentityProviderSettingsType","i18n","useI18n","telemetry","useTelemetry","rootStore","useRootStore","ssoStore","useSSOStore","uiStore","useUIStore","message","useMessage","toast","useToast","ssoActivatedLabel","computed","ssoSettingsSaved","ref","redirectUrl","entityId","ipsOptions","ipsType","metadataUrl","metadata","isSaveEnabled","_a","_b","isTestEnabled","getSamlConfig","config","onSave","onTest","error","url","goToUpgrade","onMounted"],"mappings":"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"}