import{A as i}from"./AuthView-B_jZMnGj.js";import{u as n,a as l,M as p,V as o}from"./index-1OxaEeO3.js";import{m as u}from"./pinia-sugP77Im.js";import{G as h,ag as m,l as d,M as c,R as w}from"./vendor-Dv5OeN6t.js";import{_ as f}from"./n8n-4UEsHtUL.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./lodash-es-CZ1inz46.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const g=h({name:"ChangePasswordView",components:{AuthView:i},setup(){return{...n()}},data(){return{password:"",loading:!1,config:null}},computed:{...u(l)},async mounted(){const e={title:this.$locale.baseText("auth.changePassword"),buttonText:this.$locale.baseText("auth.changePassword"),redirectText:this.$locale.baseText("auth.signin"),redirectLink:"/signin",inputs:[{name:"password",properties:{label:this.$locale.baseText("auth.newPassword"),type:"password",required:!0,validationRules:[{name:"DEFAULT_PASSWORD_RULES"}],infoText:this.$locale.baseText("auth.defaultPasswordRequirements"),autocomplete:"new-password",capitalize:!0}},{name:"password2",properties:{label:this.$locale.baseText("auth.changePassword.reenterNewPassword"),type:"password",required:!0,validators:{TWO_PASSWORDS_MATCH:{validate:this.passwordsMatch}},validationRules:[{name:"TWO_PASSWORDS_MATCH"}],autocomplete:"new-password",capitalize:!0}}]},t=this.getResetToken();this.getMfaEnabled()&&e.inputs.push({name:"mfaToken",initialValue:"",properties:{required:!0,label:this.$locale.baseText("mfa.code.input.label"),placeholder:this.$locale.baseText("mfa.code.input.placeholder"),maxlength:p,capitalize:!0,validateOnBlur:!0}}),this.config=e;try{if(!t)throw new Error(this.$locale.baseText("auth.changePassword.missingTokenError"));await this.usersStore.validatePasswordToken({token:t})}catch(s){this.showError(s,this.$locale.baseText("auth.changePassword.tokenValidationError")),this.$router.replace({name:o.SIGNIN})}},methods:{passwordsMatch(e){return typeof e!="string"?!1:e!==this.password?{messageKey:"auth.changePassword.passwordsMustMatchError"}:!1},onInput(e){e.name==="password"&&(this.password=e.value)},getResetToken(){return!this.$route.query.token||typeof this.$route.query.token!="string"?null:this.$route.query.token},getMfaEnabled(){return this.$route.query.mfaEnabled?this.$route.query.mfaEnabled==="true":null},async onSubmit(e){try{this.loading=!0;const t=this.getResetToken();if(t){const a={token:t,password:this.password,...e.mfaToken&&{mfaToken:e.mfaToken}};await this.usersStore.changePassword(a),this.showMessage({type:"success",title:this.$locale.baseText("auth.changePassword.passwordUpdated"),message:this.$locale.baseText("auth.changePassword.passwordUpdatedMessage")}),await this.$router.push({name:o.SIGNIN})}else this.showError(new Error(this.$locale.baseText("auth.validation.missingParameters")),this.$locale.baseText("auth.changePassword.error"))}catch(t){this.showError(t,this.$locale.baseText("auth.changePassword.error"))}this.loading=!1}}});function T(e,t,a,s,b,$){const r=m("AuthView");return e.config?(d(),c(r,{key:0,form:e.config,"form-loading":e.loading,onSubmit:e.onSubmit,onUpdate:e.onInput},null,8,["form","form-loading","onSubmit","onUpdate"])):w("",!0)}const Q=f(g,[["render",T]]);export{Q as default};
//# sourceMappingURL=ChangePasswordView-BDsuHv0B.js.map
