import{N as _,aA as Y,aB as Z,_ as F,aC as ee}from"./n8n-4UEsHtUL.js";import{aK as te,u as ne,x as oe,a4 as q,j as G,ao as Q}from"./index-1OxaEeO3.js";import{G as W,af as se,r as E,b as ae,ag as B,l as y,m as g,p as w,I as p,U as v,T as h,u as U,M as H,a2 as re,R as j,F as L,a7 as K,e as O,O as R,S as x,d as ie,J as le}from"./vendor-Dv5OeN6t.js";import{D as ue}from"./lodash-es-CZ1inz46.js";import"./axios-Mm4CS0gO.js";import"./esprima-next-nhoSXAeq.js";import"./luxon-CLwAIbs0.js";import"./pinia-sugP77Im.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-BBHtM40w.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-CIxnBJXX.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./@n8n/codemirror-lang-sql-DBO6T13I.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-CWDO6_kP.js";import"./@n8n/codemirror-lang-Dl0FW_KM.js";import"./fast-json-stable-stringify-BOfzoJX1.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const z=n=>({type:"json",data:n,parsed:!1}),X={[_.AiLanguageModel](n){const o=n.response??n;if(!o)throw new Error("No response from Language Model");return Array.isArray(o==null?void 0:o.messages)&&(o==null?void 0:o.messages.length)===1&&typeof(o==null?void 0:o.messages[0])=="string"?{type:"text",data:o.messages[0],parsed:!0}:o.messages&&Array.isArray(o.messages)?X[_.AiMemory](n):o.generations?{type:"json",data:o.generations.map(a=>a!=null&&a.text?a.text:Array.isArray(a)?a.map(M=>M.text??M).join(`

`).trim():a),parsed:!0}:{type:"json",data:o,parsed:!0}},[_.AiTool]:z,[_.AiAgent]:z,[_.AiMemory](n){var b;const o=n.chatHistory??n.messages??((b=n==null?void 0:n.response)==null?void 0:b.chat_history);return Array.isArray(o)?{type:"markdown",data:o.map(a=>{var M;if(a.type==="constructor"&&((M=a.id)!=null&&M.includes("messages"))&&a.kwargs){let s=a.kwargs.content;return Array.isArray(s)&&(s=s.map(D=>{const{type:S,image_url:f}=D;return S==="image_url"&&typeof f=="object"&&typeof f.url=="string"?`![Input image](${f.url})`:typeof f=="string"?`![Input image](${f})`:D.text}).join(`
`)),Object.keys(a.kwargs.additional_kwargs).length&&(s+=` (${JSON.stringify(a.kwargs.additional_kwargs)})`),a.id.includes("HumanMessage")?s=`**Human:** ${String(s).trim()}`:a.id.includes("AIMessage")?s=`**AI:** ${s}`:a.id.includes("SystemMessage")&&(s=`**System Message:** ${s}`),n.action&&typeof n.action!="object"&&n.action!=="getMessages"&&(s=`## Action: ${n.action}

${s}`),s}return""}).join(`

`),parsed:!0}:z(n)},[_.AiOutputParser]:z,[_.AiRetriever]:z,[_.AiVectorStore](n){return n.documents?{type:"json",data:n.documents,parsed:!0}:z(n)},[_.AiEmbedding](n){return n.documents?{type:"json",data:n.documents,parsed:!0}:z(n)},[_.AiDocument](n){return n.documents?{type:"json",data:n.documents,parsed:!0}:z(n)},[_.AiTextSplitter](n){return{type:"text",data:(Array.isArray(n.response)?n.response:[n.textSplitter]).join(`

`),parsed:!0}}},ce=()=>({parseAiRunData:(o,b)=>{if([_.AiChain,_.Main].includes(b))return o.map(s=>({raw:s.json,parsedContent:null}));const N=o.map(s=>!Y(s.binary)?s.binary:s.json),a=X[b];return a?N.filter(s=>s!==void 0).map(s=>({raw:s,parsedContent:a(s)})):[{raw:N.filter(s=>s!==void 0),parsedContent:null}]}});var J=W({name:"VueMarkdown",props:{source:{type:String,required:!0},options:{type:Object,required:!1}},data:function(){return{md:null}},computed:{content:function(){var n,o=this.source;return(n=this.md)===null||n===void 0?void 0:n.render(o)}},created:function(){var n;this.md=new Z((n=this.options)!==null&&n!==void 0?n:{})},render:function(){return se("div",{innerHTML:this.content})}});const de=["data-content-type"],pe=["textContent"],me=W({__name:"AiRunContentBlock",props:{runData:{}},setup(n){const o=n,b=oe(),N=te(),{showMessage:a}=ne(),M=ce(),s=E(r()),D=E(!1),S=E(!1),f=E(void 0);function r(){return!{input:[_.AiDocument,_.AiTextSplitter],output:[_.AiDocument,_.AiEmbedding,_.AiTextSplitter,_.AiVectorStore]}[o.runData.inOut].includes(o.runData.type)}function T(e){return e.data?M.parseAiRunData(e.data,e.type):void 0}function $(e){return typeof e!="string"?!1:[/^# .+/gm,/\*{1,2}.+\*{1,2}/g,/\[.+\]\(.+\)/g,/```[\s\S]+```/g].some(u=>u.test(e))}function k(e){return"```json\n"+e+"\n```"}function A(e){return $(e)?e:Array.isArray(e)&&e.length&&typeof e[0]!="number"?e.map(u=>A(u)).join(`

`).trim():k(typeof e=="string"?e:JSON.stringify(e,null,2))}function t(e){S.value=!!e.find(i=>{var u;return((u=i.parsedContent)==null?void 0:u.parsed)===!0})}function c(){s.value=!s.value}function m(e){try{N.copy(JSON.stringify(e,void 0,2)),a({title:b.baseText("generic.copiedToClipboard"),type:"success"})}catch{}}return ae(()=>{f.value=T(o.runData),f.value&&t(f.value)}),(e,i)=>{const u=B("font-awesome-icon"),l=B("el-switch"),C=B("n8n-icon-button");return y(),g("div",{class:p(e.$style.block)},[w("header",{class:p(e.$style.blockHeader),onClick:c},[w("button",{class:p(e.$style.blockToggle)},[v(u,{icon:s.value?"angle-down":"angle-up",size:"lg"},null,8,["icon"])],2),w("p",{class:p(e.$style.blockTitle)},h(U(ue)(e.runData.inOut)),3),S.value?(y(),H(l,{key:0,modelValue:D.value,"onUpdate:modelValue":i[0]||(i[0]=d=>D.value=d),class:p(e.$style.rawSwitch),"active-text":"RAW JSON",onClick:i[1]||(i[1]=re(()=>{},["stop"]))},null,8,["modelValue","class"])):j("",!0)],2),w("main",{class:p({[e.$style.blockContent]:!0,[e.$style.blockContentExpanded]:s.value})},[(y(!0),g(L,null,K(f.value,({parsedContent:d,raw:I},V)=>(y(),g("div",{key:V,class:p(e.$style.contentText),"data-content-type":d==null?void 0:d.type},[d&&!D.value?(y(),g(L,{key:0},[d.type==="json"?(y(),H(U(J),{key:0,source:A(d.data),class:p(e.$style.markdown)},null,8,["source","class"])):j("",!0),d.type==="markdown"?(y(),H(U(J),{key:1,source:d.data,class:p(e.$style.markdown)},null,8,["source","class"])):j("",!0),d.type==="text"?(y(),g("p",{key:2,class:p(e.$style.runText),textContent:h(d.data)},null,10,pe)):j("",!0)],64)):(y(),g("div",{key:1,class:p(e.$style.rawContent)},[v(C,{size:"small",class:p(e.$style.copyToClipboard),type:"secondary",title:e.$locale.baseText("nodeErrorView.copyToClipboard"),icon:"copy",onClick:P=>m(I)},null,8,["class","title","onClick"]),v(U(J),{source:A(I),class:p(e.$style.markdown)},null,8,["source","class"])],2))],10,de))),128))],2)],2)}}}),ye="_copyToClipboard_1bt7e_1",fe="_rawContent_1bt7e_7",_e="_markdown_1bt7e_11",ke="_contentText_1bt7e_35",ge="_block_1bt7e_40",Te="_blockContent_1bt7e_48",be="_blockContentExpanded_1bt7e_52",he="_runText_1bt7e_56",ve="_rawSwitch_1bt7e_61",we="_blockHeader_1bt7e_68",$e="_blockTitle_1bt7e_80",Ae="_blockToggle_1bt7e_85",Ce={copyToClipboard:ye,rawContent:fe,markdown:_e,contentText:ke,block:ge,blockContent:Te,blockContentExpanded:be,runText:he,rawSwitch:ve,blockHeader:we,blockTitle:$e,blockToggle:Ae},Me={$style:Ce},Se=F(me,[["__cssModules",Me]]),Ie={key:0},je={key:1},De=w("br",null,null,-1),Ne=W({__name:"RunDataAiContent",props:{inputData:{},contentIndex:{}},setup(n){const o=n,b=q(),N=G(),a=O(()=>{var T,$;return($=(T=S.value)==null?void 0:T.data)==null?void 0:$.reduce((k,A)=>{var c,m;const t=((c=A.json)==null?void 0:c.tokenUsage)??((m=A.json)==null?void 0:m.tokenUsageEstimate);return t?{completionTokens:k.completionTokens+t.completionTokens,promptTokens:k.promptTokens+t.promptTokens,totalTokens:k.totalTokens+t.totalTokens}:k},{completionTokens:0,promptTokens:0,totalTokens:0})}),M=O(()=>{var r,T;return(T=(r=S.value)==null?void 0:r.data)==null?void 0:T.some($=>{var k;return(k=$.json)==null?void 0:k.tokenUsageEstimate})});function s(r){return M.value?`~${r}`:r.toString()}function D(r){const T=N.getNodeByName(o.inputData.node),$=b.getNodeType((T==null?void 0:T.type)??"");return{startTimeMs:r.metadata.startTime,executionTimeMs:r.metadata.executionTime,node:$,type:r.inOut,connectionType:r.type}}const S=O(()=>o.inputData.data.find(r=>r.inOut==="output")),f=O(()=>{if(S.value!==void 0)return D(S.value)});return(r,T)=>{var t,c,m,e,i,u;const $=B("n8n-tooltip"),k=B("n8n-text"),A=B("n8n-info-tip");return y(),g("div",{class:p(r.$style.container)},[w("header",{class:p(r.$style.header)},[(t=f.value)!=null&&t.node?(y(),H(Q,{key:0,class:p(r.$style.nodeIcon),"node-type":f.value.node,size:20},null,8,["class","node-type"])):j("",!0),w("div",{class:p(r.$style.headerWrap)},[w("p",{class:p(r.$style.title)},h(r.inputData.node),3),w("ul",{class:p(r.$style.meta)},[(c=f.value)!=null&&c.startTimeMs?(y(),g("li",Ie,h((m=f.value)==null?void 0:m.executionTimeMs)+"ms",1)):j("",!0),(e=f.value)!=null&&e.startTimeMs?(y(),g("li",je,[v($,null,{content:R(()=>{var l;return[x(h(new Date((l=f.value)==null?void 0:l.startTimeMs).toLocaleString()),1)]}),default:R(()=>{var l;return[x(" "+h(r.$locale.baseText("runData.aiContentBlock.startedAt",{interpolate:{startTime:new Date((l=f.value)==null?void 0:l.startTimeMs).toLocaleTimeString()}})),1)]}),_:1})])):j("",!0),(((i=a.value)==null?void 0:i.totalTokens)??0)>0?(y(),g("li",{key:2,class:p(r.$style.tokensUsage)},[x(h(r.$locale.baseText("runData.aiContentBlock.tokens",{interpolate:{count:s(((u=a.value)==null?void 0:u.totalTokens)??0)}}))+" ",1),v(A,{type:"tooltip",theme:"info-light","tooltip-placement":"right"},{default:R(()=>[w("div",null,[v(k,{bold:!0,size:"small"},{default:R(()=>{var l;return[x(h(r.$locale.baseText("runData.aiContentBlock.tokens.prompt"))+" "+h(r.$locale.baseText("runData.aiContentBlock.tokens",{interpolate:{count:s(((l=a.value)==null?void 0:l.promptTokens)??0)}})),1)]}),_:1}),De,v(k,{bold:!0,size:"small"},{default:R(()=>{var l;return[x(h(r.$locale.baseText("runData.aiContentBlock.tokens.completion"))+" "+h(r.$locale.baseText("runData.aiContentBlock.tokens",{interpolate:{count:s(((l=a.value)==null?void 0:l.completionTokens)??0)}})),1)]}),_:1})])]),_:1})],2)):j("",!0)],2)],2)],2),(y(!0),g(L,null,K(o.inputData.data,(l,C)=>(y(),g("main",{key:C,class:p(r.$style.content)},[v(Se,{"run-data":l},null,8,["run-data"])],2))),128))],2)}}}),Re="_container_dypaw_2",Be="_nodeIcon_dypaw_5",ze="_header_dypaw_8",xe="_headerWrap_dypaw_14",Oe="_title_dypaw_18",Ee="_meta_dypaw_25",Ue="_tokensUsage_dypaw_41",Ve={container:Re,nodeIcon:Be,header:ze,headerWrap:xe,title:Oe,meta:Ee,tokensUsage:Ue},He={$style:Ve},Le=F(Ne,[["__cssModules",He]]),We=["data-tree-depth"],Pe=["onClick"],Je=["textContent"],Fe=W({__name:"RunDataAi",props:{node:{},runIndex:{default:0},hideTitle:{type:Boolean},slim:{type:Boolean}},setup(n){const o=n,b=G(),N=q(),a=E([]);function M(t){return a.value.some(c=>c.node===t.node&&c.runIndex===t.runIndex)}function s(t,c,m){const e=b.getWorkflowResultDataByNodeName(t.node);if(!(e!=null&&e[t.runIndex]))return[];const i=e[t.runIndex];if(!i)return[];const u=[];function l(C,d){C&&Object.keys(C).map(I=>{u.push({data:C[I][0],inOut:d,type:I,metadata:{executionTime:i.executionTime,startTime:i.startTime}})})}return c&&l(i.inputOverride,"input"),l(i.data,"output"),u}function D(t){t.expanded=!t.expanded}function S(t){var m;if(!((m=k.value)==null?void 0:m.find(e=>e.node===t.node&&e.runIndex===t.runIndex))){a.value=[];return}a.value=[{node:t.node,runIndex:t.runIndex,data:s({node:t.node,runIndex:t.runIndex},!0)}]}function f(t){const c=b.getNodeByName(t);return c?N.getNodeType(c==null?void 0:c.type):null}function r(){A.value.length&&A.value[0].children.length&&S(A.value[0].children[0])}const T=(t,c,m,e=[])=>{var i,u;return{node:t,id:t,depth:c,startTime:((u=(i=m==null?void 0:m.data)==null?void 0:i.metadata)==null?void 0:u.startTime)??0,runIndex:(m==null?void 0:m.runIndex)??0,children:e}};function $(t,c){var C;const{connectionsByDestinationNode:m}=b.getCurrentWorkflow(),e=m[t],i=((C=k.value)==null?void 0:C.filter(d=>d.node===t))??[];if(!e)return i.map(d=>T(t,c,d));const l=Object.keys(e).filter(d=>d!==_.Main).flatMap(d=>e[d][0].flatMap(I=>$(I.node,c+1)));return i.length?i.map(d=>T(t,c,d,l)):(l.sort((d,I)=>d.startTime-I.startTime),[T(t,c,void 0,l)])}const k=O(()=>{var e;const t=b.getWorkflowResultDataByNodeName(o.node.name);if(!t||!Array.isArray(t))return;const c=(e=t[o.runIndex].metadata)==null?void 0:e.subRun;if(!Array.isArray(c))return;const m=c.flatMap(i=>s(i,!1).map(u=>({...i,data:u})));return m.sort((i,u)=>{var d,I,V,P;const l=((I=(d=i.data)==null?void 0:d.metadata)==null?void 0:I.startTime)||0,C=((P=(V=u.data)==null?void 0:V.metadata)==null?void 0:P.startTime)||0;return l-C}),m}),A=O(()=>{const t=o.node;return $(t.name,0)||[]});return ie(()=>o.runIndex,r,{immediate:!0}),(t,c)=>{const m=B("font-awesome-icon"),e=B("n8n-tooltip"),i=B("n8n-text");return k.value?(y(),g("div",{key:0,class:p(t.$style.container)},[w("div",{class:p({[t.$style.tree]:!0,[t.$style.slim]:t.slim})},[v(U(ee),{data:A.value,props:{label:"node"},"default-expand-all":"",indent:12,"expand-on-click-node":!1,"data-test-id":"lm-chat-logs-tree",onNodeClick:S},{default:R(({node:u,data:l})=>[w("div",{class:p({[t.$style.treeNode]:!0,[t.$style.isSelected]:M(l)}),"data-tree-depth":l.depth,style:le({"--item-depth":l.depth})},[l.children.length?(y(),g("button",{key:0,class:p(t.$style.treeToggle),onClick:C=>D(u)},[v(m,{icon:u.expanded?"angle-down":"angle-up"},null,8,["icon"])],10,Pe)):j("",!0),v(e,{disabled:!t.slim,placement:"right"},{content:R(()=>[x(h(u.label),1)]),default:R(()=>[w("span",{class:p(t.$style.leafLabel)},[v(Q,{"node-type":f(l.node),size:17},null,8,["node-type"]),t.slim?j("",!0):(y(),g("span",{key:0,textContent:h(u.label)},null,8,Je))],2)]),_:2},1032,["disabled"])],14,We)]),_:1},8,["data"])],2),w("div",{class:p(t.$style.runData)},[a.value.length===0?(y(),g("div",{key:0,class:p(t.$style.empty)},[v(i,{size:"large"},{default:R(()=>[x(h(t.$locale.baseText("ndv.output.ai.empty",{interpolate:{node:o.node.name}})),1)]),_:1})],2)):j("",!0),(y(!0),g(L,null,K(a.value,(u,l)=>(y(),g("div",{key:`${u.node}__${u.runIndex}__index`,"data-test-id":"lm-chat-logs-entry"},[v(Le,{"input-data":u,"content-index":l},null,8,["input-data","content-index"])]))),128))],2)],2)):j("",!0)}}}),Ke="_treeToggle_z0rh6_1",qe="_leafLabel_z0rh6_9",Ge="_empty_z0rh6_15",Qe="_title_z0rh6_19",Xe="_tree_z0rh6_1",Ye="_slim_z0rh6_32",Ze="_runData_z0rh6_36",et="_container_z0rh6_42",tt="_isSelected_z0rh6_69",nt="_treeNode_z0rh6_73",ot={treeToggle:Ke,leafLabel:qe,empty:Ge,title:Qe,tree:Xe,slim:Ye,runData:Ze,container:et,isSelected:tt,treeNode:nt},st={$style:ot},Bt=F(Fe,[["__cssModules",st]]);export{Bt as default};
//# sourceMappingURL=RunDataAi-C3XiqNZa.js.map
